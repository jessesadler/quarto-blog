<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2018-03-28">
<meta name="description" content="Creating great circles in R with the sp and sf packages">

<title>A Rogue Historian - Great Circles with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<!-- plausible -->
<script defer="" data-domain="jessesadler.com" src="https://plausible.io/js/script.js"></script>
<script src="../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="../../site_libs/jquery-1.12.4/jquery.min.js"></script>
<link href="../../site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="../../site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="../../site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="../../site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="../../site_libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="../../site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="../../site_libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>
<link href="../../site_libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="../../site_libs/HomeButton-0.0.1/home-button.js"></script>
<script src="../../site_libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="../../site_libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="../../site_libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="../../site_libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">


</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jesse Sadler</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../project.html">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../course.html">
 <span class="menu-text">Courses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../slides.html">
 <span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jessesadler"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://hachyderm.io/@vivalosburros"><i class="bi bi-mastodon" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/vivalosburros"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#great-circles-with-r" id="toc-great-circles-with-r" class="nav-link active" data-scroll-target="#great-circles-with-r">Great circles with R</a></li>
  <li><a href="#preparing-the-data" id="toc-preparing-the-data" class="nav-link" data-scroll-target="#preparing-the-data">Preparing the data</a></li>
  <li><a href="#great-circles-with-geosphere-and-sp" id="toc-great-circles-with-geosphere-and-sp" class="nav-link" data-scroll-target="#great-circles-with-geosphere-and-sp">Great circles with <code>geosphere</code> and <code>sp</code></a></li>
  <li><a href="#great-circles-with-sf" id="toc-great-circles-with-sf" class="nav-link" data-scroll-target="#great-circles-with-sf">Great circles with <code>sf</code></a>
  <ul class="collapse">
  <li><a href="#great-circles-with-sf-tidy-method" id="toc-great-circles-with-sf-tidy-method" class="nav-link" data-scroll-target="#great-circles-with-sf-tidy-method">Great circles with <code>sf</code>: tidy method</a></li>
  <li><a href="#great-circles-with-sf-for-loop-method" id="toc-great-circles-with-sf-for-loop-method" class="nav-link" data-scroll-target="#great-circles-with-sf-for-loop-method">Great circles with <code>sf</code>: for loop method</a></li>
  </ul></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Great Circles with R</h1>
<p class="subtitle lead">Three methods with sp and sf</p>
  <div class="quarto-categories">
    <div class="quarto-category">rstats</div>
    <div class="quarto-category">rspatial</div>
  </div>
  </div>

<div>
  <div class="description">
    Creating great circles in R with the sp and sf packages
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">28 March 2018</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>In 1569 the Flemish cartographer and mathematician <a href="https://en.wikipedia.org/wiki/Gerardus_Mercator">Gerardus Mercator</a> published a new world map under the title “New and more complete representation of the terrestrial globe properly adapted for use in navigation.” The title of the map points to Mercator’s main claim for its usefulness, which he expounded upon in the map’s legends. Mercator presented his map as not only an accurate representation of the known world, but also as a particularly useful map for the purposes of navigation. As described in the <a href="https://en.wikipedia.org/wiki/Mercator_1569_world_map#legend3">third legend</a>, Mercator aimed to maintain conformity to the shape of land masses even towards the poles and to have straight lines on the map accurately represent directionality. To achieve his goals Mercator used a <a href="https://www.vox.com/world/2016/12/2/13817712/map-projection-mercator-globe">projection</a> in which lines of longitude and latitude were made perpendicular at all values by increasing the distance between degrees of latitude as they reach the pole.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Mercator’s projection had the benefit that straight lines drawn on the map are rhumb lines, lines of constant bearing that pass every degree of longitude at the same angle. Theoretically this simplified oceanic navigation; a ship captain could draw a straight line from one port to another, calculate the bearing, and maintain that bearing along the voyage. However, 16th-century navigators used magnetic courses and not longitude and latitude values as Mercator’s map assumed.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> An <a href="https://en.wikipedia.org/wiki/History_of_longitude#Problem_of_longitude">accurate means to measure longitude</a> at sea was only discovered in the second half of the 18th century with the development of the sextant and later the marine chronometer.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div id="fig-mercator" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/Mercator-1569.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: World Map by Gerardus Mercator, 1569</figcaption><p></p>
</figure>
</div>
<p>The Mercator projection was designed with certain uses in mind. Mercator’s emphasis on perpendicular lines of longitude and latitude and the equivalence of straight lines and rhumb lines were meant to simplify navigation and have recently proved useful for <a href="https://en.wikipedia.org/wiki/Web_Mercator">online mapping services</a>. However, the stretching of latitudes towards the poles <a href="https://www.youtube.com/watch?v=OH1bZ0F3zVU">distorts the size of land masses</a>, making those closer to the poles appear larger than those near the equator. The stress on rhumb lines in Mercator’s map also highlights the difference between lines of constant bearing (<a href="https://en.wikipedia.org/wiki/Rhumb_line">rhumb or loxodrome lines</a>) and the shortest distance between two points (<a href="https://en.wikipedia.org/wiki/Great-circle_distance">great circles</a>). Due to Earth’s ellipsoidal nature, the shortest distance between two points is not necessarily a straight line. For instance, to fly from Los Angeles to Amsterdam, one would not want to fly in a straight line of constant bearing at 78 degrees. Instead, you would want to make an arc to the north to take advantage of the ellipsoidal shape of the Earth. By flying along the great circle from Los Angeles to Amsterdam one would travel 1120 kilometers less than flying along the rhumb line.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/great-circle-rhumb-line-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="great-circles-with-r" class="level2">
<h2 class="anchored" data-anchor-id="great-circles-with-r">Great circles with R</h2>
<p>In <a href="https://jessesadler.com/post/geocoding-with-r/">Geocoding with R</a> and <a href="https://jessesadler.com/post/gis-with-r-intro/">Introduction to GIS with R</a> I demonstrated different ways to make maps that showed the sources and destinations of letters sent to the sixteenth-century merchant Daniel van der Meulen in 1585. This post will show how to create great circle lines to connect the sources and destinations of the letters. There are a number of resources on making great circles with R, and each resource uses slightly different methods.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> The diversity of methods to get the same or similar result is both one of the more interesting and one of the more frustrating parts of coding. Here, I will show how to create great circles as a <code>SpatialLinesDataFrame</code> from the <a href="https://cran.r-project.org/web/packages/sp/"><code>sp</code></a> package, as well as two different methods using the <a href="https://cran.r-project.org/web/packages/sf/"><code>sf</code></a> package. The results of the three methods will be very similar, and the ability to convert between objects used by the <code>sp</code> and <code>sf</code> packages means that they can be used interchangeably. However, showing multiple methods will help to explicate the process of creating lines from longitude and latitude data and turning them into great circles. You can find the data and the R script that goes along with this post on <a href="https://github.com/jessesadler/intro-to-r">GitHub</a>.</p>
<p><code>sp</code> and <code>sf</code> both depend upon external packages to calculate the shortest distance between two points of longitude and latitude data. Creating a <code>SpatialLinesDataFrame</code> of great circles is done through the <a href="https://cran.r-project.org/web/packages/geosphere/index.html"><code>geosphere</code></a> package, while the calculations for <code>sf</code> objects depend upon the <a href="https://cran.r-project.org/web/packages/lwgeom/index.html"><code>lwgeom</code></a> package.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> Despite the different sources for the calculations, the results produced by <code>geosphere</code> and <code>lwgeom</code> are all but equivalent. Internally, both the <code>gcIntermediate()</code> function from <code>geosphere</code> and <code>st_segmentize()</code> function from <code>sf</code> use a spherical model of the Earth to calculate great circles. Therefore, the path drawn by the two functions are not as exact as the distance calculations from the two packages, which use more accurate ellipsoidal models of the Earth. The primary difference between <code>gcIntermediate()</code> and <code>st_segmentize()</code> is not the internal calculations, but how they are implemented in R. Both functions work by breaking a straight line with two points into a segmented line, with the number of breaks defined by the user. <code>gcIntermediate()</code> calculates segments based on a specified number of breaks. On the other hand, <code>st_segmentize()</code> uses a maximum distance argument to calculate the number of segments. This means that whereas <code>gcIntermediate()</code> results in the same number of points along the great circle for each line irrespective of distance, <code>st_segmentize()</code> creates segments of relatively equal distance but with the amount of segments in a line varying by distance.</p>
<p>Let’s start by loading the packages and data that we will use to make the great circles. To wrangle the data into the correct formats I will use the <a href="http://tidyverse.org"><code>tidyverse</code></a>. We need to load the <code>sp</code> and <code>geosphere</code> packages to make a <code>SpatialLinesDataFrame</code> of great circles and the <code>sf</code> package for the latter two methods. Internally, <code>st_segmentize()</code> uses the <code>lwgeom</code> package, but we will not use the package directly, and so while it is necessary to have <code>lwgeom</code> installed, we do not need to load it. Lastly, I will use the <code>rnaturalearth</code> package to provide some background maps. The data that I will be using is again the letters sent to Daniel van der Meulen in 1585 along with the latitude and longitude values of the cities within his correspondence network at this time. We can also load the countries map from <code>rnaturalearth</code> as both a <code>Spatial</code> and <code>sf</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geosphere)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>letters <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/correspondence-data-1585.csv"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/locations.csv"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the background maps</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>countries_sp <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>countries_sf <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preparing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-data">Preparing the data</h2>
<p>The basis for all three methods of creating great circles is a data frame of routes — a data frame with a single row for each unique connection between a source and a destination — which we can then join to the longitude and latitude values in the <code>locations</code> data frame. The <code>letters</code> data contains 114 rows with each row containing a letter. We can calculate the number of letters sent along each unique route with a <code>group_by()</code> and <code>count()</code> pipeline in which we group the letters that have the same source and destination. We then want to <code>ungroup()</code> the data frame to prevent the group attribute from interfering with any code further down the line. The final step is to arrange the rows by the count column, which has been named “n” by <code>count()</code>. This ensures that the routes with more letters sent across them will be drawn later in the plot, making them more visible in the maps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame of routes and count for letters per route</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>routes <span class="ot">&lt;-</span> letters <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source, destination) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(n)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print routes</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>routes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 3
   source    destination     n
   &lt;chr&gt;     &lt;chr&gt;       &lt;int&gt;
 1 Amsterdam Bremen          1
 2 Antwerp   Middelburg      1
 3 Dordrecht Haarlem         1
 4 Emden     Bremen          1
 5 Haarlem   Middelburg      1
 6 Haarlem   The Hague       1
 7 Hamburg   Bremen          1
 8 Het Vlie  Bremen          1
 9 Lisse     Delft           1
10 Antwerp   The Hague       2
11 Haarlem   Bremen          2
12 Venice    Haarlem         2
13 Antwerp   Haarlem         5
14 Haarlem   Delft          26
15 Antwerp   Delft          68</code></pre>
</div>
</div>
<p>The <code>routes</code> data shows that there are 15 unique source to destination combinations within the <code>letters</code> data. A glimpse at <code>routes</code> shows that the majority of letters that Daniel received in 1585 — 68 letters — were sent from Antwerp to Delft, while a sizable number of letters were sent from Haarlem to Delft.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> Daniel received letters along other routes much less frequently. With the routes identified, and already possessing the longitude and latitude of the end points for the routes in the <code>locations</code> data frame, we can now move on to creating the great circles between these sets of points.</p>
</section>
<section id="great-circles-with-geosphere-and-sp" class="level2">
<h2 class="anchored" data-anchor-id="great-circles-with-geosphere-and-sp">Great circles with <code>geosphere</code> and <code>sp</code></h2>
<p>Let’s start by creating great circles as a <code>SpatialLinesDataFrame</code> from the <code>sp</code> package. Before the recent growth of the <code>sf</code> package, the <code>gcIntermediate()</code> function from the <code>geosphere</code> package represented the main method for creating great circles. I have tried to simplify the process, making it possible to create a <code>SpatialLinesDataFrame</code> in four steps.</p>
<p>The <code>gcIntermediate()</code> function provides one of the easiest methods for transforming coordinates data into spatial lines. A single step creates a <code>SpatialLines</code> object and calculates the great circle. As we will see below, the <code>sf</code> methods split these into two steps. The <code>gcIntermediate()</code> function takes two sets of longitude and latitude coordinates, one for the beginning point of the line and one for the end point. The coordinates can be supplied in the form of either a data frame or a matrix. Here, I will supply the coordinates in a data frame, since our longitude and latitude values are already in this format. We can identify the longitude and latitude values for the sources of the routes by joining <code>locations</code> to <code>routes</code> by the “source” column. Since we only want the longitude and latitude values for the <code>gcIntermediate()</code> function, we <code>select()</code> the “lon” and “lat” columns — the names of the columns that contain longitude and latitude values — creating a <code>sources_tbl</code> with two columns and the same amount of rows as the <code>routes</code> data. Joining <code>locations</code> to <code>routes</code> by “destination” creates an equivalent <code>destinations_tbl</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble of longitude and latitude values of sources</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sources_tbl <span class="ot">&lt;-</span> routes <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(locations, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"source"</span> <span class="ot">=</span> <span class="st">"place"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(lon, lat)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble of longitude and latitude values of destinations</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>destinations_tbl <span class="ot">&lt;-</span> routes <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(locations, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"destination"</span> <span class="ot">=</span> <span class="st">"place"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(lon, lat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The next step is to decide on the number of segments for the line and the type of output we want. In this example, I choose 50 breaks, which is more than enough for the routes that we are drawing. The end result will actually have 52 segments, because I want to include the start and end points within the line by setting the <code>addStartEnd</code> to <code>TRUE</code>.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> Lastly, in order to have the output be a <code>Spatial</code> object, we need to set the <code>sp</code> argument to <code>TRUE</code>.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Great circles as a SpatialLines object</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>routes_sl <span class="ot">&lt;-</span> <span class="fu">gcIntermediate</span>(sources_tbl, destinations_tbl, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">n =</span> <span class="dv">50</span>, <span class="at">addStartEnd =</span> <span class="cn">TRUE</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sp =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj
= prefer_proj): Discarded datum Unknown based on WGS84 ellipsoid in Proj4
definition</code></pre>
</div>
</div>
<p>Let’s investigate the object that we have created with the <code>gcIntermediate()</code> function. You will not want to print <code>routes_sl</code> to the console, as this will print out fifteen matrices with 52 rows each, but we can use other methods to look at the object. <code>routes_sl</code> is a <code>Spatial</code> object of class <code>SpatialLines</code>. The different forms of data within <code>Spatial</code> objects are <a href="https://jessesadler.com/post/gis-with-r-intro/#overview-spsf">contained in slots</a>, which can be identified with <code>slotNames()</code>. The <code>lines</code> slot contains the coordinates of the routes produced by <code>gcIntermediate()</code>. The <code>gcIntermediate()</code> function also added a coordinate reference system and set it to longitude and latitude coordinates on the WGS84 ellipsoid, equivalent to <a href="https://epsg.io/4326">EPSG 4326</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Class of routes_sl</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(routes_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SpatialLines"
attr(,"package")
[1] "sp"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Slots in routes_sl</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">slotNames</span>(routes_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "lines"       "bbox"        "proj4string"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CRS of routes_sl</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>routes_sl<span class="sc">@</span>proj4string</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
Deprecated Proj.4 representation: +proj=longlat +ellps=WGS84 +no_defs 
WKT2 2019 representation:
GEOGCRS["unknown",
    DATUM["Unknown based on WGS84 ellipsoid",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1],
            ID["EPSG",7030]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433],
        ID["EPSG",8901]],
    CS[ellipsoidal,2],
        AXIS["longitude",east,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]],
        AXIS["latitude",north,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]]] </code></pre>
</div>
</div>
<p>The inclusion of a coordinate reference system makes <code>routes_sl</code> a truly geospatial object that can be plotted on our background map, though it does not yet possess any attribute data about the names of the locations or the number of letters sent along each route.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make bbox of countries_sp the same as routes_sl</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>countries_sp<span class="sc">@</span>bbox <span class="ot">&lt;-</span> <span class="fu">bbox</span>(routes_sl)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot map</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(countries_sp, <span class="at">col =</span> <span class="fu">gray</span>(<span class="fl">0.8</span>), <span class="at">border =</span> <span class="fu">gray</span>(<span class="fl">0.7</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"SpatialLines great circles"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in wkt(obj): CRS object has no comment</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(routes_sl, <span class="at">col =</span> <span class="st">"dodgerblue"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/routes-sl-plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>At this point, the output is not hugely informative. However, we can confirm that the process of making great circles worked by observing the curvatures of the lines. Notice that the amount of curvature differs according to distance and the bearing of the line.</p>
<p>We can add the attribute data for the lines and create a <code>SpatialLinesDataFrame</code> object by combining <code>routes_sl</code> and the <code>routes</code> data frame through the <code>SpatialLinesDataFrame()</code> function. There is no need to worry about linking the lines data to the correct row in <code>routes</code>, because <code>routes_sl</code> contains a lines ID attribute that corresponds to the row numbers of <code>sources_tbl</code> and <code>destinations_tbl</code>, which were derived from <code>routes</code>.<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Great circles as a SpatialLinesDataFrame object</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>routes_sldf <span class="ot">&lt;-</span> <span class="fu">SpatialLinesDataFrame</span>(routes_sl, <span class="at">data =</span> routes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result of <code>SpatialLinesDataFrame()</code> is a complete <code>Spatial</code> object that contains a CRS, attribute data in the <code>data</code> slot, and great circle lines in the <code>lines</code> slot. It is now possible to plot <code>routes_sldf</code> and distinguish the lines by the number of letters sent along each route. The easiest way to show this in a base plot is by adjusting the line width of the great circles by a chosen formula. In this case, I take the square route of the number of letters and add 0.25 to get the maximum and minimum line width to a reasonable size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>countries_sp<span class="sc">@</span>bbox <span class="ot">&lt;-</span> <span class="fu">bbox</span>(routes_sldf)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Map with SpatialLinesDataFrame object</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(countries_sp, <span class="at">col =</span> <span class="fu">gray</span>(<span class="fl">0.8</span>), <span class="at">border =</span> <span class="fu">gray</span>(<span class="fl">0.7</span>),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"SpatialLinesDataFrame great circles"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in wkt(obj): CRS object has no comment</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(routes_sldf,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="fu">sqrt</span>(routes_sldf<span class="sc">$</span>n<span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fl">0.25</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"dodgerblue"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/routes-sldf-plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="great-circles-with-sf" class="level2">
<h2 class="anchored" data-anchor-id="great-circles-with-sf">Great circles with <code>sf</code></h2>
<p>There is no straightforward way, no single function, to create great circles from longitude and latitude data with the <code>sf</code> package that is reminiscent of <code>gcIntermediate()</code>. With <code>sf</code> the creation of great circles is a two-step process. First, we need to create lines or objects with a geometry of <code>LINESTRING</code>, and then it will be possible to convert the straight line into a great circle with <code>st_segmentize()</code>. The first transformation is the trickier of the two. As I have <a href="https://jessesadler.com/post/gis-with-r-intro/#sf">shown previously</a>, you can create an <code>sf</code> object with <code>POINT</code> geometry through the <code>st_as_sf()</code> function, but there is no equivalent function for creating lines. Here, I will show two different methods for creating lines and then great circles with <code>sf</code>. The first method will convert the <code>routes</code> data to an <code>sf</code> object of <code>POINT</code> geometry and take advantage of the <code>sf</code> package’s ability to use <code>dplyr</code> functions to create lines through a <code>group_by()</code> and <code>summarise()</code> pipeline. The second method vectorizes the creation of a single <code>LINESTRING</code> feature through a for loop. The resulting <code>sf</code> object of great circles will be essentially identical.</p>
<section id="great-circles-with-sf-tidy-method" class="level3">
<h3 class="anchored" data-anchor-id="great-circles-with-sf-tidy-method">Great circles with <code>sf</code>: tidy method</h3>
<p>When I first attempted to create great circles with the <code>sf</code> package, I was not sure how to proceed. In fact, for many months I used the above method from <code>geosphere</code> and then converted the <code>SpatialLinesDataFrame</code> to an <code>sf</code> object with <code>st_as_sf()</code>. I discovered this first method for creating great circles with <code>sf</code> when I came to the realization that the form of the data in the <code>routes</code> data frame was problematic. It obviously makes sense from a perspective of data entry to have a row for each letter with a source and destination. However, this results in two columns that represent a similar type of data of place names. When coordinate data is added, you end up with two sets of longitude and latitude variables. In an <code>sf</code> object this translates to two separate geometry columns, which is possible but problematic.</p>
<p>Once I identified the problem, I could find a solution in the form of the functions in the <a href="http://tidyr.tidyverse.org"><code>tidyr</code></a> package and the transformation of <code>routes</code> from a “wide” form with a “source” and “destination” column in the same row to a “long” form in which the source and destination of each letter are in separate rows. The “long” format of the <code>routes</code> data frame with a single “place” column makes it possible to add a single set of longitude and latitude data and then convert to an <code>sf</code> object. From this format we can transform an <code>sf</code> object with <code>POINT</code> geometry to <code>LINESTRING</code> geometry through <code>sf</code>’s integration with <code>dplyr</code>.<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a></p>
<p>Let’s see how this works in practice. Before we begin though, we need to make a slight change to <code>routes</code> to add an “id” column. This will enable us to keep track of the relationship between the sources and destinations and will be used later to group the routes together. We can do this with the very helpful <code>rowid_to_column()</code> function from the <code>tibble</code> package, which even places the “id” column at the start of the data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create id column to routes</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>routes_id <span class="ot">&lt;-</span> <span class="fu">rowid_to_column</span>(routes, <span class="at">var =</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With this done, the first step is to transform <code>routes_id</code> into a “long” format with the use of <code>gather()</code>. The related <code>gather()</code> and <code>spread()</code> functions are almost magical when you can get them to do what you want, but this also makes them somewhat tricky to use.<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a> <code>gather()</code> combines variables and transforms them into values. The <code>gather()</code> function has three main arguments: <code>key</code>, <code>value</code>, and <code>...</code> to choose the columns to keep or modify. The values passed to the <code>key</code> and <code>value</code> arguments provide the names for two new columns to be created by the <code>gather()</code> function. They can be anything you choose, but assigning descriptive names makes it easier to understand what the function is doing. You can think of the <code>key</code> argument as the name for the column whose values are currently column names. The <code>key</code> essentially identifies the “type”. The <code>value</code> argument is the name of the variable whose values are contained within the columns that are spread apart. The <code>...</code> argument is used to demarcate the columns to either be used by <code>gather()</code> or to specify which columns you want to keep as is and thus make longer. This uses the same grammar as <code>select()</code> with <code>-variable_name</code> for columns that you want to be left alone.</p>
<p>In our example, we want to turn the “source” and “destination” variables or columns into values that identify whether a place is a source or destination. Here, I choose to name the <code>key</code> “type” and the <code>value</code> “place”, which aligns with the nomenclature used in the <code>locations</code> data. To make the function work properly, we need to choose the right columns for <code>gather()</code> to work upon. In this case, there are two possibilities. We can either tell <code>gather()</code> to use the “source” and “destination” columns or to leave “id” and “n” alone with a <code>-</code> before these column names. Here, I do the former.<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform routes to long format</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>routes_long <span class="ot">&lt;-</span> routes_id <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"type"</span>, <span class="at">value =</span> <span class="st">"place"</span>, source, destination)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print routes_long</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>routes_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 4
      id     n type   place    
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;    
 1     1     1 source Amsterdam
 2     2     1 source Antwerp  
 3     3     1 source Dordrecht
 4     4     1 source Emden    
 5     5     1 source Haarlem  
 6     6     1 source Haarlem  
 7     7     1 source Hamburg  
 8     8     1 source Het Vlie 
 9     9     1 source Lisse    
10    10     2 source Antwerp  
# … with 20 more rows</code></pre>
</div>
</div>
<p>Because we performed the <code>gather()</code> function on two columns, <code>routes_long</code> possesses twice as many rows as <code>routes</code>. <code>routes_long</code> has two new columns corresponding to the names we gave them in the <code>key</code> and <code>values</code> arguments, while the “id” and “n” values have essentially been doubled such that the same values are associated with both a source and destination “type”. Now that we have a single column with place names, we can add the longitude and latitude values of the places through a left join.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add coordinate values</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>routes_long_geo <span class="ot">&lt;-</span> <span class="fu">left_join</span>(routes_long, locations, <span class="at">by =</span> <span class="st">"place"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With <code>routes_long_geo</code> we now have the data in the correct format to create an <code>sf</code> object with <code>POINT</code> geometry and a CRS through the <code>st_as_sf()</code> function. Let’s create the object and then see what it looks like.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert coordinate data to sf object</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>routes_long_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(routes_long_geo,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print routes_long_sf</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>routes_long_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 30 features and 4 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 3.610998 ymin: 45.44085 xmax: 12.31552 ymax: 53.55108
Geodetic CRS:  WGS 84
# A tibble: 30 × 5
      id     n type   place                geometry
 * &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;             &lt;POINT [°]&gt;
 1     1     1 source Amsterdam (4.895168 52.37022)
 2     2     1 source Antwerp   (4.402464 51.21945)
 3     3     1 source Dordrecht  (4.690093 51.8133)
 4     4     1 source Emden       (7.20601 53.3594)
 5     5     1 source Haarlem   (4.646219 52.38739)
 6     6     1 source Haarlem   (4.646219 52.38739)
 7     7     1 source Hamburg   (9.993682 53.55108)
 8     8     1 source Het Vlie      (5.183333 53.3)
 9     9     1 source Lisse     (4.557483 52.25793)
10    10     2 source Antwerp   (4.402464 51.21945)
# … with 20 more rows</code></pre>
</div>
</div>
<p>From this point on, we are able to use <code>sf</code>’s <code>dplyr</code> integration to convert from a <code>POINT</code> geometry to <code>MULTIPOINT</code> and then <code>LINESTRING</code>. We can perform the former by grouping <code>routes_long_sf</code> by the “id” column and summarizing the points into a <code>MULTIPOINT</code> geometry.<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a> The <code>sf</code> implementation of <code>summarise()</code> includes a <code>do.union</code> argument. With <code>do.union</code> set to <code>TRUE</code>, the default, <code>summarise()</code> will try to resolve internal boundaries, but it can also change the order of points. Therefore, we will set <code>do.union</code> to <code>FALSE</code>, which uses <code>st_combine()</code> to more simply combine geometries in a manner similar to <code>c ()</code>. The latter transformation from <code>MULTIPOINT</code> to <code>LINESTRING</code> involves <code>st_cast()</code> and takes advantage of the fact that internally <code>MULTIPOINT</code> and <code>LINESTRING</code> are derived from the same type of data, making it possible to convert back and forth between the two geometries without any loss of data. Here I will do all of this in a single pipeline, though you could do it step-by-step to see the multiple conversions that are taking place.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert POINT geometry to MULTIPOINT, then LINESTRING</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>routes_lines <span class="ot">&lt;-</span> routes_long_sf <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">do_union =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print routes_lines</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>routes_lines</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 15 features and 1 field
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 3.610998 ymin: 45.44085 xmax: 12.31552 ymax: 53.55108
Geodetic CRS:  WGS 84
# A tibble: 15 × 2
      id                               geometry
   &lt;int&gt;                       &lt;LINESTRING [°]&gt;
 1     1  (4.895168 52.37022, 8.801694 53.0793)
 2     2  (4.402464 51.21945, 3.610998 51.4988)
 3     3  (4.690093 51.8133, 4.646219 52.38739)
 4     4    (7.20601 53.3594, 8.801694 53.0793)
 5     5  (4.646219 52.38739, 3.610998 51.4988)
 6     6    (4.646219 52.38739, 4.3007 52.0705)
 7     7  (9.993682 53.55108, 8.801694 53.0793)
 8     8      (5.183333 53.3, 8.801694 53.0793)
 9     9 (4.557483 52.25793, 4.357068 52.01158)
10    10    (4.402464 51.21945, 4.3007 52.0705)
11    11  (4.646219 52.38739, 8.801694 53.0793)
12    12 (12.31552 45.44085, 4.646219 52.38739)
13    13 (4.402464 51.21945, 4.646219 52.38739)
14    14 (4.646219 52.38739, 4.357068 52.01158)
15    15 (4.402464 51.21945, 4.357068 52.01158)</code></pre>
</div>
</div>
<p>We have successfully created an <code>sf</code> object with lines. In addition to the change in geometry type, we can see that the number of rows has been halved and returned to the original length of <code>routes_id</code>. However, in doing this, we lost the data on the name of the source and destination of the lines, as well as the number of letters sent along the route. This occurred when we grouped <code>routes_long_sf</code> by the “id” column, leaving other non-geometry columns to be silently dropped. We can re-add the attribute data by joining <code>routes_lines</code> to the original <code>routes_id</code> data frame, using the “id” column to perform the join. This work flow of grouping and then joining by “id” is why we needed to create the column in the first place.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join sf object with attributes data</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>routes_lines <span class="ot">&lt;-</span> <span class="fu">left_join</span>(routes_lines, routes_id, <span class="at">by =</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that the geometry of the <code>sf</code> object is <code>LINESTRING</code>, creating a great circle with <code>st_segmentize()</code> is straight forward. The only decision you have to make is the maximum distance for the length of a segment. The maximum distance argument can either be the number of meters for the maximum segment or an object from the <a href="https://cran.r-project.org/web/packages/units/index.html"><code>units</code></a> package, which makes it possible to use a more sensible unit for this argument such as kilometers.<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a> In this case, I will use the <code>set_units</code> function from the <code>units</code> package and set the maximum length to 20 kilometers.<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert rhumb lines to great circles</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>routes_sf_tidy <span class="ot">&lt;-</span> routes_lines <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_segmentize</span>(units<span class="sc">::</span><span class="fu">set_units</span>(<span class="dv">20</span>, km))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With <code>routes_sf_tidy</code> we have reached our goal, an <code>sf</code> object with great circle lines. We can confirm the changes made by <code>st_segmentize()</code> both visually and by looking at the number of coordinates or points in <code>routes_sf_tidy</code> compared to <code>routes_lines</code>. Where <code>routes_lines</code> has 30 set of coordinates — two for each line — <code>routes_sf_tidy</code> has <code>nrow(st_coordinates(routes_sf_tidy))</code> as a result of <code>st_segmentize()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare number of points in routes_lines and routes_sf_tidy</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">st_coordinates</span>(routes_lines))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">st_coordinates</span>(routes_sf_tidy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 193</code></pre>
</div>
</div>
<p>We can visualize the difference between the rhumb lines of <code>routes_lines</code> and the great circles of <code>routes_sf_tidy</code> by plotting them on the same map. Because the lines in this example are relatively short, the differences will be fairly minimal and even imperceptible in some cases. Here, I plot the great circles in black on top of the rhumb lines in magenta to highlight where the differences are visible. The most perceptible difference is the route from Venice to Haarlem. The magenta rhumb lines are also partially visible in the routes to Bremen. Routes over shorter distances such as those between Antwerp and Zeeland or Holland are more similar and the appearance of the magenta rhumb lines are less perceptible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rhumb lines vs great circles</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_sf, <span class="at">fill =</span> <span class="fu">gray</span>(<span class="fl">0.8</span>), <span class="at">color =</span> <span class="fu">gray</span>(<span class="fl">0.7</span>)) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> routes_lines, <span class="at">color =</span> <span class="st">"magenta"</span>) <span class="sc">+</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> routes_sf_tidy) <span class="sc">+</span> </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">14</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">54</span>), <span class="at">datum =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Rhumb lines vs Great circles"</span>) <span class="sc">+</span> </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/rhumb-great-circle-plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also compare the output of <code>gcIntermediate</code> and <code>st_segmentize()</code>. The use of a maximum length of a segment by <code>st_segmentize()</code> instead of the number of segments is the main differentiation between <code>st_segmentize()</code> and <code>gcIntermediate()</code>. The exact coordinates along which the great circles are drawn will necessarily differ between the two functions. In practice, the differences are likely to be unimportant, and in a map like the one we are creating here, the differences between the two sets of great circles will be imperceptible. The limited extent of the difference between the two functions can be seen by plotting <code>routes_sldf</code> and <code>routes_sf_tidy</code> on the same interactive map using the <a href="https://cran.r-project.org/web/packages/mapview/index.html"><code>mapview</code></a> package. This makes it possible to zoom in on the lines and see where they do differ, such as the line between Venice and Haarlem. The differences that are visible are on the scale of meters, and this is without optimizing the alignment for the choices of the number of segments and maximum length of a segment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive comparison of gcIntermediate and st_segmentize</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapview)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(routes_sldf, <span class="at">color =</span> <span class="st">"magenta"</span>) <span class="sc">+</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapview</span>(routes_sf_tidy, <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="htmlwidget-e8c304b6f71a5af020db" style="width:100%;height:464px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-e8c304b6f71a5af020db">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["line",430]},{"method":"addPolylines","args":[[[[{"lng":[4.8951679,4.97052173458627,5.04592714075233,5.1213840178086,5.19689226436101,5.27245177831049,5.34806245685258,5.423724196477,5.49943689296727,5.57520044140032,5.65101473614615,5.72687967086748,5.80279513851946,5.87876103134933,5.95477724089619,6.03084365799069,6.10696017275486,6.18312667460181,6.25934305223559,6.335609193651,6.41192498613342,6.48829031625866,6.56470506989289,6.64116913219246,6.71768238760393,6.79424471986392,6.8708560119991,6.9475161463262,7.02422500445201,7.10098246727335,7.17778841497722,7.25464272704076,7.33154528223141,7.408495958607,7.48549463351587,7.56254118359707,7.63963548478045,7.71677741228695,7.79396684062876,7.87120364360958,7.94848769432487,8.02581886516216,8.10319702780134,8.18062205321499,8.2580938116687,8.33561217272153,8.4131770052263,8.49078817733008,8.56844555647461,8.64614900939677,8.72389840212902,8.8016936],"lat":[52.3702157,52.3853414578695,52.400419268767,52.4154490737966,52.4304308141569,52.4453644311413,52.4602498661392,52.475087060637,52.4898759562189,52.504616494568,52.5193086174669,52.5339522667992,52.54854738455,52.5630939128069,52.5775917937612,52.5920409697086,52.6064413830503,52.6207929762938,52.635095692054,52.6493494730542,52.6635542621268,52.6777100022144,52.691816636371,52.7058741077625,52.7198823596681,52.7338413354807,52.7477509787086,52.7616112329759,52.7754220420237,52.7891833497107,52.802895100015,52.816557237034,52.8301697049863,52.8437324482119,52.8572454111738,52.8707085384586,52.8841217747775,52.8974850649673,52.9107983539916,52.9240615869414,52.9372747090361,52.9504376656248,52.9635504021871,52.9766128643337,52.9896249978082,53.0025867484871,53.0154980623816,53.028358885638,53.0411691645389,53.0539288455043,53.0666378750922,53.0792962]}]],[[{"lng":[4.4024643,4.38703809425844,4.3716081828486,4.35617456550874,4.34073724197859,4.32529621199933,4.30985147531362,4.29440303166558,4.27895088080083,4.26349502246644,4.24803545641096,4.23257218238443,4.21710520013836,4.20163450942576,4.1861601100011,4.17068200162035,4.15520018404096,4.13971465702189,4.12422542032358,4.10873247370795,4.09323581693843,4.07773544977995,4.06223137199894,4.04672358336332,4.03121208364252,4.01569687260748,4.00017795003064,3.98465531568596,3.96912896934889,3.9535989107964,3.938065139807,3.92252765616068,3.90698645963897,3.89144155002492,3.87589292710308,3.86034059065956,3.84478454048197,3.82922477635945,3.81366129808267,3.79809410544385,3.78252319823672,3.76694857625656,3.75137023930017,3.73578818716592,3.72020241965368,3.7046129365649,3.68901973770256,3.67342282287117,3.65782219187682,3.64221784452713,3.62660978063128,3.610998],"lat":[51.2194475,51.2249759968274,51.2305024653398,51.2360269046494,51.2415493138679,51.2470696921068,51.2525880384776,51.2581043520916,51.2636186320598,51.2691308774931,51.2746410875023,51.2801492611979,51.2856553976903,51.2911594960896,51.296661555506,51.3021615750493,51.3076595538292,51.3131554909552,51.3186493855367,51.3241412366827,51.3296310435025,51.3351188051047,51.340604520598,51.346088189091,51.351569809692,51.3570493815091,51.3625269036504,51.3680023752236,51.3734757953364,51.3789471630964,51.3844164776107,51.3898837379867,51.3953489433312,51.4008120927511,51.4062731853531,51.4117322202437,51.4171891965291,51.4226441133155,51.4280969697091,51.4335477648155,51.4389964977404,51.4444431675894,51.4498877734679,51.4553303144809,51.4607707897336,51.4662091983307,51.4716455393771,51.4770798119772,51.4825120152354,51.4879421482559,51.4933702101428,51.4987962]}]],[[{"lng":[4.6900929,4.68924341078085,4.68839349690254,4.68754315798113,4.68669239363223,4.68584120347099,4.68498958711214,4.68413754416992,4.68328507425815,4.68243217699018,4.6815788519789,4.68072509883677,4.67987091717578,4.67901630660747,4.67816126674292,4.67730579719274,4.67644989756712,4.67559356747576,4.67473680652792,4.67387961433237,4.67302199049747,4.67216393463107,4.67130544634059,4.67044652523299,4.66958717091473,4.66872738299185,4.6678671610699,4.66700650475399,4.66614541364872,4.66528388735828,4.66442192548635,4.66355952763616,4.66269669341048,4.66183342241159,4.66096971424131,4.660105568501,4.65924098479153,4.65837596271331,4.65751050186629,4.65664460184991,4.65577826226318,4.65491148270461,4.65404426277223,4.65317660206361,4.65230850017584,4.65143995670552,4.65057097124879,4.6497015434013,4.64883167275822,4.64796135891425,4.6470906014636,4.6462194],"lat":[51.8132979,51.8245547200658,51.835811534009,51.8470683418241,51.8583251435054,51.8695819390474,51.8808387284446,51.8920955116914,51.9033522887822,51.9146090597115,51.9258658244736,51.937122583063,51.9483793354741,51.9596360817012,51.9708928217389,51.9821495555813,51.993406283223,52.0046630046583,52.0159197198815,52.0271764288871,52.0384331316693,52.0496898282225,52.060946518541,52.0722032026192,52.0834598804514,52.0947165520319,52.105973217355,52.1172298764151,52.1284865292063,52.1397431757231,52.1509998159596,52.1622564499102,52.1735130775691,52.1847696989307,52.196026313989,52.2072829227385,52.2185395251733,52.2297961212877,52.2410527110759,52.2523092945321,52.2635658716506,52.2748224424255,52.2860790068511,52.2973355649215,52.3085921166309,52.3198486619735,52.3311052009436,52.3423617335351,52.3536182597424,52.3648747795596,52.3761312929807,52.3873878]}]],[[{"lng":[7.2060095,7.2374963136065,7.26897531118305,7.30044648394856,7.33190982314161,7.36336532002036,7.39481296586261,7.4262527519658,7.457684669647,7.48910871024291,7.52052486510986,7.55193312562386,7.58333348318052,7.61472592919513,7.64611045510264,7.67748705235762,7.70885571243433,7.74021642682668,7.77156918704824,7.80291398463225,7.83425081113162,7.86557965811892,7.89690051718641,7.92821337994602,7.95951823802935,7.99081508308767,8.02210390679195,8.05338470083283,8.08465745692063,8.11592216678538,8.14717882217677,8.17842741486418,8.20966793663668,8.24090037930305,8.27212473469173,8.30334099465087,8.33454915104832,8.36574919577159,8.39694112072793,8.42812491784423,8.45930057906713,8.49046809636293,8.52162746171763,8.55277866713693,8.58392170464623,8.6150565662906,8.64618324413485,8.67730173026343,8.70841201678052,8.73951409581,8.77060795949541,8.8016936],"lat":[53.3594029,53.3541162127734,53.3488212411037,53.3435179886469,53.3382064590627,53.3328866560141,53.3275585831681,53.322222244195,53.3168776427687,53.3115247825667,53.3061636672701,53.3007943005635,53.2954166861349,53.2900308276761,53.2846367288821,53.2792343934516,53.2738238250867,53.268405027493,53.2629780043796,53.2575427594589,53.2520992964468,53.2466476190629,53.2411877310297,53.2357196360737,53.2302433379242,53.2247588403144,53.2192661469806,53.2137652616625,53.2082561881031,53.202738930049,53.1972134912498,53.1916798754586,53.1861380864318,53.1805881279291,53.1750300037135,53.1694637175511,53.1638892732116,53.1583066744677,53.1527159250953,53.1471170288738,53.1415099895857,53.1358948110166,53.1302714969554,53.1246400511942,53.1190004775283,53.1133527797562,53.1076969616793,53.1020330271024,53.0963609798335,53.0906808236835,53.0849925624666,53.0792962]}]],[[{"lng":[4.6462194,4.62552279621529,4.6048424325382,4.58417828945311,4.56353034746719,4.54289858711041,4.52228298893554,4.5016835335181,4.48110020145638,4.46053297337141,4.43998182990696,4.41944675172952,4.39892771952828,4.37842471401512,4.3579377159246,4.33746670601394,4.31701166506304,4.2965725738744,4.27614941327317,4.25574216410711,4.23535080724655,4.21497532358443,4.19461569403625,4.17427189954007,4.15394392105647,4.13363173956858,4.11333533608203,4.09305469162495,4.07278978724795,4.0525406040241,4.03230712304894,4.01208932544044,3.991887192339,3.97170070490742,3.95152984433089,3.93137459181699,3.91123492859566,3.89111083591919,3.87100229506221,3.85090928732165,3.83083179401676,3.81076979648908,3.7907232761024,3.77069221424278,3.75067659231854,3.73067639176019,3.71069159402048,3.69072218057434,3.67076813291888,3.65082943257337,3.63090606107922,3.610998],"lat":[52.3873878,52.3700527008567,52.352713989516,52.3353716710695,52.3180257506009,52.3006762331853,52.28332312389,52.2659664277737,52.2486061498871,52.2312422952728,52.2138748689651,52.1965038759901,52.179129321366,52.1617512101027,52.144369547202,52.1269843376576,52.1095955864552,52.0922032985724,52.0748074789787,52.0574081326357,52.0400052644968,52.0225988795075,52.0051889826053,51.9877755787196,51.9703586727721,51.9529382696762,51.9355143743376,51.918086991654,51.9006561265152,51.8832217838031,51.8657839683917,51.8483426851471,51.8308979389277,51.8134497345837,51.7959980769579,51.778542970885,51.761084421192,51.743622432698,51.7261570102145,51.7086881585451,51.6912158824858,51.6737401868246,51.656261076342,51.6387785558107,51.6212926299957,51.6038033036544,51.5863105815365,51.5688144683839,51.551314968931,51.5338120879046,51.5163058300237,51.4987962]}]],[[{"lng":[4.6462194,4.63939692737971,4.63257637172797,4.62575773219826,4.61894100794451,4.612126198121,4.60531330188241,4.5985023183838,4.59169324678065,4.58488608622878,4.57808083588443,4.57127749490422,4.56447606244516,4.55767653766464,4.55087891972046,4.54408320777076,4.53728940097412,4.53049749848948,4.52370749947616,4.51691940309388,4.51013320850276,4.50334891486328,4.49656652133631,4.48978602708312,4.48300743126536,4.47623073304506,4.46945593158465,4.46268302604693,4.45591201559509,4.44914289939271,4.44237567660376,4.43561034639257,4.42884690792389,4.42208536036282,4.41532570287488,4.40856793462595,4.40181205478229,4.39505806251057,4.38830595697782,4.38155573735148,4.37480740279933,4.36806095248959,4.36131638559081,4.35457370127196,4.34783289870238,4.3410939770518,4.33435693549032,4.32762177318843,4.320888489317,4.3141570830473,4.30742755355096,4.3006999],"lat":[52.3873878,52.3811840070472,52.3749798214212,52.3687752433201,52.3625702729421,52.3563649104851,52.3501591561471,52.3439530101257,52.3377464726188,52.3315395438237,52.3253322239379,52.3191245131586,52.3129164116831,52.3067079197085,52.3004990374316,52.2942897650493,52.2880801027583,52.2818700507552,52.2756596092364,52.2694487783984,52.2632375584374,52.2570259495495,52.2508139519308,52.2446015657771,52.2383887912842,52.2321756286477,52.2259620780634,52.2197481397265,52.2135338138323,52.2073191005762,52.2011040001532,52.1948885127583,52.1886726385863,52.1824563778319,52.1762397306899,52.1700226973547,52.1638052780207,52.1575874728822,52.1513692821334,52.1451507059684,52.138931744581,52.1327123981651,52.1264926669145,52.1202725510227,52.1140520506832,52.1078311660893,52.1016098974344,52.0953882449116,52.0891662087139,52.0829437890342,52.0767209860653,52.0704978]}]],[[{"lng":[9.9936819,9.97005573301095,9.94643976419506,9.92283399093622,9.89923841061021,9.87565302058473,9.85207781821941,9.82851280086586,9.80495796586767,9.78141331056043,9.75787883227176,9.73435452832135,9.71084039602093,9.68733643267434,9.66384263557754,9.64035900201862,9.61688552927784,9.59342221462763,9.56996905533263,9.54652604864969,9.52309319182793,9.49967048210871,9.47625791672571,9.45285549290489,9.42946320786457,9.4060810588154,9.38270904296042,9.35934715749507,9.3359953996072,9.31265376647709,9.28932225527749,9.26600086317365,9.2426895873233,9.2193884248767,9.19609737297667,9.17281642875857,9.14954558935038,9.12628485187267,9.10303421343865,9.07979367115417,9.05656322211777,9.03334286342067,9.01013259214682,8.9869324053729,8.96374230016833,8.94056227359535,8.91739232270896,8.89423244455699,8.87108263618013,8.84794289461191,8.82481321687876,8.8016936],"lat":[53.5510846,53.5419487570578,53.5328082598859,53.5236631120461,53.5145133170983,53.5053588786007,53.4961998001099,53.4870360851805,53.4778677373655,53.4686947602163,53.4595171572822,53.450334932111,53.4411480882488,53.4319566292396,53.422760558626,53.4135598799486,53.4043545967465,53.3951447125567,53.3859302309146,53.3767111553539,53.3674874894065,53.3582592366023,53.3490264004697,53.3397889845352,53.3305469923236,53.3213004273577,53.3120492931588,53.3027935932462,53.2935333311374,53.2842685103484,53.274999134393,53.2657252067835,53.2564467310302,53.2471637106418,53.237876149125,53.2285840499848,53.2192874167244,53.2099862528452,53.2006805618467,53.1913703472267,53.1820556124811,53.1727363611039,53.1634125965875,53.1540843224224,53.1447515420972,53.1354142590987,53.1260724769119,53.11672619902,53.1073754289042,53.0980201700442,53.0886604259175,53.0792962]}]],[[{"lng":[5.183333,5.25461171188843,5.32587943660515,5.39713603545317,5.46838136989168,5.53961530153798,5.6108376921693,5.68204840372466,5.75324729830671,5.82443423818354,5.89560908579057,5.96677170373232,6.03792195478426,6.10905970189459,6.18018480818612,6.25129713695797,6.32239655168746,6.39348291603184,6.4645560938301,6.53561594910475,6.60666234606356,6.67769514910139,6.74871422280185,6.81971943193917,6.89071064147984,6.96168771658442,7.03265052260925,7.10359892510817,7.17453278983425,7.24545198274148,7.31635636998653,7.38724581793039,7.45812019314011,7.52897936239044,7.59982319266555,7.67065155116068,7.74146430528383,7.81226132265737,7.88304247111975,7.95380761872711,8.02455663375489,8.09528938469954,8.16600574028005,8.23670556943965,8.30738874134734,8.37805512539955,8.44870459122168,8.51933700866976,8.58995224783193,8.66055017903009,8.73113067282144,8.8016936],"lat":[53.3,53.2967290888739,53.2934156936142,53.2900598259374,53.2866614977058,53.2832207209277,53.2797375077567,53.2762118704916,53.2726438215765,53.2690333736001,53.265380539296,53.2616853315421,53.2579477633604,53.2541678479172,53.2503455985222,53.246481028629,53.2425741518341,53.2386249818774,53.2346335326415,53.2305998181517,53.2265238525754,53.2224056502226,53.2182452255446,53.2140425931349,53.209797767728,53.2055107641997,53.2011815975666,53.1968102829862,53.1923968357559,53.1879412713137,53.1834436052372,53.1789038532436,53.1743220311896,53.1696981550708,53.1650322410217,53.1603243053152,53.1555743643627,53.1507824347133,53.1459485330539,53.141072676209,53.1361548811401,53.1311951649453,53.1261935448599,53.1211500382548,53.1160646626374,53.1109374356506,53.1057683750726,53.1005574988171,53.0953048249321,53.0900103716006,53.0846741571396,53.0792962]}]],[[{"lng":[4.5574834,4.55353231125329,4.54958208236238,4.54563271301403,4.54168420289512,4.53773655169266,4.53378975909381,4.52984382478585,4.52589874845621,4.52195452979243,4.51801116848219,4.51406866421334,4.5101270166738,4.50618622555169,4.50224629053521,4.49830721131272,4.49436898757271,4.49043161900381,4.48649510529475,4.48255944613445,4.47862464121191,4.47469069021629,4.47075759283687,4.46682534876309,4.46289395768449,4.45896341929075,4.4550337332717,4.45110489931729,4.4471769171176,4.44324978636286,4.43932350674339,4.4353980779497,4.4314734996724,4.42754977160223,4.42362689343006,4.41970486484692,4.41578368554394,4.4118633552124,4.40794387354371,4.4040252402294,4.40010745496116,4.39619051743077,4.39227442733018,4.38835918435144,4.38444478818677,4.38053123852849,4.37661853506906,4.37270667750107,4.36879566551725,4.36488549881045,4.36097617707366,4.3570677],"lat":[52.2579303,52.2531031167331,52.2482758016053,52.2434483546683,52.2386207759737,52.2337930655732,52.2289652235181,52.2241372498602,52.2193091446509,52.2144809079417,52.2096525397841,52.2048240402294,52.1999954093292,52.1951666471348,52.1903377536976,52.1855087290689,52.1806795733,52.1758502864422,52.1710208685469,52.1661913196651,52.1613616398482,52.1565318291474,52.1517018876138,52.1468718152985,52.1420416122527,52.1372112785275,52.1323808141739,52.1275502192431,52.1227194937859,52.1178886378534,52.1130576514966,52.1082265347664,52.1033952877138,52.0985639103897,52.0937324028449,52.0889007651302,52.0840689972966,52.0792370993947,52.0744050714755,52.0695729135895,52.0647406257877,52.0599082081206,52.055075660639,52.0502429833935,52.0454101764347,52.0405772398133,52.0357441735798,52.0309109777848,52.0260776524788,52.0212441977123,52.0164106135359,52.0115769]}]],[[{"lng":[4.4024643,4.40050524542831,4.39854476914464,4.39658286927058,4.39461954392456,4.39265479122176,4.39068860927418,4.38872099619058,4.38675195007648,4.38478146903419,4.38280955116276,4.380836194558,4.37886139731244,4.37688515751537,4.3749074732528,4.37292834260746,4.3709477636588,4.36896573448297,4.36698225315283,4.36499731773793,4.36301092630449,4.36102307691544,4.35903376763035,4.35704299650547,4.35505076159371,4.35305706094463,4.35106189260443,4.34906525461593,4.3470671450186,4.34506756184853,4.34306650313841,4.34106396691754,4.33905995121182,4.33705445404375,4.33504747343241,4.33303900739344,4.33102905393906,4.32901761107808,4.32700467681581,4.32499024915414,4.3229743260915,4.32095690562285,4.31893798573965,4.31691756442991,4.31489563967812,4.3128722094653,4.31084727176894,4.30882082456302,4.306792865818,4.30476339350082,4.30273240557487,4.3006999],"lat":[51.2194475,51.236135596968,51.2528236612106,51.2695116926847,51.2861996913468,51.3028876571535,51.3195755900612,51.3362634900264,51.3529513570054,51.3696391909544,51.3863269918297,51.4030147595872,51.4197024941831,51.4363901955733,51.4530778637137,51.46976549856,51.486453100068,51.5031406681934,51.5198282028917,51.5365157041184,51.5532031718289,51.5698906059786,51.5865780065228,51.6032653734166,51.6199527066151,51.6366400060734,51.6533272717465,51.6700145035891,51.6867017015562,51.7033888656024,51.7200759956823,51.7367630917507,51.7534501537618,51.7701371816702,51.7868241754302,51.803511134996,51.8201980603217,51.8368849513616,51.8535718080696,51.8702586303996,51.8869454183055,51.903632171741,51.9203188906599,51.9370055750158,51.9536922247621,51.9703788398524,51.98706542024,52.0037519658782,52.0204384767202,52.0371249527192,52.0538113938281,52.0704978]}]],[[{"lng":[4.6462194,4.72640084826977,4.8066365549037,4.88692638805953,4.96727021503948,5.04766790229019,5.1281193154027,5.20862431911236,5.28918277729892,5.3697945529865,5.4504595083437,5.53117750468363,5.61194840246411,5.69277206128773,5.77364833990211,5.85457709620003,5.9355581872197,6.01659146914503,6.0976767973059,6.17881402617846,6.26000300938553,6.34124359969692,6.42253564902991,6.50387900844959,6.58527352816939,6.66671905755158,6.74821544510774,6.82976253849938,6.91136018453848,6.99300822918811,7.07470651756308,7.15645489393064,7.23825320171113,7.32010128347877,7.40199898096238,7.48394613504622,7.56594258577079,7.64798817233368,7.73008273309051,7.81222610555576,7.89441812640382,7.97665863146992,8.05894745575113,8.14128443340743,8.2236693977628,8.30610218130629,8.38858261569319,8.47111053174618,8.55368575945656,8.63630812798544,8.71897746566504,8.8016936],"lat":[52.3873878,52.402337769099,52.4172334598115,52.4320748062435,52.4468617426381,52.461594203377,52.4762721229814,52.4908954361131,52.5054640775764,52.5199779823185,52.5344370854314,52.5488413221527,52.5631906278669,52.5774849381069,52.5917241885548,52.6059083150436,52.6200372535579,52.6341109402356,52.6481293113689,52.6620923034057,52.6759998529504,52.6898518967658,52.7036483717738,52.7173892150567,52.7310743638588,52.7447037555872,52.7582773278131,52.7717950182735,52.7852567648717,52.7986625056793,52.8120121789365,52.8253057230544,52.8385430766155,52.8517241783752,52.8648489672627,52.877917382383,52.8909293630171,52.9038848486244,52.9167837788426,52.9296260934902,52.9424117325669,52.9551406362552,52.9678127449215,52.9804279991172,52.9929863395803,53.0054877072363,53.0179320431996,53.0303192887745,53.0426493854569,53.0549222749348,53.0671378990902,53.0792962]}]],[[{"lng":[12.3155151,12.1842847900598,12.0523954778011,11.9198413077961,11.7866163709001,11.6527147038188,11.5181302886774,11.3828570525905,11.2468888672344,11.1102195484213,10.9728428556751,10.8347524918108,10.6959421025161,10.5564052759362,10.4161355422619,10.2751263733221,10.1333711821795,9.9908633227313,9.84759608931436,9.7035627163159,9.55875637778923,9.41317018707581,9.26679719643339,9.11963039667105,8.97166271679143,8.82288702364056,8.67329612156592,8.5228827520831,8.37163959355157,8.21955926086025,8.06663430512311,7.91285721338579,7.75822040834343,7.60271624807055,7.44633702576356,7.28907496949652,7.13092224199084,6.97187094039958,6.81191309610717,6.65104067454514,6.48924557502475,6.32651963058727,6.16285460787267,5.99824220700767,5.83267406151392,5.66614173823726,5.49863673729894,5.33015049206985,5.16067436916857,4.99019966848446,4.81871762322662,4.6462194],"lat":[45.4408474,45.5815403624536,45.7220823161836,45.8624717548294,46.0027071547727,46.142786974913,46.2827096564402,46.4224736226036,46.5620772784791,46.7015190107323,46.8407971873796,46.979910157546,47.1188562512196,47.2576337790035,47.3962410318643,47.5346762808781,47.6729377769726,47.8110237506667,47.9489324118069,48.0866619493002,48.2242105308441,48.3615763026538,48.498757389185,48.6357518928552,48.7725578937601,48.9091734493877,49.0455965943293,49.1818253399865,49.3178576742752,49.453691561327,49.5893249411861,49.724755729504,49.8599818172303,49.9950010703003,50.1298113293195,50.2644104092447,50.3987960990615,50.5329661614594,50.6669183325024,50.8006503212975,50.9341598096592,51.0674444517711,51.2005018738443,51.3333296737724,51.4659254207838,51.5982866550901,51.7304108875324,51.8622955992237,51.9939382411887,52.1253362340006,52.2564869674148,52.3873878]}]],[[{"lng":[4.4024643,4.40712420031115,4.41178874395524,4.41645793933152,4.42113179485875,4.42581031897528,4.43049352013915,4.43518140682807,4.43987398753954,4.44457127079088,4.4492732651193,4.45397997908195,4.45869142125598,4.4634076002386,4.46812852464714,4.47285420311911,4.47758464431227,4.48231985690464,4.48705984959465,4.4918046311011,4.4965542101633,4.50130859554108,4.50606779601487,4.51083182038577,4.51560067747559,4.52037437612694,4.52515292520325,4.52993633358887,4.53472461018912,4.53951776393032,4.54431580375993,4.54911873864653,4.55392657757993,4.55873932957122,4.56355700365282,4.56837960887857,4.5732071543238,4.57803964908533,4.58287710228162,4.58771952305276,4.59256692056061,4.59741930398878,4.60227668254276,4.60713906544998,4.61200646195981,4.61687888134372,4.6217563328953,4.62663882593029,4.63152636978671,4.63641897382491,4.64131664742762,4.6462194],"lat":[51.2194475,51.2423530615644,51.265258437929,51.2881636287574,51.3110686337123,51.3339734524555,51.3568780846483,51.3797825299509,51.4026867880228,51.4255908585229,51.448494741109,51.4713984354383,51.4943019411671,51.5172052579509,51.5401083854445,51.5630113233016,51.5859140711754,51.6088166287181,51.6317189955812,51.6546211714153,51.6775231558701,51.7004249485946,51.723326549237,51.7462279574446,51.7691291728637,51.7920301951401,51.8149310239185,51.8378316588428,51.8607320995561,51.8836323457007,51.906532396918,51.9294322528485,51.9523319131319,51.975231377407,51.9981306453118,52.0210297164834,52.043928590558,52.066827267171,52.0897257459569,52.1126240265493,52.1355221085809,52.1584199916837,52.1813176754886,52.2042151596257,52.2271124437242,52.2500095274124,52.2729064103178,52.295803092067,52.3186995722855,52.3415958505981,52.3644919266286,52.3873878]}]],[[{"lng":[4.6462194,4.64050254110449,4.63478758826178,4.62907454040146,4.62336339645383,4.61765415534991,4.61194681602143,4.60624137740086,4.60053783842134,4.59483619801676,4.5891364551217,4.58343860867148,4.57774265760209,4.57204860085028,4.56635643735346,4.5606661660498,4.55497778587813,4.54929129577803,4.54360669468977,4.53792398155433,4.5322431553134,4.52656421490936,4.52088715928533,4.51521198738511,4.5095386981532,4.50386729053483,4.49819776347592,4.49253011592309,4.48686434682367,4.48120045512569,4.47553843977788,4.46987829972967,4.4642200339312,4.45856364133331,4.45290912088753,4.44725647154609,4.44160569226193,4.43595678198868,4.43030973968066,4.42466456429292,4.41902125478116,4.41337981010181,4.40774022921199,4.4021025110695,4.39646665463286,4.39083265886125,4.38520052271458,4.37957024515343,4.37394182513908,4.3683152616335,4.36269055359936,4.3570677],"lat":[52.3873878,52.380025784605,52.3726634935051,52.3653009268654,52.357938084851,52.3505749676267,52.3432115753573,52.3358479082075,52.3284839663418,52.3211197499247,52.3137552591204,52.3063904940931,52.2990254550068,52.2916601420256,52.2842945553131,52.2769286950332,52.2695625613493,52.2621961544249,52.2548294744233,52.2474625215078,52.2400952958414,52.2327277975871,52.2253600269077,52.2179919839661,52.2106236689246,52.203255081946,52.1958862231924,52.1885170928262,52.1811476910095,52.1737780179044,52.1664080736726,52.159037858476,52.1516673724761,52.1442966158347,52.1369255887129,52.1295542912723,52.1221827236738,52.1148108860786,52.1074387786477,52.1000664015417,52.0926937549215,52.0853208389476,52.0779476537805,52.0705741995805,52.0632004765079,52.0558264847228,52.0484522243851,52.0410776956547,52.0337028986914,52.0263278336549,52.0189525007046,52.0115769]}]],[[{"lng":[4.4024643,4.40158924865907,4.40071360630941,4.39983737222351,4.39896054567266,4.39808312592702,4.39720511225559,4.39632650392618,4.39544730020547,4.39456750035894,4.39368710365091,4.39280610934453,4.39192451670178,4.39104232498345,4.39015953344915,4.38927614135733,4.38839214796521,4.38750755252887,4.38662235430317,4.38573655254179,4.38485014649722,4.38396313542073,4.38307551856242,4.38218729517117,4.38129846449466,4.38040902577936,4.37951897827054,4.37862832121225,4.37773705384733,4.3768451754174,4.37595268516286,4.37505958232289,4.37416586613545,4.37327153583727,4.37237659066386,4.37148102984948,4.37058485262717,4.36968805822872,4.36879064588471,4.36789261482444,4.366993964276,4.36609469346621,4.36519480162065,4.36429428796365,4.36339315171828,4.36249139210636,4.36158900834845,4.36068599966383,4.35978236527056,4.35887810438537,4.35797321622378,4.3570677],"lat":[51.2194475,51.2349796155887,51.2505117246486,51.2660438271715,51.2815759231495,51.2971080125744,51.3126400954381,51.3281721717326,51.3437042414498,51.3592363045816,51.3747683611198,51.3903004110563,51.4058324543829,51.4213644910915,51.4368965211738,51.4524285446218,51.4679605614271,51.4834925715815,51.4990245750769,51.514556571905,51.5300885620574,51.545620545526,51.5611525223025,51.5766844923785,51.5922164557457,51.6077484123959,51.6232803623206,51.6388123055115,51.6543442419603,51.6698761716586,51.6854080945979,51.7009400107698,51.7164719201661,51.7320038227781,51.7475357185975,51.7630676076158,51.7785994898245,51.7941313652151,51.8096632337792,51.8251950955082,51.8407269503935,51.8562587984267,51.8717906395992,51.8873224739024,51.9028543013277,51.9183861218665,51.9339179355102,51.9494497422502,51.9649815420779,51.9805133349845,51.9960451209614,52.0115769]}]]],null,"routes_sldf",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"line","stroke":true,"color":"#FF00FF","weight":2,"opacity":0.9,"fill":false,"fillColor":"#6666FF","fillOpacity":1,"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Amsterdam&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Middelburg&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Dordrecht&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Emden&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Middelburg&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>The Hague&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Hamburg&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Het Vlie&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Lisse&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Delft&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>10&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>The Hague&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>11&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>12&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Venice&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>13&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 5&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Delft&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td>26&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>15&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Delft&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td>68&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":3,"opacity":1,"fill":false,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[3.610998,45.4408474,12.3155151,53.5510846,true,"routes_sldf","Zoom to routes_sldf","<strong> routes_sldf <\/strong>","bottomright"]},{"method":"addLegend","args":[{"colors":["#FF00FF"],"labels":["routes_sldf"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"routes_sldf"}]},{"method":"addPolylines","args":[[[[{"lng":[4.89516789999999,5.13553790419513,5.37642963107331,5.61783974481818,5.85976483670078,6.10220142496578,6.34514595473783,6.58859479794882,6.83254425328568,7.07699054615975,7.32192982869768,7.56735817975411,7.81327160494666,8.05966603671359,8.30653733439399,8.55388128433128,8.80169359999999],"lat":[52.3702157,52.4182618130615,52.4658194703992,52.5128867747953,52.559461839171,52.6055427868968,52.6511277521055,52.6962148800052,52.740802327194,52.784888261975,52.8284708646729,52.8715483279509,52.9141188571281,52.9561806704979,52.9977319996464,53.038771089771,53.0792962]}]],[[{"lng":[4.40246429999999,4.20550252978609,4.00793787527596,3.80976984815248,3.610998],"lat":[51.2194475,51.2897836626097,51.359788398845,51.4294598617662,51.4987962]}]],[[{"lng":[4.6900929,4.67922999948087,4.66829732630544,4.65729406804996,4.64621940000001],"lat":[51.8132979,51.9568218957245,52.100344885476,52.2438668575338,52.3873878]}]],[[{"lng":[7.20600949999999,7.40660380718128,7.60687855986728,7.80683152403637,8.00646049812886,8.20576331307345,8.40473783230692,8.60338195178727,8.80169359999999],"lat":[53.3594029,53.3255584245427,53.2913780649666,53.256862775933,53.2220135178794,53.1868312569055,53.1513169646593,53.1154716182232,53.0792962]}]],[[{"lng":[4.64621940000001,4.51455630246718,4.38354896394537,4.25319237578114,4.1234815667614,3.99441160296803,3.8659775876275,3.73817466095605,3.610998],"lat":[52.3873878,52.2768147829055,52.1660960710798,52.0552329666151,51.9442267582309,51.8330787214207,51.7217901185959,51.6103621992299,51.4987962]}]],[[{"lng":[4.64621940000001,4.55937624006097,4.4728430952722,4.38661822530003,4.30069990000001],"lat":[52.3873878,52.3082600793007,52.2290689018368,52.1498146742173,52.0704978]}]],[[{"lng":[9.99368190000001,9.84323974329826,9.69321147031931,9.54359638653293,9.39439378441375,9.24560294366933,9.09722313146673,8.94925360265736,8.80169359999999],"lat":[53.5510846,53.4927639501531,53.4342549264682,53.3755584480749,53.3166754311924,53.257606789106,53.1983534321446,53.1389162676589,53.0792962]}]],[[{"lng":[5.183333,5.41049539786619,5.63754308505446,5.86447158668767,6.09127644485,6.31795321918858,6.54449748750901,6.77090484636463,6.99717091163933,7.22329131912375,7.44926172508465,7.67507780682735,7.90073526325099,8.12622981539661,8.35155720698754,8.57671320496232,8.80169359999999],"lat":[53.3,53.2894258733339,53.2784203646906,53.2669838689872,53.2551167961084,53.2428195708345,53.2300926327688,53.2169364362606,53.2033514503272,53.1893381585733,53.1748970591074,53.1600286644571,53.1447335014811,53.1290121112797,53.1128650491024,53.0962928842544,53.0792962]}]],[[{"lng":[4.5574834,4.45699846975378,4.35706769999999],"lat":[52.2579303,52.1347960626761,52.0115769]}]],[[{"lng":[4.40246429999999,4.38995092218076,4.37737935280845,4.36474909847445,4.35205966035818,4.33931053415193,4.32650120998471,4.31363117234463,4.30069990000001],"lat":[51.2194475,51.325833556411,51.4322182733412,51.538601639416,51.6449836431359,51.7513642728745,51.8577435168768,51.9641213632578,52.0704978]}]],[[{"lng":[4.64621940000001,4.90198674682259,5.15830241893821,5.41516205565108,5.67256120794417,5.93049533850402,6.18895982177534,6.44794994404549,6.70746090355914,6.96748781066395,7.22802568798707,7.48906947064324,7.75061400647471,8.01265405632319,8.27518429433414,8.53819930829397,8.80169359999999],"lat":[52.3873878,52.4348515033124,52.4817622681066,52.5281179751425,52.5739165198926,52.619155812945,52.6638337804084,52.7079483643165,52.7514975230333,52.7944792316591,52.8368914824365,52.8787322851558,52.9199996675611,52.9606916757561,53.0008063746081,53.0403418481534,53.0792962]}]],[[{"lng":[12.3155151,12.2109940924524,12.1060553641514,12.0006959603618,11.894912904759,11.7887031992891,11.6820638240308,11.5749917370562,11.4674838742932,11.3595371493875,11.2511484535652,11.1423146554965,11.0330326011596,10.9232991137048,10.8131109933202,10.7024650170978,10.5913579389,10.4797864892277,10.3677473750886,10.2552372798676,10.1422528631969,10.0287907608284,9.91484758450704,9.80041992184491,9.68550433619754,9.57009736654106,9.4541955273514,9.33779530848457,9.22089317505919,9.10348556734053,8.98556890062648,8.86713956513566,8.74819392589751,8.6287283226446,8.50873906970727,8.38822245591061,8.26717474447409,8.14559217291372,8.02347095294692,7.90080727040046,7.77759728512106,7.65383713088946,7.5295229153374,7.40465071986827,7.27921659958116,7.15321658319834,7.026646672997,6.8995028447444,6.77178104763766,6.6434772042472,6.51458721046518,6.38510693545808,6.25503222162419,6.12435888455599,5.9930827130076,5.86119946886748,5.7287048871367,5.59559467591254,5.46186451637831,5.32751006279898,5.19252694252302,5.05691075599069,4.92065707674919,4.78376145147445,4.64621940000001],"lat":[45.4408474,45.5529742773999,45.6650054560874,45.7769401764522,45.8887776719616,46.000517169089,46.1121578872412,46.2236990386851,46.335139828474,46.4464794543731,46.5577171067832,46.6688519686655,46.7798832154641,46.8908100150283,47.0016315275343,47.1123469054059,47.2229552932344,47.3334558276979,47.4438476374797,47.5541298431855,47.664301557261,47.7743618839074,47.8843099189966,47.9941447499858,48.1038654558311,48.2134711069001,48.3229607648843,48.4323334827097,48.5415883044474,48.6507242652235,48.7597403911268,48.8686356991178,48.9774091969347,49.0860598830005,49.1945867463274,49.3029887664222,49.4112649131892,49.5194141468335,49.627435417763,49.7353276664892,49.8430898235275,49.9507208092972,50.0582195340195,50.1655848976155,50.272815789603,50.3799110889929,50.486869664184,50.5936903728579,50.7003720618721,50.8069135671528,50.9133137135874,51.0195713149147,51.1256851736159,51.2316540808035,51.3374768161104,51.4431521475777,51.5486788315411,51.6540556125181,51.7592812230928,51.8643543838007,51.9692738030129,52.0740381768189,52.1786461889093,52.2830965104574,52.3873878]}]],[[{"lng":[4.40246429999999,4.43225092810655,4.46222811094623,4.49239806593809,4.5227630438072,4.5533253292154,4.58408724140673,4.61505113486726,4.64621940000001],"lat":[51.2194475,51.3654672735562,51.5114794464874,51.6574839299453,51.8034806337388,51.9494694663083,52.0954503347,52.2414231445385,52.3873878]}]],[[{"lng":[4.64621940000001,4.57347193750408,4.5010322920013,4.42889827085077,4.35706769999999],"lat":[52.3873878,52.2935014959396,52.1995706865309,52.1055957096469,52.0115769]}]],[[{"lng":[4.40246429999999,4.39687570385792,4.39126292911683,4.38562578484829,4.37996407817135,4.3742776142274,4.36856619615443,4.36282962506104,4.35706769999999],"lat":[51.2194475,51.3184646248188,51.4174814825352,51.5164980710393,51.6155143881994,51.7145304318624,51.8135461998525,51.912561689972,52.0115769]}]]],null,"routes_sf_tidy",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"line","stroke":true,"color":"#000000","weight":2,"opacity":0.9,"fill":false,"fillColor":"#6666FF","fillOpacity":1,"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Amsterdam&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 2&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Middelburg&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 3&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Dordrecht&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 4&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Emden&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 5&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Middelburg&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 6&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>The Hague&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 7&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Hamburg&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 8&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Het Vlie&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 9&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Lisse&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Delft&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>10&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>10&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>The Hague&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>11&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>11&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>12&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>12&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Venice&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>13&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>13&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 5&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>14&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Delft&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td>26&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>15&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>15&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Delft&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td>68&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":3,"opacity":1,"fill":false,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addHomeButton","args":[3.610998,45.4408474,12.3155151,53.5510846,true,"routes_sf_tidy","Zoom to routes_sf_tidy","<strong> routes_sf_tidy <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],["routes_sldf","routes_sf_tidy"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#000000"],"labels":["routes_sf_tidy"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"routes_sf_tidy"}]},{"method":"addHomeButton","args":[3.610998,45.4408474,12.3155151,53.5510846,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"limits":{"lat":[45.4408474,53.5510846],"lng":[3.610998,12.3155151]},"fitBounds":[45.4408474,3.610998,53.5510846,12.3155151,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
</section>
<section id="great-circles-with-sf-for-loop-method" class="level3">
<h3 class="anchored" data-anchor-id="great-circles-with-sf-for-loop-method">Great circles with <code>sf</code>: for loop method</h3>
<p>The above method for creating great circles using <code>sf</code> highlights the integration of <code>sf</code> into the tidyverse, but there are always more than one path to answer a question with code. As I learned more about <code>sf</code> objects, I got interested in more directly creating an <code>sf</code> object with a geometry type of <code>LINESTRING</code> from longitude and latitude data. As with the tidy method, the biggest challenge came from creating <code>LINESTRING</code> features and not in turning rhumb lines into great circles. The method I came up with essentially vectorizes the creation of a single <code>LINESTRING</code> feature through the use of a for loop. This uses a similar step-by-step creation of an <code>sf</code> object — from an <code>sfg</code>, to an <code>sfc</code> object, and then to an <code>sf</code> object — that I have shown in <a href="https://jessesadler.com/post/simple-feature-objects/">Exploration of Simple Features for R</a>.<a href="#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a></p>
<p>Let’s start by building a single feature with a geometry of <code>LINESTRING</code> using coordinates from Venice and Haarlem to outline the process. The <code>st_linestring()</code> function takes a matrix of two or more sets of coordinates to create an <code>sfg</code> object with a geometry of class <code>LINESTRING</code>. We can construct the matrix of coordinates by row binding two vectors — created using <code>c()</code> — of the longitude and latitude values for Venice and Haarlem.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a line between Venice and Haarlem</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_linestring</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="fl">12.315515</span>, <span class="fl">45.44085</span>), <span class="fu">c</span>(<span class="fl">4.646219</span>, <span class="fl">52.38739</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>LINESTRING (12.31551 45.44085, 4.646219 52.38739)</code></pre>
</div>
</div>
<p>It is this process that we want to repeat for each of the 15 routes found in <code>routes</code>. A first instinct might be to create a matrix of the coordinates of all of the routes, but this results in a single line connecting the coordinates. Instead, what we need to do is create 15 matrices that each contain the coordinates for the source and destination of a single route. In other words, we want to take the longitude and latitude of both the source and destination from the first row of <code>routes</code>, bind them together into a 2x2 matrix, and then repeat the process for the second row and so forth. This is the realm of the <a href="#">for loop</a>.</p>
<p>Before getting into the mechanics of the for loop, we have to get the data into a format that is similar to the vectors used to create the line between the coordinates of Venice and Haarlem. A similar workflow to that we used above to prepare the data for the <code>gcIntermediate()</code> function gets us what we are looking for. In this case though, we need matrices of source coordinates and destination coordinates. We could either transform <code>sources_tbl</code> and <code>destinations_tbl</code> into matrices with <code>as.matrix()</code> or rerun the code used to create them and use <code>as.matrix()</code> at the end of the pipeline. Here, I do the latter for greater transparency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrix of longitude and latitude values of sources</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>sources_m <span class="ot">&lt;-</span> routes <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(locations, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"source"</span> <span class="ot">=</span> <span class="st">"place"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(lon<span class="sc">:</span>lat) <span class="sc">%&gt;%</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrix of longitude and latitude values of destinations</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>destinations_m <span class="ot">&lt;-</span> routes <span class="sc">%&gt;%</span> </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(locations, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"destination"</span> <span class="ot">=</span> <span class="st">"place"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(lon<span class="sc">:</span>lat) <span class="sc">%&gt;%</span> </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can deal with creating a for loop.<a href="#fn17" class="footnote-ref" id="fnref17" role="doc-noteref"><sup>17</sup></a> There are <a href="http://r4ds.had.co.nz/iteration.html#for-loops">three components of a for loop</a>: the creation of an object that will contain the output of the for loop, the sequence along which to run the for loop, and the actual code that will be looped. Let’s break this down one part at a time. The goal is to build an object that contains a 2x2 matrix for each route. We should start out by creating an empty vector of the appropriate form and length to hold the output of the for loop. We can do this by creating a <a href="http://colinfay.me/intro-to-r/lists-and-data-frames.html">list</a> that has a length equal to the number of rows in the <code>routes</code> data frame with the <code>vector()</code> function: <code>linestrings_sfg &lt;- vector(mode = "list", length = nrow(routes))</code>.</p>
<p>The second step is to define a sequence along which the function will loop by creating a variable that holds the place in the sequence and defining the sequence itself. The conventional variable used in a for loop is <code>i</code>. The sequence itself will be similar, if not identical, to the formula used to create the output object. In this case, we want a sequence from 1 — the first row — to 15 — the number of unique routes in our data, which we can determine programmatically by <code>1:nrow(routes)</code>. Thus, the sequence of the for loop is <code>for (i in 1:nrow(routes))</code> with <code>for</code> acting to choose the type of loop and the formula within the parentheses defining the sequence.</p>
<p>Finally, we are able to construct the code to create the desired output. We already know the inputs, output, and functions to use, which we can summarize as follows: <code>linestrings_sfg &lt;- st_linestring(rbind(sources_m, destinations_m))</code>.</p>
<p>However, we do not want to run this code, as it would create a single <code>sfg</code> object connecting all of the points. Instead, we can get our desired output by using the sequence variable to subset both the output list and input matrices in the code. For each iteration of the loop, we want the output to fill one component of the <code>linestrings_sfg</code> list, which we can access with <code>[[i]]</code>. Concerning the inputs, we want to select one row of coordinates from <code>sources_m</code> and one row of coordinates from <code>destinations_m</code> for each iteration. This is possible with the matrix subsetting method of <code>[row, column]</code>. Thus, we can access the sequence of rows with <code>sources_m[i, ]</code> and <code>destinations_m[i, ]</code>.</p>
<p>Putting the above together, we get a complete for loop that creates <code>linestrings_sfg</code>, a list of 15 <code>sfg</code> objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list object of length equal to number of routes</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>linestrings_sfg <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(routes))</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define sequence and body of loop</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(routes)) {</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  linestrings_sfg[[i]] <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">rbind</span>(sources_m[i, ],</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                                              destinations_m[i, ]))</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can check that the for loop worked by looking at the contents of one value from the list with <code>[[]]</code> subsetting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># geometry of a single route</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>linestrings_sfg[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>LINESTRING (4.402464 51.21945, 3.610998 51.4988)</code></pre>
</div>
</div>
<p>The next step is to create an <code>sfc</code> object by transforming the list of <code>sfg</code> objects into a geometry column with <code>st_sfc()</code>. An <code>sfc</code> object is referred to as a geometry set and is itself a list. It is at this step that the lines become geospatial through the addition of a CRS. At this point, we can also convert the rhumb lines to great circles by using <code>st_segmentize()</code> in the same manner as above in the pipeline.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sfc object of great circles</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>linestrings_sfc <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(linestrings_sfg, <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_segmentize</span>(units<span class="sc">::</span><span class="fu">set_units</span>(<span class="dv">20</span>, km))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print linestrings_sfc</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>linestrings_sfc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Geometry set for 15 features 
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 3.610998 ymin: 45.44085 xmax: 12.31552 ymax: 53.55108
Geodetic CRS:  WGS 84
First 5 geometries:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>LINESTRING (4.895168 52.37022, 5.135538 52.4182...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>LINESTRING (4.402464 51.21945, 4.205503 51.2897...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>LINESTRING (4.690093 51.8133, 4.67923 51.95682,...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>LINESTRING (7.206009 53.3594, 7.406604 53.32556...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>LINESTRING (4.646219 52.38739, 4.514556 52.2768...</code></pre>
</div>
</div>
<p><code>linestrings_sfc</code> is a fully geospatial object. The truncated print out of the coordinates for the first five features indicates that the lines have been segmentized and turned into great circles. The final step is to add the attribute data and convert the <code>sfc</code> object to a <code>sf</code> object with <code>st_sf()</code> and the <code>routes</code> data. The <code>st_sf()</code> function effectively adds <code>linestrings_sfc</code> to <code>routes</code> as a geometry column and converts the whole object to class <code>sf</code> and <code>data.frame</code>. Because we have not done anything to rearrange the rows of <code>routes</code> the data will line up correctly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object from data frame and sfc geometry set</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>routes_sf <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(routes, <span class="at">geometry =</span> linestrings_sfc)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print routes_sf</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>routes_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 15 features and 3 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 3.610998 ymin: 45.44085 xmax: 12.31552 ymax: 53.55108
Geodetic CRS:  WGS 84
First 10 features:
      source destination n                       geometry
1  Amsterdam      Bremen 1 LINESTRING (4.895168 52.370...
2    Antwerp  Middelburg 1 LINESTRING (4.402464 51.219...
3  Dordrecht     Haarlem 1 LINESTRING (4.690093 51.813...
4      Emden      Bremen 1 LINESTRING (7.206009 53.359...
5    Haarlem  Middelburg 1 LINESTRING (4.646219 52.387...
6    Haarlem   The Hague 1 LINESTRING (4.646219 52.387...
7    Hamburg      Bremen 1 LINESTRING (9.993682 53.551...
8   Het Vlie      Bremen 1 LINESTRING (5.183333 53.3, ...
9      Lisse       Delft 1 LINESTRING (4.557483 52.257...
10   Antwerp   The Hague 2 LINESTRING (4.402464 51.219...</code></pre>
</div>
</div>
<p>Though they were produced using very different methods, <code>routes_sf_tidy</code> and <code>routes_sf</code> are identical objects apart from the presence of an “id” column in <code>routes_sf_tidy</code>.</p>
<p>Now that we have attribute and spatial data for the great circles of the routes of the letters received by Daniel in 1585, we can create a map that uses color to distinguish the amount of letters sent along each route. Because they are essentially identical, you could use either <code>routes_sf_tidy</code> or <code>routes_sf</code> to create this map. The code to create a <code>ggplot2</code> map using <code>geom_sf()</code> is very similar to that made above to compare <code>routes_lines</code> and <code>routes_sf_tidy</code>. In this case, though, we want the color of the lines to differ according to the “n” variable. In addition, I change the color palette used for the lines to the <a href="https://cran.r-project.org/web/packages/viridis/index.html">viridis palette</a> on a continuous scale, hence the <code>_c</code> at the end of the function. I also label the color legend as “Letters”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot2 of great circle routes</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_sf, <span class="at">fill =</span> <span class="fu">gray</span>(<span class="fl">0.8</span>), <span class="at">color =</span> <span class="fu">gray</span>(<span class="fl">0.7</span>)) <span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> routes_sf, <span class="fu">aes</span>( <span class="at">color =</span> n)) <span class="sc">+</span> </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Letters"</span>, <span class="at">title =</span> <span class="st">"Great circles with sf"</span>) <span class="sc">+</span> </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">14</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">54</span>), <span class="at">datum =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/great-circles-sf-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<ul>
<li>Great circles with <code>sp</code>
<ul>
<li><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/">Flowing Data – How to map connections with great circles</a>
<ul>
<li><a href="http://personal.tcu.edu/kylewalker/interactive-flow-visualization-in-r.html">Kyle Walker – Interactive flow visualization in R</a></li>
<li><a href="https://www.dataplanes.org/notes/2018/01/27/flight-routes-night-lights">Data Planes – Flights at Night: Mapping airline routes on NASA’s night lights images</a></li>
</ul></li>
</ul></li>
<li>Great circles with <code>sf</code> - <a href="http://www.visibledata.co.uk/blog/2018/02/28/2018-02-28_great-circles-with-sf-and-leaflet/">Martin Hadley – Great circles with sf and leaflet</a> - <a href="http://jsmayorga.com/post/mapping-the-global-network-of-transnational-fisheries/">Juan Mayorga – Mapping the Global Network of Transnational Fisheries</a></li>
</ul>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>As Mercator explained in <a href="https://en.wikipedia.org/wiki/Mercator_1569_world_map#legend6">legend 6</a> the distortion of distance is infinite at the poles such that they cannot actually be represented on the map.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Joaquim Alves Gaspar, “Revisiting the Mercator World Map of 1569: an Assessment of Navigational Accuracy,” <em>The Journal of Navigation</em> 69 (2016): 1183–1196.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Roy Iliffe, “Science and the Voyages of Discovery,” in <em>The Cambridge History of Science: Eighteenth-Century Science</em>, ed.&nbsp;Roy Porter (Cambridge: Cambridge University Press, 2003).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>See the resources section at the end of the post for a list of posts on creating great circles in R.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Previous to <a href="https://github.com/r-spatial/sf/blob/master/NEWS.md">version 0.6</a>, <code>sf</code> also used the <code>geosphere</code> package to calculate distance and create great circles with geographic coordinates. The change to use the <code>lwgeom</code> package, which is an implementation of the <a href="https://github.com/postgis/postgis/tree/svn-trunk/liblwgeom">liblwgeom</a> library, aligns <code>sf</code> with the methods used by <a href="http://postgis.net/">PostGIS</a>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>This is hardly surprising. Until the fall of 1585, Daniel’s family mainly resided in Antwerp, and he was serving as a representative to the States General, which was meeting at Delft.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>You can also set whether you want the line to be broken at the International Date Line, but the argument is superfluous in this case.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>Setting <code>sp = FALSE</code>, which is the default, returns a list of matrices containing the latitude and longitude values for the path along the great circle of each route.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>Even if you set the <code>Match.ID</code> argument to <code>FALSE</code>, the lines and attribute data would be correctly aligned as long as you do not change the order of the <code>routes</code> data frame after creating <code>sources_tbl</code> and <code>destinations_tbl</code>.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>This method is similar to the original workflow shown by <a href="http://www.visibledata.co.uk/blog/2018/02/28/2018-02-28_great-circles-with-sf-and-leaflet/">Martin Hadley in his post on Great circles with sf and leaflet</a>.<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>For more information on <code>gather()</code> and <code>spread()</code> see <a href="http://r4ds.had.co.nz/tidy-data.html">Wickham, <em>R for Data Science</em>, Chapter 12</a> and <a href="https://github.com/jtr13/codehelp/blob/master/R/gather.md">Joyce Robbins’s excellent tutorial on <code>gather()</code></a>.<a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn12"><p>It is not necessary to place “type” and “place” in quotations, but doing so more clearly identifies these as strings and not as names of already extant objects.<a href="#fnref12" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn13"><p>You do not need to include the geometry column in the <code>group_by()</code> function. <a href="https://jessesadler.com/post/simple-feature-objects/#sf">The geometry column is sticky</a> and will remain attached to the <code>sf</code> object unless explicitly removed.<a href="#fnref13" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn14"><p>The <code>units</code> package is imported along with <code>sf</code>, so if you have <code>sf</code>, you should also have the <code>units</code> package.<a href="#fnref14" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn15"><p>The equivalent code without the <code>units</code> package would be <code>st_segmentize(routes_lines, 20000)</code>.<a href="#fnref15" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn16"><p>See the same <a href="https://jessesadler.com/post/simple-feature-objects/">post</a> for a more in depth treatment of the vocabulary of simple feature objects.<a href="#fnref16" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn17"><p>If you are familiar with for loops in R, you can skip this discussion of the steps to build the for loop.<a href="#fnref17" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://www.quarto.org">Built with Quarto</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://hachyderm.io/@vivalosburros">
      <i class="bi bi-mastodon" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jessesadler">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>