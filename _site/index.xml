<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>A Rogue Historian</title>
<link>https://www.jessesadler.com/</link>
<atom:link href="https://www.jessesadler.com/index.xml" rel="self" type="application/rss+xml"/>
<description>Personal website of Jesse Sadler</description>
<generator>quarto-1.5.55</generator>
<lastBuildDate>Thu, 23 Mar 2023 04:00:00 GMT</lastBuildDate>
<item>
  <title>debkeepr: An R package for the analysis of non-decimal currencies</title>
  <link>https://www.jessesadler.com/post/debkeepr-cran/</link>
  <description><![CDATA[ 
<div class="no-row-height column-margin column-container"><div class="">
<p><img src="https://www.jessesadler.com/post/debkeepr-cran/img/logo.png" class="img-fluid"></p>
</div></div><p><code>debkeepr</code> is now—finally—on CRAN with <a href="https://cran.r-project.org/package=debkeepr">version 0.1.1</a>! <code>debkeepr</code> integrates non-decimal currencies that use tripartite or tetrapartite systems into the methodologies of Digital Humanities and the practices of reproducible research. The package makes it possible for historical non-decimal currencies, such as the tripartite system of pounds, shillings, and pence (£465 12s. 8d.), to behave like decimalized values through the implementation of the <code>deb_lsd</code>, <code>deb_tetra</code>, and <code>deb_decimal</code> vector types. These types are based on the infrastructure provided by the <a href="https://vctrs.r-lib.org/">vctrs package</a>. The name of the package derives from its ability to analyze historical account books that used the system of <strong>D</strong>ouble-<strong>e</strong>ntry <strong>b</strong>ook<strong>keep</strong>ing.</p>
<p>You can now install the released version of <code>debkeepr</code> from CRAN or the development version on GitHub:</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install CRAN release</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"debkeepr"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install development version</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("pak")</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pak</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://pak.r-lib.org/reference/pak.html">pak</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jessesadler/debkeepr"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Please open an <a href="https://github.com/jessesadler/debkeepr/issues">issue</a> if you have any questions, comments, or requests.</p>
<p>This release has been a long time coming. I first started to develop <code>debkeepr</code> in 2018 to deal with the problem of performing mathematical operations on non-decimal currencies of pounds, shillings, and pence that was crucial to my research on <a href="../../project/df-inheritance.html">merchant families in the 16th and 17th centuries</a>. I introduced the package with <a href="../../post/debkeepr-intro/">this blog post</a> in September 2018. After talking to Hadley Wickham at the Tidyverse developer day at RStudio::conf 2019, I completely rewrote the package, using the <a href="https://vctrs.r-lib.org/">vctrs package</a> to develop fully integrated S3 vector types that could represent non-decimal currencies. I discussed this process at <a href="https://posit.co/resources/videos/vctrs-creating-custom-vector-classes-with-the-vctrs-package/">RStudio::conf 2020</a>. Since then, I have been developing the package on and off, while also using it for my historical research.<sup>1</sup> But I never quite got around to putting the package on CRAN. However, progress was made. I kept up with changes to <code>vctrs</code> and <a href="https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/">dplyr</a> and added a new class for tetrapartite values: pounds, shillings, pence, and farthings. The forthcoming second edition of the <a href="https://r-pkgs.org"><em>R Packages</em></a> book by Hadley Wickham and Jenny Bryan and the recently updated chapter on <a href="https://r-pkgs.org/release.html">Releasing to CRAN</a> helped motivate me to finally prep and submit the package for CRAN release. On 22 March 2023 version 0.1.1 of <code>debkeepr</code> was accepted on CRAN after one quite minor round of changes.</p>
<section id="usage" class="level2"><h2 class="anchored" data-anchor-id="usage">Usage</h2>
<p>The <code>debkeepr</code> package introduces three new vector types—<code>deb_lsd()</code>, <code>deb_tetra()</code>, and <code>deb_decimal()</code>—to deal with two interrelated problems inherent in historical non-decimal currencies and other such value systems.</p>
<ol type="1">
<li>Historical currencies consist of three or four separate non-decimal <strong>units</strong>.</li>
<li>The <strong>bases</strong> of the shillings, pence, and optionally farthing units differed by region, coinage, and era.</li>
</ol>
<p>The <code>deb_lsd</code> type maintains the tripartite structure of non-decimal currencies and provides a <code>bases</code> attribute to record the bases for the shillings and pence units. The <code>deb_tetra</code> type extends the concept of the <code>deb_lsd</code> type to incorporate currencies and other types of values that consist of four units. The <code>deb_decimal</code> type provides a means to decimalize both <code>deb_lsd</code> and <code>deb_tetra</code> types, while keeping track of the two or three non-decimal <code>bases</code> and the <code>unit</code> represented as attributes.<sup>2</sup></p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/jessesadler/debkeepr">debkeepr</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create deb_lsd, deb_tetra, and deb_decimal vectors</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># with default bases of 20s. 12d.</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># deb_lsd vector: £8 13s. 4d.</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>l <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;deb_lsd[1]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 8:13s:4d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Bases: 20s 12d</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># deb_tetra vector: £8 13s. 4d. 3f.</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_tetra</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>l <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;deb_tetra[1]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 8:13s:4d:3f</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Bases: 20s 12d 4f</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># deb_decimal: £8 13s. 4d. in decimalized shillings</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_decimal</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">173.33</span>, unit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"s"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;deb_decimal[1]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 173.33</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Unit: solidus</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Bases: 20s 12d</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cast £8 13s. 4d. to a decimal form</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_as_decimal</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;deb_decimal[1]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 8.666667</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Unit: libra</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Bases: 20s 12d</span></span></code></pre></div>
</div>
</section><section id="resources" class="level2"><h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p><code>debkeepr</code> provides three vignettes and example data to help get started using the package.</p>
<ul>
<li>
<a href="https://jessesadler.github.io/debkeepr/articles/debkeepr.html">Getting Started with debkeepr vignette</a> provides a thorough introduction to the package and the three <code>debkeepr</code> vector types.</li>
<li>
<a href="https://jessesadler.github.io/debkeepr/articles/transactions.html">Transactions in Richard Dafforne’s Journal vignette</a> goes through examples of financial and arithmetic calculations dealing with various currencies taken from the practice journal in Richard Dafforne’s <em>Merchant’s Mirrour</em> (1660), a 17th-century textbook for learning accounting practices.</li>
<li>
<a href="https://jessesadler.github.io/debkeepr/articles/ledger.html">Analysis of Richard Dafforne’s Journal and Ledger vignette</a> analyzes and visualizes the practice double-entry bookkeeping ledger from Dafforne’s <em>Merchant’s Mirrour</em> as found in the <a href="https://jessesadler.github.io/debkeepr/reference/dafforne_transactions.html"><code>dafforne_transactions</code></a> and <a href="https://jessesadler.github.io/debkeepr/reference/dafforne_accounts.html"><code>dafforne_accounts</code></a> data provided in <code>debkeepr</code>.</li>
</ul>
<p>The rest of this post will provide a quick overview of how <code>debkeepr</code> can assist historians in research involving non-decimal currencies and bring the study of historical account books into the practices of reproducible research.</p>
</section><section id="arithmetic-with-non-decimal-currencies" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="arithmetic-with-non-decimal-currencies">Arithmetic with non-decimal currencies</h2>
<p>Arithmetic with non-decimal currencies is cumbersome and error-prone, at least if you were not educated within non-decimal systems. The primary issue is the need to do <a href="https://en.wikipedia.org/wiki/Arithmetic#Compound_unit_arithmetic">compound unit arithmetic</a> to normalize units according to their bases.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[60,40]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 60.0%;justify-content: flex-start;">
<div id="fig-barbary" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-barbary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/debkeepr-cran/img/barbary-scratchpad.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-barbary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: A scratchpad from the archive of Daniel van der Meulen
</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 40.0%;justify-content: flex-start;">
<div id="fig-cua" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-cua-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/debkeepr-cran/img/compound-arithmetic.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cua-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Compound unit arithmetic
</figcaption></figure>
</div>
</div>
</div>
</div>
<p><code>debkeepr</code> types provide a way to access arithmetic operations and <a href="https://jessesadler.github.io/debkeepr/reference/mathematics.html">mathematical functions</a> for non-decimal values, drastically simplifying these calculations. For instance, we can add together the values in Figure&nbsp;2 with either <code>+</code> or <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add multiple deb_lsd vectors</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;deb_lsd[1]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 134:15s:11d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Bases: 20s 12d</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sum of one deb_lsd vector</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>l <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>          s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>          d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;deb_lsd[1]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 134:15s:11d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Bases: 20s 12d</span></span></code></pre></div>
</div>
<p>Addition and subtraction might be cumbersome with non-decimal values, but multiplication and division get tricky quite quickly. We can see this using examples from the article on Arithmetic in the third edition of the <a href="http://onlinebooks.library.upenn.edu/webbin/metabook?id=britannica3"><em>Encyclopedia Britannica</em>, printed in 1797</a> and comparing these to the process with <code>debkeepr</code> types.</p>
<p>The <em>Encyclopedia Britannica</em> outlines the process for multiplying £15 3s. 8d. sterling by 32 and £17 3s. 8d. sterling by 75. It breaks down larger multiplication operations into smaller ones. Multiplying £15 3s. 8d. sterling by 32 becomes a matter of sequentially multiplying the monetary value by 8 and then by 4. Multiplying £17 3s. 8d. sterling by 75 is presented as a three step process of multiplying by 3, then by 5, and then 5 again as <code>3 * 5 * 5 = 75</code>. With <code>debkeepr</code> you can use multiplication as you would any other numeric vector.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multiply £15 3s. 8d. sterling by 32</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;deb_lsd[1]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 485:17s:4d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Bases: 20s 12d</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multiply £17 3s. 8d. sterling by 75</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;deb_lsd[1]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 1288:15s:0d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Bases: 20s 12d</span></span></code></pre></div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-multiplication" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-multiplication-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/debkeepr-cran/img/lsd-multiplication.png" height="350" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multiplication-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Multiplication in <em>Encyclopedia Britannica</em>
</figcaption></figure>
</div>
</div></div><p>The process for division presented in the <em>Encyclopedia Britannica</em> might bring you back to grade school and long division problems, though the operation also includes multiplication due to the need to convert between units. The <em>Encyclopedia</em> shows the division of £465 12s. 8d. sterling by 72 and 345 hundredweight 1 quarter 8 lbs by 22. This latter example provides an opportunity to demonstrate how you can use the <code>bases</code> argument in <code>debkeepr</code>-type vectors to adapt them to other value systems besides the default of 20 shillings to the pound and 12 pence to the shilling. In this case, there are 4 quarters in a hundredweight and 28 pounds in a quarter. This example also gives proof of the gains in accuracy, as the answer is shown as 15 cwt. 2 q. 21 lb., but it should actually be 22 lb.<sup>3</sup> Note too that the output of <code>debkeepr</code> types shows the bases of the vectors: <code># Bases: 4s 28d</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Divide £465 12s. 8d. sterling by 72</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">465</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;deb_lsd[1]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 6:9s:4.111d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Bases: 20s 12d</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Divide 345 hundredweight 1 quarter 8 lbs by 22</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">345</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, bases <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;deb_lsd[1]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 15:2s:22d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Bases: 4s 28d</span></span></code></pre></div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-division" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-division-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/debkeepr-cran/img/lsd-division.png" height="400" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-division-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Division in <em>Encyclopedia Britannica</em>
</figcaption></figure>
</div>
</div></div><p>The example of dividing a measurement of weight also provides an opportunity to use the <code>deb_tetra</code> type that allows for four units, here hundredweight, quarters, stones, and pounds. We can, thus, rewrite the value to be divided as 345 cwt. 1 q. 0 st. 8 lb.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Divide 345 cwt. 1 q. 0 st. 8 lb. by 22</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_tetra</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">345</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, bases <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; &lt;deb_tetra[1]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 15:2s:1d:8f</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Bases: 4s 2d 14f</span></span></code></pre></div>
</div>
<p>For many more examples, including how to work with vectors of different types and different bases see the <a href="https://jessesadler.github.io/debkeepr/articles/debkeepr.html">Getting Started with debkeepr vignette</a> and the <a href="https://jessesadler.github.io/debkeepr/articles/transactions.html">Transactions in Richard Dafforne’s Journal vignette</a>.</p>
</section><section id="debkeepr-and-double-entry-bookkeeping" class="level2"><h2 class="anchored" data-anchor-id="debkeepr-and-double-entry-bookkeeping">
<code>debkeepr</code> and double-entry bookkeeping</h2>
<div id="fig-accounts" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-accounts-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/debkeepr-cran/img/account-book.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-accounts-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Account book of Jacques della Faille, 1585
</figcaption></figure>
</div>
<p>The ability to treat non-decimal values of three (<code>deb_lsd</code>) or four (<code>deb_tetra</code>) units as numeric vectors greatly simplifies analysis of these types of values. However, it is the integration of <code>debkeepr</code> types in data frame columns—particularly in the form of what <code>debkeepr</code> refers to as <a href="https://jessesadler.github.io/debkeepr/reference/transactions.html#transactions-data-frames-">transaction data frames</a>—that makes it possible to bring the analysis of historical account books recorded in various non-decimal currencies into the practices of Digital Humanities and reproducible research. <code>debkeepr</code> provides a methodology to enter data from historical account books and create <code>deb_lsd</code> or <code>deb_tetra</code> columns with <code>deb_gather_lsd()</code> and <code>deb_gather_tetra()</code> respectively. These data frames can then be analyzed and visualized using methods such as those provided by the <a href="https://www.tidyverse.org">tidyverse</a>, particularly with <a href="https://dplyr.tidyverse.org/">dplyr</a> and <a href="https://ggplot2.tidyverse.org/">ggplot2</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">240</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Raw data of a transaction data frame</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Input each unit of non-decimal currency as separate column</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">raw_data</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span>  credit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  debit  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  l <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">raw_data</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   id credit debit  l  s  d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1  1      1     3 24  6 10</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2  2      3     2 34 12  5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3  3      2     1 83  2  4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4  4      2     3 41  5  9</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5  5      3     1 92 11 11</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create deb_lsd column</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_gather_lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">raw_data</span>,</span>
<span>               l <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">l</span>, s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">s</span>, d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">d</span>,</span>
<span>               lsd_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lsd</span>, replace <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   id credit debit        lsd</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1  1      1     3  24:6s:10d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2  2      3     2  34:12s:5d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3  3      2     1   83:2s:4d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4  4      2     3   41:5s:9d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5  5      3     1 92:11s:11d</span></span></code></pre></div>
</div>
<p><code>debkeepr</code> includes two data frames of example data. <code>dafforne_transactions</code> is a transactions data frame that has columns for transaction <code>id</code>, <code>credit</code> account, <code>debit</code> account, <code>date</code> of the transaction, and the value of the transaction as a <code>deb_lsd</code> column with bases 20s. and 12d., along with some addition information. This is paired with a data frame containing information about the 46 accounts in Dafforne’s practice ledger. See <code>?dafforne_transactions</code> and <code>?dafforne_accounts</code> for more details. For a fuller discussion of using these data frames, see the <a href="https://jessesadler.github.io/debkeepr/articles/ledger.html">Analysis of Richard Dafforne’s Journal and Ledger vignette</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load tidyverse packages</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transactions data frame</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dafforne_transactions</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 177 × 8</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       id credit debit date                  lsd journal ledger description      </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;     &lt;lsd[20s:12d]&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;            </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1     1      2     1 1633-01-01    1000:15s:7d       1 1/1    Various coins of…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2     2      2     3 1633-01-01     477:10s:0d       1 1/1    60 Leeds dozens …</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3     3      2     4 1633-01-01       55:0s:6d       1 2/1    5 barrels that r…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4     4      2     5 1633-01-01      240:0s:0d       1 2/1    For 800 French c…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5     5      2     6 1633-01-01      229:0s:0d       1 2/1    2290 guilders re…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6     6      2     8 1633-01-01       3:17s:8d       1 3/1    Expenses for the…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7     7      7     2 1633-01-01      150:0s:0d       1 1/2    Ready money from…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8     8      9    11 1633-01-04      360:0s:0d       1 4/3    100 Leeds dozens…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9     9      1     9 1633-01-04      144:0s:0d       2 3/1    For 2/5 of the 1…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10    10      5    10 1633-01-04      120:0s:0d       2 3/2    400 French crown…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # ℹ 167 more rows</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Accounts data frame</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dafforne_accounts</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 46 × 5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       id account                                    ledger investor  description</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;int&gt; &lt;chr&gt;                                       &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;      </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1     1 Cash                                            1 Ego       Account fo…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2     2 Stock                                           1 Ego       Account of…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3     3 Wares                                           1 Ego       Account fo…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4     4 Kettles                                         2 Ego       Account fo…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5     5 Jean du Boys - account current                  2 Jean du … Factor in …</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6     6 Jacob Symonson - account by him in company      2 Jacob Sy… Aggregatio…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7     7 Jacob Symonson - account current                2 Jacob Sy… Current ac…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8     8 Jacob Symonson - Cochineal                      3 Jacob Sy… Sale of co…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9     9 George Pinchback                                3 George P… Account wi…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10    10 Jacob Symonson - ready money                    3 Jacob Sy… Account of…</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # ℹ 36 more rows</span></span></code></pre></div>
</div>
<p><code>debkeepr</code> provides a <a href="https://jessesadler.github.io/debkeepr/reference/transactions.html">set of functions</a> that work with data frames with the same structure as <code>dafforne_transactions</code>. <code>deb_account_summary()</code> is useful for obtaining an overview of the account book at its closing, providing a summary of the total credits, debits, and current value of each account.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dafforne_transactions</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_account_summary</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>credit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">credit</span>, debit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">debit</span>, lsd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 46 × 4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    account_id         credit          debit        current</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         &lt;dbl&gt; &lt;lsd[20s:12d]&gt; &lt;lsd[20s:12d]&gt; &lt;lsd[20s:12d]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1          1   1956:10s:11d    2903:13s:0d   -947:-2s:-1d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2          2     2006:3s:9d      150:0s:0d     1856:3s:9d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3          3      570:0s:0d      570:0s:0d        0:0s:0d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4          4       75:0s:8d       75:0s:8d        0:0s:0d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5          5      813:3s:0d      813:3s:0d        0:0s:0d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6          6     568:1s:11d      869:2s:7d    -301:0s:-8d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7          7   2958:18s:10d   2958:18s:10d        0:0s:0d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8          8    1580:10s:0d    1580:10s:0d        0:0s:0d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9          9     1744:1s:4d     1744:1s:4d        0:0s:0d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10         10      606:2s:6d      606:2s:6d        0:0s:0d</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # ℹ 36 more rows</span></span></code></pre></div>
</div>
<p>We can present this information in a line-range plot in which the upper range represents the total credit, the lower range the total debit, and a point for the current value. This also allows an opportunity to point out some limitations of the <code>deb_lsd</code> and <code>deb_tetra</code> vector types; <code>ggplot2</code> currently does not know how to pick a scale for <code>deb_lsd</code> and <code>deb_tetra</code> columns. However, <code>deb_decimal</code> columns work as expected. It is therefore necessary to cast the <code>deb_lsd</code> or <code>deb_tetra</code> columns to <code>deb_decimal</code> with <code>deb_as_decimal()</code>, either before or within the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> call.<sup>4</sup> For a line-range plot we also need to turn the <code>debit</code> column into negative values.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot summary of accounts</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dafforne_transactions</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>lsd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_as_decimal</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lsd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_account_summary</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Columns have default names of credit, debit, and lsd</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>debit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">debit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_linerange</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">account_id</span>, ymin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">debit</span>, ymax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">credit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">account_id</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">current</span>,</span>
<span>                     color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">current</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Closed"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Open"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Open <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, Closed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scales</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://scales.r-lib.org/reference/dollar_format.html">label_dollar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>prefix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"\u00a3"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Accounts"</span>,</span>
<span>         y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pounds sterling"</span>,</span>
<span>         color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Status"</span>,</span>
<span>         title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Summary of the accounts"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/debkeepr-cran/index_files/figure-html/summary-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="debkeepr-and-reproducibility" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="debkeepr-and-reproducibility">
<code>debkeepr</code> and reproducibility</h2>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-scratchpad" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-scratchpad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/debkeepr-cran/img/math-scratchpad.jpg" height="400" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-scratchpad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Scratchpad: Doing math by hand
</figcaption></figure>
</div>
</div></div><p>The above plot only scratches the surface of the possibilities for exploring and analyzing account books that use historical non-decimal currencies with <code>debkeepr</code>. The <a href="https://jessesadler.github.io/debkeepr/articles/transactions.html">Transactions in Richard Dafforne’s Journal vignette</a> provides additional examples. Yet, what I think is the most significant about <code>debkeepr</code> is not any one plot, time saving feature, or type of analysis, but rather the possibility of using the practices of reproducible research in the context of historical economic data. Individual calculations are easier to track and validate when written in code rather than scrawled out on a scratch piece of paper or entered into a calculator. Even more importantly, <code>debkeepr</code> provides a workflow for entering data from account books into a data base, <a href="http://vita.had.co.nz/papers/tidy-data.html">tidying the data</a>, and then exploring, analyzing, and visualizing the data in ways that integrate with the <a href="https://www.tidyverse.org">tidyverse</a> and more general practices of data analysis in R.</p>
<p>I have seen this in my own work on the <a href="../../project/df-inheritance.html">accounts of the estate of Jan della Faille de Oude</a>. Without <code>debkeepr</code> the process of transcribing the over 2,100 transactions and analyzing the 480 accounts appeared to have limited use for quite a bit of work. Instead, I picked a handful of crucial accounts and worked by hand. With <code>debkeepr</code> the effort becomes worthwhile and whole plethora of research questions and ways to communicate were opened up. It is my hope that <code>debkeepr</code> can help bring to light crucial and interesting social interactions that are buried in economic manuscripts, making these stories accessible to a wider audience.</p>


</section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>For instance, in my talk, “Rough Estimation: Inheritance, Accounting, and Sibling Rivalry in an Early Modern Merchant Family.” See the <a href="https://www.youtube.com/watch?v=qHTXnYiNC5c">video</a> and/or <a href="https://www.jessesadler.com/slides/lchs2021.pdf">slides</a>.↩︎</p></li>
<li id="fn2"><p><code>debkeepr</code> uses the nomenclature of <a href="https://en.wikipedia.org/wiki/%C2%A3sd">l, s, and d</a> to represent pounds, shillings, and pence units in non-decimal currencies. The abbreviations derive from the Latin terms <a href="https://en.wikipedia.org/wiki/French_livre"><em>libra</em></a>, <a href="https://en.wikipedia.org/wiki/Solidus_(coin)"><em>solidus</em></a>, and <a href="https://en.wikipedia.org/wiki/Denarius"><em>denarius</em></a>. It uses the default of 20 shillings to the pound and 12 pence to the shilling that became ingrained in much of Europe during the <a href="https://en.wikipedia.org/wiki/Carolingian_Empire">Carolingian Empire</a> in the 9th century. However, a variety of <a href="https://en.wikipedia.org/wiki/Non-decimal_currency">other bases</a> also developed over time, and so these bases can be modified by the user using the <code>bases</code> argument.↩︎</p></li>
<li id="fn3"><p>Checking the long division at the bottom of the calculation, 22 goes into 44 twice not once.↩︎</p></li>
<li id="fn4"><p>The only context in which casting to <code>deb_decimal</code> results in any loss of information is in labeling the plotted values. However, this can be rectified through <code>deb_text()</code>, which provides a flexible way to format <code>debkeepr</code> types as text.↩︎</p></li>
</ol></section></div> ]]></description>
  <category>rstats</category>
  <category>debkeepr</category>
  <guid>https://www.jessesadler.com/post/debkeepr-cran/</guid>
  <pubDate>Thu, 23 Mar 2023 04:00:00 GMT</pubDate>
  <media:content url="https://www.jessesadler.com/post/debkeepr-cran/img/logo.png" medium="image" type="image/png" height="167" width="144"/>
</item>
<item>
  <title>Downloading Twitter data with rtweet</title>
  <link>https://www.jessesadler.com/post/rtweet/</link>
  <description><![CDATA[ <p>Last night, the 17th of November, 2022, I, like so many others, was rather gleefully, but also sadly, doom scrolling through Twitter as Elon Musk seemed to be rocketing the social network into the ground at amazing speed.</p>
<p></p>
<div id="tweet-62682"></div>
<script>tweet={"url":"https:\/\/twitter.com\/_inundata\/status\/1593421891439513600","author_name":"Karthik Ram","author_url":"https:\/\/twitter.com\/_inundata","html":"\u003Cblockquote class=\"twitter-tweet\" align=\"center\"\u003E\u003Cp lang=\"en\" dir=\"ltr\"\u003ETwitter vibe this evening \u003Ca href=\"https:\/\/t.co\/TxPnf2DGXw\"\u003Epic.twitter.com\/TxPnf2DGXw\u003C\/a\u003E\u003C\/p\u003E&mdash; Karthik Ram (@_inundata) \u003Ca href=\"https:\/\/twitter.com\/_inundata\/status\/1593421891439513600?ref_src=twsrc%5Etfw\"\u003ENovember 18, 2022\u003C\/a\u003E\u003C\/blockquote\u003E\n\u003Cscript async src=\"https:\/\/platform.twitter.com\/widgets.js\" charset=\"utf-8\"\u003E\u003C\/script\u003E\n\n","width":550,"height":null,"type":"rich","cache_age":"3153600000","provider_name":"Twitter","provider_url":"https:\/\/twitter.com","version":"1.0"};document.getElementById("tweet-62682").innerHTML = tweet["html"];</script><p>It seemed a good time to heed the warning that so many had put out about downloading your twitter data: your tweets, those you follow, your followers, and maybe the Twitter lists that you have created or followed. I knew that much of this could be done with the <a href="https://docs.ropensci.org/rtweet/articles/rtweet.html">rtweet</a> package, and I had seen a few people tweet out ways to get the data, in particular, I had saved <a href="https://twitter.com/AmeliaMN">Amelia McNamara’s</a> tweet from <a href="https://twitter.com/AmeliaMN/status/1591100508298956808">11 November 2022</a>.</p>
<p><img src="https://www.jessesadler.com/post/rtweet/AmeliaMN-2022-11-11.jpeg" class="img-fluid" alt="@AmeliaMN's instructions for using rtweet."></p>
<p>I followed <a href="https://gist.github.com/AmeliaMN/c2e75ca0da51232dd2f8200646fd24c5">her script</a>, played around with the functions in <code>rtweet</code> a bit, and tried to fit the basics of a script to download most of the important data in one tweet.</p>
<p></p>
<div id="tweet-53103"></div>
<script>tweet={"url":"https:\/\/twitter.com\/vivalosburros\/status\/1593444948841443328","author_name":"Jesse Sadler - @vivalosburros@hachyderm.io","author_url":"https:\/\/twitter.com\/vivalosburros","html":"\u003Cblockquote class=\"twitter-tweet\" align=\"center\"\u003E\u003Cp lang=\"en\" dir=\"ltr\"\u003ETwitter data downloaded thanks to rtweet and \u003Ca href=\"https:\/\/twitter.com\/hashtag\/rstats?src=hash&amp;ref_src=twsrc%5Etfw\"\u003E#rstats\u003C\/a\u003E\u003Cbr\u003E\u003Cbr\u003Eget_timeline(“user”, n = inf)\u003Cbr\u003E\u003Cbr\u003Efriends &lt;- get_friends(“user”)\u003Cbr\u003Elookup_users(friends$to_id)\u003Cbr\u003E\u003Cbr\u003Efollowers &lt;- get_followers(“user”)\u003Cbr\u003Elookup_users(followers$from_id)\u003Cbr\u003E\u003Cbr\u003Elists &lt;- lists_users(“user”)\u003Cbr\u003Emap(lists$list_id, lists_members)\u003C\/p\u003E&mdash; Jesse Sadler - @vivalosburros@hachyderm.io (@vivalosburros) \u003Ca href=\"https:\/\/twitter.com\/vivalosburros\/status\/1593444948841443328?ref_src=twsrc%5Etfw\"\u003ENovember 18, 2022\u003C\/a\u003E\u003C\/blockquote\u003E\n\u003Cscript async src=\"https:\/\/platform.twitter.com\/widgets.js\" charset=\"utf-8\"\u003E\u003C\/script\u003E\n\n","width":550,"height":null,"type":"rich","cache_age":"3153600000","provider_name":"Twitter","provider_url":"https:\/\/twitter.com","version":"1.0"};document.getElementById("tweet-53103").innerHTML = tweet["html"];</script><p>Below, I will expand on the Tweet to show more fully how to download and save your Twitter data. This closely follows Amelia’s script but adds a bit of data.</p>
<section id="getting-the-data" class="level3"><h3 class="anchored" data-anchor-id="getting-the-data">Getting the data</h3>
<p>Let’s get the data of the tweets, followers, those followed, and lists of a single user. Here, I use my own account of <a href="http://twitter.com/vivalosburros"><span class="citation" data-cites="vivalosburros">@vivalosburros</span></a>. If you want to go even further in moving away from Twitter and use <code>rtweet</code> to delete your tweets, see <a href="https://juliasilge.com/blog/delete-tweets/">Julia Silge’s post</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load rtweet and tidyverse for cleaning and saving data</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://docs.ropensci.org/rtweet/">rtweet</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Authenticate twitter</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">auth_setup_default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Twitter user name: I use my own name @vivalosburros</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">user</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vivalosburros"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Your tweets -------------------------------------------------------------</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tweets</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_timeline</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">user</span>, n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Who you follow ----------------------------------------------------------</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">friends</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_friends</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">user</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">friend_screennames</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lookup_users</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">friends</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">to_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Followers ---------------------------------------------------------------</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">followers</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_followers</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">user</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">follower_screennames</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lookup_users</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">followers</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">from_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Lists -------------------------------------------------------------------</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lists</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lists_users</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">user</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a list of tibbles of the different lists you follow</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lists_screenames</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lists</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">list_id</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lists_members</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
</section><section id="clean-the-data" class="level3"><h3 class="anchored" data-anchor-id="clean-the-data">Clean the data</h3>
<p>The data we get is returned as tibbles with many columns that have data that might not be all that useful to you. However, you can easily skip this data cleaning step if you just want the raw data. The variables that you are interested in might be different than the ones I have below.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select desired columns: Feel free to skip</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tweets</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tweets</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">created_at</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">full_text</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">retweet_count</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">retweeted</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">friend_screennames</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">friend_screennames</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">follower_screennames</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">follower_screennames</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lists_screenames</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lists_screenames</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">.</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">user_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
</section><section id="saving-the-data" class="level3"><h3 class="anchored" data-anchor-id="saving-the-data">Saving the data</h3>
<p>Now we can save the data in a folder called <code>data/</code> with the <a href="https://readr.tidyverse.org"><code>readr</code></a>. The only tricky part is using <code><a href="https://purrr.tidyverse.org/reference/map2.html">walk2()</a></code> from <a href="https://purrr.tidyverse.org"><code>purrr</code></a> to save the list of tibbles that has the Twitter lists you follow, if you follow more than one.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save the tweets, following, and followers data</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tweets</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/tweets.csv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">friend_screennames</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/following.csv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">follower_screennames</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/followers.csv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save the list data and name csv with the list name</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get names of lists</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">list_names</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lists</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://purrr.tidyverse.org/reference/map2.html">walk2</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lists_screenames</span>,</span>
<span>      <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">list_names</span>,</span>
<span>      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">.x</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/list-"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">.y</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".csv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Now you have all your data. All that is left is to watch the ship sink and make fun of billionaires who think they are geniuses 🫡.</p>


</section> ]]></description>
  <category>rstats</category>
  <category>twitter</category>
  <guid>https://www.jessesadler.com/post/rtweet/</guid>
  <pubDate>Fri, 18 Nov 2022 05:00:00 GMT</pubDate>
  <media:content url="https://www.jessesadler.com/post/rtweet/twitter-is-fine.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Moving to Quarto</title>
  <link>https://www.jessesadler.com/post/moving-to-quarto/</link>
  <description><![CDATA[ 




<p>It has been a while since I have posted anything new to this site. I had a pretty good pace of posting going for a while and then things got busy, a pandemic occurred, and I moved a couple of times, and somehow it has now been four years since I have made a new post. Every couple of months I would get the itch to write something new, but I just never got around to doing it. But now I hoping to make a concerted effort to revitalize the blog. There are two main reasons for doing so now: an interest in trying out <a href="https://quarto.org">Quarto</a> and a desire to again participate more actively in the digital humanities, data science, and rstats communities.</p>
<p>When I <a href="../../post/by-way-of-introduction/">first began this blog</a> in 2017, I had the goal of trying to learn as many digital skills as possible. I was in the middle of learning R, but I also wanted to gain some basic understanding of the workings of websites. There were some options like <a href="https://bookdown.org/yihui/blogdown/">blogdown</a> that would have combined my newfound interest in R and my desire to create a website, but I was not sure I wanted to fully commit to the R ecosystem. And I figured I could learn more by going an alternate route. I eventually settled on <a href="https://gohugo.io">Hugo</a>, which has served me well, but now I am ready to make the switch to Quarto.</p>
<p><a href="https://www.apreshill.com/blog/2022-04-we-dont-talk-about-quarto/">Why Quarto?</a> For one, I just want to try out something new. It’s exciting to learn a new system, even if Quarto is not so substantially different from <a href="https://rmarkdown.rstudio.com">RMarkdown</a>. I also want to simplify the process of writing posts with R code and getting them up on the blog. With Hugo, I had to convert the RMarkdown files to markdown, which added time and complexity. I also have never felt totally comfortable in my understanding of how Hugo works. In practice this has rarely been a hindrance, but I am not sure that I have much more to gain by running a Hugo site unless I want to do a deeper dive on <a href="https://go.dev">Go</a> and how Hugo templates work. In other words, the usefulness of Hugo had mostly run its course for me, and the structure of the website was more of a hindrance to writing than an impetus to write.</p>
<p>At the same time, both the introduction of Quarto and my own path in data science and digital humanities make moving away from Hugo much easier of a choice even taking into account my desire to learn by doing. I am much more committed to the larger rstats community than I was in the summer of 2017 as an R novice. I have no qualms fully investing in the technologies provided by <a href="https://posit.co/">RStudio, now Posit</a>. Moreover, Quarto fixes any issues I might have had with <a href="https://bookdown.org/yihui/blogdown/">blogdown</a> or <a href="https://rstudio.github.io/distill/">Distill</a> by no longer depending on R and having a command line interface. This, combined with the ability to learn more about a tool that can be used to produce <a href="https://quarto.org/docs/authoring/title-blocks.html">academic articles</a>, <a href="https://quarto.org/docs/books/">books</a>, and <a href="https://quarto.org/docs/presentations/">presentations</a>, as well as <a href="https://quarto.org/docs/websites/">websites and blogs</a>, made the decision a rather easy one.</p>
<p>I have had a lot of fun moving the website over to Quarto and redesigning the site. The <a href="https://quarto.org/docs/guide/">Quarto guides</a> have been really helpful throughout the whole process. I was very inspired by <a href="https://ivelasq.quarto.pub/building-a-blog-with-quarto/">Isabella Velásquez’s Building a blog with Quarto</a> tutorial and her Quarto website <a href="https://ivelasq.rbind.io/">Pipe Dreams</a>. I also found Danielle Navarro’s post <a href="https://blog.djnavarro.net/posts/2022-04-20_porting-to-quarto/">Porting a distill blog to quarto</a> very helpful even though I was moving over from Hugo.</p>
<p>I am sure that I will continue to tweak and tinker with this site, but so far I am very happy with Quarto and how the site looks. Hopefully this move will push me to write some of the blog posts I have had in my head for quite a while. With the seeming demise, or at least instability of Twitter, it seems more necessary than ever to have a place of one’s own on the internet. This is mine.</p>



 ]]></description>
  <category>quarto</category>
  <guid>https://www.jessesadler.com/post/moving-to-quarto/</guid>
  <pubDate>Sat, 05 Nov 2022 04:00:00 GMT</pubDate>
  <media:content url="https://www.jessesadler.com/post/moving-to-quarto/quarto.png" medium="image" type="image/png" height="111" width="144"/>
</item>
<item>
  <title>Introducing debkeepr</title>
  <link>https://www.jessesadler.com/post/debkeepr-intro/</link>
  <description><![CDATA[ 




<p><strong>Note</strong>: The API for <code>debkeepr</code> described in this post has been <strong>deprecated</strong>. For the new API, see the <a href="https://jessesadler.github.io/debkeepr/"><code>debkeepr</code> website</a> and the <a href="../../post/debkeepr-cran">blog post</a> announcing <a href="https://cran.r-project.org/package=debkeepr"><code>debkeepr</code>’s release on CRAN</a>.</p>
<p>You can now install the released version of <code>debkeepr</code> from CRAN or the development version on GitHub:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install CRAN release</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"debkeepr"</span>)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install development version</span></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("pak")</span></span>
<span id="cb1-6">pak<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pak</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jessesadler/debkeepr"</span>)</span></code></pre></div>
<hr>
<p>After an extensive period of iteration and a long but rewarding process of learning about package development, I am pleased to announce the release of my first R package. The package is called <a href="http://jessesadler.github.io/debkeepr/">debkeepr</a>, and it derives directly from my historical <a href="https://www.jessesadler.com/project/df-inheritance/">research on early modern merchants</a>. <code>debkeepr</code> provides an interface for working with non-decimal currencies that use the tripartite system of pounds, shillings, and pence that was used throughout Europe in the medieval and early modern periods. The package includes functions to apply arithmetic and financial operations to single or multiple values and to analyze account books that use <a href="https://en.wikipedia.org/wiki/Double-entry_bookkeeping_system">double-entry bookkeeping</a> with the latter providing the basis for the name of <code>debkeepr</code>. In this post I want to discuss the motivation behind the creation of the package and provide some examples for how <code>debkeepr</code> can help those who encounter non-decimal currencies in their research.</p>
<section id="pounds-shillings-and-pence-lsd-monetary-systems" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="pounds-shillings-and-pence-lsd-monetary-systems">Pounds, shillings, and pence: lsd monetary systems</h2>
<p>The system of expressing monetary values in the form of pounds, shillings, and pence dates back to the Carolingian Empire and the change from the use of gold coins that derived from the late Roman Empire to silver pennies that had taken place by the eighth century. Needing ways to count larger quantities of the new silver <a href="https://en.wikipedia.org/wiki/Denarius">denarius</a>, people began to define a <a href="https://en.wikipedia.org/wiki/Solidus_(coin)">solidus</a>, originally a gold coin introduced by the Emperor Constantine, as a unit of account equivalent to 12 denarii. For even larger valuations, the denarius was further defined in relation to a pound or <a href="https://en.wikipedia.org/wiki/French_livre">libra</a> of silver. Though the actual number of coins struck from a pound of silver differed over time, the rate of 240 coins lasted long enough to create the custom of counting coins in dozens (solidi) and scores of dozens (librae). The <a href="https://en.wikipedia.org/wiki/%C2%A3sd">librae, solidi, and denarii (lsd)</a> monetary system was translated into various European languages, and though the ratios between the three units often differed by region and period, the basic structure of the system remained in place until decimalization began following the French Revolution.<sup>1</sup></p>
<p>The pounds, shillings, and pence system complicates even relatively <a href="https://en.wikipedia.org/wiki/Arithmetic#Compound_unit_arithmetic">simple arithmetic operations</a>. Especially in our decimalized world, manipulating values that are made up of three different units in which two of the units are non-decimal quickly becomes cumbersome. The principles of grade school arithmetic come running back, as the practice of addition and carrying over values to the next unit gains new relevancy. Calculations with pounds, shillings, and pence values are further complicated when dealing with more than one currency or <a href="https://en.wikipedia.org/wiki/Unit_of_account">money of account</a>, particularly if one or more of the currencies used bases for the shillings and pence units that differed from the common bases of 20 shillings to a pound and 12 pence to a shilling.</p>
<p>The economic historian encounters the difficulties of handling non-decimal currencies in two main contexts. In reading through documents that may or may not be primarily economic in nature, the researcher comes across sets of values that need to be manipulated to better understand their meaning. A common case is the discovery of values that need to be added together to see if they are equivalent to a value in another document, or there may be values in one currency that have to be converted to another currency for comparison. The second context in which historians confront non-decimal monetary values is in explicitly economic documents such as entire account books that may contain hundreds or thousands of transactions. In both contexts the researcher is often stuck performing arithmetic calculations by hand just as merchants and bookkeepers had to do in the past. I do not know how many pages of scratched out calculations I went through in my own research on the estate of Jan della Faille de Oude, a wealthy merchant from Antwerp who died in 1582.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-scratchpad" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-scratchpad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/debkeepr-intro/img/math-scratchpad.jpg" height="400" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-scratchpad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Scratchpad: Doing math by hand
</figcaption>
</figure>
</div>
</div></div><p>The tripartite and non-decimal nature of pounds, shillings, and pence values presents particular difficulties for the analysis of large sets of accounts. A first instinct of the researcher is to place the transactions from an account book into a table or data base to better understand these large groups of data, but how should the pounds, shillings, and pence values be entered? Should they be placed into three separate variables or brought together somehow into one, and how should the arithmetic be performed? So long as there is no clear way to handle one, not to mention multiple, non-decimal currency within a data base, the use of digital tools to investigate and analyze historical accounts books will be hindered.</p>
</section>
<section id="debkeepr" class="level2">
<h2 class="anchored" data-anchor-id="debkeepr"><code>debkeepr</code></h2>
<p><code>debkeepr</code> seeks to overcome these issues and integrate non-decimal pounds, shillings, and pence values into the decimalized environment of R, opening the vast analytical and visual capabilities of R to historical monies of account. <code>debkeepr</code> accomplishes this through the creation of the <code>lsd</code> class and functions intended to work with this new class of object in R. The <code>lsd</code> class unifies the separate pounds, shillings, and pence units into a numeric vector of length three and tracks the non-decimal bases for the shillings and pence units through a <code>bases</code> attribute. <code>lsd</code> objects are stored as <a href="http://r4ds.had.co.nz/vectors.html#lists">lists</a>, making it possible for a single object to contain multiple pounds, shillings, and pence values and to implement <code>lsd</code> objects as list columns in a data frame or <a href="https://tibble.tidyverse.org">tibble</a>. The <code>lsd</code> class is intended to both minimize the difficulty historians encounter in one-off calculations and provide a consistent means for the exploration and analysis of large sets of accounts.<sup>2</sup></p>
<p>I have set up a <a href="http://jessesadler.github.io/debkeepr/">pkgdown site for <code>debkeepr</code></a>, and you can find the source code on <a href="https://github.com/jessesadler/debkeepr">GitHub</a>. The package includes three vignettes, two of which deal with data from the practice journal and ledger from Richard Dafforne’s <em>The Merchant’s Mirrour, Or Directions for the Perfect Ordering and Keeping of His Accounts</em> (London, 1660), a bookkeeping manual that was printed throughout the seventeenth century. Data frames for the transactions and accounts from this set of account books are also included with the package.</p>
<section id="vignettes" class="level3">
<h3 class="anchored" data-anchor-id="vignettes">Vignettes</h3>
<ul>
<li><a href="https://jessesadler.github.io/debkeepr/articles/debkeepr.html">Getting Started with debkeepr vignette</a>: An in depth overview of <code>debkeepr</code>’s functions and their use in various contexts.</li>
<li><a href="https://jessesadler.github.io/debkeepr/articles/transactions.html">Transactions in Richard Dafforne’s Journal vignette</a>: Examples of financial and arithmetic calculations dealing with various currencies taken from the example journal in Richard Dafforne’s <em>Merchant’s Mirrour</em> (1660).</li>
<li><a href="https://jessesadler.github.io/debkeepr/articles/ledger.html">Analysis of Richard Dafforne’s Journal and Ledger vignette</a>: An analysis of the example journal and ledger in Dafforne’s <em>Merchant’s Mirrour</em> using the <code>dafforne_transactions</code> and <code>dafforne_accounts</code> data provided in <code>debkeepr</code>.</li>
</ul>
<p>In the rest of this post I want to quickly highlight how <code>debkeepr</code> can assist historians in handling pounds, shillings, and and pence values in both one-off calculations and in the context of an entire account book. The vignettes go into much greater detail than will be done here.</p>
</section>
</section>
<section id="arithmetic-with-debkeepr" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="arithmetic-with-debkeepr">Arithmetic with <code>debkeepr</code></h2>
<p>At the heart of <code>debkeepr</code> is the ability to normalize pounds, shillings, and pence values to specified non-decimal unit bases in the process or making various calculations. Even in the simplest case of addition, <code>debkeepr</code> makes the process easier and less error prone. Let’s use an example from the image below that shows arithmetic on a scratch piece of paper dealing with trade between Holland and the Barbary coast in the 1590s.<sup>3</sup> On the top right four values in the money of account of pounds Flemish are added together.</p>
<div id="fig-barbary" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-barbary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/debkeepr-intro/img/barbary-scratchpad.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-barbary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: A scratchpad from the archive of Daniel van der Meulen
</figcaption>
</figure>
</div>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: right;">pounds</th>
<th style="text-align: right;">shillings</th>
<th style="text-align: right;">pence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">74</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">26</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">107</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">28</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><code>debkeepr</code> provides multiple means to add together values of pounds Flemish, which used the standard bases of 20 shillings per pound and 12 pence per shilling.<sup>4</sup></p>
<ul>
<li>Add the separate units by hand and then normalize.</li>
<li>Do the addition with <code>debkeepr</code> by supplying numeric vectors of length three.</li>
<li>Create an object of class <code>lsd</code> and proceed with the addition.</li>
</ul>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(debkeepr)</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normalize £235 51s. 8d.</span></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_normalize</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">235</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bases =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       l  s d</span></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 237 11 8</span></span>
<span id="cb2-7"></span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Addition of values with debkeepr</span></span>
<span id="cb2-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb2-11">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb2-12">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">107</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb2-13">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       l  s d</span></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 237 11 8</span></span>
<span id="cb2-16"></span>
<span id="cb2-17"></span>
<span id="cb2-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create lsd object from list of vectors, then do addition</span></span>
<span id="cb2-19">lsd_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_as_lsd</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb2-20">                              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb2-21">                              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">107</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb2-22">                              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)),</span>
<span id="cb2-23">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bases =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb2-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_sum</span>(lsd_values)</span>
<span id="cb2-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       l  s d</span></span>
<span id="cb2-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 237 11 8</span></span></code></pre></div>
<p>Multiplication and division of pounds, shillings, and pence values were equally frequent calculations, but they are more complex to do by hand. Bookkeeping and merchant manuals often included rules for the multiplication and division of compound values such as pounds, shillings, and pence. The article on arithmetic in the third edition of the <a href="http://onlinebooks.library.upenn.edu/webbin/metabook?id=britannica3"><em>Encyclopedia Britannica</em>, printed in 1797</a>, provides a good example of how to do <a href="https://en.wikipedia.org/wiki/Arithmetic#Compound_unit_arithmetic">compound unit arithmetic</a>. <code>debkeepr</code> greatly simplifies this process.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multiply £15 3s. 8d. sterling by 32</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_multiply</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>)</span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       l  s d</span></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 485 17 4</span></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multiply £17 3s. 8d. sterling by 75</span></span>
<span id="cb3-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_multiply</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>)</span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;        l  s d</span></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 1288 15 0</span></span></code></pre></div>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-multiplication" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multiplication-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/debkeepr-intro/img/lsd-multiplication.png" height="350" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multiplication-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Multiplication in <em>Encyclopedia Britannica</em>
</figcaption>
</figure>
</div>
</div></div><p>The examples for division in the <em>Encyclopedia Britannica</em> include the division of pounds, shillings, and pence, as well as the division of weight measured in terms of hundredweight, quarters, and pounds. A hundredweight consisted of four quarters and there were 28 pounds (or two stones) in a quarter. While <code>debkeepr</code> was created with pounds, shillings, and pence values in mind, the measurement of weight in terms of hundredweight can be integrated by altering the bases argument. This example even serves to show a mistake in the printing in the <em>Encyclopedia</em>, as the answer is shown as 15 cwt. 2 q. 21 lb., but it should actually be 22 lb. Checking the long division at the bottom of the calculation, 22 goes into 44 twice not once. Notice too that the division of £465 12s. 8d. ends with a remainder of 8 even though this is not included in the answer provided. This remainder leads to the decimal in the pence unit in the answer provided by <code>deb_divide()</code>. Setting the <code>round</code> argument to 0 would convert the pence unit to a whole number.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Divide £465 12s. 8d. sterling by 72</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_divide</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">465</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>)</span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     l s       d</span></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 6 9 4.11111</span></span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Divide 345 hundredweight 1 quarter 8 lbs by 22</span></span>
<span id="cb4-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_divide</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">345</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bases =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>))</span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;      l s  d</span></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 15 2 22</span></span></code></pre></div>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-division" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-division-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/debkeepr-intro/img/lsd-division.png" height="400" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-division-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Division in <em>Encyclopedia Britannica</em>
</figcaption>
</figure>
</div>
</div></div><p>These examples replicate answers already provided, but they serve to demonstrate the gains in both speed and accuracy for these common calculations. Further examples, including the use of <code>debkeepr</code> to convert between currencies that may or may not have different bases for the shillings and pence units, can be found in both <a href="https://jessesadler.github.io/debkeepr/articles/debkeepr.html">Getting Started with debkeepr</a> and the <a href="https://jessesadler.github.io/debkeepr/articles/transactions.html">Transactions in Richard Dafforne’s Journal vignette</a>.</p>
</section>
<section id="analysis-of-account-books" class="level2">
<h2 class="anchored" data-anchor-id="analysis-of-account-books">Analysis of account books</h2>
<p>As a way of providing example data of pounds, shillings, and pence values in a data frame, <code>debkeepr</code> includes data from the example journal and ledger in Dafforne’s <em>Merchant’s Mirrour</em> from 1660. <code>dafforne_transactions</code> has 177 transactions between 46 accounts from the journal. Each transaction has a creditor and debtor account, showing where each transactional value came from and where it went to, the date of the transaction, and the value in pounds sterling contained in an <code>lsd</code> list column. Extra details include the pages on which the transaction can be found in Dafforne’s journal and ledger and a short description of the transaction. A PDF copy of the journal is <a href="https://github.com/jessesadler/debkeepr/blob/master/data-raw/dafforne-journal.pdf">available for download</a> if you want to see what the original source looks like. The <a href="https://github.com/jessesadler/debkeepr/tree/main/data-raw">raw data</a> from which <code>dafforne_transactions</code> derives also demonstrates the process of entering pounds, shillings, and pence units into three separate columns to create the data base and then using <code>deb_lsd_gather()</code> to transform these variables into an <code>lsd</code> list column.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transactions from the Dafforne's example journal</span></span>
<span id="cb5-2">dafforne_transactions</span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 177 x 8</span></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       id credit debit date       lsd    journal ledger description        </span></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;dbl&gt;  &lt;int&gt; &lt;int&gt; &lt;date&gt;     &lt;S3: &gt;   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;              </span></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1     1      2     1 1633-01-01 1000,…       1 1/1    Various coins of g…</span></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2     2      2     3 1633-01-01 477, …       1 1/1    60 Leeds dozens at…</span></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3     3      2     4 1633-01-01 55, 0…       1 2/1    5 barrels that rem…</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4     4      2     5 1633-01-01 240, …       1 2/1    For 800 French cro…</span></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5     5      2     6 1633-01-01 229, …       1 2/1    2290 guilders rema…</span></span>
<span id="cb5-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6     6      2     8 1633-01-01 3, 17…       1 3/1    Expenses for the r…</span></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7     7      7     2 1633-01-01 150, …       1 1/2    Ready money from J…</span></span>
<span id="cb5-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8     8      9    11 1633-01-04 360, …       1 4/3    100 Leeds dozens s…</span></span>
<span id="cb5-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9     9      1     9 1633-01-04 144, …       2 3/1    For 2/5 of the 100…</span></span>
<span id="cb5-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10    10      5    10 1633-01-04 120, …       2 3/2    400 French crowns …</span></span>
<span id="cb5-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # ... with 167 more rows</span></span></code></pre></div>
<p>The <a href="https://jessesadler.github.io/debkeepr/articles/ledger.html">Analysis of Richard Dafforne’s Journal and Ledger vignette</a> provides a fuller breakdown of the data, but here I would like to show how to get a summary of the 46 accounts in the books and create a plot using <a href="https://ggplot2.tidyverse.org">ggplot2</a>. One side effect of the use of a list column to represent pounds, shillings, and pence values is that it cannot be used for the purposes of plotting. However, this issue is overcome by the robust support for <a href="https://jessesadler.github.io/debkeepr/reference/index.html#section-decimalization">decimalization</a> in <code>debkeepr</code>. Pounds, shillings, and pence values can be decimalized to any of the three units and returned to their original form when desired. For the purposes of plotting, the most useful workflow is to transform the <code>lsd</code> list column to decimalized pounds.</p>
<p><code>debkeepr</code> has a <a href="https://jessesadler.github.io/debkeepr/reference/index.html#section-transaction-data-frames">set of functions</a> meant to deal with data frames that mimic the form of a journal used for double-entry bookkeeping such as <code>dafforne_transactions</code>. The 177 transactions and 46 accounts in <code>dafforne_transactions</code> are more than enough to lose track of which accounts were most significant to the bookkeeper’s trade. Here, I will use <code>deb_account_summary()</code> to calculate the total credit or amount each account sent, total debit or amount each account received, and the current value of the account at the closing of the books. While <code>deb_account_summary()</code> gives a nice overview of the entire set of account books, it is also possible to focus on a single account with <code>deb_account()</code>.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Summary of all accounts in Dafforne's example journal</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_account_summary</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df =</span> dafforne_transactions)</span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 46 x 4</span></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    account_id credit       debit        current     </span></span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         &lt;int&gt; &lt;S3: lsd&gt;    &lt;S3: lsd&gt;    &lt;S3: lsd&gt;   </span></span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1          1 1956, 10, 11 2903, 13, 0  -947, -2, -1</span></span>
<span id="cb6-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2          2 2006, 3, 9   150, 0, 0    1856, 3, 9  </span></span>
<span id="cb6-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3          3 570, 0, 0    570, 0, 0    0, 0, 0     </span></span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4          4 75, 0, 8     75, 0, 8     0, 0, 0     </span></span>
<span id="cb6-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5          5 813, 3, 0    813, 3, 0    0, 0, 0     </span></span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6          6 568, 1, 11   869, 2, 7    -301, 0, -8 </span></span>
<span id="cb6-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7          7 2958, 18, 10 2958, 18, 10 0, 0, 0     </span></span>
<span id="cb6-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8          8 1580, 10, 0  1580, 10, 0  0, 0, 0     </span></span>
<span id="cb6-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9          9 1744, 1, 4   1744, 1, 4   0, 0, 0     </span></span>
<span id="cb6-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10         10 606, 2, 6    606, 2, 6    0, 0, 0     </span></span>
<span id="cb6-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # ... with 36 more rows</span></span>
<span id="cb6-17"></span>
<span id="cb6-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Summary of the cash account in Dafforne's example journal</span></span>
<span id="cb6-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_account</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df =</span> dafforne_transactions, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">account_id =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 3 x 2</span></span>
<span id="cb6-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   relation lsd         </span></span>
<span id="cb6-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;chr&gt;    &lt;S3: lsd&gt;   </span></span>
<span id="cb6-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 credit   1956, 10, 11</span></span>
<span id="cb6-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2 debit    2903, 13, 0 </span></span>
<span id="cb6-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3 current  -947, -2, -1</span></span></code></pre></div>
<p>To plot the summary of the accounts in the journal and ledger the <code>lsd</code> list columns have to be converted to decimalized pounds, which is done with <code>deb_lsd_l()</code> and <code>dplyr::mutate_if()</code>. From this information, we can create a line range plot in which the upper limit is represented by the total credit, the lower limit by the total debit, and the current value by a point. Blue points show accounts that have been balanced by the end of the books and are therefore closed, while black points represent the values for accounts that remain open.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prepare account summary for plotting</span></span>
<span id="cb7-5">(dafforne_summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dafforne_transactions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deb_account_summary</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_if</span>(deb_is_lsd, deb_lsd_l) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">debit =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>debit))</span>
<span id="cb7-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 46 x 4</span></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    account_id credit   debit current</span></span>
<span id="cb7-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb7-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1          1 1957.  -2904.    -947.</span></span>
<span id="cb7-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2          2 2006.   -150     1856.</span></span>
<span id="cb7-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3          3  570    -570        0 </span></span>
<span id="cb7-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4          4   75.0   -75.0      0 </span></span>
<span id="cb7-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5          5  813.   -813.       0 </span></span>
<span id="cb7-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6          6  568.   -869.    -301.</span></span>
<span id="cb7-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7          7 2959.  -2959.       0 </span></span>
<span id="cb7-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8          8 1580.  -1580.       0 </span></span>
<span id="cb7-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9          9 1744.  -1744.       0 </span></span>
<span id="cb7-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10         10  606.   -606.       0 </span></span>
<span id="cb7-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # ... with 36 more rows</span></span>
<span id="cb7-23"></span>
<span id="cb7-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot summary of accounts</span></span>
<span id="cb7-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dafforne_summary) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_linerange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> account_id, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> debit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> credit)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> account_id, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> current,</span>
<span id="cb7-28">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(current <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Closed"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Open"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Open =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Closed =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dollar_format</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prefix =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"£"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Accounts"</span>,</span>
<span id="cb7-32">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pounds sterling"</span>,</span>
<span id="cb7-33">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Status"</span>,</span>
<span id="cb7-34">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Summary of the accounts in Dafforne's ledger"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_light</span>()</span></code></pre></div>
<div id="fig-summary" class="quarto-float quarto-figure quarto-figure-center anchored" height="500px" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/debkeepr-intro/img/account-summary-1.png" id="fig-summary" class="quarto-figure quarto-figure-center anchored figure-img" height="500">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
</figcaption>
</figure>
</div>
</section>
<section id="debkeepr-and-reproducibility" class="level2">
<h2 class="anchored" data-anchor-id="debkeepr-and-reproducibility"><code>debkeepr</code> and reproducibility</h2>
<p>The above plot only scratches the surface of the possibilities for exploring and analyzing account books that use pounds, shillings, and pence values with <code>debkeepr</code>. Yet, what I think is the most significant about <code>debkeepr</code> is not any one plot, time saving feature, or type of analysis, but rather the possibility of using the <a href="http://ropensci.github.io/reproducibility-guide/">practices of reproducible research</a> in the context of historical economic data that takes the form of pounds, shillings, and pence values. Individual calculations are easier to track and validate when written in code rather than scrawled out on a scratch piece of paper or entered into a calculator. Even more importantly, <code>debkeepr</code> provides a workflow for entering data from account books into a data base, <a href="http://vita.had.co.nz/papers/tidy-data.html">tidying the data</a> by transforming separate pounds, shillings, and pence variables into an <code>lsd</code> list column, and then exploring, analyzing, and visualizing the data in ways that integrate with the <a href="https://www.tidyverse.org">tidyverse</a> and more general practices of data analysis in R. It is my hope that <code>debkeepr</code> can help bring to light crucial and interesting social interactions that are buried in economic manuscripts, making these stories accessible to a wider audience.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>For more information about the development of the system of pounds, shillings, and pence and medieval monetary systems more generally see Peter Spufford, <em>Money and its Use in Medieval Europe</em> (Cambridge: Cambridge University Press, 1988).↩︎</p></li>
<li id="fn2"><p>For a more in depth discussion of <code>lsd</code> objects and a step-by-step overview of how to create and work with them see <a href="https://jessesadler.github.io/debkeepr/articles/debkeepr.html">Getting Started with debkeepr</a>.↩︎</p></li>
<li id="fn3"><p>This scratch piece of paper comes from the archive of Daniël van der Meulen en Hester de la Faille, zijn vrouw, 1550-1648 at Erfgoed Leiden en Omstreken. You can access the original <a href="https://www.erfgoedleiden.nl/collecties/archieven/archievenoverzicht/scans/NL-LdnRAL-0096/7.23">here</a>.↩︎</p></li>
<li id="fn4"><p>This means that the default value of <code>c(20, 12)</code> does not need to be altered for the <code>bases</code> argument, though it is included in some of the below examples for transparency.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>rstats</category>
  <category>debkeepr</category>
  <guid>https://www.jessesadler.com/post/debkeepr-intro/</guid>
  <pubDate>Tue, 18 Sep 2018 04:00:00 GMT</pubDate>
  <media:content url="https://www.jessesadler.com/post/debkeepr-intro/img/barbary-scratchpad.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>One Year Anniversary</title>
  <link>https://www.jessesadler.com/post/one-year-reflections/</link>
  <description><![CDATA[ 




<p>It was a year ago today that I launched this website with a post <a href="https://jessesadler.com/post/by-way-of-introduction/">introducing myself</a> and the goals for the blog. When I launched the site, I was at the beginning of teaching myself about digital humanities and how to code in R. Building this <a href="http://gohugo.io">Hugo site</a> was part of my learning process. I learned about the command line, Git, and GitHub, not to mention a bit of HTML and CSS to get the website up and going. I also wanted to share my progress and provide information for others who might want to go down a similar path. Over the past year I have gone from a coding newbie to actively working on <a href="https://www.jessesadler.com/project/">two digital humanities projects</a> and closing in on the launch of my first <a href="https://github.com/jessesadler/debkeepr">R package</a> that makes it easier to work with historical non-decimal currencies.</p>
<p>After writing a couple of posts on <a href="https://jessesadler.com/post/my-approach-to-dh/">my thoughts about digital humanities</a>, I have concentrated on writing posts about using R to analyze and visualize historical data. I have always tried to adopt the perspective of a newcomer to code and to R, since I was in that position not all that long ago. The rsats community has done an admirable job in trying to make learning R as approachable as possible, but there is no way around the fact that learning to code is a daunting task. My posts have mainly focused on using R for <a href="https://jessesadler.com/post/gis-with-r-intro/">GIS</a> and <a href="https://jessesadler.com/post/network-analysis-with-r/">network analysis</a> since these are the two topics most pertinent to the digital humanities projects I have been working on. Writing posts on these topics proved to be the best way for me to learn not only how to create maps and network graphs with R but also about the fields of GIS and network analysis in general.</p>
<p>Even if no one read my posts they would have been useful endeavors for all that I learned through writing them. However, the most gratifying aspect of writing this blog has been hearing that the content has proven useful to others in their efforts to learn R. It has been particularly amazing and amusing to hear from people in the sciences and think about biologists and chemists learning to code by analyzing <a href="https://jessesadler.com/project/dvdm-correspondence/">letters from a sixteenth-century merchant in the Low Countries</a>, which is the <a href="https://github.com/jessesadler/intro-to-r/tree/master/data">data set</a> that I have used in my posts.</p>
<p>I never could have imagined that this website and my blog posts would be read by very many people, and I have been amazed by the steady stream of visitors that continue to read the website daily. The digital humanities and rstats communities have been amazingly open and welcoming, and I never could have gotten this far nor had this much fun without the kindness of the people in these communities. I have received very generous encouragement and increased visibility through tweeting out my posts from <a href="https://twitter.com/ma_salmon">Maëlle Salmon</a>, <a href="https://twitter.com/dataandme">Mara Averick</a>, <a href="https://twitter.com/hadleywickham">Hadley Wickham</a>, and the great <a href="https://twitter.com/R4DScommunity">R4DS community</a> among many others. To these individuals and to the entire community that has come to read my blog I can only say thank you.</p>
<p>In a nice little coincidence this is the 11th post to the blog and pushes my first introductory post to the second page of blog entries. I am looking forward to the next year of continuing to learn more about digital humanities and R and writing about my experiences on this blog, pushing more and more posts to the second page and beyond.</p>



 ]]></description>
  <guid>https://www.jessesadler.com/post/one-year-reflections/</guid>
  <pubDate>Wed, 06 Jun 2018 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Great Circles with R</title>
  <link>https://www.jessesadler.com/post/great-circles-sp-sf/</link>
  <description><![CDATA[ <p>In 1569 the Flemish cartographer and mathematician <a href="https://en.wikipedia.org/wiki/Gerardus_Mercator">Gerardus Mercator</a> published a new world map under the title “New and more complete representation of the terrestrial globe properly adapted for use in navigation.” The title of the map points to Mercator’s main claim for its usefulness, which he expounded upon in the map’s legends. Mercator presented his map as not only an accurate representation of the known world, but also as a particularly useful map for the purposes of navigation. As described in the <a href="https://en.wikipedia.org/wiki/Mercator_1569_world_map#legend3">third legend</a>, Mercator aimed to maintain conformity to the shape of land masses even towards the poles and to have straight lines on the map accurately represent directionality. To achieve his goals Mercator used a <a href="https://www.vox.com/world/2016/12/2/13817712/map-projection-mercator-globe">projection</a> in which lines of longitude and latitude were made perpendicular at all values by increasing the distance between degrees of latitude as they reach the pole.<sup>1</sup> Mercator’s projection had the benefit that straight lines drawn on the map are rhumb lines, lines of constant bearing that pass every degree of longitude at the same angle. Theoretically this simplified oceanic navigation; a ship captain could draw a straight line from one port to another, calculate the bearing, and maintain that bearing along the voyage. However, 16th-century navigators used magnetic courses and not longitude and latitude values as Mercator’s map assumed.<sup>2</sup> An <a href="https://en.wikipedia.org/wiki/History_of_longitude#Problem_of_longitude">accurate means to measure longitude</a> at sea was only discovered in the second half of the 18th century with the development of the sextant and later the marine chronometer.<sup>3</sup></p>
<div id="fig-mercator" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mercator-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/great-circles-sp-sf/img/Mercator-1569.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mercator-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: World Map by Gerardus Mercator, 1569
</figcaption></figure>
</div>
<p>The Mercator projection was designed with certain uses in mind. Mercator’s emphasis on perpendicular lines of longitude and latitude and the equivalence of straight lines and rhumb lines were meant to simplify navigation and have recently proved useful for <a href="https://en.wikipedia.org/wiki/Web_Mercator">online mapping services</a>. However, the stretching of latitudes towards the poles <a href="https://www.youtube.com/watch?v=OH1bZ0F3zVU">distorts the size of land masses</a>, making those closer to the poles appear larger than those near the equator. The stress on rhumb lines in Mercator’s map also highlights the difference between lines of constant bearing (<a href="https://en.wikipedia.org/wiki/Rhumb_line">rhumb or loxodrome lines</a>) and the shortest distance between two points (<a href="https://en.wikipedia.org/wiki/Great-circle_distance">great circles</a>). Due to Earth’s ellipsoidal nature, the shortest distance between two points is not necessarily a straight line. For instance, to fly from Los Angeles to Amsterdam, one would not want to fly in a straight line of constant bearing at 78 degrees. Instead, you would want to make an arc to the north to take advantage of the ellipsoidal shape of the Earth. By flying along the great circle from Los Angeles to Amsterdam one would travel 1120 kilometers less than flying along the rhumb line.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/great-circles-sp-sf/index_files/figure-html/great-circle-rhumb-line-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="great-circles-with-r" class="level2"><h2 class="anchored" data-anchor-id="great-circles-with-r">Great circles with R</h2>
<p>In <a href="https://jessesadler.com/post/geocoding-with-r/">Geocoding with R</a> and <a href="https://jessesadler.com/post/gis-with-r-intro/">Introduction to GIS with R</a> I demonstrated different ways to make maps that showed the sources and destinations of letters sent to the sixteenth-century merchant Daniel van der Meulen in 1585. This post will show how to create great circle lines to connect the sources and destinations of the letters. There are a number of resources on making great circles with R, and each resource uses slightly different methods.<sup>4</sup> The diversity of methods to get the same or similar result is both one of the more interesting and one of the more frustrating parts of coding. Here, I will show how to create great circles as a <code>SpatialLinesDataFrame</code> from the <a href="https://cran.r-project.org/web/packages/sp/"><code>sp</code></a> package, as well as two different methods using the <a href="https://cran.r-project.org/web/packages/sf/"><code>sf</code></a> package. The results of the three methods will be very similar, and the ability to convert between objects used by the <code>sp</code> and <code>sf</code> packages means that they can be used interchangeably. However, showing multiple methods will help to explicate the process of creating lines from longitude and latitude data and turning them into great circles. You can find the data and the R script that goes along with this post on <a href="https://github.com/jessesadler/intro-to-r">GitHub</a>.</p>
<p><code>sp</code> and <code>sf</code> both depend upon external packages to calculate the shortest distance between two points of longitude and latitude data. Creating a <code>SpatialLinesDataFrame</code> of great circles is done through the <a href="https://cran.r-project.org/web/packages/geosphere/index.html"><code>geosphere</code></a> package, while the calculations for <code>sf</code> objects depend upon the <a href="https://cran.r-project.org/web/packages/lwgeom/index.html"><code>lwgeom</code></a> package.<sup>5</sup> Despite the different sources for the calculations, the results produced by <code>geosphere</code> and <code>lwgeom</code> are all but equivalent. Internally, both the <code>gcIntermediate()</code> function from <code>geosphere</code> and <code>st_segmentize()</code> function from <code>sf</code> use a spherical model of the Earth to calculate great circles. Therefore, the path drawn by the two functions are not as exact as the distance calculations from the two packages, which use more accurate ellipsoidal models of the Earth. The primary difference between <code>gcIntermediate()</code> and <code>st_segmentize()</code> is not the internal calculations, but how they are implemented in R. Both functions work by breaking a straight line with two points into a segmented line, with the number of breaks defined by the user. <code>gcIntermediate()</code> calculates segments based on a specified number of breaks. On the other hand, <code>st_segmentize()</code> uses a maximum distance argument to calculate the number of segments. This means that whereas <code>gcIntermediate()</code> results in the same number of points along the great circle for each line irrespective of distance, <code>st_segmentize()</code> creates segments of relatively equal distance but with the amount of segments in a line varying by distance.</p>
<p>Let’s start by loading the packages and data that we will use to make the great circles. To wrangle the data into the correct formats I will use the <a href="http://tidyverse.org"><code>tidyverse</code></a>. We need to load the <code>sp</code> and <code>geosphere</code> packages to make a <code>SpatialLinesDataFrame</code> of great circles and the <code>sf</code> package for the latter two methods. Internally, <code>st_segmentize()</code> uses the <code>lwgeom</code> package, but we will not use the package directly, and so while it is necessary to have <code>lwgeom</code> installed, we do not need to load it. Lastly, I will use the <code>rnaturalearth</code> package to provide some background maps. The data that I will be using is again the letters sent to Daniel van der Meulen in 1585 along with the latitude and longitude values of the cities within his correspondence network at this time. We can also load the countries map from <code>rnaturalearth</code> as both a <code>Spatial</code> and <code>sf</code> object.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load packages</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/edzer/sp/">sp</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">geosphere</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://docs.ropensci.org/rnaturalearth/">rnaturalearth</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load the data</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/correspondence-data-1585.csv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">locations</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/locations.csv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load the background maps</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sp</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ne_countries</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ne_countries</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medium"</span>, returnclass <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
</section><section id="preparing-the-data" class="level2"><h2 class="anchored" data-anchor-id="preparing-the-data">Preparing the data</h2>
<p>The basis for all three methods of creating great circles is a data frame of routes — a data frame with a single row for each unique connection between a source and a destination — which we can then join to the longitude and latitude values in the <code>locations</code> data frame. The <code>letters</code> data contains 114 rows with each row containing a letter. We can calculate the number of letters sent along each unique route with a <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> pipeline in which we group the letters that have the same source and destination. We then want to <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> the data frame to prevent the group attribute from interfering with any code further down the line. The final step is to arrange the rows by the count column, which has been named “n” by <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>. This ensures that the routes with more letters sent across them will be drawn later in the plot, making them more visible in the maps.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame of routes and count for letters per route</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">source</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destination</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print routes</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 15 × 3</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    source    destination     n</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;chr&gt;     &lt;chr&gt;       &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Amsterdam Bremen          1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Antwerp   Middelburg      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Dordrecht Haarlem         1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Emden     Bremen          1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Haarlem   Middelburg      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Haarlem   The Hague       1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Hamburg   Bremen          1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Het Vlie  Bremen          1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Lisse     Delft           1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Antwerp   The Hague       2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11 Haarlem   Bremen          2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 Venice    Haarlem         2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13 Antwerp   Haarlem         5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 14 Haarlem   Delft          26</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 15 Antwerp   Delft          68</span></span></code></pre></div>
</div>
<p>The <code>routes</code> data shows that there are 15 unique source to destination combinations within the <code>letters</code> data. A glimpse at <code>routes</code> shows that the majority of letters that Daniel received in 1585 — 68 letters — were sent from Antwerp to Delft, while a sizable number of letters were sent from Haarlem to Delft.<sup>6</sup> Daniel received letters along other routes much less frequently. With the routes identified, and already possessing the longitude and latitude of the end points for the routes in the <code>locations</code> data frame, we can now move on to creating the great circles between these sets of points.</p>
</section><section id="great-circles-with-geosphere-and-sp" class="level2"><h2 class="anchored" data-anchor-id="great-circles-with-geosphere-and-sp">Great circles with <code>geosphere</code> and <code>sp</code>
</h2>
<p>Let’s start by creating great circles as a <code>SpatialLinesDataFrame</code> from the <code>sp</code> package. Before the recent growth of the <code>sf</code> package, the <code>gcIntermediate()</code> function from the <code>geosphere</code> package represented the main method for creating great circles. I have tried to simplify the process, making it possible to create a <code>SpatialLinesDataFrame</code> in four steps.</p>
<p>The <code>gcIntermediate()</code> function provides one of the easiest methods for transforming coordinates data into spatial lines. A single step creates a <code>SpatialLines</code> object and calculates the great circle. As we will see below, the <code>sf</code> methods split these into two steps. The <code>gcIntermediate()</code> function takes two sets of longitude and latitude coordinates, one for the beginning point of the line and one for the end point. The coordinates can be supplied in the form of either a data frame or a matrix. Here, I will supply the coordinates in a data frame, since our longitude and latitude values are already in this format. We can identify the longitude and latitude values for the sources of the routes by joining <code>locations</code> to <code>routes</code> by the “source” column. Since we only want the longitude and latitude values for the <code>gcIntermediate()</code> function, we <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> the “lon” and “lat” columns — the names of the columns that contain longitude and latitude values — creating a <code>sources_tbl</code> with two columns and the same amount of rows as the <code>routes</code> data. Joining <code>locations</code> to <code>routes</code> by “destination” creates an equivalent <code>destinations_tbl</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tibble of longitude and latitude values of sources</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sources_tbl</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">locations</span>, by <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"place"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lon</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tibble of longitude and latitude values of destinations</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destinations_tbl</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">locations</span>, by <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"destination"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"place"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lon</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>The next step is to decide on the number of segments for the line and the type of output we want. In this example, I choose 50 breaks, which is more than enough for the routes that we are drawing. The end result will actually have 52 segments, because I want to include the start and end points within the line by setting the <code>addStartEnd</code> to <code>TRUE</code>.<sup>7</sup> Lastly, in order to have the output be a <code>Spatial</code> object, we need to set the <code>sp</code> argument to <code>TRUE</code>.<sup>8</sup></p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Great circles as a SpatialLines object</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sl</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gcIntermediate</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sources_tbl</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destinations_tbl</span>, </span>
<span>                            n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, addStartEnd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, </span>
<span>                            sp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Let’s investigate the object that we have created with the <code>gcIntermediate()</code> function. You will not want to print <code>routes_sl</code> to the console, as this will print out fifteen matrices with 52 rows each, but we can use other methods to look at the object. <code>routes_sl</code> is a <code>Spatial</code> object of class <code>SpatialLines</code>. The different forms of data within <code>Spatial</code> objects are <a href="https://jessesadler.com/post/gis-with-r-intro/#overview-spsf">contained in slots</a>, which can be identified with <code><a href="https://rdrr.io/r/methods/slot.html">slotNames()</a></code>. The <code>lines</code> slot contains the coordinates of the routes produced by <code>gcIntermediate()</code>. The <code>gcIntermediate()</code> function also added a coordinate reference system and set it to longitude and latitude coordinates on the WGS84 ellipsoid, equivalent to <a href="https://epsg.io/4326">EPSG 4326</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Class of routes_sl</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sl</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "SpatialLines"</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; attr(,"package")</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "sp"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Slots in routes_sl</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/methods/slot.html">slotNames</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sl</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "lines"       "bbox"        "proj4string"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># CRS of routes_sl</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sl</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">proj4string</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Coordinate Reference System:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Deprecated Proj.4 representation: +proj=longlat +ellps=WGS84 +no_defs </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; WKT2 2019 representation:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; GEOGCRS["unknown",</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     DATUM["Unknown based on WGS84 ellipsoid",</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         ELLIPSOID["WGS 84",6378137,298.257223563,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             LENGTHUNIT["metre",1],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ID["EPSG",7030]]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     PRIMEM["Greenwich",0,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         ANGLEUNIT["degree",0.0174532925199433],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         ID["EPSG",8901]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     CS[ellipsoidal,2],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         AXIS["longitude",east,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ORDER[1],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ANGLEUNIT["degree",0.0174532925199433,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;                 ID["EPSG",9122]]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         AXIS["latitude",north,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ORDER[2],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ANGLEUNIT["degree",0.0174532925199433,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;                 ID["EPSG",9122]]]]</span></span></code></pre></div>
</div>
<p>The inclusion of a coordinate reference system makes <code>routes_sl</code> a truly geospatial object that can be plotted on our background map, though it does not yet possess any attribute data about the names of the locations or the number of letters sent along each route.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make bbox of countries_sp the same as routes_sl</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">bbox</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bbox</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sl</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot map</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>mar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sp</span>, col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, border <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>     main <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SpatialLines great circles"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sl</span>, col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue"</span>, add <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/great-circles-sp-sf/index_files/figure-html/routes-sl-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>At this point, the output is not hugely informative. However, we can confirm that the process of making great circles worked by observing the curvatures of the lines. Notice that the amount of curvature differs according to distance and the bearing of the line.</p>
<p>We can add the attribute data for the lines and create a <code>SpatialLinesDataFrame</code> object by combining <code>routes_sl</code> and the <code>routes</code> data frame through the <code>SpatialLinesDataFrame()</code> function. There is no need to worry about linking the lines data to the correct row in <code>routes</code>, because <code>routes_sl</code> contains a lines ID attribute that corresponds to the row numbers of <code>sources_tbl</code> and <code>destinations_tbl</code>, which were derived from <code>routes</code>.<sup>9</sup></p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Great circles as a SpatialLinesDataFrame object</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sldf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SpatialLinesDataFrame</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sl</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>The result of <code>SpatialLinesDataFrame()</code> is a complete <code>Spatial</code> object that contains a CRS, attribute data in the <code>data</code> slot, and great circle lines in the <code>lines</code> slot. It is now possible to plot <code>routes_sldf</code> and distinguish the lines by the number of letters sent along each route. The easiest way to show this in a base plot is by adjusting the line width of the great circles by a chosen formula. In this case, I take the square route of the number of letters and add 0.25 to get the maximum and minimum line width to a reasonable size.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">bbox</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bbox</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sldf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Map with SpatialLinesDataFrame object</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>mar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sp</span>, col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, border <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>     main <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SpatialLinesDataFrame great circles"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sldf</span>,</span>
<span>     lwd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sldf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,</span>
<span>     col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue"</span>,</span>
<span>     add <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/great-circles-sp-sf/index_files/figure-html/routes-sldf-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="great-circles-with-sf" class="level2"><h2 class="anchored" data-anchor-id="great-circles-with-sf">Great circles with <code>sf</code>
</h2>
<p>There is no straightforward way, no single function, to create great circles from longitude and latitude data with the <code>sf</code> package that is reminiscent of <code>gcIntermediate()</code>. With <code>sf</code> the creation of great circles is a two-step process. First, we need to create lines or objects with a geometry of <code>LINESTRING</code>, and then it will be possible to convert the straight line into a great circle with <code>st_segmentize()</code>. The first transformation is the trickier of the two. As I have <a href="https://jessesadler.com/post/gis-with-r-intro/#sf">shown previously</a>, you can create an <code>sf</code> object with <code>POINT</code> geometry through the <code>st_as_sf()</code> function, but there is no equivalent function for creating lines. Here, I will show two different methods for creating lines and then great circles with <code>sf</code>. The first method will convert the <code>routes</code> data to an <code>sf</code> object of <code>POINT</code> geometry and take advantage of the <code>sf</code> package’s ability to use <code>dplyr</code> functions to create lines through a <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> pipeline. The second method vectorizes the creation of a single <code>LINESTRING</code> feature through a for loop. The resulting <code>sf</code> object of great circles will be essentially identical.</p>
<section id="great-circles-with-sf-tidy-method" class="level3"><h3 class="anchored" data-anchor-id="great-circles-with-sf-tidy-method">Great circles with <code>sf</code>: tidy method</h3>
<p>When I first attempted to create great circles with the <code>sf</code> package, I was not sure how to proceed. In fact, for many months I used the above method from <code>geosphere</code> and then converted the <code>SpatialLinesDataFrame</code> to an <code>sf</code> object with <code>st_as_sf()</code>. I discovered this first method for creating great circles with <code>sf</code> when I came to the realization that the form of the data in the <code>routes</code> data frame was problematic. It obviously makes sense from a perspective of data entry to have a row for each letter with a source and destination. However, this results in two columns that represent a similar type of data of place names. When coordinate data is added, you end up with two sets of longitude and latitude variables. In an <code>sf</code> object this translates to two separate geometry columns, which is possible but problematic.</p>
<p>Once I identified the problem, I could find a solution in the form of the functions in the <a href="http://tidyr.tidyverse.org"><code>tidyr</code></a> package and the transformation of <code>routes</code> from a “wide” form with a “source” and “destination” column in the same row to a “long” form in which the source and destination of each letter are in separate rows. The “long” format of the <code>routes</code> data frame with a single “place” column makes it possible to add a single set of longitude and latitude data and then convert to an <code>sf</code> object. From this format we can transform an <code>sf</code> object with <code>POINT</code> geometry to <code>LINESTRING</code> geometry through <code>sf</code>’s integration with <code>dplyr</code>.<sup>10</sup></p>
<p>Let’s see how this works in practice. Before we begin though, we need to make a slight change to <code>routes</code> to add an “id” column. This will enable us to keep track of the relationship between the sources and destinations and will be used later to group the routes together. We can do this with the very helpful <code><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column()</a></code> function from the <code>tibble</code> package, which even places the “id” column at the start of the data frame.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create id column to routes</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes</span>, var <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>With this done, the first step is to transform <code>routes_id</code> into a “long” format with the use of <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code>. The related <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/spread.html">spread()</a></code> functions are almost magical when you can get them to do what you want, but this also makes them somewhat tricky to use.<sup>11</sup> <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code> combines variables and transforms them into values. The <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code> function has three main arguments: <code>key</code>, <code>value</code>, and <code>...</code> to choose the columns to keep or modify. The values passed to the <code>key</code> and <code>value</code> arguments provide the names for two new columns to be created by the <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code> function. They can be anything you choose, but assigning descriptive names makes it easier to understand what the function is doing. You can think of the <code>key</code> argument as the name for the column whose values are currently column names. The <code>key</code> essentially identifies the “type”. The <code>value</code> argument is the name of the variable whose values are contained within the columns that are spread apart. The <code>...</code> argument is used to demarcate the columns to either be used by <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code> or to specify which columns you want to keep as is and thus make longer. This uses the same grammar as <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> with <code>-variable_name</code> for columns that you want to be left alone.</p>
<p>In our example, we want to turn the “source” and “destination” variables or columns into values that identify whether a place is a source or destination. Here, I choose to name the <code>key</code> “type” and the <code>value</code> “place”, which aligns with the nomenclature used in the <code>locations</code> data. To make the function work properly, we need to choose the right columns for <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code> to work upon. In this case, there are two possibilities. We can either tell <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code> to use the “source” and “destination” columns or to leave “id” and “n” alone with a <code>-</code> before these column names. Here, I do the former.<sup>12</sup></p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transform routes to long format</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_long</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>, value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"place"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">source</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destination</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print routes_long</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_long</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 30 × 4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       id     n type   place    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1     1     1 source Amsterdam</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2     2     1 source Antwerp  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3     3     1 source Dordrecht</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4     4     1 source Emden    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5     5     1 source Haarlem  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6     6     1 source Haarlem  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7     7     1 source Hamburg  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8     8     1 source Het Vlie </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9     9     1 source Lisse    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10    10     2 source Antwerp  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # … with 20 more rows</span></span></code></pre></div>
</div>
<p>Because we performed the <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code> function on two columns, <code>routes_long</code> possesses twice as many rows as <code>routes</code>. <code>routes_long</code> has two new columns corresponding to the names we gave them in the <code>key</code> and <code>values</code> arguments, while the “id” and “n” values have essentially been doubled such that the same values are associated with both a source and destination “type”. Now that we have a single column with place names, we can add the longitude and latitude values of the places through a left join.</p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add coordinate values</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_long_geo</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_long</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">locations</span>, by <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"place"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>With <code>routes_long_geo</code> we now have the data in the correct format to create an <code>sf</code> object with <code>POINT</code> geometry and a CRS through the <code>st_as_sf()</code> function. Let’s create the object and then see what it looks like.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert coordinate data to sf object</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_long_sf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_long_geo</span>,</span>
<span>                           coords <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lon"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                           crs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print routes_long_sf</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_long_sf</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Simple feature collection with 30 features and 4 fields</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: POINT</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: 3.610998 ymin: 45.44085 xmax: 12.31552 ymax: 53.55108</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 30 × 5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       id     n type   place                geometry</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  * &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;             &lt;POINT [°]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1     1     1 source Amsterdam (4.895168 52.37022)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2     2     1 source Antwerp   (4.402464 51.21945)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3     3     1 source Dordrecht  (4.690093 51.8133)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4     4     1 source Emden       (7.20601 53.3594)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5     5     1 source Haarlem   (4.646219 52.38739)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6     6     1 source Haarlem   (4.646219 52.38739)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7     7     1 source Hamburg   (9.993682 53.55108)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8     8     1 source Het Vlie      (5.183333 53.3)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9     9     1 source Lisse     (4.557483 52.25793)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10    10     2 source Antwerp   (4.402464 51.21945)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # … with 20 more rows</span></span></code></pre></div>
</div>
<p>From this point on, we are able to use <code>sf</code>’s <code>dplyr</code> integration to convert from a <code>POINT</code> geometry to <code>MULTIPOINT</code> and then <code>LINESTRING</code>. We can perform the former by grouping <code>routes_long_sf</code> by the “id” column and summarizing the points into a <code>MULTIPOINT</code> geometry.<sup>13</sup> The <code>sf</code> implementation of <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> includes a <code>do.union</code> argument. With <code>do.union</code> set to <code>TRUE</code>, the default, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> will try to resolve internal boundaries, but it can also change the order of points. Therefore, we will set <code>do.union</code> to <code>FALSE</code>, which uses <code>st_combine()</code> to more simply combine geometries in a manner similar to <code><a href="https://rdrr.io/r/base/c.html">c ()</a></code>. The latter transformation from <code>MULTIPOINT</code> to <code>LINESTRING</code> involves <code>st_cast()</code> and takes advantage of the fact that internally <code>MULTIPOINT</code> and <code>LINESTRING</code> are derived from the same type of data, making it possible to convert back and forth between the two geometries without any loss of data. Here I will do all of this in a single pipeline, though you could do it step-by-step to see the multiple conversions that are taking place.</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert POINT geometry to MULTIPOINT, then LINESTRING</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_lines</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_long_sf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>do_union <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_cast</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LINESTRING"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print routes_lines</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_lines</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Simple feature collection with 15 features and 1 field</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: 3.610998 ymin: 45.44085 xmax: 12.31552 ymax: 53.55108</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 15 × 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       id                               geometry</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;int&gt;                       &lt;LINESTRING [°]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1     1  (4.895168 52.37022, 8.801694 53.0793)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2     2  (4.402464 51.21945, 3.610998 51.4988)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3     3  (4.690093 51.8133, 4.646219 52.38739)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4     4    (7.20601 53.3594, 8.801694 53.0793)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5     5  (4.646219 52.38739, 3.610998 51.4988)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6     6    (4.646219 52.38739, 4.3007 52.0705)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7     7  (9.993682 53.55108, 8.801694 53.0793)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8     8      (5.183333 53.3, 8.801694 53.0793)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9     9 (4.557483 52.25793, 4.357068 52.01158)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10    10    (4.402464 51.21945, 4.3007 52.0705)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11    11  (4.646219 52.38739, 8.801694 53.0793)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12    12 (12.31552 45.44085, 4.646219 52.38739)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13    13 (4.402464 51.21945, 4.646219 52.38739)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 14    14 (4.646219 52.38739, 4.357068 52.01158)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 15    15 (4.402464 51.21945, 4.357068 52.01158)</span></span></code></pre></div>
</div>
<p>We have successfully created an <code>sf</code> object with lines. In addition to the change in geometry type, we can see that the number of rows has been halved and returned to the original length of <code>routes_id</code>. However, in doing this, we lost the data on the name of the source and destination of the lines, as well as the number of letters sent along the route. This occurred when we grouped <code>routes_long_sf</code> by the “id” column, leaving other non-geometry columns to be silently dropped. We can re-add the attribute data by joining <code>routes_lines</code> to the original <code>routes_id</code> data frame, using the “id” column to perform the join. This work flow of grouping and then joining by “id” is why we needed to create the column in the first place.</p>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join sf object with attributes data</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_lines</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_lines</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_id</span>, by <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Now that the geometry of the <code>sf</code> object is <code>LINESTRING</code>, creating a great circle with <code>st_segmentize()</code> is straight forward. The only decision you have to make is the maximum distance for the length of a segment. The maximum distance argument can either be the number of meters for the maximum segment or an object from the <a href="https://cran.r-project.org/web/packages/units/index.html"><code>units</code></a> package, which makes it possible to use a more sensible unit for this argument such as kilometers.<sup>14</sup> In this case, I will use the <code>set_units</code> function from the <code>units</code> package and set the maximum length to 20 kilometers.<sup>15</sup></p>
<div class="cell">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert rhumb lines to great circles</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sf_tidy</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_lines</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_segmentize</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">units</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_units</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">km</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>With <code>routes_sf_tidy</code> we have reached our goal, an <code>sf</code> object with great circle lines. We can confirm the changes made by <code>st_segmentize()</code> both visually and by looking at the number of coordinates or points in <code>routes_sf_tidy</code> compared to <code>routes_lines</code>. Where <code>routes_lines</code> has 30 set of coordinates — two for each line — <code>routes_sf_tidy</code> has <code>nrow(st_coordinates(routes_sf_tidy))</code> as a result of <code>st_segmentize()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compare number of points in routes_lines and routes_sf_tidy</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_coordinates</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_lines</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 30</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_coordinates</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sf_tidy</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 193</span></span></code></pre></div>
</div>
<p>We can visualize the difference between the rhumb lines of <code>routes_lines</code> and the great circles of <code>routes_sf_tidy</code> by plotting them on the same map. Because the lines in this example are relatively short, the differences will be fairly minimal and even imperceptible in some cases. Here, I plot the great circles in black on top of the rhumb lines in magenta to highlight where the differences are visible. The most perceptible difference is the route from Venice to Haarlem. The magenta rhumb lines are also partially visible in the routes to Bremen. Routes over shorter distances such as those between Antwerp and Zeeland or Holland are more similar and the appearance of the magenta rhumb lines are less perceptible.</p>
<div class="cell">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rhumb lines vs great circles</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sf</span>, fill <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_lines</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magenta"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sf_tidy</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>xlim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, ylim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, datum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rhumb lines vs Great circles"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/great-circles-sp-sf/index_files/figure-html/rhumb-great-circle-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also compare the output of <code>gcIntermediate</code> and <code>st_segmentize()</code>. The use of a maximum length of a segment by <code>st_segmentize()</code> instead of the number of segments is the main differentiation between <code>st_segmentize()</code> and <code>gcIntermediate()</code>. The exact coordinates along which the great circles are drawn will necessarily differ between the two functions. In practice, the differences are likely to be unimportant, and in a map like the one we are creating here, the differences between the two sets of great circles will be imperceptible. The limited extent of the difference between the two functions can be seen by plotting <code>routes_sldf</code> and <code>routes_sf_tidy</code> on the same interactive map using the <a href="https://cran.r-project.org/web/packages/mapview/index.html"><code>mapview</code></a> package. This makes it possible to zoom in on the lines and see where they do differ, such as the line between Venice and Haarlem. The differences that are visible are on the scale of meters, and this is without optimizing the alignment for the choices of the number of segments and maximum length of a segment.</p>
<div class="cell">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Interactive comparison of gcIntermediate and st_segmentize</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/r-spatial/mapview">mapview</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapview</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sldf</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magenta"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapview</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sf_tidy</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-63f9a704c897b3739f68" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-63f9a704c897b3739f68">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["line",430]},{"method":"addPolylines","args":[[[[{"lng":[4.8951679,4.97052173458627,5.04592714075233,5.1213840178086,5.19689226436101,5.27245177831049,5.34806245685258,5.423724196477,5.49943689296727,5.57520044140032,5.65101473614615,5.72687967086748,5.80279513851946,5.87876103134933,5.95477724089619,6.03084365799069,6.10696017275486,6.18312667460181,6.25934305223559,6.335609193651,6.41192498613342,6.48829031625866,6.56470506989289,6.64116913219246,6.71768238760393,6.79424471986392,6.8708560119991,6.9475161463262,7.02422500445201,7.10098246727335,7.17778841497722,7.25464272704076,7.33154528223141,7.408495958607,7.48549463351587,7.56254118359707,7.63963548478045,7.71677741228695,7.79396684062876,7.87120364360958,7.94848769432487,8.02581886516216,8.10319702780134,8.18062205321499,8.2580938116687,8.33561217272153,8.4131770052263,8.49078817733008,8.56844555647461,8.64614900939677,8.72389840212902,8.8016936],"lat":[52.3702157,52.3853414578695,52.400419268767,52.4154490737966,52.4304308141569,52.4453644311413,52.4602498661392,52.475087060637,52.4898759562189,52.504616494568,52.5193086174669,52.5339522667992,52.54854738455,52.5630939128069,52.5775917937612,52.5920409697086,52.6064413830503,52.6207929762938,52.635095692054,52.6493494730542,52.6635542621268,52.6777100022144,52.691816636371,52.7058741077625,52.7198823596681,52.7338413354807,52.7477509787086,52.7616112329759,52.7754220420237,52.7891833497107,52.802895100015,52.816557237034,52.8301697049863,52.8437324482119,52.8572454111738,52.8707085384586,52.8841217747775,52.8974850649673,52.9107983539916,52.9240615869414,52.9372747090361,52.9504376656248,52.9635504021871,52.9766128643337,52.9896249978082,53.0025867484871,53.0154980623816,53.028358885638,53.0411691645389,53.0539288455043,53.0666378750922,53.0792962]}]],[[{"lng":[4.4024643,4.38703809425844,4.3716081828486,4.35617456550874,4.34073724197859,4.32529621199933,4.30985147531362,4.29440303166558,4.27895088080083,4.26349502246644,4.24803545641096,4.23257218238443,4.21710520013836,4.20163450942576,4.1861601100011,4.17068200162035,4.15520018404096,4.13971465702189,4.12422542032358,4.10873247370795,4.09323581693843,4.07773544977995,4.06223137199894,4.04672358336332,4.03121208364252,4.01569687260748,4.00017795003064,3.98465531568596,3.96912896934889,3.9535989107964,3.938065139807,3.92252765616068,3.90698645963897,3.89144155002492,3.87589292710308,3.86034059065956,3.84478454048197,3.82922477635945,3.81366129808267,3.79809410544385,3.78252319823672,3.76694857625656,3.75137023930017,3.73578818716592,3.72020241965368,3.7046129365649,3.68901973770256,3.67342282287117,3.65782219187682,3.64221784452713,3.62660978063128,3.610998],"lat":[51.2194475,51.2249759968274,51.2305024653398,51.2360269046494,51.2415493138679,51.2470696921068,51.2525880384776,51.2581043520916,51.2636186320598,51.2691308774931,51.2746410875023,51.2801492611979,51.2856553976903,51.2911594960896,51.296661555506,51.3021615750493,51.3076595538292,51.3131554909552,51.3186493855367,51.3241412366827,51.3296310435025,51.3351188051047,51.340604520598,51.346088189091,51.351569809692,51.3570493815091,51.3625269036504,51.3680023752236,51.3734757953364,51.3789471630964,51.3844164776107,51.3898837379867,51.3953489433312,51.4008120927511,51.4062731853531,51.4117322202437,51.4171891965291,51.4226441133155,51.4280969697091,51.4335477648155,51.4389964977404,51.4444431675894,51.4498877734679,51.4553303144809,51.4607707897336,51.4662091983307,51.4716455393771,51.4770798119772,51.4825120152354,51.4879421482559,51.4933702101428,51.4987962]}]],[[{"lng":[4.6900929,4.68924341078085,4.68839349690254,4.68754315798113,4.68669239363223,4.68584120347099,4.68498958711214,4.68413754416992,4.68328507425815,4.68243217699018,4.6815788519789,4.68072509883677,4.67987091717578,4.67901630660747,4.67816126674292,4.67730579719274,4.67644989756712,4.67559356747576,4.67473680652792,4.67387961433237,4.67302199049747,4.67216393463107,4.67130544634059,4.67044652523299,4.66958717091473,4.66872738299185,4.6678671610699,4.66700650475399,4.66614541364872,4.66528388735828,4.66442192548635,4.66355952763616,4.66269669341048,4.66183342241159,4.66096971424131,4.660105568501,4.65924098479153,4.65837596271331,4.65751050186629,4.65664460184991,4.65577826226318,4.65491148270461,4.65404426277223,4.65317660206361,4.65230850017584,4.65143995670552,4.65057097124879,4.6497015434013,4.64883167275822,4.64796135891425,4.6470906014636,4.6462194],"lat":[51.8132979,51.8245547200658,51.835811534009,51.8470683418241,51.8583251435054,51.8695819390474,51.8808387284446,51.8920955116914,51.9033522887822,51.9146090597115,51.9258658244736,51.937122583063,51.9483793354741,51.9596360817012,51.9708928217389,51.9821495555813,51.993406283223,52.0046630046583,52.0159197198815,52.0271764288871,52.0384331316693,52.0496898282225,52.060946518541,52.0722032026192,52.0834598804514,52.0947165520319,52.105973217355,52.1172298764151,52.1284865292063,52.1397431757231,52.1509998159596,52.1622564499102,52.1735130775691,52.1847696989307,52.196026313989,52.2072829227385,52.2185395251733,52.2297961212877,52.2410527110759,52.2523092945321,52.2635658716506,52.2748224424255,52.2860790068511,52.2973355649215,52.3085921166309,52.3198486619735,52.3311052009436,52.3423617335351,52.3536182597424,52.3648747795596,52.3761312929807,52.3873878]}]],[[{"lng":[7.2060095,7.2374963136065,7.26897531118305,7.30044648394856,7.33190982314161,7.36336532002036,7.39481296586261,7.4262527519658,7.457684669647,7.48910871024291,7.52052486510986,7.55193312562386,7.58333348318052,7.61472592919513,7.64611045510264,7.67748705235762,7.70885571243433,7.74021642682668,7.77156918704824,7.80291398463225,7.83425081113162,7.86557965811892,7.89690051718641,7.92821337994602,7.95951823802935,7.99081508308767,8.02210390679195,8.05338470083283,8.08465745692063,8.11592216678538,8.14717882217677,8.17842741486418,8.20966793663668,8.24090037930305,8.27212473469173,8.30334099465087,8.33454915104832,8.36574919577159,8.39694112072793,8.42812491784423,8.45930057906713,8.49046809636293,8.52162746171763,8.55277866713693,8.58392170464623,8.6150565662906,8.64618324413485,8.67730173026343,8.70841201678052,8.73951409581,8.77060795949541,8.8016936],"lat":[53.3594029,53.3541162127734,53.3488212411037,53.3435179886469,53.3382064590627,53.3328866560141,53.3275585831681,53.322222244195,53.3168776427687,53.3115247825667,53.3061636672701,53.3007943005635,53.2954166861349,53.2900308276761,53.2846367288821,53.2792343934516,53.2738238250867,53.268405027493,53.2629780043796,53.2575427594589,53.2520992964468,53.2466476190629,53.2411877310297,53.2357196360737,53.2302433379242,53.2247588403144,53.2192661469806,53.2137652616625,53.2082561881031,53.202738930049,53.1972134912498,53.1916798754586,53.1861380864318,53.1805881279291,53.1750300037135,53.1694637175511,53.1638892732116,53.1583066744677,53.1527159250953,53.1471170288738,53.1415099895857,53.1358948110166,53.1302714969554,53.1246400511942,53.1190004775283,53.1133527797562,53.1076969616793,53.1020330271024,53.0963609798335,53.0906808236835,53.0849925624666,53.0792962]}]],[[{"lng":[4.6462194,4.62552279621529,4.6048424325382,4.58417828945311,4.56353034746719,4.54289858711041,4.52228298893554,4.5016835335181,4.48110020145638,4.46053297337141,4.43998182990696,4.41944675172952,4.39892771952828,4.37842471401512,4.3579377159246,4.33746670601394,4.31701166506304,4.2965725738744,4.27614941327317,4.25574216410711,4.23535080724655,4.21497532358443,4.19461569403625,4.17427189954007,4.15394392105647,4.13363173956858,4.11333533608203,4.09305469162495,4.07278978724795,4.0525406040241,4.03230712304894,4.01208932544044,3.991887192339,3.97170070490742,3.95152984433089,3.93137459181699,3.91123492859566,3.89111083591919,3.87100229506221,3.85090928732165,3.83083179401676,3.81076979648908,3.7907232761024,3.77069221424278,3.75067659231854,3.73067639176019,3.71069159402048,3.69072218057434,3.67076813291888,3.65082943257337,3.63090606107922,3.610998],"lat":[52.3873878,52.3700527008567,52.352713989516,52.3353716710695,52.3180257506009,52.3006762331853,52.28332312389,52.2659664277737,52.2486061498871,52.2312422952728,52.2138748689651,52.1965038759901,52.179129321366,52.1617512101027,52.144369547202,52.1269843376576,52.1095955864552,52.0922032985724,52.0748074789787,52.0574081326357,52.0400052644968,52.0225988795075,52.0051889826053,51.9877755787196,51.9703586727721,51.9529382696762,51.9355143743376,51.918086991654,51.9006561265152,51.8832217838031,51.8657839683917,51.8483426851471,51.8308979389277,51.8134497345837,51.7959980769579,51.778542970885,51.761084421192,51.743622432698,51.7261570102145,51.7086881585451,51.6912158824858,51.6737401868246,51.656261076342,51.6387785558107,51.6212926299957,51.6038033036544,51.5863105815365,51.5688144683839,51.551314968931,51.5338120879046,51.5163058300237,51.4987962]}]],[[{"lng":[4.6462194,4.63939692737971,4.63257637172797,4.62575773219826,4.61894100794451,4.612126198121,4.60531330188241,4.5985023183838,4.59169324678065,4.58488608622878,4.57808083588443,4.57127749490422,4.56447606244516,4.55767653766464,4.55087891972046,4.54408320777076,4.53728940097412,4.53049749848948,4.52370749947616,4.51691940309388,4.51013320850276,4.50334891486328,4.49656652133631,4.48978602708312,4.48300743126536,4.47623073304506,4.46945593158465,4.46268302604693,4.45591201559509,4.44914289939271,4.44237567660376,4.43561034639257,4.42884690792389,4.42208536036282,4.41532570287488,4.40856793462595,4.40181205478229,4.39505806251057,4.38830595697782,4.38155573735148,4.37480740279933,4.36806095248959,4.36131638559081,4.35457370127196,4.34783289870238,4.3410939770518,4.33435693549032,4.32762177318843,4.320888489317,4.3141570830473,4.30742755355096,4.3006999],"lat":[52.3873878,52.3811840070472,52.3749798214212,52.3687752433201,52.3625702729421,52.3563649104851,52.3501591561471,52.3439530101257,52.3377464726188,52.3315395438237,52.3253322239379,52.3191245131586,52.3129164116831,52.3067079197085,52.3004990374316,52.2942897650493,52.2880801027583,52.2818700507552,52.2756596092364,52.2694487783984,52.2632375584374,52.2570259495495,52.2508139519308,52.2446015657771,52.2383887912842,52.2321756286477,52.2259620780634,52.2197481397265,52.2135338138323,52.2073191005762,52.2011040001532,52.1948885127583,52.1886726385863,52.1824563778319,52.1762397306899,52.1700226973547,52.1638052780207,52.1575874728822,52.1513692821334,52.1451507059684,52.138931744581,52.1327123981651,52.1264926669145,52.1202725510227,52.1140520506832,52.1078311660893,52.1016098974344,52.0953882449116,52.0891662087139,52.0829437890342,52.0767209860653,52.0704978]}]],[[{"lng":[9.9936819,9.97005573301095,9.94643976419506,9.92283399093622,9.89923841061021,9.87565302058473,9.85207781821941,9.82851280086586,9.80495796586767,9.78141331056043,9.75787883227176,9.73435452832135,9.71084039602093,9.68733643267434,9.66384263557754,9.64035900201862,9.61688552927784,9.59342221462763,9.56996905533263,9.54652604864969,9.52309319182793,9.49967048210871,9.47625791672571,9.45285549290489,9.42946320786457,9.4060810588154,9.38270904296042,9.35934715749507,9.3359953996072,9.31265376647709,9.28932225527749,9.26600086317365,9.2426895873233,9.2193884248767,9.19609737297667,9.17281642875857,9.14954558935038,9.12628485187267,9.10303421343865,9.07979367115417,9.05656322211777,9.03334286342067,9.01013259214682,8.9869324053729,8.96374230016833,8.94056227359535,8.91739232270896,8.89423244455699,8.87108263618013,8.84794289461191,8.82481321687876,8.8016936],"lat":[53.5510846,53.5419487570578,53.5328082598859,53.5236631120461,53.5145133170983,53.5053588786007,53.4961998001099,53.4870360851805,53.4778677373655,53.4686947602163,53.4595171572822,53.450334932111,53.4411480882488,53.4319566292396,53.422760558626,53.4135598799486,53.4043545967465,53.3951447125567,53.3859302309146,53.3767111553539,53.3674874894065,53.3582592366023,53.3490264004697,53.3397889845352,53.3305469923236,53.3213004273577,53.3120492931588,53.3027935932462,53.2935333311374,53.2842685103484,53.274999134393,53.2657252067835,53.2564467310302,53.2471637106418,53.237876149125,53.2285840499848,53.2192874167244,53.2099862528452,53.2006805618467,53.1913703472267,53.1820556124811,53.1727363611039,53.1634125965875,53.1540843224224,53.1447515420972,53.1354142590987,53.1260724769119,53.11672619902,53.1073754289042,53.0980201700442,53.0886604259175,53.0792962]}]],[[{"lng":[5.183333,5.25461171188843,5.32587943660515,5.39713603545317,5.46838136989168,5.53961530153798,5.6108376921693,5.68204840372466,5.75324729830671,5.82443423818354,5.89560908579057,5.96677170373232,6.03792195478426,6.10905970189459,6.18018480818612,6.25129713695797,6.32239655168746,6.39348291603184,6.4645560938301,6.53561594910475,6.60666234606356,6.67769514910139,6.74871422280185,6.81971943193917,6.89071064147984,6.96168771658442,7.03265052260925,7.10359892510817,7.17453278983425,7.24545198274148,7.31635636998653,7.38724581793039,7.45812019314011,7.52897936239044,7.59982319266555,7.67065155116068,7.74146430528383,7.81226132265737,7.88304247111975,7.95380761872711,8.02455663375489,8.09528938469954,8.16600574028005,8.23670556943965,8.30738874134734,8.37805512539955,8.44870459122168,8.51933700866976,8.58995224783193,8.66055017903009,8.73113067282144,8.8016936],"lat":[53.3,53.2967290888739,53.2934156936142,53.2900598259374,53.2866614977058,53.2832207209277,53.2797375077567,53.2762118704916,53.2726438215765,53.2690333736001,53.265380539296,53.2616853315421,53.2579477633604,53.2541678479172,53.2503455985222,53.246481028629,53.2425741518341,53.2386249818774,53.2346335326415,53.2305998181517,53.2265238525754,53.2224056502226,53.2182452255446,53.2140425931349,53.209797767728,53.2055107641997,53.2011815975666,53.1968102829862,53.1923968357559,53.1879412713137,53.1834436052372,53.1789038532436,53.1743220311896,53.1696981550708,53.1650322410217,53.1603243053152,53.1555743643627,53.1507824347133,53.1459485330539,53.141072676209,53.1361548811401,53.1311951649453,53.1261935448599,53.1211500382548,53.1160646626374,53.1109374356506,53.1057683750726,53.1005574988171,53.0953048249321,53.0900103716006,53.0846741571396,53.0792962]}]],[[{"lng":[4.5574834,4.55353231125329,4.54958208236238,4.54563271301403,4.54168420289512,4.53773655169266,4.53378975909381,4.52984382478585,4.52589874845621,4.52195452979243,4.51801116848219,4.51406866421334,4.5101270166738,4.50618622555169,4.50224629053521,4.49830721131272,4.49436898757271,4.49043161900381,4.48649510529475,4.48255944613445,4.47862464121191,4.47469069021629,4.47075759283687,4.46682534876309,4.46289395768449,4.45896341929075,4.4550337332717,4.45110489931729,4.4471769171176,4.44324978636286,4.43932350674339,4.4353980779497,4.4314734996724,4.42754977160223,4.42362689343006,4.41970486484692,4.41578368554394,4.4118633552124,4.40794387354371,4.4040252402294,4.40010745496116,4.39619051743077,4.39227442733018,4.38835918435144,4.38444478818677,4.38053123852849,4.37661853506906,4.37270667750107,4.36879566551725,4.36488549881045,4.36097617707366,4.3570677],"lat":[52.2579303,52.2531031167331,52.2482758016053,52.2434483546683,52.2386207759737,52.2337930655732,52.2289652235181,52.2241372498602,52.2193091446509,52.2144809079417,52.2096525397841,52.2048240402294,52.1999954093292,52.1951666471348,52.1903377536976,52.1855087290689,52.1806795733,52.1758502864422,52.1710208685469,52.1661913196651,52.1613616398482,52.1565318291474,52.1517018876138,52.1468718152985,52.1420416122527,52.1372112785275,52.1323808141739,52.1275502192431,52.1227194937859,52.1178886378534,52.1130576514966,52.1082265347664,52.1033952877138,52.0985639103897,52.0937324028449,52.0889007651302,52.0840689972966,52.0792370993947,52.0744050714755,52.0695729135895,52.0647406257877,52.0599082081206,52.055075660639,52.0502429833935,52.0454101764347,52.0405772398133,52.0357441735798,52.0309109777848,52.0260776524788,52.0212441977123,52.0164106135359,52.0115769]}]],[[{"lng":[4.4024643,4.40050524542831,4.39854476914464,4.39658286927058,4.39461954392456,4.39265479122176,4.39068860927418,4.38872099619058,4.38675195007648,4.38478146903419,4.38280955116276,4.380836194558,4.37886139731244,4.37688515751537,4.3749074732528,4.37292834260746,4.3709477636588,4.36896573448297,4.36698225315283,4.36499731773793,4.36301092630449,4.36102307691544,4.35903376763035,4.35704299650547,4.35505076159371,4.35305706094463,4.35106189260443,4.34906525461593,4.3470671450186,4.34506756184853,4.34306650313841,4.34106396691754,4.33905995121182,4.33705445404375,4.33504747343241,4.33303900739344,4.33102905393906,4.32901761107808,4.32700467681581,4.32499024915414,4.3229743260915,4.32095690562285,4.31893798573965,4.31691756442991,4.31489563967812,4.3128722094653,4.31084727176894,4.30882082456302,4.306792865818,4.30476339350082,4.30273240557487,4.3006999],"lat":[51.2194475,51.236135596968,51.2528236612106,51.2695116926847,51.2861996913468,51.3028876571535,51.3195755900612,51.3362634900264,51.3529513570054,51.3696391909544,51.3863269918297,51.4030147595872,51.4197024941831,51.4363901955733,51.4530778637137,51.46976549856,51.486453100068,51.5031406681934,51.5198282028917,51.5365157041184,51.5532031718289,51.5698906059786,51.5865780065228,51.6032653734166,51.6199527066151,51.6366400060734,51.6533272717465,51.6700145035891,51.6867017015562,51.7033888656024,51.7200759956823,51.7367630917507,51.7534501537618,51.7701371816702,51.7868241754302,51.803511134996,51.8201980603217,51.8368849513616,51.8535718080696,51.8702586303996,51.8869454183055,51.903632171741,51.9203188906599,51.9370055750158,51.9536922247621,51.9703788398524,51.98706542024,52.0037519658782,52.0204384767202,52.0371249527192,52.0538113938281,52.0704978]}]],[[{"lng":[4.6462194,4.72640084826977,4.8066365549037,4.88692638805953,4.96727021503948,5.04766790229019,5.1281193154027,5.20862431911236,5.28918277729892,5.3697945529865,5.4504595083437,5.53117750468363,5.61194840246411,5.69277206128773,5.77364833990211,5.85457709620003,5.9355581872197,6.01659146914503,6.0976767973059,6.17881402617846,6.26000300938553,6.34124359969692,6.42253564902991,6.50387900844959,6.58527352816939,6.66671905755158,6.74821544510774,6.82976253849938,6.91136018453848,6.99300822918811,7.07470651756308,7.15645489393064,7.23825320171113,7.32010128347877,7.40199898096238,7.48394613504622,7.56594258577079,7.64798817233368,7.73008273309051,7.81222610555576,7.89441812640382,7.97665863146992,8.05894745575113,8.14128443340743,8.2236693977628,8.30610218130629,8.38858261569319,8.47111053174618,8.55368575945656,8.63630812798544,8.71897746566504,8.8016936],"lat":[52.3873878,52.402337769099,52.4172334598115,52.4320748062435,52.4468617426381,52.461594203377,52.4762721229814,52.4908954361131,52.5054640775764,52.5199779823185,52.5344370854314,52.5488413221527,52.5631906278669,52.5774849381069,52.5917241885548,52.6059083150436,52.6200372535579,52.6341109402356,52.6481293113689,52.6620923034057,52.6759998529504,52.6898518967658,52.7036483717738,52.7173892150567,52.7310743638588,52.7447037555872,52.7582773278131,52.7717950182735,52.7852567648717,52.7986625056793,52.8120121789365,52.8253057230544,52.8385430766155,52.8517241783752,52.8648489672627,52.877917382383,52.8909293630171,52.9038848486244,52.9167837788426,52.9296260934902,52.9424117325669,52.9551406362552,52.9678127449215,52.9804279991172,52.9929863395803,53.0054877072363,53.0179320431996,53.0303192887745,53.0426493854569,53.0549222749348,53.0671378990902,53.0792962]}]],[[{"lng":[12.3155151,12.1842847900598,12.0523954778011,11.9198413077961,11.7866163709001,11.6527147038188,11.5181302886774,11.3828570525905,11.2468888672344,11.1102195484213,10.9728428556751,10.8347524918108,10.6959421025161,10.5564052759362,10.4161355422619,10.2751263733221,10.1333711821795,9.9908633227313,9.84759608931436,9.7035627163159,9.55875637778923,9.41317018707581,9.26679719643339,9.11963039667105,8.97166271679143,8.82288702364056,8.67329612156592,8.5228827520831,8.37163959355157,8.21955926086025,8.06663430512311,7.91285721338579,7.75822040834343,7.60271624807055,7.44633702576356,7.28907496949652,7.13092224199084,6.97187094039958,6.81191309610717,6.65104067454514,6.48924557502475,6.32651963058727,6.16285460787267,5.99824220700767,5.83267406151392,5.66614173823726,5.49863673729894,5.33015049206985,5.16067436916857,4.99019966848446,4.81871762322662,4.6462194],"lat":[45.4408474,45.5815403624536,45.7220823161836,45.8624717548294,46.0027071547727,46.142786974913,46.2827096564402,46.4224736226036,46.5620772784791,46.7015190107323,46.8407971873796,46.979910157546,47.1188562512196,47.2576337790035,47.3962410318643,47.5346762808781,47.6729377769726,47.8110237506667,47.9489324118069,48.0866619493002,48.2242105308441,48.3615763026538,48.498757389185,48.6357518928552,48.7725578937601,48.9091734493877,49.0455965943293,49.1818253399865,49.3178576742752,49.453691561327,49.5893249411861,49.724755729504,49.8599818172303,49.9950010703003,50.1298113293195,50.2644104092447,50.3987960990615,50.5329661614594,50.6669183325024,50.8006503212975,50.9341598096592,51.0674444517711,51.2005018738443,51.3333296737724,51.4659254207838,51.5982866550901,51.7304108875324,51.8622955992237,51.9939382411887,52.1253362340006,52.2564869674148,52.3873878]}]],[[{"lng":[4.4024643,4.40712420031115,4.41178874395524,4.41645793933152,4.42113179485875,4.42581031897528,4.43049352013915,4.43518140682807,4.43987398753954,4.44457127079088,4.4492732651193,4.45397997908195,4.45869142125598,4.4634076002386,4.46812852464714,4.47285420311911,4.47758464431227,4.48231985690464,4.48705984959465,4.4918046311011,4.4965542101633,4.50130859554108,4.50606779601487,4.51083182038577,4.51560067747559,4.52037437612694,4.52515292520325,4.52993633358887,4.53472461018912,4.53951776393032,4.54431580375993,4.54911873864653,4.55392657757993,4.55873932957122,4.56355700365282,4.56837960887857,4.5732071543238,4.57803964908533,4.58287710228162,4.58771952305276,4.59256692056061,4.59741930398878,4.60227668254276,4.60713906544998,4.61200646195981,4.61687888134372,4.6217563328953,4.62663882593029,4.63152636978671,4.63641897382491,4.64131664742762,4.6462194],"lat":[51.2194475,51.2423530615644,51.265258437929,51.2881636287574,51.3110686337123,51.3339734524555,51.3568780846483,51.3797825299509,51.4026867880228,51.4255908585229,51.448494741109,51.4713984354383,51.4943019411671,51.5172052579509,51.5401083854445,51.5630113233016,51.5859140711754,51.6088166287181,51.6317189955812,51.6546211714153,51.6775231558701,51.7004249485946,51.723326549237,51.7462279574446,51.7691291728637,51.7920301951401,51.8149310239185,51.8378316588428,51.8607320995561,51.8836323457007,51.906532396918,51.9294322528485,51.9523319131319,51.975231377407,51.9981306453118,52.0210297164834,52.043928590558,52.066827267171,52.0897257459569,52.1126240265493,52.1355221085809,52.1584199916837,52.1813176754886,52.2042151596257,52.2271124437242,52.2500095274124,52.2729064103178,52.295803092067,52.3186995722855,52.3415958505981,52.3644919266286,52.3873878]}]],[[{"lng":[4.6462194,4.64050254110449,4.63478758826178,4.62907454040146,4.62336339645383,4.61765415534991,4.61194681602143,4.60624137740086,4.60053783842134,4.59483619801676,4.5891364551217,4.58343860867148,4.57774265760209,4.57204860085028,4.56635643735346,4.5606661660498,4.55497778587813,4.54929129577803,4.54360669468977,4.53792398155433,4.5322431553134,4.52656421490936,4.52088715928533,4.51521198738511,4.5095386981532,4.50386729053483,4.49819776347592,4.49253011592309,4.48686434682367,4.48120045512569,4.47553843977788,4.46987829972967,4.4642200339312,4.45856364133331,4.45290912088753,4.44725647154609,4.44160569226193,4.43595678198868,4.43030973968066,4.42466456429292,4.41902125478116,4.41337981010181,4.40774022921199,4.4021025110695,4.39646665463286,4.39083265886125,4.38520052271458,4.37957024515343,4.37394182513908,4.3683152616335,4.36269055359936,4.3570677],"lat":[52.3873878,52.380025784605,52.3726634935051,52.3653009268654,52.357938084851,52.3505749676267,52.3432115753573,52.3358479082075,52.3284839663418,52.3211197499247,52.3137552591204,52.3063904940931,52.2990254550068,52.2916601420256,52.2842945553131,52.2769286950332,52.2695625613493,52.2621961544249,52.2548294744233,52.2474625215078,52.2400952958414,52.2327277975871,52.2253600269077,52.2179919839661,52.2106236689246,52.203255081946,52.1958862231924,52.1885170928262,52.1811476910095,52.1737780179044,52.1664080736726,52.159037858476,52.1516673724761,52.1442966158347,52.1369255887129,52.1295542912723,52.1221827236738,52.1148108860786,52.1074387786477,52.1000664015417,52.0926937549215,52.0853208389476,52.0779476537805,52.0705741995805,52.0632004765079,52.0558264847228,52.0484522243851,52.0410776956547,52.0337028986914,52.0263278336549,52.0189525007046,52.0115769]}]],[[{"lng":[4.4024643,4.40158924865907,4.40071360630941,4.39983737222351,4.39896054567266,4.39808312592702,4.39720511225559,4.39632650392618,4.39544730020547,4.39456750035894,4.39368710365091,4.39280610934453,4.39192451670178,4.39104232498345,4.39015953344915,4.38927614135733,4.38839214796521,4.38750755252887,4.38662235430317,4.38573655254179,4.38485014649722,4.38396313542073,4.38307551856242,4.38218729517117,4.38129846449466,4.38040902577936,4.37951897827054,4.37862832121225,4.37773705384733,4.3768451754174,4.37595268516286,4.37505958232289,4.37416586613545,4.37327153583727,4.37237659066386,4.37148102984948,4.37058485262717,4.36968805822872,4.36879064588471,4.36789261482444,4.366993964276,4.36609469346621,4.36519480162065,4.36429428796365,4.36339315171828,4.36249139210636,4.36158900834845,4.36068599966383,4.35978236527056,4.35887810438537,4.35797321622378,4.3570677],"lat":[51.2194475,51.2349796155887,51.2505117246486,51.2660438271715,51.2815759231495,51.2971080125744,51.3126400954381,51.3281721717326,51.3437042414498,51.3592363045816,51.3747683611198,51.3903004110563,51.4058324543829,51.4213644910915,51.4368965211738,51.4524285446218,51.4679605614271,51.4834925715815,51.4990245750769,51.514556571905,51.5300885620574,51.545620545526,51.5611525223025,51.5766844923785,51.5922164557457,51.6077484123959,51.6232803623206,51.6388123055115,51.6543442419603,51.6698761716586,51.6854080945979,51.7009400107698,51.7164719201661,51.7320038227781,51.7475357185975,51.7630676076158,51.7785994898245,51.7941313652151,51.8096632337792,51.8251950955082,51.8407269503935,51.8562587984267,51.8717906395992,51.8873224739024,51.9028543013277,51.9183861218665,51.9339179355102,51.9494497422502,51.9649815420779,51.9805133349845,51.9960451209614,52.0115769]}]]],null,"routes_sldf",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"line","stroke":true,"color":"#FF00FF","weight":2,"opacity":0.9,"fill":false,"fillColor":"#6666FF","fillOpacity":1,"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Amsterdam&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Middelburg&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Dordrecht&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Emden&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Middelburg&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>The Hague&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Hamburg&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Het Vlie&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Lisse&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Delft&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>10&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>The Hague&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>11&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>12&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Venice&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>13&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td> 5&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Delft&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td>26&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>15&emsp;<\/td><\/tr><tr><td>1<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>2<\/td><th>destination&emsp;<\/th><td>Delft&emsp;<\/td><\/tr><tr><td>3<\/td><th>n&emsp;<\/th><td>68&emsp;<\/td><\/tr><tr><td>4<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":3,"opacity":1,"fill":false,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[3.610998,45.4408474,12.3155151,53.5510846,true,"routes_sldf","Zoom to routes_sldf","<strong> routes_sldf <\/strong>","bottomright"]},{"method":"addLegend","args":[{"colors":["#FF00FF"],"labels":["routes_sldf"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"routes_sldf"}]},{"method":"addPolylines","args":[[[[{"lng":[4.89516789999999,5.13553790419513,5.37642963107331,5.61783974481818,5.85976483670078,6.10220142496578,6.34514595473783,6.58859479794882,6.83254425328568,7.07699054615975,7.32192982869768,7.56735817975411,7.81327160494666,8.05966603671359,8.30653733439399,8.55388128433128,8.80169359999999],"lat":[52.3702157,52.4182618130615,52.4658194703992,52.5128867747953,52.559461839171,52.6055427868968,52.6511277521055,52.6962148800052,52.740802327194,52.784888261975,52.8284708646729,52.8715483279509,52.9141188571281,52.956180670498,52.9977319996464,53.038771089771,53.0792962]}]],[[{"lng":[4.40246429999999,4.20550252978609,4.00793787527596,3.80976984815248,3.610998],"lat":[51.2194475,51.2897836626097,51.359788398845,51.4294598617662,51.4987962]}]],[[{"lng":[4.6900929,4.67922999948087,4.66829732630544,4.65729406804996,4.64621940000001],"lat":[51.8132979,51.9568218957245,52.100344885476,52.2438668575338,52.3873878]}]],[[{"lng":[7.20600949999999,7.40660380718128,7.60687855986728,7.80683152403637,8.00646049812886,8.20576331307345,8.40473783230692,8.60338195178727,8.80169359999999],"lat":[53.3594029,53.3255584245427,53.2913780649666,53.256862775933,53.2220135178794,53.1868312569055,53.1513169646594,53.1154716182232,53.0792962]}]],[[{"lng":[4.64621940000001,4.51455630246718,4.38354896394537,4.25319237578114,4.1234815667614,3.99441160296803,3.8659775876275,3.73817466095605,3.610998],"lat":[52.3873878,52.2768147829055,52.1660960710798,52.0552329666151,51.9442267582309,51.8330787214207,51.7217901185959,51.6103621992299,51.4987962]}]],[[{"lng":[4.64621940000001,4.55937624006097,4.4728430952722,4.38661822530003,4.30069990000001],"lat":[52.3873878,52.3082600793007,52.2290689018368,52.1498146742173,52.0704978]}]],[[{"lng":[9.99368190000001,9.84323974329826,9.69321147031931,9.54359638653293,9.39439378441375,9.24560294366933,9.09722313146673,8.94925360265736,8.80169359999999],"lat":[53.5510846,53.4927639501531,53.4342549264682,53.3755584480749,53.3166754311924,53.257606789106,53.1983534321447,53.1389162676589,53.0792962]}]],[[{"lng":[5.183333,5.41049539786619,5.63754308505446,5.86447158668767,6.09127644485,6.31795321918858,6.54449748750901,6.77090484636463,6.99717091163933,7.22329131912375,7.44926172508465,7.67507780682735,7.90073526325099,8.12622981539661,8.35155720698754,8.57671320496232,8.80169359999999],"lat":[53.3,53.2894258733339,53.2784203646906,53.2669838689872,53.2551167961084,53.2428195708345,53.2300926327688,53.2169364362606,53.2033514503272,53.1893381585733,53.1748970591074,53.1600286644571,53.1447335014811,53.1290121112797,53.1128650491024,53.0962928842544,53.0792962]}]],[[{"lng":[4.5574834,4.45699846975378,4.35706769999999],"lat":[52.2579303,52.1347960626761,52.0115769]}]],[[{"lng":[4.40246429999999,4.38995092218076,4.37737935280845,4.36474909847445,4.35205966035818,4.33931053415193,4.32650120998471,4.31363117234463,4.30069990000001],"lat":[51.2194475,51.325833556411,51.4322182733412,51.538601639416,51.6449836431359,51.7513642728745,51.8577435168768,51.9641213632578,52.0704978]}]],[[{"lng":[4.64621940000001,4.90198674682259,5.15830241893821,5.41516205565108,5.67256120794417,5.93049533850402,6.18895982177534,6.44794994404549,6.70746090355914,6.96748781066395,7.22802568798707,7.48906947064324,7.75061400647471,8.01265405632319,8.27518429433414,8.53819930829397,8.80169359999999],"lat":[52.3873878,52.4348515033124,52.4817622681066,52.5281179751425,52.5739165198926,52.619155812945,52.6638337804085,52.7079483643165,52.7514975230333,52.7944792316591,52.8368914824365,52.8787322851558,52.9199996675611,52.9606916757561,53.0008063746081,53.0403418481534,53.0792962]}]],[[{"lng":[12.3155151,12.2109940924524,12.1060553641514,12.0006959603618,11.894912904759,11.7887031992891,11.6820638240308,11.5749917370562,11.4674838742932,11.3595371493875,11.2511484535652,11.1423146554965,11.0330326011596,10.9232991137048,10.8131109933202,10.7024650170978,10.5913579389001,10.4797864892277,10.3677473750886,10.2552372798676,10.1422528631969,10.0287907608284,9.91484758450704,9.80041992184493,9.68550433619754,9.57009736654109,9.4541955273514,9.33779530848457,9.22089317505919,9.10348556734053,8.98556890062648,8.86713956513566,8.74819392589751,8.6287283226446,8.50873906970727,8.38822245591061,8.26717474447409,8.14559217291372,8.02347095294692,7.90080727040046,7.77759728512106,7.65383713088946,7.5295229153374,7.40465071986827,7.27921659958116,7.15321658319834,7.026646672997,6.8995028447444,6.77178104763766,6.6434772042472,6.51458721046518,6.38510693545808,6.25503222162419,6.12435888455599,5.9930827130076,5.86119946886748,5.7287048871367,5.59559467591254,5.46186451637831,5.32751006279898,5.19252694252302,5.05691075599069,4.92065707674919,4.78376145147445,4.64621940000001],"lat":[45.4408474,45.5529742773999,45.6650054560874,45.7769401764522,45.8887776719616,46.000517169089,46.1121578872412,46.2236990386851,46.335139828474,46.4464794543731,46.5577171067832,46.6688519686655,46.7798832154641,46.8908100150283,47.0016315275343,47.1123469054059,47.2229552932344,47.3334558276979,47.4438476374797,47.5541298431855,47.6643015572611,47.7743618839074,47.8843099189966,47.9941447499858,48.1038654558311,48.2134711069001,48.3229607648843,48.4323334827097,48.5415883044474,48.6507242652235,48.7597403911268,48.8686356991178,48.9774091969347,49.0860598830005,49.1945867463274,49.3029887664222,49.4112649131892,49.5194141468335,49.627435417763,49.7353276664892,49.8430898235275,49.9507208092972,50.0582195340195,50.1655848976155,50.272815789603,50.3799110889929,50.486869664184,50.5936903728579,50.7003720618721,50.8069135671528,50.9133137135874,51.0195713149147,51.1256851736159,51.2316540808035,51.3374768161105,51.4431521475777,51.5486788315411,51.6540556125181,51.7592812230928,51.8643543838007,51.9692738030129,52.0740381768189,52.1786461889093,52.2830965104575,52.3873878]}]],[[{"lng":[4.40246429999999,4.43225092810655,4.46222811094623,4.49239806593809,4.5227630438072,4.5533253292154,4.58408724140673,4.61505113486726,4.64621940000001],"lat":[51.2194475,51.3654672735562,51.5114794464874,51.6574839299453,51.8034806337388,51.9494694663083,52.0954503347,52.2414231445385,52.3873878]}]],[[{"lng":[4.64621940000001,4.57347193750408,4.5010322920013,4.42889827085077,4.35706769999999],"lat":[52.3873878,52.2935014959396,52.1995706865309,52.1055957096469,52.0115769]}]],[[{"lng":[4.40246429999999,4.39687570385792,4.39126292911683,4.38562578484829,4.37996407817135,4.3742776142274,4.36856619615443,4.36282962506104,4.35706769999999],"lat":[51.2194475,51.3184646248188,51.4174814825352,51.5164980710393,51.6155143881994,51.7145304318624,51.8135461998526,51.912561689972,52.0115769]}]]],null,"routes_sf_tidy",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"line","stroke":true,"color":"#000000","weight":2,"opacity":0.9,"fill":false,"fillColor":"#6666FF","fillOpacity":1,"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Amsterdam&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 2&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Middelburg&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 3&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Dordrecht&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 4&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Emden&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 5&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Middelburg&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 6&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>The Hague&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 7&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Hamburg&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 8&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Het Vlie&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td> 9&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Lisse&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Delft&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>10&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>10&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>The Hague&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>11&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>11&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Bremen&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>12&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>12&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Venice&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>13&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>13&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td> 5&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>14&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Haarlem&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Delft&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td>26&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>15&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>15&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>source&emsp;<\/th><td>Antwerp&emsp;<\/td><\/tr><tr><td>4<\/td><th>destination&emsp;<\/th><td>Delft&emsp;<\/td><\/tr><tr><td>5<\/td><th>n&emsp;<\/th><td>68&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":3,"opacity":1,"fill":false,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addHomeButton","args":[3.610998,45.4408474,12.3155151,53.5510846,true,"routes_sf_tidy","Zoom to routes_sf_tidy","<strong> routes_sf_tidy <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],["routes_sldf","routes_sf_tidy"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#000000"],"labels":["routes_sf_tidy"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"routes_sf_tidy"}]},{"method":"addHomeButton","args":[3.610998,45.4408474,12.3155151,53.5510846,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"limits":{"lat":[45.4408474,53.5510846],"lng":[3.610998,12.3155151]},"fitBounds":[45.4408474,3.610998,53.5510846,12.3155151,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
</section><section id="great-circles-with-sf-for-loop-method" class="level3"><h3 class="anchored" data-anchor-id="great-circles-with-sf-for-loop-method">Great circles with <code>sf</code>: for loop method</h3>
<p>The above method for creating great circles using <code>sf</code> highlights the integration of <code>sf</code> into the tidyverse, but there are always more than one path to answer a question with code. As I learned more about <code>sf</code> objects, I got interested in more directly creating an <code>sf</code> object with a geometry type of <code>LINESTRING</code> from longitude and latitude data. As with the tidy method, the biggest challenge came from creating <code>LINESTRING</code> features and not in turning rhumb lines into great circles. The method I came up with essentially vectorizes the creation of a single <code>LINESTRING</code> feature through the use of a for loop. This uses a similar step-by-step creation of an <code>sf</code> object — from an <code>sfg</code>, to an <code>sfc</code> object, and then to an <code>sf</code> object — that I have shown in <a href="https://jessesadler.com/post/simple-feature-objects/">Exploration of Simple Features for R</a>.<sup>16</sup></p>
<p>Let’s start by building a single feature with a geometry of <code>LINESTRING</code> using coordinates from Venice and Haarlem to outline the process. The <code>st_linestring()</code> function takes a matrix of two or more sets of coordinates to create an <code>sfg</code> object with a geometry of class <code>LINESTRING</code>. We can construct the matrix of coordinates by row binding two vectors — created using <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> — of the longitude and latitude values for Venice and Haarlem.</p>
<div class="cell">
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a line between Venice and Haarlem</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_linestring</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">12.315515</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">45.44085</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.646219</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.38739</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; LINESTRING (12.31551 45.44085, 4.646219 52.38739)</span></span></code></pre></div>
</div>
<p>It is this process that we want to repeat for each of the 15 routes found in <code>routes</code>. A first instinct might be to create a matrix of the coordinates of all of the routes, but this results in a single line connecting the coordinates. Instead, what we need to do is create 15 matrices that each contain the coordinates for the source and destination of a single route. In other words, we want to take the longitude and latitude of both the source and destination from the first row of <code>routes</code>, bind them together into a 2x2 matrix, and then repeat the process for the second row and so forth. This is the realm of the for loop.</p>
<p>Before getting into the mechanics of the for loop, we have to get the data into a format that is similar to the vectors used to create the line between the coordinates of Venice and Haarlem. A similar workflow to that we used above to prepare the data for the <code>gcIntermediate()</code> function gets us what we are looking for. In this case though, we need matrices of source coordinates and destination coordinates. We could either transform <code>sources_tbl</code> and <code>destinations_tbl</code> into matrices with <code><a href="https://rdrr.io/r/base/matrix.html">as.matrix()</a></code> or rerun the code used to create them and use <code><a href="https://rdrr.io/r/base/matrix.html">as.matrix()</a></code> at the end of the pipeline. Here, I do the latter for greater transparency.</p>
<div class="cell">
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Matrix of longitude and latitude values of sources</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sources_m</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">locations</span>, by <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"place"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lon</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Matrix of longitude and latitude values of destinations</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destinations_m</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">locations</span>, by <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"destination"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"place"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lon</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Now we can deal with creating a for loop.<sup>17</sup> There are <a href="http://r4ds.had.co.nz/iteration.html#for-loops">three components of a for loop</a>: the creation of an object that will contain the output of the for loop, the sequence along which to run the for loop, and the actual code that will be looped. Let’s break this down one part at a time. The goal is to build an object that contains a 2x2 matrix for each route. We should start out by creating an empty vector of the appropriate form and length to hold the output of the for loop. We can do this by creating a <a href="http://colinfay.me/intro-to-r/lists-and-data-frames.html">list</a> that has a length equal to the number of rows in the <code>routes</code> data frame with the <code><a href="https://rdrr.io/r/base/vector.html">vector()</a></code> function: <code>linestrings_sfg &lt;- vector(mode = "list", length = nrow(routes))</code>.</p>
<p>The second step is to define a sequence along which the function will loop by creating a variable that holds the place in the sequence and defining the sequence itself. The conventional variable used in a for loop is <code>i</code>. The sequence itself will be similar, if not identical, to the formula used to create the output object. In this case, we want a sequence from 1 — the first row — to 15 — the number of unique routes in our data, which we can determine programmatically by <code>1:nrow(routes)</code>. Thus, the sequence of the for loop is <code>for (i in 1:nrow(routes))</code> with <code>for</code> acting to choose the type of loop and the formula within the parentheses defining the sequence.</p>
<p>Finally, we are able to construct the code to create the desired output. We already know the inputs, output, and functions to use, which we can summarize as follows: <code>linestrings_sfg &lt;- st_linestring(rbind(sources_m, destinations_m))</code>.</p>
<p>However, we do not want to run this code, as it would create a single <code>sfg</code> object connecting all of the points. Instead, we can get our desired output by using the sequence variable to subset both the output list and input matrices in the code. For each iteration of the loop, we want the output to fill one component of the <code>linestrings_sfg</code> list, which we can access with <code>[[i]]</code>. Concerning the inputs, we want to select one row of coordinates from <code>sources_m</code> and one row of coordinates from <code>destinations_m</code> for each iteration. This is possible with the matrix subsetting method of <code>[row, column]</code>. Thus, we can access the sequence of rows with <code>sources_m[i, ]</code> and <code>destinations_m[i, ]</code>.</p>
<p>Putting the above together, we get a complete for loop that creates <code>linestrings_sfg</code>, a list of 15 <code>sfg</code> objects.</p>
<div class="cell">
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create empty list object of length equal to number of routes</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linestrings_sfg</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>mode <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"list"</span>, length <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define sequence and body of loop</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">i</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linestrings_sfg</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[[</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">i</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_linestring</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sources_m</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">i</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>,</span>
<span>                                              <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destinations_m</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">i</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
<p>We can check that the for loop worked by looking at the contents of one value from the list with <code>[[]]</code> subsetting.</p>
<div class="cell">
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># geometry of a single route</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linestrings_sfg</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; LINESTRING (4.402464 51.21945, 3.610998 51.4988)</span></span></code></pre></div>
</div>
<p>The next step is to create an <code>sfc</code> object by transforming the list of <code>sfg</code> objects into a geometry column with <code>st_sfc()</code>. An <code>sfc</code> object is referred to as a geometry set and is itself a list. It is at this step that the lines become geospatial through the addition of a CRS. At this point, we can also convert the rhumb lines to great circles by using <code>st_segmentize()</code> in the same manner as above in the pipeline.</p>
<div class="cell">
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sfc object of great circles</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linestrings_sfc</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_sfc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linestrings_sfg</span>, crs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_segmentize</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">units</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_units</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">km</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print linestrings_sfc</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linestrings_sfc</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry set for 15 features </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: 3.610998 ymin: 45.44085 xmax: 12.31552 ymax: 53.55108</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; First 5 geometries:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; LINESTRING (4.895168 52.37022, 5.135538 52.4182...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; LINESTRING (4.402464 51.21945, 4.205503 51.2897...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; LINESTRING (4.690093 51.8133, 4.67923 51.95682,...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; LINESTRING (7.206009 53.3594, 7.406604 53.32556...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; LINESTRING (4.646219 52.38739, 4.514556 52.2768...</span></span></code></pre></div>
</div>
<p><code>linestrings_sfc</code> is a fully geospatial object. The truncated print out of the coordinates for the first five features indicates that the lines have been segmentized and turned into great circles. The final step is to add the attribute data and convert the <code>sfc</code> object to a <code>sf</code> object with <code>st_sf()</code> and the <code>routes</code> data. The <code>st_sf()</code> function effectively adds <code>linestrings_sfc</code> to <code>routes</code> as a geometry column and converts the whole object to class <code>sf</code> and <code>data.frame</code>. Because we have not done anything to rearrange the rows of <code>routes</code> the data will line up correctly.</p>
<div class="cell">
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create sf object from data frame and sfc geometry set</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes</span>, geometry <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linestrings_sfc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print routes_sf</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sf</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Simple feature collection with 15 features and 3 fields</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: 3.610998 ymin: 45.44085 xmax: 12.31552 ymax: 53.55108</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; First 10 features:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       source destination n                       geometry</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1  Amsterdam      Bremen 1 LINESTRING (4.895168 52.370...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2    Antwerp  Middelburg 1 LINESTRING (4.402464 51.219...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3  Dordrecht     Haarlem 1 LINESTRING (4.690093 51.813...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4      Emden      Bremen 1 LINESTRING (7.206009 53.359...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5    Haarlem  Middelburg 1 LINESTRING (4.646219 52.387...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 6    Haarlem   The Hague 1 LINESTRING (4.646219 52.387...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 7    Hamburg      Bremen 1 LINESTRING (9.993682 53.551...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 8   Het Vlie      Bremen 1 LINESTRING (5.183333 53.3, ...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 9      Lisse       Delft 1 LINESTRING (4.557483 52.257...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10   Antwerp   The Hague 2 LINESTRING (4.402464 51.219...</span></span></code></pre></div>
</div>
<p>Though they were produced using very different methods, <code>routes_sf_tidy</code> and <code>routes_sf</code> are identical objects apart from the presence of an “id” column in <code>routes_sf_tidy</code>.</p>
<p>Now that we have attribute and spatial data for the great circles of the routes of the letters received by Daniel in 1585, we can create a map that uses color to distinguish the amount of letters sent along each route. Because they are essentially identical, you could use either <code>routes_sf_tidy</code> or <code>routes_sf</code> to create this map. The code to create a <code>ggplot2</code> map using <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> is very similar to that made above to compare <code>routes_lines</code> and <code>routes_sf_tidy</code>. In this case, though, we want the color of the lines to differ according to the “n” variable. In addition, I change the color palette used for the lines to the <a href="https://cran.r-project.org/web/packages/viridis/index.html">viridis palette</a> on a continuous scale, hence the <code>_c</code> at the end of the function. I also label the color legend as “Letters”.</p>
<div class="cell">
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggplot2 of great circle routes</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sf</span>, fill <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_sf</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters"</span>, title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Great circles with sf"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>xlim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, ylim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, datum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/great-circles-sp-sf/index_files/figure-html/great-circles-sf-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="resources" class="level2"><h2 class="anchored" data-anchor-id="resources">Resources</h2>
<ul>
<li>Great circles with <code>sp</code>
<ul>
<li>
<a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/">Flowing Data – How to map connections with great circles</a>
<ul>
<li><a href="http://personal.tcu.edu/kylewalker/interactive-flow-visualization-in-r.html">Kyle Walker – Interactive flow visualization in R</a></li>
<li><a href="https://www.dataplanes.org/notes/2018/01/27/flight-routes-night-lights">Data Planes – Flights at Night: Mapping airline routes on NASA’s night lights images</a></li>
</ul>
</li>
</ul>
</li>
<li>Great circles with <code>sf</code> - <a href="http://www.visibledata.co.uk/blog/2018/02/28/2018-02-28_great-circles-with-sf-and-leaflet/">Martin Hadley – Great circles with sf and leaflet</a> - <a href="http://jsmayorga.com/post/mapping-the-global-network-of-transnational-fisheries/">Juan Mayorga – Mapping the Global Network of Transnational Fisheries</a>
</li>
</ul>


</section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>As Mercator explained in <a href="https://en.wikipedia.org/wiki/Mercator_1569_world_map#legend6">legend 6</a> the distortion of distance is infinite at the poles such that they cannot actually be represented on the map.↩︎</p></li>
<li id="fn2"><p>Joaquim Alves Gaspar, “Revisiting the Mercator World Map of 1569: an Assessment of Navigational Accuracy,” <em>The Journal of Navigation</em> 69 (2016): 1183–1196.↩︎</p></li>
<li id="fn3"><p>Roy Iliffe, “Science and the Voyages of Discovery,” in <em>The Cambridge History of Science: Eighteenth-Century Science</em>, ed.&nbsp;Roy Porter (Cambridge: Cambridge University Press, 2003).↩︎</p></li>
<li id="fn4"><p>See the resources section at the end of the post for a list of posts on creating great circles in R.↩︎</p></li>
<li id="fn5"><p>Previous to <a href="https://github.com/r-spatial/sf/blob/master/NEWS.md">version 0.6</a>, <code>sf</code> also used the <code>geosphere</code> package to calculate distance and create great circles with geographic coordinates. The change to use the <code>lwgeom</code> package, which is an implementation of the <a href="https://github.com/postgis/postgis/tree/svn-trunk/liblwgeom">liblwgeom</a> library, aligns <code>sf</code> with the methods used by <a href="http://postgis.net/">PostGIS</a>.↩︎</p></li>
<li id="fn6"><p>This is hardly surprising. Until the fall of 1585, Daniel’s family mainly resided in Antwerp, and he was serving as a representative to the States General, which was meeting at Delft.↩︎</p></li>
<li id="fn7"><p>You can also set whether you want the line to be broken at the International Date Line, but the argument is superfluous in this case.↩︎</p></li>
<li id="fn8"><p>Setting <code>sp = FALSE</code>, which is the default, returns a list of matrices containing the latitude and longitude values for the path along the great circle of each route.↩︎</p></li>
<li id="fn9"><p>Even if you set the <code>Match.ID</code> argument to <code>FALSE</code>, the lines and attribute data would be correctly aligned as long as you do not change the order of the <code>routes</code> data frame after creating <code>sources_tbl</code> and <code>destinations_tbl</code>.↩︎</p></li>
<li id="fn10"><p>This method is similar to the original workflow shown by <a href="http://www.visibledata.co.uk/blog/2018/02/28/2018-02-28_great-circles-with-sf-and-leaflet/">Martin Hadley in his post on Great circles with sf and leaflet</a>.↩︎</p></li>
<li id="fn11"><p>For more information on <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/spread.html">spread()</a></code> see <a href="http://r4ds.had.co.nz/tidy-data.html">Wickham, <em>R for Data Science</em>, Chapter 12</a> and <a href="https://github.com/jtr13/codehelp/blob/master/R/gather.md">Joyce Robbins’s excellent tutorial on <code>gather()</code></a>.↩︎</p></li>
<li id="fn12"><p>It is not necessary to place “type” and “place” in quotations, but doing so more clearly identifies these as strings and not as names of already extant objects.↩︎</p></li>
<li id="fn13"><p>You do not need to include the geometry column in the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function. <a href="https://jessesadler.com/post/simple-feature-objects/#sf">The geometry column is sticky</a> and will remain attached to the <code>sf</code> object unless explicitly removed.↩︎</p></li>
<li id="fn14"><p>The <code>units</code> package is imported along with <code>sf</code>, so if you have <code>sf</code>, you should also have the <code>units</code> package.↩︎</p></li>
<li id="fn15"><p>The equivalent code without the <code>units</code> package would be <code>st_segmentize(routes_lines, 20000)</code>.↩︎</p></li>
<li id="fn16"><p>See the same <a href="https://jessesadler.com/post/simple-feature-objects/">post</a> for a more in depth treatment of the vocabulary of simple feature objects.↩︎</p></li>
<li id="fn17"><p>If you are familiar with for loops in R, you can skip this discussion of the steps to build the for loop.↩︎</p></li>
</ol></section></div> ]]></description>
  <category>rstats</category>
  <category>rspatial</category>
  <guid>https://www.jessesadler.com/post/great-circles-sp-sf/</guid>
  <pubDate>Wed, 28 Mar 2018 04:00:00 GMT</pubDate>
</item>
<item>
  <title>An Exploration of Simple Features for R</title>
  <link>https://www.jessesadler.com/post/simple-feature-objects/</link>
  <description><![CDATA[ <p>The <a href="https://jessesadler.com/post/gis-with-r-intro/">previous post</a> provided an introduction to the <a href="https://cran.r-project.org/web/packages/sp/index.html"><code>sp</code></a> and <a href="https://cran.r-project.org/web/packages/sf/index.html"><code>sf</code></a> packages and how they represent spatial data in R. There I discussed the creation of <code>Spatial</code> and <code>sf</code> objects from data with longitude and latitude values and the process of making maps with the two packages. In this post I will provide further background for the <code>sf</code> package by going into the details of the structure of <code>sf</code> objects and explaining how the package implements the <a href="http://www.opengeospatial.org/standards/sfa">Simple Features open standard</a>. It is certainly not necessary to know the ins and outs of <code>sf</code> objects and the Simple Features standard to use the package — it has taken me long enough to get my head around much of this — but a better knowledge of the structure and vocabulary of <code>sf</code> objects is helpful for understanding the effects of the plethora of <code>sf</code> functions. There are a variety of good resources that discuss the structure of <code>sf</code> objects. The most comprehensive are the <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html">package vignette Simple Features for R</a> and the overview in Chapter 2 of the working book <a href="https://geocompr.robinlovelace.net/spatial-class.html#sf-classes">&nbsp;<em>Geocomputation with R</em> by Robin Lovelace, Jakub Nowosad, and Jannes Muenchow</a>. This post is based on these sources, as well as my own sleuthing through the code for the <code>sf</code> package.</p>
<p>Before diving in, let’s take a step back to provide some background to the package. The <code>sf</code> package implements the <a href="https://en.wikipedia.org/wiki/Simple_Features">Simple Features standard</a> in R. The Simple Features standard is widely used by GIS software such as <a href="http://postgis.net/">PostGIS</a>, <a href="http://geojson.org/">GeoJSON</a>, and <a href="http://www.esri.com/">ArcGIS</a> to represent geographic vector data. The <code>sf</code> package is designed to bring spatial analysis in R in line with these other systems.<sup>1</sup> The standard defines a simple feature as a representation of a real world object by a point or points that may or may not be connected by straight line segments to form lines or polygons. A simple feature can contain both a geometry that includes points, any connecting lines, and a coordinate reference system to identify its location of Earth and attributes to describe the object, such as a name, values, color, etc. The <code>sf</code> package takes advantage of the wide use of Simple Features by linking directly to the <a href="http://gdal.org">GDAL</a>, <a href="http://trac.osgeo.org/geos">GEOS</a>, and <a href="http://proj4.org">PROJ</a> libraries that provide the back end for reading spatial data, making geographic calculations, and handling coordinate reference systems.<sup>2</sup> You can see this from the message when you load the <code>sf</code> package, so let’s do that now.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</span></span></code></pre></div>
</div>
<p>With this general definition of Simple Features in mind, we can look at how the <code>sf</code> package implements the standard through the <code>sf</code> class of object.<sup>3</sup> At its most basic, an <code>sf</code> object is a collection of simple features that includes attributes and geometries in the form of a data frame. In other words, it is a data frame (or tibble) with rows of features, columns of attributes, and a special geometry column that contains the spatial aspects of the features. The special geometry column is itself a <a href="http://colinfay.me/intro-to-r/lists-and-data-frames.html">list</a> of class <code>sfc</code>, which is made up of individual objects of class <code>sfg</code>. While it is possible to have multiple geometry columns, <code>sf</code> objects usually only have a single geometry column. We can break down the components of an <code>sf</code> object by looking at the printed output of an <code>sf</code> object.<sup>4</sup></p>
<p><img src="https://www.jessesadler.com/post/simple-feature-objects/img/sf-object.tiff" id="sf-object" class="img-fluid"></p>
<ul>
<li>
<code>sf</code> object: collection of simple features represented by a data frame</li>
<li>feature: a single simple feature with attributes and geometry represented by a row in the data frame</li>
<li>attributes: non-geometry variables or columns in the data frame</li>
<li>
<code>sfg</code> object: geometry of a single feature</li>
<li>
<code>sfc</code> object: geometry column with the spatial attributes of the object printed above the data frame</li>
</ul>
<p>This terminology covers the basics for <code>sf</code> objects and provides the majority of information you need to work with them. The most likely way to create an <code>sf</code> object is convert another type of spatial object or a data frame with coordinates to an <code>sf</code> object. Rarely is there a reason to create an <code>sf</code> object from scratch. However, we can learn more about the nature of <code>sf</code> objects by delving further into their structure and explicating how <code>sfg</code> and <code>sfc</code> objects combine to store spatial data. The rest of the post will do this by creating an <code>sf</code> object step by step from a single <code>sfg</code> object, to a combination of <code>sfg</code> objects in an <code>sfc</code> object, and finally the addition of attributes to produce a full <code>sf</code> object.</p>
<section id="sfg" class="level2"><h2 class="anchored" data-anchor-id="sfg">
<code>sfg</code> objects</h2>
<p><code>sfg</code> objects represent the geometry of a single feature and contain information about the feature’s coordinates, dimension, and type of geometry. The coordinates are the values of the point or points in the feature, which can have two-, three-, or four dimensions. The vast majority of data is two dimensional, possessing and X and Y coordinates, but the Simple Features standard also possesses a Z coordinate for elevation and an M coordinate for information about the measurement of a point that is rarely used. The geometry type indicates the shape of the feature, whether it consists of a point, multiple points, a line, multiple lines, a polygon, multiple polygons, or some combination of these. There are seventeen different possible types of geometries, but the vast majority of data will use the seven main types discussed here.<sup>5</sup></p>
<section id="geometry-types" class="level3"><h3 class="anchored" data-anchor-id="geometry-types">Geometry types</h3>
<ul>
<li>
<code>POINT</code> – a single point</li>
<li>
<code>MULTIPOINT</code> – multiple points
<ul>
<li>
<code>LINESTRING</code> – sequence of two or more points connected by straight lines</li>
<li>
<code>MULTILINESTRING</code> – multiple lines</li>
<li>
<code>POLYGON</code> – a closed ring with zero or more interior holes</li>
<li>
<code>MULTIPOLYGON</code> - multiple polygons</li>
<li>
<code>GEOMETRYCOLLECTION</code> – any combination of the above types</li>
</ul>
</li>
</ul>
<p>Within the Simple Features standard the geometry of a feature is encoded using <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html#wkb">well-known binary</a> (WKB) that can also be represented in a more human readable form of well-known text (WKT). The <code>sf</code> package can convert between <code>sfg</code> and WKB or WKT very quickly, but <code>sfg</code> objects are created and stored in R as vectors, matrices, or lists of matrices depending on the geometry type.</p>
</section><section id="creating-geometry-types" class="level3"><h3 class="anchored" data-anchor-id="creating-geometry-types">Creating geometry types</h3>
<ul>
<li>
<code>POINT</code> – a vector</li>
<li>
<code>MULTIPOINT</code> and <code>LINESTRING</code> – a matrix with each row representing a point</li>
<li>
<code>MULTILINESTRING</code> and <code>POLYGON</code> – a list of matrices</li>
<li>
<code>MULTIPOLYGON</code> - a list of lists of matrices</li>
<li>
<code>GEOMETRYCOLLECTION</code> – list that combines any of the above</li>
</ul>
<p>An <code>sfg</code> object of each of the seven main geometry types can be created through separate functions: <code>st_point()</code>, <code>st_multipoint()</code>, <code>st_linestring()</code>, etc. The functions all have two arguments: an R object of the proper class to create the specified geometry type and identification of dimensions as either XYZ or XYM if the data has three dimensions. In this post I will create POINT, MULTIPOINT, and LINESTRING geometry types, which are the most likely to be used when creating an <code>sf</code> object from scratch and provide the basis for the remaining types. You can see how to create the remaining types in the package <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html">vignette</a> and <a href="https://geocompr.robinlovelace.net/spatial-class.html#sf-classes"><em>Geocomputation with R</em></a>. Let’s start by creating two points using vectors of longitude and latitude values for points in Los Angeles and Amsterdam.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create an sfg object with coordinates of Los Angeles and Amsterdam</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">la_sfg</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_point</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">118.2615805</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">34.1168926</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">amsterdam_sfg</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_point</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.8979755</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.3745403</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>The relative simplicity of the command to create an <code>sfg</code> POINT underlines the simplicity of <code>sfg</code> objects as a whole. We can see this by taking a closer look at the information contained in these objects.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print sfg POINT objects</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">la_sfg</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; POINT (-118.2616 34.11689)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">amsterdam_sfg</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; POINT (4.897976 52.37454)</span></span></code></pre></div>
</div>
<p>The printing method for all <code>sfg</code> objects uses the well-known text style with the geometry type printed in capital letters followed by the coordinates, using commas and parentheses to distinguish between the different elements for each feature.<sup>6</sup></p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Structure of a sfg POINT object</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">la_sfg</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  'XY' num [1:2] -118.3 34.1</span></span></code></pre></div>
</div>
<p>If we look a bit further into the structure of an <code>sfg</code> object, we can see that it consists of three classes corresponding to the dimensions, geometry type, and the <code>sfg</code> class itself. In addition, the object possesses coordinates, which is a vector of length two. The coordinates can also be represented by a matrix with two columns and one row. In fact, all <code>sfg</code> objects can be represented as a matrix of coordinates, though more complex geometry types contain additional columns to keep track of pieces that make up the feature or features.<sup>7</sup></p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Coordinates of a sfg object</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_coordinates</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">la_sfg</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;           X        Y</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 -118.2616 34.11689</span></span></code></pre></div>
</div>
<p>Points are the building block for all other geometry types. We can see this by creating a MULTIPOINT and LINESTRING simple feature, which are both formed by a matrix of points. The matrix can be created by using <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code> to bind the coordinate vectors together into rows.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Matrix of points</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">118.2615805</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">34.1168926</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.8979755</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.3745403</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             [,1]     [,2]</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1,] -118.261580 34.11689</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [2,]    4.897976 52.37454</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create MULTIPOINT and LINESTRING sfg objects through matrix of points</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">multipoint_sfg</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_multipoint</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">118.2615805</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">34.1168926</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.8979755</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.3745403</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linestring_sfg</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_linestring</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">118.2615805</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">34.1168926</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.8979755</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.3745403</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print objects</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">multipoint_sfg</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; MULTIPOINT ((-118.2616 34.11689), (4.897976 52.37454))</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linestring_sfg</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; LINESTRING (-118.2616 34.11689, 4.897976 52.37454)</span></span></code></pre></div>
</div>
<p>Printing the two new <code>sfg</code> objects shows their basic similarity. They were created by the same matrix and thus have the same coordinates. The only difference is that one is of class MULTIPOINT and the other is of class LINESTRING. In other words, the geometry of <code>multipoint_sfg</code> consists of points, and the geometry of <code>linestring_sfg</code> is a straight line between the same two points. We can see this by plotting the objects next to each other.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>mar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>    mfrow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">multipoint_sfg</span>, main <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MULTIPOINT"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linestring_sfg</span>, main <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LINESTRING"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/simple-feature-objects/index_files/figure-html/multipoint-linestring-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As important as what type of information is contained in <code>sfg</code> objects is, what is missing is equally significant in understanding their role within <code>sf</code> objects. <code>sfg</code> objects consist of a dimension, geometry type, and coordinates, but though they possess spatial aspects, they are not not geospatial. <code>sfg</code> objects do not possess a <a href="https://jessesadler.com/post/gis-with-r-intro/#crs">coordinate reference system (CRS)</a>. There is nothing within the structure of an <code>sfg</code> object to indicate that the X and Y values of the coordinates correspond to longitude and latitude values, much less to the datum of the coordinates. Calculating the distance between <code>la_sfg</code> and <code>amsterdam_sfg</code> demonstrates the non-geospatial nature of <code>sfg</code> objects. The calculation cannot take into account the ellipsoidal nature of the Earth, nor that the distance between degrees of longitude decrease as they move towards the poles. Thus, the calculation for <code>st_distance()</code> has no direct real-world meaning. In fact, the <code>st_distance()</code> function with <code>sfg</code> objects returns the same value as the base R <code><a href="https://rdrr.io/r/stats/dist.html">dist()</a></code> function from the <code>stats</code> package.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Distance on sfg objects does not have real-world meaning</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_distance</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">la_sfg</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">amsterdam_sfg</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;          [,1]</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1,] 124.5055</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># st_distance and stats::dist the same for sfg objects</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">118.2615805</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">34.1168926</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.8979755</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.3745403</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;          1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2 124.5055</span></span></code></pre></div>
</div>
</section></section><section id="sfc" class="level2"><h2 class="anchored" data-anchor-id="sfc">
<code>sfc</code> objects</h2>
<p>The spatial aspects of an <code>sf</code> object are contained in an object of class <code>sfc</code>. The documentation for the <code>sf</code> package often refers to an <code>sfc</code> object as a simple feature geometry list column, which is the role that they play within <code>sf</code> objects. However, as a stand-alone object, an object of class <code>sfc</code> is a list of one or more <code>sfg</code> objects with attributes — in the <a href="http://colinfay.me/r-language-definition/objects.html#attributes">R sense of attributes</a> — that enable the object to have a coordinate reference system. When an <code>sfc</code> object is printed to the console, it is referred to as a geometry set. The <code>sfc</code> class possesses seven subclasses, one for an <code>sfc</code> object composed of each of the six main geometry types and an addition subclass for an <code>sfc</code> object that contains a combination of geometry types.</p>
<section id="sfc-subclasses" class="level3"><h3 class="anchored" data-anchor-id="sfc-subclasses">
<code>sfc</code> subclasses</h3>
<ul>
<li><code>sfc_POINT</code></li>
<li><code>sfc_MULTIPOINT</code></li>
<li><code>sfc_LINESTRING</code></li>
<li><code>sfc_MULTILINESTRING</code></li>
<li><code>sfc_POLYGON</code></li>
<li><code>sfc_MULTIPOLYGON</code></li>
<li><code>sfc_GEOMETRY</code></li>
</ul>
<p>The <code>st_sfc()</code> function to create an <code>sfc</code> object takes any number of <code>sfg</code> objects and a CRS in the form of either an <a href="http://www.epsg.org">EPSG code</a> or a <code>proj4string</code> from the <a href="http://proj4.org">PROJ library</a>. Internally, the <code>crs</code> argument uses the <code>st_crs()</code> function to look up either the EPSG code or <code>proj4string</code> and, if possible, set the corresponding value for the undefined <code>epsg</code> or <code>proj4string</code> through external calls to the <a href="http://gdal.org">GDAL</a> and PROJ libraries. The default CRS for an <code>sfc</code> object is <code>NA</code> or not available. Let’s create an <code>sfc</code> object from one of the above <code>sfg</code> objects with the default CRS to see how an <code>sfc</code> object differs from an <code>sfg</code> object even when it contains the geometry of only one feature.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create sfc object with default crs</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_sfc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">multipoint_sfg</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry set for 1 feature </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: MULTIPOINT</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: -118.2616 ymin: 34.11689 xmax: 4.897976 ymax: 52.37454</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; CRS:           NA</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; MULTIPOINT ((-118.2616 34.11689), (4.897976 52....</span></span></code></pre></div>
</div>
<p>The <code>sfc</code> print method reveals the information contained in the <code>sfg</code> object or objects used to create it, including the geometry type or <code>sfc</code> subclass, dimensions, and the coordinates printed in the same well-known text format used by the <code>sfg</code> print method.<sup>8</sup> However, the <code>sfc</code> print method also reveals the addition of the <code>crs</code> attribute by printing out the <code>epsg</code> and <code>proj4string</code> values. Thus, even though in this case the geospatial aspect of the <code>sfc</code> object is left undefined, the object can be considered geospatial. Let’s further investigate the structure of an <code>sfc</code> object by creating an <code>sfc</code> object with multiple <code>sfg</code> objects and use the <a href="https://en.wikipedia.org/wiki/World_Geodetic_System#WGS84">EPSG code 4326</a> to identify longitude and latitude coordinates on the WGS84 ellipsoid for the CRS. Notice in the print out of the object that the <code>proj4string</code> is identified, though it was not included in the arguments.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create sfc object with multiple sfg objects</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sfc</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_sfc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">la_sfg</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">amsterdam_sfg</span>, crs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sfc</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry set for 2 features </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: POINT</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: -118.2616 ymin: 34.11689 xmax: 4.897976 ymax: 52.37454</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; POINT (-118.2616 34.11689)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; POINT (4.897976 52.37454)</span></span></code></pre></div>
</div>
<p>We can see that an <code>sfc</code> object is a list and treated as such in R by running <code>View(points_sfc)</code>, which will give an output similar to any other list object. However, <code>points_sfc</code> is different from a normal list in that an <code>sfc</code> object possesses five attributes that give <code>sfc</code> objects their geospatial nature.</p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Attributes of sfc object</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sfc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; $class</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "sfc_POINT" "sfc"      </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; $precision</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 0</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; $bbox</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;        xmin        ymin        xmax        ymax </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; -118.261580   34.116893    4.897976   52.374540 </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; $crs</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Coordinate Reference System:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   User input: EPSG:4326 </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   wkt:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; GEOGCRS["WGS 84",</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     ENSEMBLE["World Geodetic System 1984 ensemble",</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (Transit)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (G730)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (G873)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (G1150)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (G1674)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (G1762)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (G2139)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         ELLIPSOID["WGS 84",6378137,298.257223563,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             LENGTHUNIT["metre",1]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         ENSEMBLEACCURACY[2.0]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     PRIMEM["Greenwich",0,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     CS[ellipsoidal,2],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         AXIS["geodetic latitude (Lat)",north,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ORDER[1],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         AXIS["geodetic longitude (Lon)",east,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ORDER[2],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     USAGE[</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         SCOPE["Horizontal component of 3D system."],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         AREA["World."],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         BBOX[-90,-180,90,180]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     ID["EPSG",4326]]</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; $n_empty</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 0</span></span></code></pre></div>
</div>
<p>Here, we can clearly see that <code>points_sfc</code> is of class <code>sfc</code> and subclass <code>sfc_POINT</code> since it only contains geometries of type POINT. The <code>precision</code> attribute corresponds to the precision element of the Simple Features standard and is used in certain geometric calculations. <code>bbox</code> is a calculation of the minimum and maximum values of the X and Y coordinates within the <code>sfc</code> object, and <code>n_empty</code> notes the number of empty <code>sfg</code> objects in the list. The <code>crs</code> attribute is the most interesting for our purposes and consists of a <code>crs</code> object, which itself is a list of length two containing a <code>proj4string</code> and an <code>epsg</code> value if one exists. Because the <code>crs</code> is an attribute of <code>sfc</code> objects, all geometries within an <code>sfc</code> object by definition possess the same CRS. We can inspect the contents of the <code>crs</code> attribute for <code>points_sfc</code> with the <code>st_crs()</code> function even if it does not provide us with any additional information.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># crs attribute is of class crs</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_crs</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sfc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "crs"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Access crs attribute of sfc object</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_crs</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sfc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Coordinate Reference System:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   User input: EPSG:4326 </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   wkt:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; GEOGCRS["WGS 84",</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     ENSEMBLE["World Geodetic System 1984 ensemble",</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (Transit)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (G730)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (G873)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (G1150)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (G1674)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (G1762)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         MEMBER["World Geodetic System 1984 (G2139)"],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         ELLIPSOID["WGS 84",6378137,298.257223563,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             LENGTHUNIT["metre",1]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         ENSEMBLEACCURACY[2.0]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     PRIMEM["Greenwich",0,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     CS[ellipsoidal,2],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         AXIS["geodetic latitude (Lat)",north,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ORDER[1],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         AXIS["geodetic longitude (Lon)",east,</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ORDER[2],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     USAGE[</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         SCOPE["Horizontal component of 3D system."],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         AREA["World."],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         BBOX[-90,-180,90,180]],</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     ID["EPSG",4326]]</span></span></code></pre></div>
</div>
<p>We can confirm the spatial nature of <code>points_sfc</code> by again using the <code>st_distance()</code> function. Beginning with <a href="https://github.com/r-spatial/sf/blob/master/NEWS.md">version 0.6</a> of the <code>sf</code> package, <code>st_distance()</code> uses the <a href="https://cran.r-project.org/web/packages/lwgeom/index.html"><code>lwgeom</code></a> package, which in turn links to geometric functions from the <a href="https://github.com/postgis/postgis/tree/svn-trunk/liblwgeom">liblwgeom</a> library used by PostGIS, to make geometric calculations on longitude and latitude values. Therefore, you may need to install the <code>lwgeom</code> package for the <code>st_distance()</code> function to work properly.</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Geographic distance with sfc object</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_distance</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sfc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Units: [m]</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         [,1]    [,2]</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1,]       0 8933585</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [2,] 8933585       0</span></span></code></pre></div>
</div>
<p>With an <code>sfc</code> object that uses longitude and latitude coordinates and a set <code>crs</code> the <code>st_distance()</code> function uses complex geometric calculations on the chosen ellipsoid to accurately calculate the distance between features. By default the function returns a dense matrix of the distance between all of the features — or <code>sfg</code> objects — contained in the <code>sfc</code> object along with the units of the values from the <a href="https://cran.r-project.org/package=units"><code>units</code></a> package. Here, we can see that the points in Los Angeles and Amsterdam are 8,955,120 meters apart from each other. You can even convert to miles or kilometers with the <code>units</code> package, but the most significant aspect of this command is how it differs from the above use of <code>st_distance()</code> with <code>sfg</code> objects. We now have usable geographical information about the two points we created.</p>
</section></section><section id="sf" class="level2"><h2 class="anchored" data-anchor-id="sf">
<code>sf</code> objects</h2>
<p>Now that we have a set of geometries containing a coordinate reference system in the form of an <code>sfc</code> object, we can connect <code>points_sfc</code> to a data frame of attributes to create an <code>sf</code> object. First though, we need a data frame of attributes that provides information about the two points.</p>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a data frame of attributes for the two points</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Los Angeles"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Amsterdam"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                   language <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"English"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dutch"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                   weather <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sunny"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rainy/cold"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>The <code>st_sf()</code> function can either join a data frame to an <code>sfc</code> object of the same length or take a data frame that already contains an <code>sfc</code> list column to create an <code>sf</code> object. When joining a data frame to an <code>sfc</code> object you can name the geometry list column. Otherwise the column will be named after the <code>sfc</code> object. It is also worth pointing out that the methodology used by <code>st_sf</code> converts a tibble to a data frame, and so the output of the function will always be an object of classes <code>sf</code> and <code>data.frame</code>. Here I want to show two different ways to make an <code>sf</code> object with the <code>data</code> data frame and <code>points_sfc</code>, first by combining the two objects into a single data frame before executing the <code>sf_sf()</code> function and then letting the <code>sf_sf()</code> function do the joining. In the first method, the use of <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code> automatically names the geometry list column as “geometry.”</p>
<div class="cell">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame with list column then make sf object</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sfc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Simple feature collection with 2 features and 3 fields</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: POINT</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: -118.2616 ymin: 34.11689 xmax: 4.897976 ymax: 52.37454</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;          name language    weather                   geometry</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 Los Angeles  English      sunny POINT (-118.2616 34.11689)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2   Amsterdam    Dutch rainy/cold  POINT (4.897976 52.37454)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make sf object from separate data frame and sfc objects</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span>, geometry <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sfc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Simple feature collection with 2 features and 3 fields</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: POINT</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: -118.2616 ymin: 34.11689 xmax: 4.897976 ymax: 52.37454</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;          name language    weather                   geometry</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 Los Angeles  English      sunny POINT (-118.2616 34.11689)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2   Amsterdam    Dutch rainy/cold  POINT (4.897976 52.37454)</span></span></code></pre></div>
</div>
<p>I think that the latter method is preferable, but the former method demonstrates part of the internal process of <code>st_sf()</code> when using the latter method. In either case, both methods produce the same result, and we are presented with the same print method for an <code>sf</code> object that we saw at the beginning of the post. As I noted above, the result of <code>st_sf()</code> is an object of classes <code>sf</code> and <code>data.frame</code>, showing that <code>sf</code> objects are an extension of data frames. Let’s confirm that by creating an <code>sf</code> object and checking its class.</p>
<div class="cell">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create sf object by combining data frame with sfc object and name sfc column geometry</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span>, geometry <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sfc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Class of new sf object</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "sf"         "data.frame"</span></span></code></pre></div>
</div>
<p>The creation of <code>points_sf</code> does not alter the geometry or geographical information contained in <code>points_sfc</code> in any way. To confirm this we can show that the geometry of <code>points_sf</code> — accessed via the <code>st_geometry()</code> function — is equivalent to <code>points_sfc</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Geometry of points_sf is equivalent to points_sfc</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_geometry</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sfc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>In many ways an <code>sf</code> object can be treated as if it were a data frame, and this is one of the main advantages of working with <code>sf</code> objects over <code>Spatial</code> objects from the <code>sp</code> package. As I noted in my <a href="https://jessesadler.com/post/gis-with-r-intro/#sf">previous post</a>, you can manipulate <code>sf</code> objects using <a href="http://dplyr.tidyverse.org/"><code>dplyr</code></a> commands. However, internally <code>sf</code> objects are different from data frames in that the geometry column is designed to be sticky. In addition to the usual attributes associated with a data frame of column names, row names, and class, <code>sf</code> objects also possess an <code>sf_column</code> attribute, which is a vector of the names of the one or more geometry columns in the <code>sf</code> object.<sup>9</sup> The <code>sf_column</code> attribute helps to implement the stickiness of geometry columns. The geometry column is kept in all subsetting of an <code>sf</code> object. For example, using <code>dplyr</code>’s <code>select()</code> function with a single column name returns an <code>sf</code> object with two columns, the selected column and the geometry column.<sup>10</sup></p>
<div class="cell">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stickiness of geometry column</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dplyr</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Simple feature collection with 2 features and 1 field</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: POINT</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: -118.2616 ymin: 34.11689 xmax: 4.897976 ymax: 52.37454</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;          name                   geometry</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 Los Angeles POINT (-118.2616 34.11689)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2   Amsterdam  POINT (4.897976 52.37454)</span></span></code></pre></div>
</div>
<p>If you want to remove the geometry column and transform an <code>sf</code> object to a data frame of tibble, you can use <code>as_tibble()</code> or <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> in a pipe before <code>select()</code>. More directly, you can remove the geometry column and convert an <code>sf</code> object to a tibble or data frame by setting the geometry to <code>NULL</code>. By converting from an <code>sf</code> object to a data frame, we have come full circle in the creation of an <code>sf</code> object from scratch.</p>
<div class="cell">
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Return sf object to a data frame by setting geometry to NULL</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_set_geometry</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;          name language    weather</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 Los Angeles  English      sunny</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2   Amsterdam    Dutch rainy/cold</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Class</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_set_geometry</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "data.frame"</span></span></code></pre></div>
</div>
</section><section id="conclusion" class="level2"><h2 class="anchored" data-anchor-id="conclusion">Wrapping up</h2>
<p>The <code>sf</code> package is quickly becoming the default GIS package for use in R. It has done this by balancing the use of the Simple Features standard, enabling it to link directly to powerful GIS libraries such as PostGIS, GEOS, and GDAL, and an implementation that uses native R objects and fits within the <a href="http://tidyverse.org">tidyverse</a> set of packages and methods. Investigating the structure of <code>sf</code> objects and how they are made through <code>sfg</code> objects, a <code>sfc</code> list column, and a data frame provides insight into how a data-frame-like object is able to possess spatial data.</p>
<p>We can summarize the role of <code>sfg</code>, <code>sfc</code>, and <code>sf</code> objects in the following fashion.</p>
<ul>
<li>
<code>sfg</code>: geometry
<ul>
<li>geometry of a single feature</li>
<li>vector, matrix, or list of matrices of coordinates with defined dimension and type of geometry</li>
<li>seven main geometry types</li>
</ul>
</li>
<li>
<code>sfc</code>: geospatial geometry
<ul>
<li>list of <code>sfg</code> objects</li>
<li>coordinate reference system through <code>crs</code> attribute</li>
<li>seven subclasses based on geometries</li>
</ul>
</li>
<li>
<code>sf</code>: geospatial geometry with attributes
<ul>
<li>data frame with geometry column of class <code>sfc</code>
</li>
<li>sticky geometry column through <code>sf_column</code> attribute</li>
</ul>
</li>
</ul>


</section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>The Simple Features standard was developed after the creation of the <code>sp</code> package, and so <code>sp</code> does not use the standard.↩︎</p></li>
<li id="fn2"><p>Before <code>sf</code>, the primary interfaces to GDAL and GEOS were through the separate <a href="https://cran.r-project.org/web/packages/rgdal/index.html"><code>rgdal</code></a> and <a href="https://cran.r-project.org/web/packages/rgeos/index.html"><code>rgeos</code></a> packages.↩︎</p></li>
<li id="fn3"><p>There are many things called “sf” or “simple features” here, so I will try to be as clear as possible in distinguishing them.↩︎</p></li>
<li id="fn4"><p>See <a href="https://jessesadler.com/post/gis-with-r-intro/">Introduction to GIS with R</a> for the code that created this object. See also the similar image in the <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html#sf-objects-with-simple-features">package vignette</a>.↩︎</p></li>
<li id="fn5"><p>The <code>sf</code> package prints the geometry types in capital letters.↩︎</p></li>
<li id="fn6"><p>See the <a href="http://www.opengeospatial.org/standards/sfa">Implementation Standard for Geographic information - Simple feature access, pg 61</a> for examples of the well-known text style.↩︎</p></li>
<li id="fn7"><p>See <code>help("st_coordinates")</code> for details.↩︎</p></li>
<li id="fn8"><p>If you have more than five features, the print command will only print the first five geometries. You can alter this with an explicit print command with a defined “n” for the number of geometries you want to print.↩︎</p></li>
<li id="fn9"><p>An <code>sf</code> object also contains an <code>agr</code> attribute that can categorize the non-geometry columns as either “constant”, “aggregate”, or “identity” values.↩︎</p></li>
<li id="fn10"><p>Since I have not loaded the <code>dplyr</code> package in this post, I am using the <code>::</code> method to call a function from a package that is not loaded.↩︎</p></li>
</ol></section></div> ]]></description>
  <category>rstats</category>
  <category>rspatial</category>
  <guid>https://www.jessesadler.com/post/simple-feature-objects/</guid>
  <pubDate>Mon, 12 Mar 2018 04:00:00 GMT</pubDate>
  <media:content url="https://www.jessesadler.com/post/simple-feature-objects/img/sf-object.tiff" medium="image"/>
</item>
<item>
  <title>Introduction to GIS with R</title>
  <link>https://www.jessesadler.com/post/gis-with-r-intro/</link>
  <description><![CDATA[ <p>The geographic visualization of data makes up one of the major branches of the Digital Humanities toolkit. There are a plethora of tools that can visualize geographic information from full-scale GIS applications such as <a href="https://www.esri.com">ArcGIS</a> and <a href="https://qgis.org">QGIS</a> to web-based tools like <a href="http://maps.google.com">Google maps</a> to any number of programing languages. There are advantages and disadvantages to these different types of tools. Using a command-line interface <a href="https://jessesadler.com/post/excel-vs-r/">has a steep learning curve</a>, but it has the benefit of enabling approaches to analysis and visualization that are customizable, transparent, and reproducible.<sup>1</sup> My own interest in coding and <a href="https://www.r-project.org">R</a> began with my desire to dip my toes into <a href="https://en.wikipedia.org/wiki/Geographic_information_system">geographic information systems (GIS)</a> and create maps of an early modern correspondence network. The goal of this post is to introduce the basic landscape of working with spatial data in R from the perspective of a non-specialist. Since the early 2000s, an active community of R developers has built a wide variety of packages to enable R to interface with geographic data. The extent of the geographic capabilities of R is readily apparent from the many packages listed in the <a href="https://cran.r-project.org/web/views/Spatial.html">CRAN task view for spatial data</a>.<sup>2</sup></p>
<p>In my previous post on <a href="https://jessesadler.com/post/geocoding-with-r/">geocoding with R</a> I showed the use of the <a href="https://cran.r-project.org/web/packages/ggmap/index.html"><code>ggmap</code></a> package to geocode data and create maps using the <a href="http://ggplot2.tidyverse.org"><code>ggplot2</code></a> system. This post will build off of the location data obtained there to introduce the two main R packages that have standardized the use of spatial data in R. The<a href="https://cran.r-project.org/web/packages/sp/index.html"><code>sp</code></a> and <a href="https://cran.r-project.org/web/packages/sf/index.html"><code>sf</code></a> packages use different methodologies for integrating spatial data into R. The <code>sp</code> package introduced a coherent set of classes and methods for handling spatial data in 2005.<sup>3</sup> The package remains the backbone of many packages that provide GIS capabilities in R. The <code>sf</code> package implements the <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html">simple features</a> open standard for the representation of geographic vector data in R. The package first appeared on <a href="http://cran.r-project.org">CRAN</a> at the end of 2016 and is under very active development. The <code>sf</code> package is <a href="https://www.r-consortium.org/blog/2017/01/03/simple-features-now-on-cran">meant to supersede <code>sp</code></a>, implementing ways to store spatial data in R that <a href="https://edzer.github.io/UseR2017/" title="Edzer Pebesma, Spatial Data in R: New Directions">integrate with the tidyverse workflow</a> of the <a href="http://tidyverse.org">packages developed by Hadley Wickham and others</a>.</p>
<p>There are a number of good resources on working with spatial data in R. The best sources for information about the <code>sp</code> and <code>sf</code> packages that I have found are Roger Bivand, Edzer Pebesma, and Virgilio Gómez-Rubio, <em>Applied Spatial Data Analysis with R</em> (2013) and the working book <a href="https://bookdown.org/robinlovelace/geocompr/">Robin Lovelace, Jakub Nowosad, Jannes Muenchow, <em>Geocomputation with R</em></a>, which concentrate on <code>sp</code> and <code>sf</code> respectively. The <a href="https://cran.r-project.org/web/packages/sf/">vignettes</a> for <code>sf</code> are also very helpful. The perspective that I adopt in this post is slightly different from these resources. In addition to more explicitly comparing <code>sp</code> and <code>sf</code>, this post approaches the two packages from the starting point of working with geocoded data with longitude and latitude values that must be transformed into spatial data. It takes the point of view of someone getting into GIS and does not assume that you are working with data that is already in a spatial format. In other words, this post provides information that I wish I knew as I learned to work with spatial data in R. Therefore, I begin the post with a general overview of spatial data and how <code>sp</code> and <code>sf</code> implement the representation of spatial data in R. The second half of the post uses an example of mapping the locations of letters sent to a Dutch merchant in 1585 to show how to create, work with, and plot <code>sp</code> and <code>sf</code> objects. I highlight the differences between the two packages and ultimately discuss some reasons why the R spatial community is moving towards the use of the <code>sf</code> package.</p>
<section id="crs" class="level2"><h2 class="anchored" data-anchor-id="crs">Spatial data and coordinate reference systems</h2>
<p>The distinguishing feature of spatial data is that it represents actual locations on Earth. To represent the geographic placement of an object you need two pieces of information: the coordinates of the object and a system of reference for how the coordinates relate to a physical location on Earth. The non-spherical shape of the Earth, which bulges at the equator, complicates the creation and use of a coordinate reference system or CRS and plethora of complex models have been created in attempts to accurately represent the Earth’s surface. A CRS consists of one such ellipsoid or geometric model of the shape of the Earth and a datum, which identifies the origin and orientation of the coordinate axes on the ellipsoid, as well as the units of measurement.<sup>4</sup> There are two types of CRSs: geographic and projected. Geographic reference systems represent points on an globe, using units of degrees longitude and latitude that correspond to angles measured from the center of the Earth as calculated using the given ellipsoid. A projected reference system uses a geometric model to project a 3-dimensional ellipsoid onto a 2-dimensional plane. A projection is necessary to create any 2-dimensional map, but it <a href="https://www.vox.com/world/2016/12/2/13817712/map-projection-mercator-globe">results in the distortion</a> of aspects of the Earth’s surface such as <a href="http://axismaps.github.io/thematic-cartography/articles/projections.html">area, direction, distance, and shape</a>. Despite the necessary distortion, projected reference systems are useful for geographic analysis, because they use linear units of measurement such as meters instead of degrees.<sup>5</sup></p>
<p>Between the variety of ellipsoidal models, the vast array of global and local datums, and the various kinds of projections, there are innumerable CRSs to choose from. The <code>sp</code> and <code>sf</code> packages implement two different ways to identify a specific CRS and to transform objects from one CRS to another: the <a href="http://proj4.org">Proj.4 library</a> and <a href="http://www.epsg.org">EPSG codes</a>. The Proj.4 library uses an identification system of <code>+parameter=value</code> to define a CRS. The library uses a <a href="http://proj4.org/parameters.html#parameter-list">wide range of parameters</a> to specify a CRS, but the most important are <code>+proj</code> and <code>+datum</code> for the projection and datum to be used. The Proj.4 parameters provides the basis for how <code>sp</code> and <code>sf</code> identify CRSs, but CRSs can also be identified through EPSG codes.<sup>6</sup> The EPSG library supplies codes for well-known CRSs, and thus provides an easier method to identify a subset of the CRSs available through the Proj.4 library. You can access a data frame of over 5,000 EPSG codes available in R through the <a href="https://cran.r-project.org/web/packages/rgdal/index.html"><code>rgdal</code></a> package with the command <code>rgdal::make_EPSG()</code>. If you plan to deal with spatial data on a regular basis it is probably worth being familiar with widely used EPSG code such as 4326, which is geographic reference system that uses units of longitude and latitude on the <a href="https://en.wikipedia.org/wiki/World_Geodetic_System#WGS84">&nbsp;World Geodetic System 1984 (WGS84) ellipsoid</a>. Two useful resources for looking up and obtaining information about specific EPSG codes are <a href="https://epsg.io">EPSG.io</a> and <a href="http://spatialreference.org">SpatialReference.org</a>.</p>
<p>Spatial data with a defined CRS can represent either vector or raster data. Vector data is based on points — which can be connected to form lines and polygons — that are located within a coordinate reference system. Raster data, on the other hand, consists of values within a grid system. For example, a road map is a vector data and a map using satellite imagery is raster data made up of pixels on a grid. <code>sp</code> has capabilities to work with both vector and raster data, while <code>sf</code> and the simple features standard on which it is based only deals with vector data. This post will only discuss vector data, which is more widely used in the Humanities and Social Sciences.</p>
</section><section id="overview-spsf" class="level2"><h2 class="anchored" data-anchor-id="overview-spsf">Overview of <code>sp</code> and <code>sf</code> packages</h2>
<p>The complexity that comes with the identification and translation between the thousands of different coordinate reference systems makes it impossible for standard R objects such as data frames to properly represent spatial data. In addition, the best way to represent coordinates — in one or two columns — and the representation of more complex objects such as lines and polygons create problems for how to store spatial data. These shortcomings can be seen with geocoded data that contains longitude and latitude values in a data frame like that I created in <a href="https://jessesadler.com/post/geocoding-with-r/">geocoding with R</a>. Most geocoded data created through <a href="https://gis.stackexchange.com/questions/48949/epsg-3857-or-4326-for-googlemaps-openstreetmap-and-leaflet">Google Maps or other geocoding sites&nbsp;</a> provides coordinates in longitude and latitude values using the WGS84 ellipsoid and thus contains a CRS equivalent to the Proj.4 argument <code>+proj=longlat +datum=WGS84</code> or EPSG 4326. However, this information about the CRS is implicit and not contained anywhere within the data frame itself.</p>
<p>Due to the inadequacies of normal data frame objects to represent the variety of features of spatial data, the <code>sp</code> and <code>sf</code> packages both define their own classes of objects to store spatial data. From a beginner’s perspective, the main differences between the <code>sp</code> and <code>sf</code> packages derive from the manner by which <code>sp</code> and <code>sf</code> classes store information about CRS, distinguish between points, lines, and polygons, and how they connect this spatial data to non-spatial data stored in a data frame.</p>
<p>The <code>sp</code> package uses what are known as <a href="https://bookdown.org/rdpeng/RProgDA/object-oriented-programming.html#s4">S4</a> classes in R to represent spatial data. S4 objects are made up of <strong>slots</strong> that store different types of well-defined data. The slots can be accessed with the <code>@</code> symbol in the form of <code>object@slot</code>. The foundational <code>sp</code> class is the <code>Spatial</code> class, which has ten subclasses differentiated by the slots they contain. To get a better idea of what this all looks like, we can use the <code><a href="https://rdrr.io/r/methods/getClass.html">getClass()</a></code> function, but first we have to load the <code>sp</code> package.<sup>7</sup></p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load the sp package</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/edzer/sp/">sp</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Spatial classes</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getClass</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spatial"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "Spatial" [package "sp"]</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Slots:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;                               </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Name:         bbox proj4string</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class:      matrix         CRS</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Known Subclasses: </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "SpatialPoints", directly</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "SpatialMultiPoints", directly</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "SpatialGrid", directly</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "SpatialLines", directly</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "SpatialPolygons", directly</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "SpatialPointsDataFrame", by class "SpatialPoints", distance 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "SpatialPixels", by class "SpatialPoints", distance 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "SpatialMultiPointsDataFrame", by class "SpatialMultiPoints", distance 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "SpatialGridDataFrame", by class "SpatialGrid", distance 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "SpatialLinesDataFrame", by class "SpatialLines", distance 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "SpatialPixelsDataFrame", by class "SpatialPoints", distance 3</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Class "SpatialPolygonsDataFrame", by class "SpatialPolygons", distance 2</span></span></code></pre></div>
</div>
<p>The output lists the different <code>Spatial</code> classes and shows that the basis for all <code>Spatial</code> objects is the <code>bbox</code> and <code>proj4string</code> slots. The <code>proj4string</code> provides the CRS for an object through a Proj.4 definition, while the <code>bbox</code> slot provides a matrix of the minimum and maximum coordinates for the object. The <code>Spatial</code> subclasses add slots to the foundational slots of <code>bbox</code> and <code>proj4string</code> for the type of geometric data — points, lines, polygons, and grid for raster — and whether the object contains attribute data in the form of a data frame. We can see this from the slots in the <code>SpatialPoints</code> and the <code>SpatialPointsDataFrame</code> classes.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># slots for SpatialPoints class</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slotNames</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SpatialPoints"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "coords"      "bbox"        "proj4string"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># slots for SpatialPointsDataFrame</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slotNames</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SpatialPointsDataFrame"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "data"        "coords.nrs"  "coords"      "bbox"        "proj4string"</span></span></code></pre></div>
</div>
<p>The <code>SpatialPoints</code> class contains a <code>coords</code> slot to store the point coordinates. The <code>SpatialPointsDataFrame</code> class adds a <code>data</code> slot that enables points to be associated with attribute data in a data frame. The non-spatial data of a <code>Spatial*DataFrame</code> object can be accessed with <code>@data</code>. However, these S4-style classes do not fit within the definition of <a href="http://r4ds.had.co.nz/tidy-data.html">tidy data</a> and cannot be manipulated using the <a href="http://r4ds.had.co.nz/transform.html"><code>dplyr</code></a> methods I have discussed in previous posts. Instead, all manipulation of the <code>@data</code> slot is done with base R commands. <code>sp</code> objects also cannot be plotted with <code>ggplot2</code>, but need to use the base or trellis plotting systems, though it is possible to force them into a compatible form with the <a href="https://cran.r-project.org/web/packages/broom/index.html"><code>broom</code></a> package.</p>
<p>In contrast to the <code>Spatial</code> class, the <code>sf</code> class — yes, the package and class have the same name — is an extension of data frames. Essentially, <code>sf</code> objects can be treated as data frames that also contain spatial data, as opposed to spatial data that may or may not also contain data frames. This enables <code>sf</code> objects to fit within the <a href="http://tidyverse.org">tidyverse</a> workflow, making it possible to <a href="http://strimas.com/r/tidy-sf/">manipulate them with <code>dplyr</code> commands</a>. The <a href="https://edzer.github.io/UseR2017/">tidy</a> nature of <code>sf</code> objects also means that they can can be <a href="http://ggplot2.tidyverse.org/reference/ggsf.html">plotted with <code>ggplot2</code></a>, though currently this capability is only possible with the development version of <code>ggplot2</code>.</p>
<p><code>sf</code> objects consist of rows of features, hence the name simple features, which have both non-spatial and spatial forms of data. The spatial data of an <code>sf</code> object is contained in a special geometry column that is of class <code>sfc</code>. The geometry column contains the same basic types of spatial data as the slots in <code>Spatial</code> objects: the CRS, coordinates, and type of geometric object. The <code>sfc</code> class has seven subclasses to denote the types of geometric objects within the geometry column, which are derived from the simple features standard. The possible geometric objects are point, linestring, polygon, multipoint, multilinestring, multipolygon, and geometrycollection for any combination of the other types.<sup>8</sup></p>
<p>With this basic introduction to spatial data and the <code>sp</code> and <code>sf</code> packages out of the way, the remainder of the post will demonstrate the creation and visualization of <code>Spatial</code> and <code>sf</code> objects by creating maps of the letters sent to Daniel van der Meulen in 1585. For this example, I want to map the total number of letters sent from and received in each location <a href="https://www.jessesadler.com/post/geocoding-with-r/#mapping-data">as I did previously with <code>ggamp</code></a>. This will involve working with spatial data in the form of points, lines, and polygons. The points will represent the sources and destinations of the letters Daniel received and will be plotted on two different kinds of background maps using the <a href="http://cran.r-project.org/web/packages/rnaturalearth"><code>rnaturalearth</code></a> package to access coastal (lines) and country (polygons) world maps from the <a href="http://www.naturalearthdata.com">Natural Earth</a> open-source repository of maps. In the process I will show how to make base R maps with <code>sp</code> and <code>ggplot2</code> plots with <code>sf</code> and development version of <code>ggplot2</code>.</p>
</section><section id="preparing-data" class="level2"><h2 class="anchored" data-anchor-id="preparing-data">Preparing the data</h2>
<p>The first thing that we need to do is get information about the number of letters sent from and received in each city and join this non-spatial data with the longitude and latitude information that was created in the <a href="https://jessesadler.com/post/geocoding-with-r/">geocoding with R</a> post. This will provide the necessary components to create spatial points object in both <code>sp</code> and <code>sf</code>. You can find the data and the R script that goes along with this example on <a href="https://github.com/jessesadler/intro-to-r">GitHub</a>. Let’s start by loading the necessary packages and the two files containing data on the letters and the location of the cities in the letters data.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load the packages</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/edzer/sp/">sp</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://docs.ropensci.org/rnaturalearth/">rnaturalearth</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load the data</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/correspondence-data-1585.csv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">locations</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/locations.csv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>The <code>letters</code> data frame contains 114 rows of letters with columns representing the writer, source, destination, and date of each letter. This example will only make use of the source and destination of the letters. The <code>locations</code> data frame contains columns for the name, longitude, and latitude of the 13 cities found in the letters data. There are a couple of ways that the data can be prepared, but in this case I want the data for the source and destination of the letters to be in a single data frame in order to minimize the objects that we will be dealing with in the post. The goal is to create a data frame with a column for the name of the city, the number of letters, and whether this information refers to letters sent or letters received. This can be done by separately finding the number of letters sent to each location and the number of letters received in each location and then joining the two data frames together.</p>
<p>We can get the number of letters sent from and received in each location by using <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>, which is a shortcut for <code>group_by() %&gt;% summarise(n = n())</code>. This provides us with a count column, but we also want to structure the data frames for source and destination in the same way. Therefore, I rename the column containing the city information to “place.” Doing this removes information about whether the observation is a source or destination, and so I add in this data with <code><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column()</a></code>, creating a “type” column.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Letters per source</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sources</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">source</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>place <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">source</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Letters per destination</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destinations</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destination</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>place <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destination</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Destination"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>At this point, you can use either <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code> or <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> to bind the rows of <code>sources</code> and <code>destinations</code> together to create a <code>letters_data</code> data frame that contains the non-spatial data we will be using. In addition, we need to make a small but important change to the type of data in the “type” column to make it possible to differentiate between the sources and destinations in the base R plots created below. We can transform the “type” column to a factor using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> and <code><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor()</a></code> from the <a href="http://forcats.tidyverse.org"><code>forcats</code></a> package. This changes the way that R represents the data behind the scenes such that “source” and “destination” can be represented by numeric integers, which is necessary for working with colors in base R plots.<sup>9</sup></p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bind the rows of the two data frames</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and change type column to factor</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters_data</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sources</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destinations</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Let’s look at the result. We can see that the data is in the format that we are looking for and that the “type” column has been correctly transformed into factors.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print letters_data</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters_data</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 14 × 3</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    place          n type       </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;chr&gt;      &lt;int&gt; &lt;fct&gt;      </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Amsterdam      1 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Antwerp       76 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Dordrecht      1 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Emden          1 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Haarlem       30 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Hamburg        1 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Het Vlie       1 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Lisse          1 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Venice         2 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Bremen         6 Destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11 Delft         95 Destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 Haarlem        8 Destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13 Middelburg     2 Destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 14 The Hague      3 Destination</span></span></code></pre></div>
</div>
<p>Having created the data for the number of letters sent from and received in each location, we now need to add the longitude and latitude of the cities. We can do this with a left join with the <code>locations</code> data frame, using the “place” column as the key to link the two data frames.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join letters_data to locations</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">geo_data</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters_data</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">locations</span>, by <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"place"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print data with longitude and latitude columns</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">geo_data</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 14 × 5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    place          n type          lon   lat</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;chr&gt;      &lt;int&gt; &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Amsterdam      1 Source       4.90  52.4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Antwerp       76 Source       4.40  51.2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Dordrecht      1 Source       4.69  51.8</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Emden          1 Source       7.21  53.4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Haarlem       30 Source       4.65  52.4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Hamburg        1 Source       9.99  53.6</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Het Vlie       1 Source       5.18  53.3</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Lisse          1 Source       4.56  52.3</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Venice         2 Source      12.3   45.4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Bremen         6 Destination  8.80  53.1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11 Delft         95 Destination  4.36  52.0</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 Haarlem        8 Destination  4.65  52.4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13 Middelburg     2 Destination  3.61  51.5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 14 The Hague      3 Destination  4.30  52.1</span></span></code></pre></div>
</div>
<p>The result is a data frame with 14 rows and 5 columns that give the number of letters sent from and received in the different locations and the longitude and latitude of those places. We now have all of the information that we need to transform this data into a spatial object with both <code>sp</code> and <code>sf</code>. We will then be able to map the points on base maps provided by the <code>rnaturalearth</code> package.</p>
</section><section id="sp" class="level2"><h2 class="anchored" data-anchor-id="sp">Spatial data with <code>sp</code>
</h2>
<p>The creation of a <code>Spatial</code> object involves providing data for the slots expected for each subclass. Creating a <code>SpatialPoints</code> object requires data for the <code>coords</code> and <code>proj4string</code> slots.<sup>10</sup> The information for the <code>coords</code> slot can be filled by a data frame of the longitude and latitude values from <code>geo_data</code>. This can be done by creating a new data frame that only contains the “lon” and “lat” columns of <code>geo_data</code>. As noted above, the CRS for our data is implicitly longitude and latitude values on the WGS84 ellipsoid, which we can identify through the <code>CRS()</code> function containing a proj.4 argument. We can either specify the specific projection and datum arguments with <code>+proj=longlat +datum=WGS84</code> or use the EPSG code with <code>+init=epsg:4326</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame of only longitude and latitude values</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">coords</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">geo_data</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lon</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create SpatialPoints object with coords and CRS</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sp</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SpatialPoints</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>coords <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">coords</span>,</span>
<span>                           proj4string <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+proj=longlat +datum=WGS84"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Printing out our newly created <code>SpatialPoints</code> object does not make for particularly exciting reading. We see the coordinates, which are now in matrix form, and the CRS of the object. We can get a better insight into the structure of the object with the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> command, even if the output is a bit off-putting at first. This shows the three slots for the <code>SpatialPoints</code> object and the values contained within the slots.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print SpatialPoints object</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sp</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; SpatialPoints:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             lon      lat</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  [1,]  4.895168 52.37022</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  [2,]  4.402464 51.21945</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  [3,]  4.690093 51.81330</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  [4,]  7.206010 53.35940</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  [5,]  4.646219 52.38739</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  [6,]  9.993682 53.55108</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  [7,]  5.183333 53.30000</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  [8,]  4.557483 52.25793</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  [9,] 12.315515 45.44085</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [10,]  8.801694 53.07930</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [11,]  4.357068 52.01158</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [12,]  4.646219 52.38739</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [13,]  3.610998 51.49880</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [14,]  4.300700 52.07050</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Coordinate Reference System (CRS) arguments: +proj=longlat +datum=WGS84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; +no_defs</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Structure of SpatialPoints object</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Formal class 'SpatialPoints' [package "sp"] with 3 slots</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ coords     : num [1:14, 1:2] 4.9 4.4 4.69 7.21 4.65 ...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. .. ..$ : NULL</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. .. ..$ : chr [1:2] "lon" "lat"</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ bbox       : num [1:2, 1:2] 3.61 45.44 12.32 53.55</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. .. ..$ : chr [1:2] "lon" "lat"</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. .. ..$ : chr [1:2] "min" "max"</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. .. ..@ projargs: chr "+proj=longlat +datum=WGS84 +no_defs"</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. .. ..$ comment: chr "GEOGCRS[\"unknown\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.25722"| __truncated__</span></span></code></pre></div>
</div>
<p>We have now successfully created a <code>Spatial</code> object. However, <code>points_sp</code> does not contain any of the non-spatial data that was created in preparing the data. We can attach this non-spatial data to the <code>Spatial</code> data by creating a <code>SpatialPointsDataFrame</code> object. This is done in the same manner as a <code>SpatialPoints</code> object but also includes filling the <code>data</code> slot with the <code>letters_data</code> data frame.<sup>11</sup> Because the data in both the <code>coords</code> and <code>data</code> slots derived from the same source, the coordinates and non-spatial data will be correctly aligned by row number.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create SpatialPointsDataFrame object</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SpatialPointsDataFrame</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>coords <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">coords</span>,</span>
<span>                                      data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters_data</span>,  </span>
<span>                                      proj4string <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+proj=longlat +datum=WGS84"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Printing out <code>points_spdf</code> shows a result not dramatically different from printing out the <code>geo_data</code> data frame. However, inspecting the structure of the object shows that it has a very different composition.</p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print out SpatialPointsDataFrame</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;             coordinates      place  n        type</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1  (4.895168, 52.37022)  Amsterdam  1      Source</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2  (4.402464, 51.21945)    Antwerp 76      Source</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3   (4.690093, 51.8133)  Dordrecht  1      Source</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4    (7.20601, 53.3594)      Emden  1      Source</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5  (4.646219, 52.38739)    Haarlem 30      Source</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 6  (9.993682, 53.55108)    Hamburg  1      Source</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 7      (5.183333, 53.3)   Het Vlie  1      Source</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 8  (4.557483, 52.25793)      Lisse  1      Source</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 9  (12.31552, 45.44085)     Venice  2      Source</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10  (8.801694, 53.0793)     Bremen  6 Destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11 (4.357068, 52.01158)      Delft 95 Destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 (4.646219, 52.38739)    Haarlem  8 Destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13  (3.610998, 51.4988) Middelburg  2 Destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 14    (4.3007, 52.0705)  The Hague  3 Destination</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Structure of SpatialPointsDataFrame object</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ data       : tibble [14 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. ..$ place: chr [1:14] "Amsterdam" "Antwerp" "Dordrecht" "Emden" ...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. ..$ n    : int [1:14] 1 76 1 1 30 1 1 1 2 6 ...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. ..$ type : Factor w/ 2 levels "Source","Destination": 1 1 1 1 1 1 1 1 1 2 ...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ coords.nrs : num(0) </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ coords     : num [1:14, 1:2] 4.9 4.4 4.69 7.21 4.65 ...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. .. ..$ : NULL</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. .. ..$ : chr [1:2] "lon" "lat"</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ bbox       : num [1:2, 1:2] 3.61 45.44 12.32 53.55</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. .. ..$ : chr [1:2] "lon" "lat"</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. .. ..$ : chr [1:2] "min" "max"</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. .. ..@ projargs: chr "+proj=longlat +datum=WGS84 +no_defs"</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. .. ..$ comment: chr "GEOGCRS[\"unknown\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.25722"| __truncated__</span></span></code></pre></div>
</div>
<p>The nature of a <code>SpatialPointsDataFrame</code> object means that they cannot be manipulated in the same way as a normal data frame. You can access the data frame as you would any of the other slots in a <code>Spatial</code> object with the <code>points_spdf@data</code> notation. However, if you want to make changes to the <code>points_spdf</code> through an aspect of the <code>data</code> slot, you cannot use <code>dplyr</code> commands. Instead, you need to use base R methods, which can be a bit more convoluted. For instance, if you want to get the observations of places in which Daniel either received or was sent a certain number of letters you would use <code>@data</code> to access the data frame, <code>[]</code> to subset, and <code>$</code> to access the column that you want to subset. You can see an example of this below, creating a <code>SpatialPointsDataFrame</code> that contains the three locations in which “n” is greater than 10 and simply printing out the result to demonstrate the workflow.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Access the data frame of a SpatialPointsDataFrame</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 14 × 3</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    place          n type       </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;chr&gt;      &lt;int&gt; &lt;fct&gt;      </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Amsterdam      1 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Antwerp       76 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Dordrecht      1 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Emden          1 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Haarlem       30 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Hamburg        1 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Het Vlie       1 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Lisse          1 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Venice         2 Source     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Bremen         6 Destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11 Delft         95 Destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 Haarlem        8 Destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13 Middelburg     2 Destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 14 The Hague      3 Destination</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Example of subsetting `points_spdf` to return locations with "n" greater than 10</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;            coordinates   place  n        type</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 (4.402464, 51.21945) Antwerp 76      Source</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2 (4.646219, 52.38739) Haarlem 30      Source</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3 (4.357068, 52.01158)   Delft 95 Destination</span></span></code></pre></div>
</div>
<p>To make a map with the <code>SpatialPoints</code> objects of the correspondence of Daniel, we need to get a background map of western Europe to provide geographical context. There are a number of R packages that provide access to various maps which can be read in as <code>Spatial</code> data. Here, I will make use of the <code>rnaturalearth</code> package to get access to a map of the coastlines of the world and another for the countries in the world.<sup>12</sup> This will create two different kinds of <code>Spatial</code> objects. Because both maps contain non-spatial attribute data, they will be of class <code>SpatialLinesDataFrame</code> and <code>SpatialpolygonsDataFrame</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get coastal and country world maps as Spatial objects</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">coast_sp</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ne_coastline</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sp</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ne_countries</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Not only are <code>coast_sp</code> and <code>countries_sp</code> useful for mapping the points data, they also provide an opportunity to look at the structure of more complex <code>Spatial</code> objects. Printing out either object fills up the entire console with an overflow of information. Instead, we can get an idea of the structure of the two objects with the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> command. To ensure that we do not overloaded with information with this command, I will only show the first two levels, which shows information about the slots but not on the data within the slots.</p>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Structure of SpatialLinesDataFrame</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">coast_sp</span>, max.level <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Formal class 'SpatialLinesDataFrame' [package "sp"] with 4 slots</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ data       :'data.frame':  1428 obs. of  2 variables:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ lines      :List of 1428</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ bbox       : num [1:2, 1:2] -180 -85.2 180 83.6</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Structure of SpatialPolygonsDataFrame</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sp</span>, max.level <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Formal class 'SpatialPolygonsDataFrame' [package "sp"] with 5 slots</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ data       :'data.frame':  241 obs. of  63 variables:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ polygons   :List of 241</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ plotOrder  : int [1:241] 12 184 39 227 42 33 16 87 113 9 ...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ bbox       : num [1:2, 1:2] -180 -90 180 83.6</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   ..$ comment: chr "TRUE"</span></span></code></pre></div>
</div>
<p>The output from <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> shows that <code>coast_sp</code> and <code>countries_sp</code> are mainly distinguished by the presence of a <code>lines</code> or a <code>polygons</code> slot. Both of the objects contain data frames, but they are very different. The data frame in <code>coast_sp</code> only contains two columns, but <code>countries_sp</code> has 63 columns. This is because the countries map from <code>rnaturalearth</code> contains a variety of population, economic, and labeling data. We do not need to deal with the <code>data</code> slots from either of these objects, but they do provide a good example of what these kind of <code>Spatial</code> objects look like.</p>
<p>The last thing that we should do before plotting the points on our background maps is to make sure that our objects all have the same CRS. If <code>points_spdf</code> and <code>coast_sp</code> have different CRSs, the points will not be correctly plotted. We can check this with either the <code>proj4string()</code> function or printing out the <code>proj4string</code> slot. Checking this shows that all of the <code>Spatial</code> objects are using geographic coordinates on the WSG84 ellipsoid, enabling us to move forward with plotting.</p>
<div class="cell">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check CRS of Spatial objects</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">coast_sp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">proj4string</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Coordinate Reference System:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Deprecated Proj.4 representation:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">proj4string</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">proj4string</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "+proj=longlat +datum=WGS84 +no_defs"</span></span></code></pre></div>
</div>
</section><section id="mapping-sp" class="level2"><h2 class="anchored" data-anchor-id="mapping-sp">Mapping with <code>sp</code>
</h2>
<p>Just as <code>Spatial</code> objects cannot be manipulated with <code>dplyr</code> commands, they cannot be plotted using <code>ggplot2</code>. <code>Spatial</code> objects can be plotted using the base R plot system or with its own plotting method that uses the Trellis plotting system with the <code>spplot()</code> command. Here, I will stick to the base plotting methods, but if you want to look at <code>spplot()</code> methods, Edzer Pebesma has created a good <a href="https://edzer.github.io/sp/">gallery of sp plots</a>. For a more in depth discussion on both plotting methods see Chapter 3 of Bivand, Pebesma, and Gómez-Rubio, <em>Applied Spatial Data Analysis with R</em>. I will discuss creating a map with the base R plotting system in some detail, because the commands are not particularly intuitive, and I have found it more difficult to find good information about making base plots compared to the use of <code>ggplot2</code>.</p>
<p>The plotting method for base R uses incremental commands to add different layers, allowing you to plot multiple types of data and add annotations such as legends and titles. The process can be somewhat tedious, and if you decide to change an aspect of the plot you need to rerun the entire string of commands. The necessity of building up every level of the plot with explicit commands has advantages and disadvantages when compared to <code>ggplot2</code>, which automates certain aspects of plot creation. For instance, base plots do not automate the creation of legends in the same way that <code>ggplot2</code> does. This makes the creation of legends more difficult, but because you have to construct each piece of the legend, its production can be more transparent than with <code>ggplot2</code>.</p>
<p>Base plotting methods enable you to manipulate a <a href="http://colinfay.me/intro-to-r/graphical-procedures.html">wide variety of parameters</a> about your plots. You can see the whole list with <code><a href="https://rdrr.io/r/graphics/par.html">?par</a></code>. For this post, I will concentrate on some of the more widely used parameters to plot the points data we have created above on two different background maps. With these maps I want to visualize three different types of data: the location of the points represented in <code>points_spdf@coords</code>, whether the point represents a source or destination of the letters from the “type” column, and a representation of the amount of letters sent or received in the location from the “n” column. The latter two types of data can be represented through color and the size of the points respectively. Let’s see how this works in practice.</p>
<p>Even before beginning to plot our <code>Spatial</code> objects, I want to set up the plotting environment by modifying the default margins to a smaller size that will work for all of these plots. The margins of a plot are identified by the <code>mar</code> or <code>mai</code> arguments within <code><a href="https://rdrr.io/r/graphics/par.html">par()</a></code>. Here, I will use <code>mar</code>, which provides the margins in units of lines. To change the margins we need to pass a vector of values for the bottom, left, top, and right margins. In this case, I will use <code>par(mar = c(1, 1, 3, 1))&nbsp;</code> to give some minimal margins and some room for a title at the top of the plot.</p>
<p>The location of the points of a <code>SpatialPoints</code> object are plotted automatically with <code>plot(points_spdf)</code>. However, the default for plotting <code>SpatialPoints</code> is to represent the points by an addition sign. We can change the symbol to represent the points with <code>pch</code> or the plotting character parameter. There are 25 available characters, and here I will use <code>pch = 20</code>, which is a solid circle.</p>
<p>Modifying the color and size of these circles is a bit trickier. The color of the circles can be adjusted with the <code>col</code> parameter according to the information in <code>points_spdf$type</code>. We are able to map the colors of the points to the “type” variable, because we earlier changed the column to be factors instead of characters. If this had not been done, the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> command would fail. The default colors for the first two levels of factors are black and red, which <a href="https://bookdown.org/rdpeng/exdata/plotting-and-color-in-r.html">are not particularly pleasant to look at</a>. However, we can create a new color palette with the <code><a href="https://rdrr.io/r/grDevices/palette.html">palette()</a></code> function. Here, I am using the named colors “darkorchid” and “darkorange”, while also adding some transparency to the points with the <code><a href="https://scales.r-lib.org/reference/alpha.html">alpha()</a></code> function from <code>ggplot2</code> since some of the points overlap.<sup>13</sup> You can get a list of all of the named colors in R with <code><a href="https://rdrr.io/r/grDevices/colors.html">colors()</a></code>. The palette has to be created before beginning to make the plot, and this will change the color palette for all further base plots. You can return to the default palette with <code>palette("default")</code>.</p>
<p>The <code>cex</code> parameter is used to modify the size of the points that will be plotted. We can set the size of the points to <code>points_spdf$n</code>, but first we need to make some modifications. We do not want the point sizes to be the actual value in the “n” column. A point with <code>cex = 95</code> — the maximum number of letters in the data — would create a point larger then the plot. Therefore, we need to adjust the minimum and maximum size of the points according to some formula. This could be done in a variety of ways, but here I choose the formula <code>sqrt(points_spdf$n)/2 + 0.25</code>, which reduces the minimum <code>cex</code> to 0.75 and the maximum to a bit over 5. The other additions that I make are to add a box around the plot with <code><a href="https://rdrr.io/r/graphics/box.html">box()</a></code> and a title with <code><a href="https://rdrr.io/r/graphics/title.html">title()</a></code> in separate commands. These two commands decorate the plot and provides and example of the way that layers can be added to a base plot. Let’s see how this looks.</p>
<div class="cell">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a new color palette to distinguish source and destination</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/palette.html">palette</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkorchid"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkorange"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set margins for bottom, left, top, and right of plot</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>mar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot points</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span>,</span>
<span>     pch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,</span>
<span>     col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span>,</span>
<span>     cex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add a box around the plot</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add a title</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>main <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correspondence of Daniel van der Meulen, 1585"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/gis-with-r-intro/index_files/figure-html/points-spdf-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Ok, we have points, but we do not have a map. We can add a background map with a separate call to the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function that contains <code>add = TRUE</code>. One nice aspect of using the base plotting methods with <code>Spatial</code> objects is that even though the coastline map we are using is a world map, adding it to our previous plot properly scales the map to the geographical extent of the data from the first plotting function. The only other change is to make the color of the coastlines black with the <code>col</code> parameter. This needs to be done, because we changed the color palette above. If we did not make this change, the coastlines would be drawn in dark orchid.</p>
<p>The final step in making this map is to create legends to show the meaning of the colors and size of the points. This will require making two legends, which can be done with two calls to the <code><a href="https://rdrr.io/r/graphics/legend.html">legend()</a></code> function. It is a bit fiddly to make these legends and build up every aspect, but the basis for what needs to be done is already present in the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> functions. The <code><a href="https://rdrr.io/r/graphics/legend.html">legend()</a></code> function takes a position for where to place the legend and the data to use for it. It is then a matter of using parameters to create informative legends.</p>
<p>Creating a legend for the distinction between sources and destinations uses data from the levels of the factors in the type column, which can be represented by <code>levels(points_spdf$type)</code>. We can map the colors to the levels with a vector containing the two levels, and here I use the shortcut of <code>1:2</code> to represent the two colors in the palette we created above. The <code>pch</code> parameter provides a symbol to represent the colors. In this case, I decided to use a filled square. The <code>pt.cex</code> parameter is used to increase the size of the colored squares, which we need to use because the <code>cex</code> parameter within <code><a href="https://rdrr.io/r/graphics/legend.html">legend()</a></code> determines the size of the entire legend.</p>
<p>The legend to relate the size of the points to the number of letters sent from or received in each location is a bit more difficult to create, as we do not yet have all the necessary components for the legend. A legend for the size of the points will possess three or four points of different sizes and the number of letters they represent. <code>ggplot2</code> does this creation automatically, but with base plots you have to choose the number and size of the points yourself. This means we need to make our own data for the legend, which I do here by creating a <code>pointsize</code> vector that will be used to show the size of points representing 1, 50, and 100 letters.<sup>14</sup> Once this is done, the creation of the legend is fairly straightforward. The key is to remember to make the point sizes for our vector of numbers equal to the points on the map by applying the same formula and using the same <code>pch</code>. A title for the legend makes it clearer that the map represents letters.<sup>15</sup></p>
<div class="cell">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pointsize vector for legend</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pointsize</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>mar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot points</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span>,</span>
<span>     pch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,</span>
<span>     col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span>,</span>
<span>     cex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot coastlines background map</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">coast_sp</span>,</span>
<span>     col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span>     add <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add a box around the plot</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Legend for colors</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, legend <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>       pt.cex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span>       col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span>       pch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># legend for size of points</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>, legend <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pointsize</span>,</span>
<span>       pt.cex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pointsize</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>       col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span>       pch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,</span>
<span>       title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Title for the map</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>main <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correspondence of Daniel van der Meulen, 1585"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/gis-with-r-intro/index_files/figure-html/coast-sp-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The resulting map is maybe a bit sparse, but it provides all the necessary information on the locations and magnitude of Daniel’s correspondence in 1585. One change that we might want to make is to color in the land to distinguish more clearly between land and water and to add some color to the plot. This cannot be done with our <code>SpatialLines</code> of the coastlines, which does not have a geometric interior that could be filled. Instead we need to use a <code>SpatialPolygons</code> object such as <code>countries_sp</code>. To make this second map we can reuse many of the parameters from our first map, but we do need to make one significant change to the plotting workflow. Because we want to fill in the land area of the map, we need to plot the background map before plotting the points. Otherwise the background map will cover the points. However, this disturbs the automatic subsetting of the world map that occurred in the first plot. We can get around this by changing the bounding box of <code>countries_sp</code> (<code>countries_sp@bbox</code>) to match that of <code>points_spdf</code> with the <code>bbox()</code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make bounding box for countries_sp match</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounding box of points_spdf</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">bbox</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bbox</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Once the countries map is properly limited to the extent of the points, we can reuse most of the parameters from the first map. The only difference from the previous plot other than placing the background map first in the plotting order is the choice of colors for <code>countries_sp</code>. For a <code>SpatialPolygons</code> object the <code>col</code> parameter adjusts the fill color for the polygons, and the <code>border</code> parameter modifies the color of the lines of the polygons. Using a map with modern country boundaries is clearly anachronistic for plotting letters from 1585, but the boundaries do help to contextualize the locations. If you want to obscure the country borders completely, you can make the <code>col</code> and <code>border</code> parameters the same color. In this case, I will use the <code><a href="https://rdrr.io/r/grDevices/gray.html">gray()</a></code> function, which enables you to choose a gray level from 0 to 1 with 0 representing black and 1 for white.</p>
<div class="cell">
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>mar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot countries map and color with grays</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sp</span>,</span>
<span>     col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>     border <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot points</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span>,</span>
<span>     pch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,</span>
<span>     col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span>, </span>
<span>     cex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,</span>
<span>     add <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add a box around the plot</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Legend for colors</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>,</span>
<span>       legend <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_spdf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>       pt.cex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span>       col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span>       pch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># legend for size of points</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>,</span>
<span>       legend <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pointsize</span>,</span>
<span>       pt.cex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pointsize</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>       col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span>       pch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,</span>
<span>       title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Title for the map</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>main <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correspondence of Daniel van der Meulen, 1585"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/gis-with-r-intro/index_files/figure-html/countries-sp-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The above maps along with the creation of <code>Spatial</code> objects and the use of maps from outside sources demonstrates the value of the <code>sp</code> package. The above examples only show the basics of working with different kinds of <code>Spatial</code> objects and does not take advantage of any of the spatial transformations or calculations that using <code>sp</code> enables. However, the R GIS community is increasingly moving towards the <code>sf</code> package. The <code>sf</code> package provides almost all of the <a href="https://github.com/r-spatial/sf/wiki/migrating">capabilities of <code>sp</code></a>, but it uses objects that are easier to work with than the S4-style classes of <code>sp</code>. The next section will replicate the workflow of creating and mapping spatial points data using <code>sf</code> methods, which will serve to illuminate the differences between the two packages.</p>
</section><section id="sf" class="level2"><h2 class="anchored" data-anchor-id="sf">Spatial data with <code>sf</code>
</h2>
<p>As I noted above, an <code>sf</code> object is a data-frame-like object that contains a special geometry column that is of class <code>sfc</code>. The geometry column stores the spatial forms of data such as the CRS, coordinates, and type of geometric object. The creation of an <code>sf</code> object with a geometry column of class <code>sfc_POINT</code> is similar to creating a <code>SpatialPointsDataFrame</code>, but it can be done in a single step with a data frame that contains longitude and latitude columns. The <code>st_as_sf()</code> function uses a vector of the coordinate columns for the <code>coords</code> argument and either a EPSG code or a Proj.4 definition for the <code>crs</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create sf object with geo_data data frame and CRS</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">geo_data</span>, coords <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lon"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, crs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>The <code><a href="https://rdrr.io/r/base/class.html">class()</a></code> function shows that <code>points_sf</code> is an <code>sf</code> object that is an extension of a <code>data.frame</code>, and in this case is an extension of <code>tbl_df</code>, because <code>geo_data</code> is a <a href="http://r4ds.had.co.nz/tibbles.html">tibble</a>. Printing <code>points_sf</code> results in an output similar to that of a tibble or data frame with additional information about the spatial aspects of the data provided by the “geometry” column. The information about the geometry shows the type of geometrical object, dimension, bounding box, and the CRS in both EPSG and proj.4 format when possible.</p>
<div class="cell">
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Getting the class of an sf object shows that it is based on tibble and data frame.</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "sf"         "tbl_df"     "tbl"        "data.frame"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Printing out an sf object is similar to tibble or data frame</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Simple feature collection with 14 features and 3 fields</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: POINT</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: 3.610998 ymin: 45.44085 xmax: 12.31552 ymax: 53.55108</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 14 × 4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    place          n type                   geometry</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  * &lt;chr&gt;      &lt;int&gt; &lt;fct&gt;               &lt;POINT [°]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Amsterdam      1 Source      (4.895168 52.37022)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Antwerp       76 Source      (4.402464 51.21945)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Dordrecht      1 Source       (4.690093 51.8133)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Emden          1 Source        (7.20601 53.3594)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Haarlem       30 Source      (4.646219 52.38739)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Hamburg        1 Source      (9.993682 53.55108)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Het Vlie       1 Source          (5.183333 53.3)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Lisse          1 Source      (4.557483 52.25793)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Venice         2 Source      (12.31552 45.44085)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Bremen         6 Destination  (8.801694 53.0793)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11 Delft         95 Destination (4.357068 52.01158)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 Haarlem        8 Destination (4.646219 52.38739)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13 Middelburg     2 Destination  (3.610998 51.4988)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 14 The Hague      3 Destination    (4.3007 52.0705)</span></span></code></pre></div>
</div>
<p>You can inspect the class of the geometry column itself by using <code>$</code> to subset the geometry column. Or you can directly access information about the spatial data in the “geometry” column with the <code>st_geometry()</code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Class of the geometry or sfc column</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">geometry</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "sfc_POINT" "sfc"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retrieve the geometry of an sf object</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to see coordinates, type of feature, and CRS</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_geometry</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry set for 14 features </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: POINT</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: 3.610998 ymin: 45.44085 xmax: 12.31552 ymax: 53.55108</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; First 5 geometries:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; POINT (4.895168 52.37022)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; POINT (4.402464 51.21945)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; POINT (4.690093 51.8133)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; POINT (7.20601 53.3594)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; POINT (4.646219 52.38739)</span></span></code></pre></div>
</div>
<p>Having already loaded the Natural Earth coastline and countries maps as <code>Spatial</code> objects, there are two possibilities for getting the same data as <code>sf</code> objects. The <code>sf</code> package provides a method for converting from <code>Spatial</code> classes to <code>sf</code> with the <code>st_as_sf()</code> function that was used above to create an <code>sf</code> object from a data frame. It is useful to know that you can easily convert an object from <code>Spatial</code> to <code>sf</code> and back, but you will obviously not always have <code>Spatial</code> objects already created. The <code>rnaturalearth</code> package enables you to create <code>sf</code> objects with the <code>returnclass = "sf"</code> argument. Here, I will use the latter method.<sup>16</sup></p>
<div class="cell">
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get coastal and country world maps as sf objects</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">coast_sf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ne_coastline</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medium"</span>, returnclass <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ne_countries</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medium"</span>, returnclass <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>The data-frame-like nature of <code>sf</code> objects makes working with spatial data more transparent and in-line with other data workflows compared to the <code>sp</code> package. For starters, it is more reasonable to print out <code>sf</code> objects to the console, though the size of <code>coast_sf</code> and <code>countries_sf</code> makes this less than ideal. However, a big advantage of <code>sf</code> over <code>sp</code> is that you can easily peruse the contents of an object with the <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> command or clicking on the object in the Environment pane in RStudio. With the <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> command an <code>sf</code> object looks like any other data frame instead of a list of lists like a <code>Spatial</code> object. This makes it much easier to get an overview of the data that you are working with. Let’s print out the first six rows, or features in the <code>sf</code> vocabulary, of <code>coast_sf</code> with the <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> function to give an idea of what the object looks like. The structure of the output is similar to that of <code>points_sf</code> with a data frame containing a geometry column and information about the geometry of the object. In this case, we can see that <code>coast_sf</code> is of class <code>MULTILINESTRING</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print first six rows of coast_sf</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">coast_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Simple feature collection with 6 features and 2 fields</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: MULTILINESTRING</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: -81.42168 ymin: -17.16387 xmax: 180 ymax: 24.94111</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; CRS:           +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   scalerank featurecla                       geometry</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 0         0  Coastline MULTILINESTRING ((180 -16.1...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1         0  Coastline MULTILINESTRING ((177.2575 ...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2         0  Coastline MULTILINESTRING ((127.3727 ...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3         0  Coastline MULTILINESTRING ((-81.32231...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4         0  Coastline MULTILINESTRING ((-80.79941...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5         0  Coastline MULTILINESTRING ((-80.62568...</span></span></code></pre></div>
</div>
<p>Unlike <code>Spatial</code> objects that use slots to distinguish the classes, all <code>sf</code> objects can generally be treated as data frames when wrangling the data. The only difference in the structure of <code>points_sf</code> compared to <code>coast_sf</code> or <code>countries_sf</code> is the class of the geometry column. This makes it possible to use workflows from the tidyverse. For instance, returning the subset of locations from <code>points_sf</code> that have a “n” greater than 10, as I showed above with <code>points_spdf</code>, can be done with <code>dplyr</code>’s <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Subset of locations with "n" greater than 10</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Simple feature collection with 3 features and 3 fields</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: POINT</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: 4.357068 ymin: 51.21945 xmax: 4.646219 ymax: 52.38739</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 3 × 4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   place       n type                   geometry</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; * &lt;chr&gt;   &lt;int&gt; &lt;fct&gt;               &lt;POINT [°]&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 Antwerp    76 Source      (4.402464 51.21945)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2 Haarlem    30 Source      (4.646219 52.38739)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3 Delft      95 Destination (4.357068 52.01158)</span></span></code></pre></div>
</div>
<p>The advantages of using <code>dplyr</code> to manipulate spatial objects is more apparent when working with complex objects such as <code>countries_sf</code> and using the pipe (<code>%&gt;%</code>) to link commands. For example, if you want to look at the countries in South America, you can much more easily navigate the 241 rows and 63 columns of non-spatial data in the <code>sf</code> version of the countries world map than the <code>sp</code> version. Printing out the names of the columns with <code><a href="https://rdrr.io/r/base/colnames.html">colnames()</a></code> shows that we can filter countries in South America through the “continent” column. We can simplify the non-spatial data by selecting only the “name” column to identify the countries. Even more impressively, it is possible to combine data wrangling commands with spatial transformations such as changing the CRS of the object with <code>st_transform()</code>. As a demonstration, I can change the CRS of the subset of <code>countries_sf</code> to use the <a href="https://en.wikipedia.org/wiki/Mollweide_projection">Mollweide projection</a>, which prioritizes accuracy of area over shape and angle. The result of the pipeline of commands is a legible <code>sf</code> object with 13 rows for the countries in South America with a new CRS. Note that because there is no EPSG code for the Mollweide projection the <code>epsg</code> of the new object is <code>NA</code>, but the <code>proj4string</code> is changed to <code>+proj=moll</code>. Notice too that the coordinates have been changed from degrees to meters.</p>
<div class="cell">
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># South American countries with new CRS</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">continent</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"South America"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>crs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+proj=moll +datum=WGS84"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Simple feature collection with 13 features and 1 field</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Dimension:     XY</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Bounding box:  xmin: -10204810 ymin: -6475765 xmax: -3470373 ymax: 1532816</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; CRS:           +proj=moll +datum=WGS84</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; First 10 features:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;            name                       geometry</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1     Argentina MULTIPOLYGON (((-4588849 -6...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2       Bolivia MULTIPOLYGON (((-5605494 -2...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3        Brazil MULTIPOLYGON (((-4505022 -3...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4         Chile MULTIPOLYGON (((-4714647 -6...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5      Colombia MULTIPOLYGON (((-7824020 31...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 6       Ecuador MULTIPOLYGON (((-8024339 -3...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 7  Falkland Is. MULTIPOLYGON (((-4403206 -6...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 8        Guyana MULTIPOLYGON (((-5715634 68...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 9          Peru MULTIPOLYGON (((-7000354 -5...</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10     Paraguay MULTIPOLYGON (((-5605494 -2...</span></span></code></pre></div>
</div>
<p>We can even visualize this transformation of <code>countries_sf</code> by piping directly to a base <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> command. Like <code>sp</code>, <code>sf</code> has its own plotting methods, which differ slightly from the base plotting system.<sup>17</sup> The changes to the defaults that I make here are to remove the automatically created legend of country names with <code>key.pos = NULL</code> and provide a title for the plot. I also add graticules, or grid lines along longitude and latitude, to more clearly show the effects of the change in projection. Before making the map, we need to return the color palette to its default settings to prevent the borders of the countries from being drawn in dark orchid.</p>
<div class="cell">
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Return to default palette</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/palette.html">palette</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Map of South American countries</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sf</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">continent</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"South America"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>crs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+proj=moll +datum=WGS84"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>key.pos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, graticule <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, main <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"South America"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/gis-with-r-intro/index_files/figure-html/sa-countries-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="mapping-sf" class="level2"><h2 class="anchored" data-anchor-id="mapping-sf">Mapping with <code>sf</code> and <code>ggplot2</code>
</h2>
<p>Returning to the example of the correspondence of Daniel van der Meulen, it would be possible to use <code>sf</code> to recreate the base R plots made with the <code>sp</code> package. However, another advantage of <code>sf</code> is that it works with <code>ggplot2</code>, and so I will concentrate on making maps using the <code>ggplot2</code> system similar to those I made with <code>ggmap</code> in <a href="https://www.jessesadler.com/post/geocoding-with-r/#mapping-data">a previous post</a>. <code>ggplot2</code> implements the plotting of <code>sf</code> objects through the creation of a specific geom, <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code>. <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> is only available in versions of <code>ggplot2</code> that are greater than 2.2.1, which is the current CRAN version. Therefore, you need to download the development version of <code>ggplot2</code> with <code>devtools::install_github("tidyverse/ggplot2")</code> to plot <code>sf</code> objects.</p>
<p>The manner in which <code>ggplot2</code> creates a plot through a single command rather than a series of separate commands as in base plots means that we need to explicitly deal with the incongruence in the geographic extent of <code>points_sf</code> and the background maps. If you make a <code>ggplot2</code> plot with <code>points_sf</code> and <code>coast_sf</code> without modifications, you will get a wold map with some small points in western Europe. There are two ways to deal with this incongruence by either changing the bounding box of the background map before making the plot or within the plot itself. As far as I know, there is no equivalent method in the <code>sf</code> package to the command we used above to modify the <code>bbox</code> slot of the <code>countries_sp</code> object. However, it is possible to geographically subset an <code>sf</code> object by a bounding box of coordinates using the <code>ms_clip()</code> function from the <a href="https://cran.r-project.org/web/packages/rmapshaper/"><code>rmapshaper</code></a> package. The other option is to leave <code>coast_sf</code> and <code>countries_sf</code> as they are and adjust the geographic extent of the objects in the plot command itself with the <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf()</a></code> function and the <code>xlim</code> and <code>ylim</code> arguments. Here, I will use the latter method.</p>
<p>There are some oddities in using <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> compared to other geoms due to the character of <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code>. By its nature, <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> is unlike other geoms in that it can be used to create points, lines, or polygons depending on the contents of the <code>sf</code> object. This variability results in the need to declare the geometrical object used in a <code>show.legend</code> argument for the legend to be properly formatted. Another difference that I have found from other geoms is that <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> does not properly identify <code>sf</code> objects unless you explicitly identify them with <code>data = sf_object</code>. While these issues are something to be aware of, they do not substantively affect the the plots that we can create.</p>
<p>Let’s start by creating a simple plot using <code>ggplot2</code> with <code>points_sf</code> and <code>coast_sf</code>. Note the explicit vocabulary to identify the <code>sf</code> objects as the data and the use of <code>show.legend = "point"</code> for the legend. Otherwise the plot recreates the basic structure of the above base R plots by mapping the aesthetics of <code>color</code> to the “type” variable and <code>size</code> to “n”. Some transparency is added to all of the points with the <code>alpha</code> argument. The last change is to subset the geographic region of the plot, and thus of <code>coast_sf</code> to a chosen bounding box with <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf()</a></code>. You can experiment with different values for <code>xlim</code> and <code>ylim</code> to see what works best.</p>
<div class="cell">
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">coast_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span>,</span>
<span>          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span>, size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>          alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>,</span>
<span>          show.legend <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"point"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>xlim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, ylim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/gis-with-r-intro/index_files/figure-html/ggplot-demo-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The map created by <code>ggplot2</code> shows the same information as the base plots. It includes legends by default so that we do not need to build them up from scratch, though with <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> we do need to use <code>show.legend = "point"</code> to format the legends properly. The aesthetics of this map are quite different from the base plots and serves to show the defaults that come with the use of <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> in <code>ggplot2</code>. The defaults for <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> use the iconic <code>ggplot</code> gray background, but instead of the usual white grid lines, graticules for the longitude and latitude are shown. Notice that the tick marks for the plot are correctly labeled in units of degrees longitude and latitude and that the axes are not labeled, as the context makes clear that the x-axis is latitude and the y-axis is longitude — at least if you remember which one is which.</p>
<p>The basic structure of what we want is present in the above map, but we can improve upon it by adding some information and making aesthetic changes to the map. We can simplify the map and make it more similar to the above base R plots by removing the graticules, which can be done by passing <code>NA</code> to the datum argument within the <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf()</a></code> function. On the other hand, it is possible to add information to the plot by labeling the points with <code>geom_text_repel()</code> from the <a href="https://cran.r-project.org/web/packages/ggrepel/index.html"><code>ggrepel</code></a> package, which will ensure that the labels for the points do not overlap. <code>geom_text_repel()</code> does not work with <code>sf</code> objects, but because we have made no geographic transformations to the data, we can use the data from the <code>locations</code> data frame to map the names of the locations to the longitude and latitude values.</p>
<p>Further changes to the non-data aspects of the map can be made through the <a href="http://r4ds.had.co.nz/graphics-for-communication.html">theme system used by <code>ggplot2</code></a>. We can alter the look of the map by choosing a different built in theme, changing individual elements of the aesthetics, or a combination of the two. You can play around with the theming system to create the look you want. In this case, I will make changes to the theme and to individual aspects of the plot. Changing the theme to <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light()</a></code> changes the background to white, but it also adds axes labels, which we will want to remove. The labels for the axes, legends, and plot as a whole can be modified within the <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> function. To remove the labeling of the axes for the plot I set the <code>x</code> and <code>y</code> labels to <code>NULL</code>. I also change the labels for the legends to give a more descriptive name to the size legend and use title case for the color legend. The last change I make is to increase the size of the points within the color legend with the <code><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides()</a></code> function, increasing the size of the points to 6.</p>
<div class="cell">
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load ggrepel package</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://ggrepel.slowkow.com/">ggrepel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">coast_sf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span>, </span>
<span>          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span>, size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>          alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>, </span>
<span>          show.legend <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"point"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>xlim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, ylim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>           datum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># removes graticules</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text_repel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">locations</span>, </span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lon</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lat</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">place</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correspondence of Daniel van der Meulen, 1585"</span>,</span>
<span>       size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters"</span>,</span>
<span>       color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span>       x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span>       y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>override.aes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/gis-with-r-intro/index_files/figure-html/ggplot-coastline-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The result is a map that is much cleaner, and because of the points are labeled, more informative. We can reuse the thematic tweaks to create a plot with the countries background map to make it possible to fill in the land area as we did above. I will use the same gray scale for the colors to fill the polygons and for the lines of the polygons. The other change that I make in this plot is to use the <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw()</a></code>, which adds a border around the plot.</p>
<div class="cell">
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">countries_sf</span>,</span>
<span>          fill <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">points_sf</span>, </span>
<span>          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span>, size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>          alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>, </span>
<span>          show.legend <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"point"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>xlim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, ylim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>           datum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># removes graticules</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text_repel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">locations</span>, </span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lon</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lat</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">place</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correspondence of Daniel van der Meulen, 1585"</span>,</span>
<span>       size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters"</span>,</span>
<span>       color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span>       x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span>       y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>override.aes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/gis-with-r-intro/index_files/figure-html/ggplot-countries-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="conclusion" class="level2"><h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This post has only scraped the surface of the power of the <code>sp</code> and <code>sf</code> packages and the more general GIS capabilities of R. My goal with this post has been to provide an understanding of the nature of spatial data, how <code>sp</code> and <code>sf</code> implement the creation of spatial objects in R, and some of the consequences of the implementation details for modifying and plotting <code>Spatial</code> and <code>sf</code> objects. <code>sp</code> and its complimentary packages have long provided a foundation to make R a viable GIS platform. The recent development of the <code>sf</code> package has modernized the implementation of spatial data in R and made it possible to integrate spatial data into the tidyverse and <code>ggplot2</code> plotting system. <code>sf</code> has made it easier to work with spatial data in R by minimizing the distinction between spatial data and other forms of data you might deal with in R. There still remain uses for the <code>sp</code> package, and I think it is helpful to see the distinction between the two packages to better understand both, but <code>sf</code> is clearly the future for the representation of geographic vector data in R.</p>
</section><section id="gis-resources" class="level2"><h2 class="anchored" data-anchor-id="gis-resources">Additional resources for GIS with R</h2>
<ul>
<li>The CRAN task view for <a href="https://cran.r-project.org/web/views/Spatial.html">Analysis of Spatial Data</a> provides a good overview of the variety of packages that deal with GIS.</li>
<li>
<code>sp</code> - The best resource for learning more about the <code>sp</code> package is Roger Bivand, Edzer Pebesma, and Virgilio Gómez-Rubio, <em>Applied Spatial Data Analysis with R</em> (2013). - There are a number of good tutorials on working with <code>Spatial</code> objects and a particularly useful resource is <a href="http://www.nickeubank.com/gis-in-r/">Nick Eubank’s, GIS in R</a>.</li>
<li>
<code>sf</code> - The <a href="https://cran.r-project.org/web/packages/sf/">package vignettes for <code>sf</code></a> are very helpful for providing an introduction to the package. - The currently in development book <a href="https://bookdown.org/robinlovelace/geocompr/">Geocomputation with R by Robin Lovelace, Jakub Nowosad, Jannes Muenchow</a> is already an invaluable resource and was of great use for writing this post. - The <a href="http://r-spatial.org">R Spatial blog</a> is a good place to keep up on developments of <code>sf</code> and complimentary packages that have adopted the use of <code>sf</code> objects.</li>
</ul>


</section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p><a href="http://onlinelibrary.wiley.com/doi/10.1029/2012EO160003/abstract">Edzer Pebesma, Daniel Nüst, and Roger Bivand, “The R Software Environment in Reproducible Geoscientific Research,” <em>Eos</em> 93 (2012): 163–164.</a>↩︎</p></li>
<li id="fn2"><p>For a good general introduction to the use and history of GIS with R, see the working book <a href="https://bookdown.org/robinlovelace/geocompr/">Robin Lovelace, Jakub Nowosad, Jannes Muenchow, <em>Geocomputation with R</em></a>.↩︎</p></li>
<li id="fn3"><p><a href="https://cran.r-project.org/doc/Rnews/Rnews_2005-2.pdf">E. J. Pebesma and R. S. Bivand, “Classes and methods for spatial data in R,” <em>R News</em> 5, no. 2 (2005): 9–13.</a>↩︎</p></li>
<li id="fn4"><p>For more information on CRSs see <a href="https://geocompr.robinlovelace.net/spatial-class.html#crs-intro">Lovelace, Nowosad, and Muenchow, Geocomputation with R</a> and Bivand, Pebesma, and Gómez-Rubio, 84–91.↩︎</p></li>
<li id="fn5"><p>The distance between degrees of longitude and latitude are only equal at the equator. Lines of longitude get progressively closer together as they approach the poles where they all meet. This variance means you cannot calculate distance between points with longitude and latitude values without the use of complex geometric models.↩︎</p></li>
<li id="fn6"><p>The details of how <code>sp</code> and <code>sf</code> interface with the Proj.4 library are different, but this should not be something that most users will have to worry about. <a href="https://github.com/r-spatial/sf/issues/280">&nbsp;See the discussion in <code>sf</code> issue 280</a>.↩︎</p></li>
<li id="fn7"><p>See chapter 2 of Bivand, Edzer Pebesma, and Virgilio Gómez-Rubio for a more in depth discussion of <code>Spatial</code> objects.↩︎</p></li>
<li id="fn8"><p>See the vignette <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html">1. Simple Features for R</a> and the very good discussion of <code>sf</code> objects in chapter 2 of <a href="https://geocompr.robinlovelace.net/spatial-class.html#sf-classes">Lovelace, Nowosad, and Muenchow, <em>Geocomputation with R</em></a>.↩︎</p></li>
<li id="fn9"><p>On factors see <a href="http://r4ds.had.co.nz/factors.html">chapter 15 of Garrett Grolemund and Hadley Wickham, <em>R for Data Science</em></a> and <a href="https://dx.doi.org/10.7287/peerj.preprints.3163v2">Amelia McNamara and Nicholas J Horton, “Wrangling Categorical Data in R”</a>.↩︎</p></li>
<li id="fn10"><p>The <code>bbox</code> slot will be created from the information provided by the other two slots.↩︎</p></li>
<li id="fn11"><p>I could use the <code>geo_data</code> data frame, but this would unnecessarily result in having the coordinates in both the <code>data</code> and <code>coords</code> slots.↩︎</p></li>
<li id="fn12"><p>You may need to download these maps the first time that you use them.↩︎</p></li>
<li id="fn13"><p>Instead of choosing your own colors, you could use any of the number of R packages that provide color palettes such as <a href="https://cran.r-project.org/web/packages/RColorBrewer/index.html"><code>RColorBrewer</code></a>, but for this example I will keep it simple and make my own palette.↩︎</p></li>
<li id="fn14"><p>Make sure to create the <code>pointsize</code> vector before beginning the chain of <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> functions.↩︎</p></li>
<li id="fn15"><p>I rerun the <code><a href="https://rdrr.io/r/graphics/par.html">par()</a></code> command for the margins to ensure that the margins stay consistent across these plots.↩︎</p></li>
<li id="fn16"><p>The <code>sf</code> package has the ability to read in and convert a number of spatial data types used in GIS with <code>st_read()</code>. <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf2.html">See the vignette on reading and writing simple features</a>.↩︎</p></li>
<li id="fn17"><p>The details of plotting <code>sf</code> objects are covered in a <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf5.html">package vignette</a>.↩︎</p></li>
</ol></section></div> ]]></description>
  <category>rstats</category>
  <category>rspatial</category>
  <guid>https://www.jessesadler.com/post/gis-with-r-intro/</guid>
  <pubDate>Wed, 07 Feb 2018 05:00:00 GMT</pubDate>
  <media:content url="https://www.jessesadler.com/post/gis-with-r-intro/sa-countries.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Introduction to Network Analysis with R</title>
  <link>https://www.jessesadler.com/post/network-analysis-with-r/</link>
  <description><![CDATA[ <p>Over a wide range of fields network analysis has become an increasingly popular tool for scholars to deal with the complexity of the interrelationships between actors of all sorts. The promise of network analysis is the placement of significance on the relationships between actors, rather than seeing actors as isolated entities. The emphasis on complexity, along with the creation of a variety of algorithms to measure various aspects of networks, makes network analysis a central tool for digital humanities.<sup>1</sup> This post will provide an introduction to working with networks in <a href="https://www.r-project.org">R</a>, using the example of the network of cities in the correspondence of <a href="https://jessesadler.com/project/dvdm-correspondence/">Daniel van der Meulen</a> in 1585.</p>
<p>There are a number of applications designed for network analysis and the creation of network graphs such as <a href="https://gephi.org">gephi</a> and <a href="http://cytoscape.org">cytoscape</a>. Though not specifically designed for it, R has developed into a powerful tool for network analysis. The strength of R in comparison to stand-alone network analysis software is three fold. In the first place, <a href="https://jessesadler.com/post/excel-vs-r/">R enables reproducible research</a> that is not possible with GUI applications. Secondly, the data analysis power of R provides robust tools for manipulating data to prepare it for network analysis. Finally, there is an ever growing range of packages designed to make R a complete network analysis tool. Significant network analysis packages for R include the <a href="http://www.statnet.org">statnet suite</a> of packages and <a href="http://igraph.org"><code>igraph</code></a>. In addition, <a href="http://www.data-imaginist.com">Thomas Lin Pedersen</a> has recently released the <a href="https://cran.r-project.org/web/packages/tidygraph/index.html"><code>tidygraph</code></a> and <a href="https://cran.r-project.org/web/packages/ggraph/index.html"><code>ggraph</code></a> packages that leverage the power of <code>igraph</code> in a manner consistent with the <a href="http://www.tidyverse.org">tidyverse</a> workflow. R can also be used to make interactive network graphs with the <a href="http://www.htmlwidgets.org">htmlwidgets framework</a> that translates R code to JavaScript.</p>
<p>This post begins with a short introduction to the basic vocabulary of network analysis, followed by a discussion of the process for getting data into the proper structure for network analysis. The network analysis packages have all implemented their own object classes. In this post, I will show how to create the specific object classes for the statnet suite of packages with the <a href="https://cran.r-project.org/web/packages/network/index.html"><code>network</code></a> package, as well as for <code>igraph</code> and <code>tidygraph</code>, which is based on the <code>igraph</code> implementation. Finally, I will turn to the creation of interactive graphs with the <a href="http://datastorm-open.github.io/visNetwork/"><code>vizNetwork</code></a> and <a href="http://christophergandrud.github.io/networkD3/"><code>networkD3</code></a> packages.</p>
<section id="network-analysis-nodes-and-edges" class="level2"><h2 class="anchored" data-anchor-id="network-analysis-nodes-and-edges">Network Analysis: Nodes and Edges</h2>
<p>The two primary aspects of networks are a multitude of separate entities and the connections between them. The vocabulary can be a bit technical and even inconsistent between different disciplines, packages, and software. The entities are referred to as <strong>nodes</strong> or <strong>vertices</strong> of a graph, while the connections are <strong>edges</strong> or <strong>links</strong>. In this post I will mainly use the nomenclature of nodes and edges except when discussing packages that use different vocabulary.</p>
<p>The network analysis packages need data to be in a particular form to create the special type of object used by each package. The object classes for <code>network</code>, <code>igraph</code>, and <code>tidygraph</code> are all based on adjacency matrices, also known as sociomatrices.<sup>2</sup> An <a href="https://en.wikipedia.org/wiki/Adjacency_matrix">adjacency matrix</a> is a square matrix in which the column and row names are the nodes of the network. Within the matrix a 1 indicates that there is a connection between the nodes, and a 0 indicates no connection. Adjacency matrices implement a very different data structure than data frames and do not fit within the <a href="http://www.tidyverse.org">tidyverse</a> workflow that I have used in my previous posts. Helpfully, the specialized network objects can also be created from an edge-list data frame, which do fit in the tidyverse workflow. In this post I will stick to the data analysis techniques of the tidyverse to create edge lists, which will then be converted to the specific object classes for <code>network</code>, <code>igraph</code>, and <code>tidygraph</code>.</p>
<p>An <strong>edge list</strong> is a data frame that contains a minimum of two columns, one column of nodes that are the source of a connection and another column of nodes that are the target of the connection. The nodes in the data are identified by unique IDs. If the distinction between source and target is meaningful, the network is <strong>directed</strong>. If the distinction is not meaningful, the network is <strong>undirected</strong>. With the example of letters sent between cities, the distinction between source and target is clearly meaningful, and so the network is directed. For the examples below, I will name the source column as “from” and the target column as “to”. I will use integers beginning with one as node IDs.<sup>3</sup> An edge list can also contain additional columns that describe <strong>attributes</strong> of the edges such as a magnitude aspect for an edge. If the edges have a magnitude attribute the graph is considered <strong>weighted</strong>.</p>
<p>Edge lists contain all of the information necessary to create network objects, but sometimes it is preferable to also create a separate node list. At its simplest, a <strong>node list</strong> is a data frame with a single column — which I will label as “id” — that lists the node IDs found in the edge list. The advantage of creating a separate node list is the ability to add attribute columns to the data frame such as the names of the nodes or any kind of groupings. Below I give an example of minimal edge and node lists created with the <code><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble()</a></code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edge_list</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>from <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, to <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">node_list</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edge_list</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 5 × 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    from    to</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1     1     2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2     2     3</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3     2     4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4     3     2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5     4     1</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">node_list</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;      id</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1     1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2     2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3     3</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4     4</span></span></code></pre></div>
</div>
<p>Compare this to an adjacency matrix with the same data.</p>
<div class="cell">
<pre><code>#&gt;   1 2 3 4
#&gt; 1 0 1 0 0
#&gt; 2 0 0 1 1
#&gt; 3 0 1 0 0
#&gt; 4 1 0 0 0</code></pre>
</div>
</section><section id="creating-edge-and-node-lists" class="level2"><h2 class="anchored" data-anchor-id="creating-edge-and-node-lists">Creating edge and node lists</h2>
<p>To create network objects from the database of letters received by Daniel van der Meulen in 1585 I will make both an edge list and a node list. This will necessitate the use of the <a href="http://dplyr.tidyverse.org">dplyr</a> package to manipulate the data frame of letters sent to Daniel and split it into two data frames or <a href="http://r4ds.had.co.nz/tibbles.html">tibbles</a> with the structure of edge and node lists. In this case, the nodes will be the cities from which Daniel’s correspondents sent him letters and the cities in which he received them. The node list will contain a “label” column, containing the names of the cities. The edge list will also have an attribute column that will show the amount of letters sent between each pair of cities. The workflow to create these objects will be similar to that I have used in my <a href="https://jessesadler.com/post/excel-vs-r/">brief introduction to R</a> and in <a href="https://jessesadler.com/post/geocoding-with-r/">geocoding with R</a>. If you would like to follow along, you can find the data used in this post and the R script used on <a href="https://github.com/jessesadler/intro-to-r">GitHub</a>.</p>
<p>The first step is to load the <code>tidyverse</code> library to import and manipulate the data. Printing out the <code>letters</code> data frame shows that it contains four columns: “writer”, “source”, “destination”, and “date”. In this example, we will only deal with the “source” and “destination” columns.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/correspondence-data-1585.csv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 114 × 4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    writer                  source  destination date      </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;chr&gt;                   &lt;chr&gt;   &lt;chr&gt;       &lt;date&gt;    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Meulen, Andries van der Antwerp Delft       1585-01-03</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Meulen, Andries van der Antwerp Haarlem     1585-01-09</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Meulen, Andries van der Antwerp Haarlem     1585-01-11</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Meulen, Andries van der Antwerp Delft       1585-01-12</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Meulen, Andries van der Antwerp Haarlem     1585-01-12</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Meulen, Andries van der Antwerp Delft       1585-01-17</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Meulen, Andries van der Antwerp Delft       1585-01-22</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Meulen, Andries van der Antwerp Delft       1585-01-23</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Della Faille, Marten    Antwerp Haarlem     1585-01-24</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Meulen, Andries van der Antwerp Delft       1585-01-28</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # … with 104 more rows</span></span></code></pre></div>
</div>
<section id="node-list" class="level3"><h3 class="anchored" data-anchor-id="node-list">Node list</h3>
<p>The workflow to create a node list is similar to the one I used to get the <a href="https://jessesadler.com/post/geocoding-with-r/#preparing-data">list of cities in order to geocode the data</a> in a previous post. We want to get the distinct cities from both the “source” and “destination” columns and then join the information from these columns together. In the example below, I slightly change the commands from those I used in the previous post to have the name for the columns with the city names be the same for both the <code>sources</code> and <code>destinations</code> data frames to simplify the <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> function. I rename the column with the city names as “label” to adopt the vocabulary used by network analysis packages.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sources</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">source</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">source</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destinations</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destination</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destination</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>To create a single dataframe with a column with the unique locations we need to use a <a href="http://r4ds.had.co.nz/relational-data.html#outer-join">full join</a>, because we want to include all unique places from both the sources of the letters and the destinations.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sources</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destinations</span>, by <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 13 × 1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    label     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;chr&gt;     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Antwerp   </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Haarlem   </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Dordrecht </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Venice    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Lisse     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Het Vlie  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Hamburg   </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Emden     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Amsterdam </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Delft     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11 The Hague </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 Middelburg</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13 Bremen</span></span></code></pre></div>
</div>
<p>This results in a data frame with one variable. However, the variable contained in the data frame is not really what we are looking for. The “label” column contains the names of the nodes, but we also want to have unique IDs for each city. We can do this by adding an “id” column to the <code>nodes</code> data frame that contains numbers from one to whatever the total number of rows in the data frame is. A helpful function for this workflow is <code><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column()</a></code>, which adds a column with the values from the row ids and places the column at the start of the data frame.<sup>4</sup> Note that <code><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column()</a></code> is a pipeable command, and so it is possible to do the <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> and add the “id” column in a single command. The result is a nodes list with an ID column and a label attribute.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 13 × 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       id label     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;int&gt; &lt;chr&gt;     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1     1 Antwerp   </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2     2 Haarlem   </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3     3 Dordrecht </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4     4 Venice    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5     5 Lisse     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6     6 Het Vlie  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7     7 Hamburg   </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8     8 Emden     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9     9 Amsterdam </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10    10 Delft     </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11    11 The Hague </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12    12 Middelburg</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13    13 Bremen</span></span></code></pre></div>
</div>
</section><section id="edge-list" class="level3"><h3 class="anchored" data-anchor-id="edge-list">Edge list</h3>
<p>Creating an edge list is similar to the above, but it is complicated by the need to deal with two ID columns instead of one. We also want to create a weight column that will note the amount of letters sent between each set of nodes. To accomplish this I will use the same <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> workflow that I have <a href="https://jessesadler.com/post/excel-vs-r/#the-pipe">discussed in previous posts</a>. The difference here is that we want to group the data frame by two columns — “source” and “destination” — instead of just one. Previously, I have named the column that counts the number of observations per group “count”, but here I adopt the nomenclature of network analysis and call it “weight”. The final command in the pipeline removes the grouping for the data frame instituted by the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function. This makes it easier to manipulate the resulting <code>per_route</code> data frame unhindered.<sup>5</sup></p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_route</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">source</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destination</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>weight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, .groups <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_route</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 15 × 3</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    source    destination weight</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;chr&gt;     &lt;chr&gt;        &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Amsterdam Bremen           1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Antwerp   Delft           68</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Antwerp   Haarlem          5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Antwerp   Middelburg       1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Antwerp   The Hague        2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Dordrecht Haarlem          1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Emden     Bremen           1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Haarlem   Bremen           2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Haarlem   Delft           26</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Haarlem   Middelburg       1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11 Haarlem   The Hague        1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 Hamburg   Bremen           1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13 Het Vlie  Bremen           1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 14 Lisse     Delft            1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 15 Venice    Haarlem          2</span></span></code></pre></div>
</div>
<p>Like the node list, <code>per_route</code> now has the basic form that we want, but we again have the problem that the “source” and “destination” columns contain labels rather than IDs. What we need to do is link the IDs that have been assigned in <code>nodes</code> to each location in both the “source” and “destination” columns. This can be accomplished with another join function. In fact, it is necessary to perform two joins, one for the “source” column and one for “destination.” In this case, I will use a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> with <code>per_route</code> as the left data frame, because we want to maintain the number of rows in <code>per_route</code>. While doing the <code>left_join</code>, we also want to rename the two “id” columns that are brought over from <code>nodes</code>. For the join using the “source” column I will rename the column as “from”. The column brought over from the “destination” join is renamed “to”. It would be possible to do both joins in a single command with the use of the pipe. However, for clarity, I will perform the joins in two separate commands. Because the join is done across two commands, notice that the data frame at the beginning of the pipeline changes from <code>per_route</code> to <code>edges</code>, which is created by the first command.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_route</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span>, by <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>from <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span>, by <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"destination"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>to <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Now that <code>edges</code> has “from” and “to” columns with node IDs, we need to reorder the columns to bring “from” and “to” to the left of the data frame. Currently, the <code>edges</code> data frame still contains the “source” and “destination” columns with the names of the cities that correspond with the IDs. However, this data is superfluous, since it is already present in <code>nodes</code>. Therefore, I will only include the “from”, “to”, and “weight” columns in the <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">from</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">to</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">weight</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 15 × 3</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     from    to weight</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;int&gt; &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1     9    13      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2     1    10     68</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3     1     2      5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4     1    12      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5     1    11      2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6     3     2      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7     8    13      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8     2    13      2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9     2    10     26</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10     2    12      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11     2    11      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12     7    13      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13     6    13      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 14     5    10      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 15     4     2      2</span></span></code></pre></div>
</div>
<p>The <code>edges</code> data frame does not look very impressive; it is three columns of integers. However, <code>edges</code> combined with <code>nodes</code> provides us with all of the information necessary to create network objects with the <code>network</code>, <code>igraph</code>, and <code>tidygraph</code> packages.</p>
</section></section><section id="creating-network-objects" class="level2"><h2 class="anchored" data-anchor-id="creating-network-objects">Creating network objects</h2>
<p>The network object classes for <code>network</code>, <code>igraph</code>, and <code>tidygraph</code> are all closely related. It is possible to translate between a <code>network</code> object and an <code>igraph</code> object. However, it is best to keep the two packages and their objects separate. In fact, the capabilities of <code>network</code> and <code>igraph</code> overlap to such an extent that it is best practice to have only one of the packages loaded at a time. I will begin by going over the <code>network</code> package and then move to the <code>igraph</code> and <code>tidygraph</code> packages.</p>
<section id="network" class="level3"><h3 class="anchored" data-anchor-id="network">network</h3>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://statnet.org/">network</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>The function used to create a <code>network</code> object is <code>network()</code>. The command is not particularly straight forward, but you can always enter <code>?network()</code> into the console if you get confused. The first argument is — as stated in the documentation — “a matrix giving the network structure in adjacency, incidence, or edgelist form.” The language demonstrates the significance of matrices in network analysis, but instead of a matrix, we have an edge list, which fills the same role. The second argument is a list of vertex attributes, which corresponds to the nodes list. Notice that the <code>network</code> package uses the nomenclature of vertices instead of nodes. The same is true of <code>igraph</code>. We then need to specify the type of data that has been entered into the first two arguments by specifying that the <code>matrix.type</code> is an <code>"edgelist"</code>. Finally, we set <code>ignore.eval</code> to <code>FALSE</code> so that our network can be weighted and take into account the number of letters along each route.</p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_network</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">network</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span>,</span>
<span>                          vertex.attr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span>,</span>
<span>                          matrix.type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"edgelist"</span>,</span>
<span>                          ignore.eval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>You can see the type of object created by the <code>network()</code> function by placing <code>routes_network</code> in the <code><a href="https://rdrr.io/r/base/class.html">class()</a></code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_network</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "network"</span></span></code></pre></div>
</div>
<p>Printing out <code>routes_network</code> to the console shows that the structure of the object is quite different from data-frame style objects such as <code>edges</code> and <code>nodes</code>. The print command reveals information that is specifically defined for network analysis. It shows that there are 13 vertices or nodes and 15 edges in <code>routes_network</code>. These numbers correspond to the number of rows in <code>nodes</code> and <code>edges</code> respectively. We can also see that the vertices and edges both contain attributes such as label and weight. You can get even more information, including a sociomatrix of the data, by entering <code>summary(routes_network)</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_network</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  Network attributes:</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   vertices = 13 </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   directed = TRUE </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   hyper = FALSE </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   loops = FALSE </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   multiple = FALSE </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   bipartite = FALSE </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   total edges= 15 </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     missing edges= 0 </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     non-missing edges= 15 </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  Vertex attribute names: </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     id label vertex.names </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  Edge attribute names: </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     weight</span></span></code></pre></div>
</div>
<p>It is now possible to get a rudimentary, if not overly aesthetically pleasing, graph of our network of letters. Both the <code>network</code> and <code>igraph</code> packages use the <a href="https://bookdown.org/rdpeng/exdata/the-base-plotting-system-1.html">base plotting system of R</a>. The conventions for base plots are significantly different from those of <a href="http://ggplot2.tidyverse.org">ggplot2</a> — which I have discussed in <a href="https://jessesadler.com/post/excel-vs-r/#ggplot">previous</a> <a href="https://jessesadler.com/post/geocoding-with-r/#mapping-data">posts</a> — and so I will stick with rather simple plots instead of going into the details of creating complex plots with base R. In this case, the only change that I make to the default <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function for the <code>network</code> package is to increase the size of nodes with the <code>vertex.cex</code> argument to make the nodes more visible. Even with this very simple graph, we can already learn something about the data. The graph makes clear that there are two main groupings or clusters of the data, which correspond to the time Daniel spent in Holland in the first three-quarters of 1585 and after his move to Bremen in September.</p>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_network</span>, vertex.cex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/network-analysis-with-r/index_files/figure-html/network-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function with a <code>network</code> object uses the Fruchterman and Reingold algorithm to decide on the placement of the nodes.<sup>6</sup> You can change the layout algorithm with the <code>mode</code> argument. Below, I layout the nodes in a circle. This is not a particularly useful arrangement for this network, but it gives an idea of some of the options available.</p>
<div class="cell">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_network</span>, vertex.cex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, mode <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"circle"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/network-analysis-with-r/index_files/figure-html/network-circle-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="igraph" class="level3"><h3 class="anchored" data-anchor-id="igraph">igraph</h3>
<p>Let’s now move on to discuss the <code>igraph</code> package. First, we need to clean up the environment in R by removing the <code>network</code> package so that it does not interfere with the <code>igraph</code> commands. We might as well also remove <code>routes_network</code> since we will not longer be using it. The <code>network</code> package can be removed with the <code><a href="https://rdrr.io/r/base/detach.html">detach()</a></code> function, and <code>routes_network</code> is removed with <code><a href="https://rdrr.io/r/base/rm.html">rm()</a></code>.<sup>7</sup> After this, we can safely load <code>igraph</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Detatch network and load igraph</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/detach.html">detach</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">package</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">network</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_network</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://r.igraph.org/">igraph</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>To create an <code>igraph</code> object from an edge-list data frame we can use the <code>graph_from_data_frame()</code> function, which is a bit more straight forward than <code>network()</code>. There are three arguments in the <code>graph_from_data_frame()</code> function: d, vertices, and directed. Here, d refers to the edge list, vertices to the node list, and directed can be either <code>TRUE</code> or <code>FALSE</code> depending on whether the data is directed or undirected.</p>
<div class="cell">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_igraph</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">graph_from_data_frame</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span>,</span>
<span>                                       vertices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span>,</span>
<span>                                       directed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Printing the <code>igraph</code> object created by <code>graph_from_data_frame()</code> to the console reveals similar information to that from a <code>network</code> object, though the structure is more cryptic.</p>
<div class="cell">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_igraph</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; IGRAPH 743b80e DNW- 13 15 -- </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; + attr: name (v/c), label (v/c), weight (e/n)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; + edges from 743b80e (vertex names):</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  [1] 9-&gt;13 1-&gt;10 1-&gt;2  1-&gt;12 1-&gt;11 3-&gt;2  8-&gt;13 2-&gt;13 2-&gt;10 2-&gt;12 2-&gt;11 7-&gt;13</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [13] 6-&gt;13 5-&gt;10 4-&gt;2</span></span></code></pre></div>
</div>
<p>The main information about the object is contained in <code>DNW- 13 15 --</code>. This tells that <code>routes_igraph</code> is a directed network (D) that has a name attribute (N) and is weighted (W). The dash after W tells us that the graph is not <a href="https://wikipedia.org/wiki/Bipartite_graph">bipartite</a>. The numbers that follow describe the number of nodes and edges in the graph respectively. Next, <code>name (v/c), label (v/c), weight (e/n)</code> gives information about the attributes of the graph. There are two vertex attributes (v/c) of name — which are the IDs — and labels and an edge attribute (e/n) of weight. Finally, there is a print out of all of the edges.</p>
<p>Just as with the <code>network</code> package, we can create a plot with an <code>igraph</code> object through the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function. The only change that I make to the default here is to decrease the size of the arrows. By default <code>igraph</code> labels the nodes with the label column if there is one or with the IDs.</p>
<div class="cell">
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_igraph</span>,</span>
<span>     vertex.size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,</span>
<span>     vertex.label.cex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span>     edge.arrow.size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/network-analysis-with-r/index_files/figure-html/igraph-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Like the <code>network</code> graph before, the default of an <code>igraph</code> plot is not particularly aesthetically pleasing, but all aspects of the plots can be manipulated. Here, I just want to change the layout of the nodes to use the graphopt algorithm created by <a href="http://www.schmuhl.org/graphopt/">Michael Schmuhl</a>. This algorithm makes it easier to see the relationship between Haarlem, Antwerp, and Delft, which are three of the most signifiant locations in the correspondence network, by spreading them out further.</p>
<div class="cell">
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_igraph</span>,</span>
<span>     layout <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">layout_with_graphopt</span>,</span>
<span>     vertex.size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,</span>
<span>     vertex.label.cex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span>     edge.arrow.size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/network-analysis-with-r/index_files/figure-html/igraph-graphopt-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="tidygraph-and-ggraph" class="level3"><h3 class="anchored" data-anchor-id="tidygraph-and-ggraph">tidygraph and ggraph</h3>
<p>The <code>tidygraph</code> and <code>ggraph</code> packages are newcomers to the network analysis landscape, but together the two packages provide real advantages over the <code>network</code> and <code>igraph</code> packages. <code>tidygraph</code> and <code>ggraph</code> represent an attempt to <a href="http://www.data-imaginist.com/2017/Introducing-tidygraph/">bring network analysis into the tidyverse workflow</a>. <a href="https://cran.r-project.org/web/packages/tidygraph/index.html"><code>tidygraph</code></a> provides a way to create a network object that more closely resembles a <a href="http://r4ds.had.co.nz/tibbles.html">tibble or data frame</a>. This makes it possible to use many of the <code>dplyr</code> functions to manipulate network data. <a href="https://cran.r-project.org/web/packages/ggraph/index.html"><code>ggraph</code></a> gives a way to plot network graphs using the conventions and power of <code>ggplot2</code>. In other words, <code>tidygraph</code> and <code>ggraph</code> allow you to deal with network objects in a manner that is more consistent with the commands used for working with tibbles and data frames. However, the true promise of <code>tidygraph</code> and <code>ggraph</code> is that they leverage the power of <code>igraph</code>. This means that you sacrifice few of the network analysis capabilities of <code>igraph</code> by using <code>tidygraph</code> and <code>ggraph</code>.</p>
<p>We need to start as always by loading the necessary packages.</p>
<div class="cell">
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://tidygraph.data-imaginist.com">tidygraph</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://ggraph.data-imaginist.com">ggraph</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>First, let’s create a network object using <code>tidygraph</code>, which is called a <code>tbl_graph</code>. A <code>tbl_graph</code> consists of two tibbles: an edges tibble and a nodes tibble. Conveniently, the <code>tbl_graph</code> object class is a wrapper around an <code>igraph</code> object, meaning that at its basis a <code>tbl_graph</code> object is essentially an <code>igraph</code> object.<sup>8</sup> The close link between <code>tbl_graph</code> and <code>igraph</code> objects results in two main ways to create a <code>tbl_graph</code> object. The first is to use an edge list and node list, using <code>tbl_graph()</code>. The arguments for the function are almost identical to those of <code>graph_from_data_frame()</code> with only a slight change to the names of the arguments.</p>
<div class="cell">
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_tidy</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tbl_graph</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>nodes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span>,</span>
<span>                         edges <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span>,</span>
<span>                         directed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>The second way to create a <code>tbl_graph</code> object is to convert an <code>igraph</code> or <code>network</code> object using <code>as_tbl_graph()</code>. Thus, we could convert <code>routes_igraph</code> to a <code>tbl_graph</code> object.</p>
<div class="cell">
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_igraph_tidy</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tbl_graph</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_igraph</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Now that we have created two <code>tbl_graph</code> objects, let’s inspect them with the <code><a href="https://rdrr.io/r/base/class.html">class()</a></code> function. This shows that <code>routes_tidy</code> and <code>routes_igraph_tidy</code> are objects of class <code>"tbl_graph" "igraph"</code>, while <code>routes_igraph</code> is object class <code>"igraph"</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_tidy</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "tbl_graph" "igraph"</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_igraph_tidy</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "tbl_graph" "igraph"</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_igraph</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] "igraph"</span></span></code></pre></div>
</div>
<p>Printing out a <code>tbl_graph</code> object to the console results in a drastically different output from that of an <code>igraph</code> object. It is an output similar to that of a normal tibble.</p>
<div class="cell">
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_tidy</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tbl_graph: 13 nodes and 15 edges</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; #</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A directed acyclic simple graph with 1 component</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; #</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Node Data: 13 × 2 (active)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;      id label    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;int&gt; &lt;chr&gt;    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1     1 Antwerp  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2     2 Haarlem  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3     3 Dordrecht</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4     4 Venice   </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5     5 Lisse    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 6     6 Het Vlie </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # … with 7 more rows</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; #</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Edge Data: 15 × 3</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    from    to weight</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;int&gt; &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1     9    13      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2     1    10     68</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3     1     2      5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # … with 12 more rows</span></span></code></pre></div>
</div>
<p>Printing <code>routes_tidy</code> shows that it is a <code>tbl_graph</code> object with 13 nodes and 15 edges. The command also prints the first six rows of “Node Data” and the first three of “Edge Data”. Notice too that it states that the Node Data is active. The notion of an active tibble within a <code>tbl_graph</code> object makes it possible to manipulate the data in one tibble at a time. The nodes tibble is activated by default, but you can change which tibble is active with the <code>activate()</code> function. Thus, if I wanted to rearrange the rows in the edges tibble to list those with the highest “weight” first, I could use <code>activate()</code> and then <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>. Here I simply print out the result rather than saving it.</p>
<div class="cell">
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_tidy</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">activate</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">weight</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tbl_graph: 13 nodes and 15 edges</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; #</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A directed acyclic simple graph with 1 component</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; #</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Edge Data: 15 × 3 (active)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    from    to weight</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;int&gt; &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1     1    10     68</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2     2    10     26</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3     1     2      5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4     1    11      2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5     2    13      2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 6     4     2      2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # … with 9 more rows</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; #</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Node Data: 13 × 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;      id label    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;int&gt; &lt;chr&gt;    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1     1 Antwerp  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2     2 Haarlem  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3     3 Dordrecht</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # … with 10 more rows</span></span></code></pre></div>
</div>
<p>Since we do not need to further manipulate <code>routes_tidy</code>, we can plot the graph with <code>ggraph</code>. Like <a href="https://jessesadler.com/post/geocoding-with-r/#mapping-data">ggmap</a>, <code>ggraph</code> is an extension of <code>ggplot2</code>, making it easier to carry over basic <code>ggplot</code> skills to the creation of network plots. As in all network graphs, there are three main aspects to a <code>ggraph</code> plot: <a href="http://www.data-imaginist.com/2017/ggraph-introduction-nodes/">nodes</a>, <a href="http://www.data-imaginist.com/2017/ggraph-introduction-edges/">edges</a>, and <a href="http://www.data-imaginist.com/2017/ggraph-introduction-layouts/">layouts</a>. The <a href="https://cran.r-project.org/web/packages/ggraph/index.html">vignettes for the ggraph package</a> helpfully cover the fundamental aspects of <code>ggraph</code> plots. <code>ggraph</code> adds special geoms to the basic set of <code>ggplot</code> geoms that are specifically designed for networks. Thus, there is a set of <code>geom_node</code> and <code>geom_edge</code> geoms. The basic plotting function is <code>ggraph()</code>, which takes the data to be used for the graph and the type of layout desired. Both of the arguments for <code>ggraph()</code> are built around <code>igraph</code>. Therefore, <code>ggraph()</code> can use either an <code>igraph</code> object or a <code>tbl_graph</code> object. In addition, the available layouts algorithms primarily derive from <code>igraph</code>. Lastly, <code>ggraph</code> introduces a special <code>ggplot</code> theme that provides better defaults for network graphs than the normal <code>ggplot</code> defaults. The <code>ggraph</code> theme can be set for a series of plots with the <code>set_graph_style()</code> command run before the graphs are plotted or by using <code>theme_graph()</code> in the individual plots. Here, I will use the latter method.</p>
<p>Let’s see what a basic <code>ggraph</code> plot looks like. The plot begins with <code>ggraph()</code> and the data. I then add basic edge and node geoms. No arguments are necessary within the edge and node geoms, because they take the information from the data provided in <code>ggraph()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggraph</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_tidy</span>, layout <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_edge_link</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_node_point</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_graph</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Using "sugiyama" as default layout</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Warning: Using the `size` aesthetic in this geom was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; ℹ Please use `linewidth` in the `default_aes` field and elsewhere instead.</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/network-analysis-with-r/index_files/figure-html/ggraph-basic-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As you can see, the structure of the command is similar to that of <code>ggplot</code> with the separate layers added with the <code>+</code> sign. The basic <code>ggraph</code> plot looks similar to those of <code>network</code> and <code>igraph</code>, if not even plainer, but we can use similar commands to <code>ggplot</code> to create a more informative graph. We can show the “weight” of the edges — or the amount of letters sent along each route — by using width in the <code>geom_edge_link()</code> function. To get the width of the line to change according to the weight variable, we place the argument within an <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> function. In order to control the maximum and minimum width of the edges, I use <code>scale_edge_width()</code> and set a <code>range</code>. I choose a relatively small width for the minimum, because there is a significant difference between the maximum and minimum number of letters sent along the routes. We can also label the nodes with the names of the locations since there are relatively few nodes. Conveniently, <code>geom_node_text()</code> comes with a repel argument that ensures that the labels do not overlap with the nodes in a manner similar to the <a href="https://cran.r-project.org/web/packages/ggrepel/index.html">ggrepel package</a>. I add a bit of transparency to the edges with the alpha argument. I also use <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> to relabel the legend “Letters”.</p>
<div class="cell">
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggraph</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_tidy</span>, layout <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"graphopt"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_node_point</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_edge_link</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">weight</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_edge_width</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>range <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_node_text</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, repel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>edge_width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_graph</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/network-analysis-with-r/index_files/figure-html/ggraph-graphopt-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In addition to the layout choices provided by <code>igraph</code>, <code>ggraph</code> also implements its own layouts. For example, you can use <code>ggraph's</code> concept of <a href="http://www.data-imaginist.com/2017/ggraph-introduction-layouts/">circularity</a> to create arc diagrams. Here, I layout the nodes in a horizontal line and have the edges drawn as arcs. Unlike the previous plot, this graph indicates directionality of the edges.<sup>9</sup> The edges above the horizontal line move from left to right, while the edges below the line move from right to left. Intsead of adding points for the nodes, I just include the label names. I use the same width aesthetic to denote the difference in the weight of each edge. Note that in this plot I use an <code>igraph</code> object as the data for the graph, which makes no practical difference.</p>
<div class="cell" data-fig.asp="0.5">
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggraph</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">routes_igraph</span>, layout <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linear"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_edge_arc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">weight</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_edge_width</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>range <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_node_text</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>edge_width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_graph</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/network-analysis-with-r/index_files/figure-html/ggraph-arc-plot-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="interactive-network-graphs-with-visnetwork-and-networkd3" class="level2"><h2 class="anchored" data-anchor-id="interactive-network-graphs-with-visnetwork-and-networkd3">Interactive network graphs with <code>visNetwork</code> and <code>networkD3</code>
</h2>
<p>The <a href="http://www.htmlwidgets.org">htmlwidgets</a> set of packages makes it possible to use R to create interactive JavaScript visualizations. Here, I will show how to make graphs with the <a href="http://datastorm-open.github.io/visNetwork/"><code>visNetwork</code></a> and <a href="http://christophergandrud.github.io/networkD3/"><code>networkD3</code></a> packages. These two packages use different JavaScript libraries to create their graphs. <code>visNetwork</code> uses <a href="http://visjs.org/">vis.js</a>, while <code>networkD3</code> uses the popular <a href="http://d3js.org/">d3 visualization library</a> to make its graphs. One difficulty in working with both <code>visNetwork</code> and <code>networkD3</code> is that they expect edge lists and node lists to use specific nomenclature. The above data manipulation conforms to the basic structure for <code>visNetwork</code>, but some work will need to be done for <code>networkD3</code>. Despite this inconvenience, both packages possess a wide range of graphing capabilities and both can work with <code>igraph</code> objects and layouts.</p>
<div class="cell">
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://datastorm-open.github.io/visNetwork/">visNetwork</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://CRAN.R-project.org/package=networkD3">networkD3</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<section id="visnetwork" class="level3"><h3 class="anchored" data-anchor-id="visnetwork">visNetwork</h3>
<p>The <code>visNetwork()</code> function uses a nodes list and edges list to create an interactive graph. The nodes list must include an “id” column, and the edge list must have “from” and “to” columns. The function also plots the labels for the nodes, using the names of the cities from the “label” column in the node list. The resulting graph is fun to play around with. You can move the nodes and the graph will use an algorithm to keep the nodes properly spaced. You can also zoom in and out on the plot and move it around to re-center it.</p>
<div class="cell">
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">visNetwork</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="visNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-199e45479f8e09e5ae94" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-199e45479f8e09e5ae94">{"x":{"nodes":{"id":[1,2,3,4,5,6,7,8,9,10,11,12,13],"label":["Antwerp","Haarlem","Dordrecht","Venice","Lisse","Het Vlie","Hamburg","Emden","Amsterdam","Delft","The Hague","Middelburg","Bremen"]},"edges":{"from":[9,1,1,1,1,3,8,2,2,2,2,7,6,5,4],"to":[13,10,2,12,11,2,13,13,10,12,11,13,13,10,2],"weight":[1,68,5,1,2,1,1,2,26,1,1,1,1,1,2]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><code>visNetwork</code> can use <code>igraph</code> layouts, providing a large variety of possible layouts. In addition, you can use <code>visIgraph()</code> to plot an <code>igraph</code> object directly. Here, I will stick with the <code>nodes</code> and <code>edges</code> workflow and use an <code>igraph</code> layout to customize the graph. I will also add a variable to change the width of the edge as we did with <code>ggraph</code>. <code>visNetwork()</code> uses column names from the edge and node lists to plot network attributes instead of arguments within the function call. This means that it is necessary to do some data manipulation to get a “width” column in the edge list. The width attribute for <code>visNetwork()</code> does not scale the values, so we have to do this manually. Both of these actions can be done with the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> function and some simple arithmetic. Here, I create a new column in <code>edges</code> and scale the weight values by dividing by 5. Adding 1 to the result provides a way to create a minimum width.</p>
<div class="cell">
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span>, width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">weight</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Once this is done, we can create a graph with variable edge widths. I also choose a layout algorithm from <code>igraph</code> and add arrows to the edges, placing them in the middle of the edge.</p>
<div class="cell">
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">visNetwork</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">visIgraphLayout</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>layout <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"layout_with_fr"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">visEdges</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>arrows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"middle"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="visNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3d0b23b8acf72203efa2" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3d0b23b8acf72203efa2">{"x":{"nodes":{"id":[1,2,3,4,5,6,7,8,9,10,11,12,13],"label":["Antwerp","Haarlem","Dordrecht","Venice","Lisse","Het Vlie","Hamburg","Emden","Amsterdam","Delft","The Hague","Middelburg","Bremen"],"x":[-0.542265634525632,-0.417416846365974,-0.992273068471269,-0.606582409103277,-1,0.745041810887742,0.297552386623189,0.898636668352277,1,-0.738835038531176,-0.159076091336065,-0.86630719390027,0.404574305806152],"y":[0.313352187878635,-0.0542099088927915,-0.273447033065793,-0.484976050533988,1,-0.957575428047797,-1,-0.30582630303258,-0.66513826395398,0.552843481697634,0.305339466893973,0.139282079717481,-0.538908217572577]},"edges":{"from":[9,1,1,1,1,3,8,2,2,2,2,7,6,5,4],"to":[13,10,2,12,11,2,13,13,10,12,11,13,13,10,2],"weight":[1,68,5,1,2,1,1,2,26,1,1,1,1,1,2],"width":[1.2,14.6,2,1.2,1.4,1.2,1.2,1.4,6.2,1.2,1.2,1.2,1.2,1.2,1.4]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":false,"arrows":"middle"},"physics":{"stabilization":false}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","igraphlayout":{"type":"square"}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section><section id="networkd3" class="level3"><h3 class="anchored" data-anchor-id="networkd3">networkD3</h3>
<p>A little more work is necessary to prepare the data to create a <code>networkD3</code> graph. To make a <code>networkD3</code> graph with a edge and node list requires that the IDs be a series of numeric integers that begin with 0. Currently, the node IDs for our data begin with 1, and so we have to do a bit of data manipulation. It is possible to renumber the nodes by subtracting 1 from the ID columns in the <code>nodes</code> and <code>edges</code> data frames. Once again, this can be done with the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> function. The goal is to recreate the current columns, while subtracting 1 from each ID. The <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> function works by creating a new column, but we can have it replace a column by giving the new column the same name as the old column. Here, I name the new data frames with a d3 suffix to distinguish them from the previous <code>nodes</code> and <code>edges</code> data frames.</p>
<div class="cell">
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes_d3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes</span>, id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges_d3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges</span>, from <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">from</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, to <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">to</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>It is now possible to plot a <code>networkD3</code> graph. Unlike <code>visNetwork()</code>, the <code>forceNetwork()</code> function uses a series of arguments to adjust the graph and plot network attributes. The “Links” and “Nodes” arguments provide the data for the plot in the form of edge and node lists. The function also requires “NodeID” and “Group” arguments. The data being used here does not have any groupings, and so I just have each node be its own group, which in practice means that the nodes will all be different colors. In addition, the below tells the function that the network has “Source” and “Target” fields, and thus is directed. I include in this graph a “Value”, which scales the width of the edges according to the “weight” column in the edge list. Finally, I add some aesthetic tweaks to make the nodes opaque and increase the font size of the labels to improve legibility. The result is very similar to the first <code>visNetwork()</code> plot that I created but with different aesthetic stylings.</p>
<div class="cell">
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forceNetwork</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Links <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges_d3</span>, Nodes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes_d3</span>,</span>
<span>             Source <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"from"</span>, Target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"to"</span>, </span>
<span>             NodeID <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, Group <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>, Value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>, </span>
<span>             opacity <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, fontSize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, zoom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="forceNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-aa095cfc5a5166d6af51" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-aa095cfc5a5166d6af51">{"x":{"links":{"source":[8,0,0,0,0,2,7,1,1,1,1,6,5,4,3],"target":[12,9,1,11,10,1,12,12,9,11,10,12,12,9,1],"value":[1,68,5,1,2,1,1,2,26,1,1,1,1,1,2],"colour":["#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666"]},"nodes":{"name":["Antwerp","Haarlem","Dordrecht","Venice","Lisse","Het Vlie","Hamburg","Emden","Amsterdam","Delft","The Hague","Middelburg","Bremen"],"group":[0,1,2,3,4,5,6,7,8,9,10,11,12]},"options":{"NodeID":"label","Group":"id","colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":16,"fontFamily":"serif","clickTextSize":40,"linkDistance":50,"linkWidth":"function(d) { return Math.sqrt(d.value); }","charge":-30,"opacity":1,"zoom":true,"legend":false,"arrows":false,"nodesize":false,"radiusCalculation":" Math.sqrt(d.nodesize)+6","bounded":false,"opacityNoHover":0,"clickAction":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>One of the main benefits of <code>networkD3</code> is that it implements a <a href="https://bost.ocks.org/mike/sankey/">d3-styled Sankey diagram</a>. A Sankey diagram is a good fit for the letters sent to Daniel in 1585. There are not too many nodes in the data, making it easier to visualize the flow of letters. Creating a Sankey diagram uses the <code>sankeyNetwork()</code> function, which takes many of the same arguments as <code>forceNetwork()</code>. This graph does not require a group argument, and the only other change is the addition of a “unit.” This provides a label for the values that pop up in a tool tip when your cursor hovers over a diagram element.<sup>10</sup></p>
<div class="cell">
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sankeyNetwork</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Links <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">edges_d3</span>, Nodes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nodes_d3</span>, Source <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"from"</span>, Target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"to"</span>, </span>
<span>              NodeID <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, Value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>, fontSize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, unit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letter(s)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="sankeyNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0d8dc5227f6c1c893a2d" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-0d8dc5227f6c1c893a2d">{"x":{"links":{"source":[8,0,0,0,0,2,7,1,1,1,1,6,5,4,3],"target":[12,9,1,11,10,1,12,12,9,11,10,12,12,9,1],"value":[1,68,5,1,2,1,1,2,26,1,1,1,1,1,2]},"nodes":{"name":["Antwerp","Haarlem","Dordrecht","Venice","Lisse","Het Vlie","Hamburg","Emden","Amsterdam","Delft","The Hague","Middelburg","Bremen"],"group":["Antwerp","Haarlem","Dordrecht","Venice","Lisse","Het Vlie","Hamburg","Emden","Amsterdam","Delft","The Hague","Middelburg","Bremen"]},"options":{"NodeID":"label","NodeGroup":"label","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":16,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"Letter(s)","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":32,"sinksRight":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section></section><section id="resource-on-network-analysis" class="level2"><h2 class="anchored" data-anchor-id="resource-on-network-analysis">Resource on network analysis</h2>
<p>This post has attempted to give a general introduction to creating and plotting network type objects in R using the <code>network</code>, <code>igraph</code>, <code>tidygraph</code>, and <code>ggraph</code> packages for static plots and <code>visNetwork</code> and <code>networkD3</code> for interactive plots. I have presented this information from the position of a non-specialist in network theory. I have only covered a very small percentage of the network analysis capabilities of R. In particular, I have not discussed the statistical analysis of networks. Happily, there is a plethora of resources on network analysis in general and in R in particular.</p>
<p>The best introduction to networks that I have found for the uninitiated is <a href="http://kateto.net/network-visualization">Katya Ognyanova’s Network Visualization with R</a>. This presents both a helpful introduction to the visual aspects of networks and a more in depth tutorial on creating network plots in R. Ognyanova primarily uses <code>igraph</code>, but she also introduces interactive networks.</p>
<p>There are two relatively recent books published on network analysis with R by Springer. <a href="http://www.springer.com/us/book/9783319238821">Douglas A. Luke, <em>A User’s Guide to Network Analysis in R</em> (2015)</a> is a very useful introduction to network analysis with R. Luke covers both the statnet suit of packages and <code>igragh</code>. The contents are at a very approachable level throughout. More advanced is <a href="http://www.springer.com/us/book/9781493909827">Eric D. Kolaczyk and Gábor Csárdi’s, Statistical Analysis of Network Data with R (2014)</a>. Kolaczyk and Csárdi’s book mainly uses <code>igraph</code>, as Csárdi is the primary maintainer of the <code>igraph</code> package for R. This book gets further into advanced topics on the statistical analysis of networks. Despite the use of very technical language, the first four chapters are generally approachable from a non-specialist point of view.</p>
<p>The <a href="https://github.com/briatte/awesome-network-analysis">list curated by François Briatte</a> is a good overview of resources on network analysis in general. The <a href="https://scottbot.net/tag/networks-demystified/">Networks Demystified series of posts by Scott Weingart</a> is also well worth perusal.</p>


</section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>One example of the interest in network analysis within digital humanities is the newly launched <a href="https://jhnr.uni.lu/index.php/jhnr">Journal of Historical Network Research</a>.↩︎</p></li>
<li id="fn2"><p>For a good description of the <code>network</code> object class, including a discussion of its relationship to the <code>igraph</code> object class, see <a href="https://www.jstatsoft.org/article/view/v024i02">Carter Butts, “<code>network</code>: A Package for Managing Relational Data in R”, <em>Journal of Statistical Software</em>, 24 (2008): 1–36</a>↩︎</p></li>
<li id="fn3"><p>This is the specific structure expected by <code>visNetwork</code>, while also conforming to the general expectations of the other packages.↩︎</p></li>
<li id="fn4"><p>This is the expected order for the columns for some of the networking packages that I will be using below.↩︎</p></li>
<li id="fn5"><p><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> is not strictly necessary in this case. However, if you do not ungroup the data frame, it is not possible to drop the “source” and “destination” columns, as I do later in the script.↩︎</p></li>
<li id="fn6"><p>Thomas M. J. Fruchterman and Edward M. Reingold, “Graph Drawing by Force-Directed Placement,” <em>Software: Practice and Experience</em>, 21 (1991): 1129–1164.↩︎</p></li>
<li id="fn7"><p>The <code><a href="https://rdrr.io/r/base/rm.html">rm()</a></code> function is useful if your working environment in R gets disorganized, but you do not want to clear the whole environment and start over again.↩︎</p></li>
<li id="fn8"><p>The relationship between <code>tbl_graph</code> and <code>igraph</code> objects is similar to that between <code>tibble</code> and <code>data.frame</code> objects.↩︎</p></li>
<li id="fn9"><p>It is possible to have <code>ggraph</code> draw arrows, but I have not shown that here.↩︎</p></li>
<li id="fn10"><p>It can take a bit of time for the tool tip to appear.↩︎</p></li>
</ol></section></div> ]]></description>
  <category>rstats</category>
  <category>network-analysis</category>
  <guid>https://www.jessesadler.com/post/network-analysis-with-r/</guid>
  <pubDate>Wed, 25 Oct 2017 04:00:00 GMT</pubDate>
  <media:content url="https://www.jessesadler.com/post/network-analysis-with-r/igraph-graphopt.png" medium="image" type="image/png" height="103" width="144"/>
</item>
<item>
  <title>Geocoding with R</title>
  <link>https://www.jessesadler.com/post/geocoding-with-r/</link>
  <description><![CDATA[ 




<p>In the <a href="https://jessesadler.com/post/excel-vs-r/">previous post</a> I discussed some reasons to use <a href="https://www.r-project.org">R</a> instead of Excel to analyze and visualize data and provided a brief introduction to the R programming language. That post used an example of letters sent to the sixteenth-century merchant <a href="https://jessesadler.com/project/dvdm-correspondence/">Daniel van der Meulen</a> in 1585. One aspect missing from the analysis was a geographical visualization of the data. This post will provide an introduction to geocoding and mapping location data using the <a href="https://cran.r-project.org/web/packages/ggmap/index.html">ggmap</a> package for R, which enables the creation of maps with <a href="http://ggplot2.tidyverse.org">ggplot</a>. There are a number of websites that can help geocode location data and even create maps.<sup>1</sup> You could also use a full-scale geographic information systems (GIS) application such as <a href="https://qgis.org">QGIS</a> or <a href="https://esri.com">ArcGIS</a>. However, an active developer community has made it possible to complete a full range of geographic analysis from geocoding data to the creation of publication-ready maps with R.<sup>2</sup> Geocoding and mapping data with R instead of a web or GIS application brings the general advantages of using a programming language in analyzing and visualizing data. With R, you can write the code once and use it over and over, while also providing a record of all your steps in the creation of a map.<sup>3</sup></p>
<p>This post will merely scratch the surface of the mapping capabilities of R and will not enter into the domain of the more complex specific geographic packages available for R.<sup>4</sup> Instead, it will build on the <a href="http://dplyr.tidyverse.org">dplyr</a> and <a href="http://ggplot2.tidyverse.org">ggplot</a> skills discussed in <a href="https://jessesadler.com/post/excel-vs-r/">my brief introduction to R</a>. The example of geocoding and mapping with R will also provide another opportunity to show the advantages of coding. In particular, geocoding is a good example of how code can simplify the workflow for entering data. Instead of dealing with separate spreadsheets to store information about the letters and geographic information, coding makes it possible to create the geographic information directly from the letters data. The code to find the longitude and latitude of locations can be saved as a R script and rerun if new data is added to ensure that the information is always kept up to date.</p>
<section id="preparing-data" class="level2">
<h2 class="anchored" data-anchor-id="preparing-data">Preparing the data with <code>dplyr</code></h2>
<p>In this example, I will use the same database of letters sent to Daniel van der Meulen in 1585 as I did in the previous post. You can find the data and the R script that goes along with this tutorial on <a href="https://github.com/jessesadler/intro-to-r">GitHub</a>. Before getting into the database of letters and figuring out how to geocode the locations found in the data, it is necessary to set up the environment in R by loading the libraries that we will be using. Here, I load both the <code>tidyverse</code> library to import and manipulate the data and the <code>ggmap</code> library to do the actual geocoding and mapping.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggmap)</span></code></pre></div>
<p>As in the previous post, the data is loaded through the <code>read_csv()</code> function from the <code>readr</code> package. It is best to keep the names of objects consistent across scripts. Therefore, I name the object <code>letters</code> with the assignment operator. Printing out the contents reveals the that <code>letters</code> is a <a href="http://tibble.tidyverse.org">tibble</a> with 114 letters and four columns.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">letters <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/correspondence-data-1585.csv"</span>)</span>
<span id="cb2-2">letters</span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 114 x 4</span></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;                     writer  source destination       date</span></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;                      &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;     &lt;date&gt;</span></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Meulen, Andries van der Antwerp       Delft 1585-01-03</span></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Meulen, Andries van der Antwerp     Haarlem 1585-01-09</span></span>
<span id="cb2-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Meulen, Andries van der Antwerp     Haarlem 1585-01-11</span></span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Meulen, Andries van der Antwerp       Delft 1585-01-12</span></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Meulen, Andries van der Antwerp     Haarlem 1585-01-12</span></span>
<span id="cb2-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Meulen, Andries van der Antwerp       Delft 1585-01-17</span></span>
<span id="cb2-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Meulen, Andries van der Antwerp       Delft 1585-01-22</span></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Meulen, Andries van der Antwerp       Delft 1585-01-23</span></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9    Della Faille, Marten Antwerp     Haarlem 1585-01-24</span></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Meulen, Andries van der Antwerp       Delft 1585-01-28</span></span>
<span id="cb2-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # ... with 104 more rows</span></span></code></pre></div>
<p>To do the actual geocoding of the locations I will be using the <code>mutate_geocode()</code> function from the <code>ggmap</code> package. To geocode a number of locations at one time, the function requires a data frame with a column containing the locations we would like to geocode. The goal, then, is to get a data frame with a column that contains all of the distinct locations found in the <code>letters</code> data frame. In the <a href="https://jessesadler.com/post/excel-vs-r/#new-dataframes">introduction to R</a> post I used the <code>distinct()</code> function to get data frames with the unique sources and destinations. We can rerun that code here and look at the results.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">sources <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>(letters, source)</span>
<span id="cb3-2">destinations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>(letters, destination)</span>
<span id="cb3-3"></span>
<span id="cb3-4">sources</span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 9 x 1</span></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;      source</span></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       &lt;chr&gt;</span></span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1   Antwerp</span></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2   Haarlem</span></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3 Dordrecht</span></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4    Venice</span></span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5     Lisse</span></span>
<span id="cb3-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 6  Het Vlie</span></span>
<span id="cb3-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 7   Hamburg</span></span>
<span id="cb3-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 8     Emden</span></span>
<span id="cb3-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 9 Amsterdam</span></span>
<span id="cb3-17"></span>
<span id="cb3-18">destinations</span>
<span id="cb3-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 5 x 1</span></span>
<span id="cb3-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   destination</span></span>
<span id="cb3-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         &lt;chr&gt;</span></span>
<span id="cb3-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1       Delft</span></span>
<span id="cb3-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2     Haarlem</span></span>
<span id="cb3-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3   The Hague</span></span>
<span id="cb3-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4  Middelburg</span></span>
<span id="cb3-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5      Bremen</span></span></code></pre></div>
<p>A glance at the two data frames shows that neither provide exactly what I are looking for. Neither the <code>sources</code> nor the <code>destinations</code> data frames include all of the locations that we want to geocode. It would be possible to geocode both the <code>sources</code> and <code>destinations</code> data frames, but this would place the geocoded information in two different data frames, which is less than ideal. Instead, we can join the two data frames together using the <a href="http://r4ds.had.co.nz/relational-data.html">join functions in dplyr</a>. Coming from the world of spreadsheets, the join functions are a revelation, opening up seemingly endless possibilities for data manipulation.</p>
<p>The <code>dplyr</code> package includes a number of functions to join two data frames together to create a single data frame. The join functions use overlapping columns of data contained in both data frames, called keys, to match up the data. There are three join functions that are used most often. The <code>left_join()</code> keeps all observations from the left, or first, data frame, while dropping all rows from the right, or second, data frame that do not have a match in the left data frame. The <code>inner_join()</code> only keeps rows that contain matching keys in both data frames. Conversely, the <code>full_join()</code> brings together all rows from both the left and right data frames. The differences between these functions may not be immediately apparent, but you can experiment with them to see the variety of outputs they create.</p>
<p>Using <code>sources</code> as the left and <code>destinations</code> as the right data frames, a <code>left_join()</code> creates a new object with 9 rows, an <code>inner_join()</code> results in only one row, and a <code>full_join()</code> contains 13 observations. Thus, the <code>full_join()</code> is what we are looking for. The <code>full_join()</code> function — like the other join functions — takes three arguments: the two data frames to join and the key column by which they are to be joined. In this case, some extra work needs to be done to the identify the key columns. The key columns are the only columns in the two data frames, but because they have different names, it is necessary to declare that they are equivalent. This is done with the help of the concatenate or combine function, <code>c()</code>.<sup>5</sup> The below command creates a new data frame that I have called <code>cities</code>, which brings together the “source” column with the “destination” column and therefore contains all of the locations found in the <code>letters</code> data frame.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">cities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">full_join</span>(sources, destinations, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"destination"</span>))</span>
<span id="cb4-2">cities</span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 13 x 1</span></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;        source</span></span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         &lt;chr&gt;</span></span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1    Antwerp</span></span>
<span id="cb4-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2    Haarlem</span></span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3  Dordrecht</span></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4     Venice</span></span>
<span id="cb4-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5      Lisse</span></span>
<span id="cb4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6   Het Vlie</span></span>
<span id="cb4-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7    Hamburg</span></span>
<span id="cb4-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8      Emden</span></span>
<span id="cb4-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9  Amsterdam</span></span>
<span id="cb4-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10      Delft</span></span>
<span id="cb4-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11  The Hague</span></span>
<span id="cb4-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 Middelburg</span></span>
<span id="cb4-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13     Bremen</span></span></code></pre></div>
<p>Printing out the <code>cities</code> data frame shows that there are 13 distinct locations in the <code>letters</code> data. However, the structure of the <code>cities</code> object is less than ideal. The name of the column is “source,” which was taken over from the <code>sources</code> data frame, but this is not an accurate description of the data in the column. This can be fixed with the help of <code>rename()</code>, which uses the structure of <code>new_name = old_name</code>. Here, I change the name of the “source” column to “place” and then print out the first two rows with the <code>head()</code> function to show the change in the column name. Notice that using the <code>cities</code> object within the <code>rename()</code> function and using the same name for the result overwrites the original object with the new one. Alternatively, you could name the new object a different name such as <code>cities1</code>.<sup>6</sup></p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">cities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(cities, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">place =</span> source)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(cities, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 2 x 1</span></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     place</span></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     &lt;chr&gt;</span></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 Antwerp</span></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2 Haarlem</span></span></code></pre></div>
</section>
<section id="geocoding" class="level2">
<h2 class="anchored" data-anchor-id="geocoding">Geocoding with <code>ggmap</code></h2>
<p>We now have an object with the basic structure needed to geocode the locations. However, if you run <code>mutate_geocode()</code> on the <code>cities</code> object as it is, you will receive an error. The error is a good example of a common frustration with coding. Computers are picky, and because humans also write flawed code, bugs exist, making computers picky in odd ways. In this case, we are running into a problem in which the <code>mutate_geocode()</code> function will not work on tibbles. As noted in my previous post, <a href="http://r4ds.had.co.nz/tibbles.html">tibbles</a> are a special kind of data frame used by the <code>tidyverse</code> set of packages. It is usually easier to work with tibbles in the <a href="https://www.tidyverse.org">tidyverse</a> workflow, but here it is necessary to convert the tibble to a standard data frame object with <code>as.data.frame()</code>. I give the result a new name to distinguish it from the <code>cities</code> tibble.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">cities_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(cities)</span></code></pre></div>
<p>The locations data from the letters sent to Daniel is now ready to be geocoded. The <code>mutate_geocode()</code> function uses <a href="https://maps.google.com">Google Maps</a> to find the longitude and latitude of each location. The two necessary arguments are the data frame and the name of the column with the location data. The function can be used to find more information about each location, including the country and region, but here I just have the function return the longitude and latitude data. The function will query Google Maps, and so you must have an internet connection. This makes running the command relatively slow, especially if your data contains a large amount of locations. There is also a limit of 2,500 queries per day, so you may have to find other methods if you are geocoding thousands of locations.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">locations_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_geocode</span>(cities_df, place)</span></code></pre></div>
<p>Because <code>mutate_geocode()</code> necessitates an internet connection, is somewhat slow to run, and has a daily limit, it is not something that you want to do all the time. It is a good idea to save the results by writing the object out to a csv file. Before doing this, however, we should inspect the data and make sure everything is correct. Let’s start by printing out the <code>locations_df</code> object and see what we have.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">locations_df</span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         place       lon      lat</span></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1     Antwerp  4.402464 51.21945</span></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2     Haarlem  4.646219 52.38739</span></span>
<span id="cb8-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3   Dordrecht  4.690093 51.81330</span></span>
<span id="cb8-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4      Venice 12.315515 45.44085</span></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5       Lisse  4.557483 52.25793</span></span>
<span id="cb8-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 6    Het Vlie  5.183333 53.30000</span></span>
<span id="cb8-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 7     Hamburg  9.993682 53.55108</span></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 8       Emden  7.206010 53.35940</span></span>
<span id="cb8-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 9   Amsterdam  4.895168 52.37022</span></span>
<span id="cb8-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10      Delft  4.357068 52.01158</span></span>
<span id="cb8-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11  The Hague  4.300700 52.07050</span></span>
<span id="cb8-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 Middelburg  3.610998 51.49880</span></span>
<span id="cb8-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 13     Bremen  8.801694 53.07930</span></span></code></pre></div>
<p>At a quick glance, the result looks like what we would expect. <code>locations_df</code> is a data frame with three columns called “place,” “lon,” and “lat” with the latter two representing longitude and latitude of the location named in the first column. One thing that we might want to change, though this step is not necessary, is to convert the data frame back to a tibble, which can be done with the <code>as_tibble()</code> function.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">locations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>(locations_df)</span></code></pre></div>
<p>A quick look at the values of the longitude and latitude columns in the <code>locations</code> data would seem to indicate that the geocoding process occurred correctly. All of the longitude and latitude values are within a reasonable range given the cities in the data. However, because the data given to the Google Maps query consisted of only the names of the cities, it is always worth double checking the returned values. As anyone who has ever used Google Maps before knows, it is possible that the query could return the location of a different place that has the same name.<sup>7</sup></p>
<p>One way to check that the geocoding was done correctly is to map the locations with the <a href="https://cran.r-project.org/web/packages/mapview/index.html">mapview</a> package. Using <code>mapview</code> requires converting the <code>locations</code> tibble to yet another format. This is done with the <a href="https://cran.r-project.org/web/packages/sf/">simple features</a> package, which brings us to the world of GIS with R. The first step is to load the <code>sf</code> and <code>mapview</code> packages.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb10-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mapview)</span></code></pre></div>
<p>I will not get into the details of the <code>sf</code> package and type of objects that it creates here, but the function to transform the <code>locations</code> tibble into an <code>sf</code> object is understandable even without knowing the details. The function to make an <code>sf</code> object takes three main arguments. The first two are the data frame to be converted and the columns that contain the geographic data. This second argument uses the <code>c()</code> function to combine the “lon” and “lat” columns. The third argument determines the <a href="https://en.wikipedia.org/wiki/Spatial_reference_system">coordinate reference system (crs)</a> for the data. Here, I indicate that I want the longitude and latitude to be plotted using the World Geographic System 1984 projection, which is referenced as <a href="http://wiki.gis.com/wiki/index.php/European_Petroleum_Survey_Group">European Petroleum Survey Group (EPSG)</a> 4326. Geographic jargon aside, what matters at this stage is that EPSG 4326 is the projection used by web maps such as Google Maps.<sup>8</sup></p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">locations_sf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(locations, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lon"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>)</span></code></pre></div>
<p>With the data in the correct format, a simple call to the <code>mapview()</code> function creates an interactive map with all the locations plotted as points. You can click on a point to see its name and compare it to the locations on the map. With this data, the accuracy of the location only needs to be at the city level. The location within the city is not relevant. Inspecting the data from the map shows that all of the locations were correctly geocoded.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapview</span>(locations_sf)</span></code></pre></div>
<iframe width="750" height="350" src="img/locations-mapview.html">
</iframe>
<p>I can now save the locations data using the <code>readr</code> package and a function similar to that used to load data. I will use the <code>write_csv()</code> function to save the data as a csv file. Here, I save the <code>locations</code> tibble, but you could also save the other forms of the locations data. The second argument tells the function where to save the csv and what to call the file. Here, I place the file in the same folder as the “correspondence-data-1585.csv” and name the file “locations.csv”.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_csv</span>(locations, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/locations.csv"</span>)</span></code></pre></div>
</section>
<section id="mapping" class="level2">
<h2 class="anchored" data-anchor-id="mapping">Mapping with <code>ggmap</code></h2>
<p>Now that we have successfully geocoded the locations from which Daniel’s correspondents sent letters and in which Daniel received them, we can move on to the task of plotting the locations on a map with <code>ggmap</code>.<sup>9</sup> <code>ggmap</code> is essentially an extension of <code>ggplot</code>. It enables you to plot a map as the background of a <code>ggplot</code> graph. The two main plotting features of <code>ggmap</code> are the <code>get_map()</code> function, which downloads a map from a specified map provider, and the <code>ggmap()</code> function that plots the downloaded map on a <code>ggplot</code> plot. Once a map is downloaded and plotted, it is then possible to use the normal grammar of <code>gglot</code> to visually represent that data on the map.</p>
<p>The <code>get_map()</code> function can access data from three different map providers: <a href="http://maps.google.com">Google Maps</a>, <a href="http://www.openstreetmap.org">Open Street Maps</a>, and <a href="http://maps.stamen.com/">Stamen Maps</a>. In this example, I will use Google Maps and the <code>get_googlemap()</code> function. The challenge with the <code>get_map()</code> function is downloading a map with a zoom level and location that shows all of the data with minimal extra space. We need two pieces of information to do this for <code>get_googlemap()</code>: a location for the center of the map and a zoom level between 1 and 21.<sup>10</sup> Figuring out the best center and zoom level for a map may take some trial and error. However, the work that we have already done can help to make an educated first guess. We can rerun <code>mapview(locations_sf)</code> and look at the details provided by the map. The map produced by <code>mapview()</code> shows the longitude and latitude at your cursor position and tells the zoom level of the map. We can use the cursor to guess a good center of the map or zoom in to find a city, which we can then geocode. After a couple of tries, I found that Mannheim, Germany works as a good center for a map with a zoom level of 6. I can get the coordinates of Mannheim with the generic <code>geocode()</code> function and then place the coordinates into the <code>get_googlemap()</code> function. The only alteration that needs to be made is to glue together the longitude and latitude values into one object with the concatenate function, <code>c()</code>.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geocode</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mannheim"</span>)</span>
<span id="cb14-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;        lon      lat</span></span>
<span id="cb14-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 8.466039 49.48746</span></span>
<span id="cb14-4"></span>
<span id="cb14-5">map <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_googlemap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">49.5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zoom =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span></code></pre></div>
<p>We can look at what the map looks like by calling the <code>ggmap()</code> function.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggmap</span>(map)</span></code></pre></div>
<div id="fig-map" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/geocoding-with-r/img/google-map.png" id="fig-map" class="img-fluid quarto-figure quarto-figure-center anchored figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
</figcaption>
</figure>
</div>
<p>Given the historical nature of the data, some of the normal features of a Google Map are problematic. The modern road system obviously did not exist in the sixteenth century, nor are the modern political boundaries useful for the data. In the below command, I change the aesthetics of the original map using the color argument and turn off features of the map by using commands from the <a href="https://developers.google.com/maps/documentation/staticmaps/">Google Maps API</a>.</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">bw_map <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_googlemap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">49.5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zoom =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,</span>
<span id="cb16-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bw"</span>,</span>
<span id="cb16-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"feature:road|visibility:off&amp;style=element:labels|visibility:off&amp;style=feature:administrative|visibility:off"</span>)</span></code></pre></div>
<p>Now let’s see what the map looks like, but this time let’s add the location data. This is done using the normal <code>ggplot</code> functions. Here, I want to add points for each place in the <code>locations</code> data that we created above. The <code>aes()</code> function within <code>geom_point()</code> tells <code>ggplot</code> that the x-axis corresponds to the longitude and the y-axis to the latitude of each place.</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggmap</span>(bw_map) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> locations, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lat))</span></code></pre></div>
<div id="fig-locations" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-locations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/geocoding-with-r/img/locations-map.png" id="fig-locations" class="img-fluid quarto-figure quarto-figure-center anchored figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-locations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
</figcaption>
</figure>
</div>
<p>The resulting map is rather sparse and does not provide much information, but it gives a good starting point from which to build a more informative map.</p>
</section>
<section id="adding-data" class="level2">
<h2 class="anchored" data-anchor-id="adding-data">Adding data with <code>dplyr</code></h2>
<p>The above map used the <code>locations</code> data to plot Daniel van der Meulen’s correspondence in 1585, but because it did not use the <code>letters</code> data, the map could not tell us anything about the number of letters sent from or received in each location. Visualizing this information is a two-step process. Firstly, it is necessary to find out how many letters were sent from and received in each location. Because we need to distinguish between sent and received locations, this data will be contained in two data frames. To do this, we can reuse the <code>per_source</code> and <code>per_destination</code> code discussed in the <a href="https://jessesadler.com/post/excel-vs-r/##the-pipe">previous post</a>, which summarizes the amount of letters sent from and to each location. Secondly, we have to join the longitude and latitude information from the <code>locations</code> data frame to the <code>per_source</code> and <code>per_destination</code> data frames.</p>
<p>As a reminder, to create the <code>per_source</code> and <code>per_destination</code> objects I will use the <code>group_by()</code> and <code>summarise()</code> workflow. This groups the data by one or more defined variables and creates a new column that counts the number of unique observations from the variable(s). Below, I make <code>per_source</code> and <code>per_destination</code> data frames and print out the <code>per_destination</code> object to show its form.</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">per_source <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> letters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(source) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">count =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(count))</span>
<span id="cb18-5"></span>
<span id="cb18-6">per_destination <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> letters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(destination) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">count =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(count))</span>
<span id="cb18-10"></span>
<span id="cb18-11">per_destination</span>
<span id="cb18-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 5 x 2</span></span>
<span id="cb18-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   destination count</span></span>
<span id="cb18-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         &lt;chr&gt; &lt;int&gt;</span></span>
<span id="cb18-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1       Delft    95</span></span>
<span id="cb18-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2     Haarlem     8</span></span>
<span id="cb18-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3      Bremen     6</span></span>
<span id="cb18-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4   The Hague     3</span></span>
<span id="cb18-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5  Middelburg     2</span></span></code></pre></div>
<p>The <code>per_source</code> and <code>per_destination</code> data frames are in the basic structure that we want, but we need to add longitude and latitude columns to both of the objects so that they can be plotted on our map. Here, I will use a <code>left_join()</code>. As noted above, a <code>left_join()</code> only keeps the observations from the first data frame in the function. In other words, the result of a <code>left_join()</code> will have the same number of rows as the original left data frame, while adding the longitude and latitude columns from the <code>locations</code> data frame. The data frames will be joined by the columns containing the name of the cities. Because these “key” columns have different names, it is again necessary to denote their equivalency with <code>c()</code>. Below, I print out the newly created <code>geo_per_destination</code> data frame to show its structure.</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">geo_per_source <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(per_source, locations, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"place"</span>))</span>
<span id="cb19-2">geo_per_destination <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(per_destination, locations, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"destination"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"place"</span>))</span>
<span id="cb19-3"></span>
<span id="cb19-4">geo_per_destination</span>
<span id="cb19-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 5 x 4</span></span>
<span id="cb19-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   destination count      lon      lat</span></span>
<span id="cb19-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;         &lt;chr&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb19-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1       Delft    95 4.357068 52.01158</span></span>
<span id="cb19-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2     Haarlem     8 4.646219 52.38739</span></span>
<span id="cb19-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3      Bremen     6 8.801694 53.07930</span></span>
<span id="cb19-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4   The Hague     3 4.300700 52.07050</span></span>
<span id="cb19-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5  Middelburg     2 3.610998 51.49880</span></span></code></pre></div>
<p>I now have the necessary data to create a map that will distinguish between the sources of the letters and their destinations and will allow me to show the quantities of letters sent from and received in each location.</p>
</section>
<section id="mapping-data" class="level2">
<h2 class="anchored" data-anchor-id="mapping-data">Mapping the data</h2>
<p>Creating a quality visualization with <code>ggplot</code> involves iteration. Because the different parts of the plot are all written out in code, aspects can be added, subtracted, or modified until a good balance is found. Let’s start by creating a basic map using the <code>geo_per_source</code> and <code>geo_per_destination</code> data. The structure of the command is similar to that used to make the first map, but now that I am using information from two data frames, I need to use two <code>geom_point()</code> functions. There is also a small change to the <code>ggmap()</code> function to have the map take up the entire plotting area so that the longitude and latitude scales do not show. The only change to the <code>geom_point()</code> function is the addition of different colors for the two sets of points. This makes it easier to distinguish between places from which Daniel’s correspondents sent letters and places where he received them. Notice that the argument for the color of the points is placed outside of the <code>aes()</code> function. This makes all of the points plotted from each data frame a single color as opposed to mapping a change in color to a variable within the data. In this instance, I chose to specify color by name, but it is also possible to use rgb values, hex values, or a number of different color palettes.<sup>11</sup></p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggmap</span>(bw_map) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> geo_per_destination,</span>
<span id="cb20-3">             <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lat), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> geo_per_source,</span>
<span id="cb20-5">             <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lat), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>)</span></code></pre></div>
<div id="fig-data1" class="quarto-float quarto-figure quarto-figure-center anchored" width="600px" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-data1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/geocoding-with-r/img/data-map1.png" id="fig-data1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" width="600">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-data1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
</figcaption>
</figure>
</div>
<p>This plot is much better than what we started with, but it still has a couple of issues. In the first place, it does not communicate any information about the quantity of letters. In addition, because the points are opaque, it is not clear that letters were both sent from and to Haarlem. The former issue can be rectified by using the size argument within the <code>aes()</code> function. This will tell <code>ggplot</code> to vary the size of each of the points in proportion to the count column. By default, the size aesthetic creates a legend to indicate the scale used. In the <code>ggmap()</code> function I place the legend in the top right corner of the map since there are no data points there. The latter issue is solved by adding an alpha argument to the two <code>geom_point()</code> functions. This argument is placed outside of the <code>aes()</code> function, because it is an aspect we want to apply to all points. <a href="https://www.w3schools.com/css/css3_colors.asp">Alpha</a> describes the translucency of an object and takes values between 1 (opaque) and 0 (translucent).</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggmap</span>(bw_map) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> geo_per_destination,</span>
<span id="cb21-3">             <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> count),</span>
<span id="cb21-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> geo_per_source,</span>
<span id="cb21-6">             <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> count),</span>
<span id="cb21-7">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span></code></pre></div>
<div id="fig-data2" class="quarto-float quarto-figure quarto-figure-center anchored" width="600px" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-data2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/geocoding-with-r/img/data-map2.png" id="fig-data2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" width="600">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-data2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
</figcaption>
</figure>
</div>
<p>The above map is more informative, but it is hardly a finished product. For instance, there is no explanation for the differences in the color of the points, the smallest points are not easy to see, and there are no labels to indicate the names of the cities. Let’s deal with these issues one at a time to create a more fully fleshed out map. This will serve as an opportunity to demonstrate both the flexibility and complexity of <code>ggplot</code> code.<sup>12</sup></p>
<p>The different colors for sent and received locations are not defined in a legend in the previous plot, because <code>ggplot</code> only creates a legend for arguments within an <code>aes()</code> function. Even though the color does not change within the data for each <code>geom_point()</code> function, it is possible to place the color in the <code>aes()</code> function when used in tandem with <code>scale_color_manual()</code>. Inside the <code>aes()</code> function the color is associated with a name that will appear in the legend. The actual color to be used is defined in a separate <code>scale_color_manual()</code> function with the values argument.<sup>13</sup></p>
<p>A similar type of scale function also makes it possible to manually control the minimum and maximum size of the points drawn by the <code>size = count</code> argument within the <code>aes()</code> functions. For this last plot, I decided to make the minimum size of the point 2 and the maximum size 9. The range of the sizes for points is a good example of a plot element that you can play around with, trying out different sizes until you find one that works. Note too, that the best sizes of plot elements will also depend on the format in which the finished plot will be presented.</p>
<p>In changing the background map from the default Google Map, I took out the city labels, but this makes it difficult to know which cities are represented by the different points. The plot only contains fourteen points, making it possible to label each point without too much clutter. In <code>ggplot</code>, <a href="http://r4ds.had.co.nz/graphics-for-communication.html#annotations">labels are geoms</a>; they are distinct elements placed on a plot with separate geom functions. Labeling points can be done with either <code>geom_text()</code> or <code>geom_label()</code>. <code>geom_text()</code> places text at the indicated position, while <code>geom_label()</code> places the text within a white text box. In addition to x and y coordinates, the two geoms require a <code>label</code> argument, which indicates the variable that should be used for the text. By default <code>geom_text()</code> and <code>geom_label()</code> are placed exactly on the x and y coordinates given by the data. It is possible to nudge the placement of the labels with the <code>nudge_x</code> and <code>nudge_y</code> arguments. However, instead of using these, I will take advantage of the <code>geom_text_repel()</code> function from the <code>ggrepel</code> package. This package automatically chooses the placement of individual labels to ensure that they do not overlap. Note too that I use the <code>locations</code> data frame for the data of the geom, since <code>locations</code> contains the longitude and latitude of each point on the map.</p>
<p>The final touches to the map can be made by ensuring that all of the elements are clearly noted. <a href="http://r4ds.had.co.nz/graphics-for-communication.html#label">Labels for the plot itself</a> can be made with the <code>labs()</code> function. For this plot, I will add a descriptive title and change the labels for the two legends. By default, <code>ggplot</code> uses the name of the indicated column as the label for the legend. This is shown in the above map, where the size of the point is labeled as “count.” The default label can be replaced with a more informative one by indicating the aesthetic to be changed. Here, I will rename the size aesthetic as “Letters.” In addition, I chose not to have a label for the color aesthetic, which is indicated by “NULL”. Finally, I altered the size of the points drawn in the color legend to a larger size. <a href="http://r4ds.had.co.nz/graphics-for-communication.html#legend-layout">This is done with the <code>guides()</code> function</a>, which changes the scales of different aspects of the plot. In this case, I use the <code>override.aes</code> argument to have the red and purple points in the legend be drawn at <code>size = 6</code>.</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggrepel)</span>
<span id="cb22-2"></span>
<span id="cb22-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggmap</span>(bw_map) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> geo_per_destination,</span>
<span id="cb22-5">             <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> count, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Destination"</span>), </span>
<span id="cb22-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> geo_per_source,</span>
<span id="cb22-8">             <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> count, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source"</span>),</span>
<span id="cb22-9">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Destination =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Source =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text_repel</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> locations, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> place)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correspondence of Daniel van der Meulen, 1585"</span>,</span>
<span id="cb22-14">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters"</span>,</span>
<span id="cb22-15">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">override.aes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)))</span></code></pre></div>
<div id="fig-data3" class="quarto-float quarto-figure quarto-figure-center anchored" width="600px" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-data3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.jessesadler.com/post/geocoding-with-r/img/data-map3.png" id="fig-data3" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" width="600">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-data3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
</figcaption>
</figure>
</div>
</section>
<section id="concluding" class="level2">
<h2 class="anchored" data-anchor-id="concluding">Conclusion</h2>
<p>The above map demonstrates the geographic spread of Daniel van der Meulen’s correspondence in 1585 and shows the relative significance of the location of his correspondents and the different places in which he received letters throughout the year. More important than the details of the map for the purposes of this post is the process by which it was created. One interesting feature that I would like to emphasize in concluding is that the map uses data from three different data frames or tables: <code>geo_per_destination</code>, <code>geo_per_source</code>, and <code>locations</code>. All three of these data frames derive from the original <code>letters</code> data, while they in turn were the product of yet more data frames. By my count, running the commands contained in this post leads to the creation of 12 different data frame like objects. The below diagram outlines the workflow. The ability to split, subset, transform, and then join newly created tables in a variety of ways is a very powerful and flexible workflow. Because the data frames can be recreated by running the code, there is minimal overhead in managing them, especially in comparison to creating tables within spreadsheets. In this case, I would only recommend that the <code>locations</code> data frame be saved for easy access in other R scripts and sessions. The other objects can be created on demand, or even more can be added, while the individual aspects of the map can be endlessly tweaked using the power of <code>ggplot</code>.</p>
<p><img src="https://www.jessesadler.com/post/geocoding-with-r/img/workflow-diagram.png" class="img-fluid"></p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Geocoding can be done with websites such as <a href="http://www.geonames.org">geonames</a> and the service provided by <a href="http://geoservices.tamu.edu/Services/Geocode/">Texas A&amp;M</a>. There are also a number of <a href="http://crln.acrl.org/index.php/crlnews/article/view/16772/18314">options for creating maps on the web</a>.↩︎</p></li>
<li id="fn2"><p>See the Introduction of <a href="https://bookdown.org/robinlovelace/geocompr/">Robin Lovelace, Jakub Nowosad, and Jannes Meunchow, <em>Geocomputation with R</em></a> for a good overview of the GIS capabilities of R.↩︎</p></li>
<li id="fn3"><p><a href="https://www.cdrc.ac.uk/wp-content/uploads/2016/04/AS_EstablishingAFrameworkforOpenGIS.pdf">Alex David Singleton, Seth Spielman, and Chris Brunsdon, “Establishing a Framework for Open Geographic Information Science,”</a> <em>International Journal of Geographical Information Science</em>, 30 (2016): 1507-1521.↩︎</p></li>
<li id="fn4"><p>A full list of geographic packages for R can be found at <a href="https://cran.r-project.org/web/views/Spatial.html">R Packages for the Analysis of Spatial Data</a>. In future posts I will discuss some of these packages and their capabilities.↩︎</p></li>
<li id="fn5"><p>In this command the quotations around “source” and “destination” are necessary. They tell the function that these are strings of characters.↩︎</p></li>
<li id="fn6"><p>It is good practice to stay away from overwriting objects until you know whether the code works. However, if you mess up, it is always possible to recreate the original object by rerunning the code that created it.↩︎</p></li>
<li id="fn7"><p>For instance, geocoding “Naples” will return the longitude and latitude of Naples, Florida and not Naples, Italy.↩︎</p></li>
<li id="fn8"><p>If you want to get an idea of how an <code>sf</code> object differs from a normal tibble or data frame, you can print out the <code>locations_sf</code> object. This shows that the longitude and latitude columns have been combined into a special type of column called <code>simple_feature</code> and named “geometry”, while additional information about the CRS is also provided.↩︎</p></li>
<li id="fn9"><p>For a fuller discussion of <code>ggmap</code>, see <a href="https://journal.r-project.org/archive/2013-1/kahle-wickham.pdf">David Kahle and Hadley Wickham, “ggmap: Spatial Visualization with ggplot2.”</a>↩︎</p></li>
<li id="fn10"><p>A zoom level of 1 is the most zoomed out, while 21 is the most zoomed in.↩︎</p></li>
<li id="fn11"><p><a href="https://www.w3schools.com/colors/default.asp">W3 Schools has a good discussion on the use of rgb and hex colors</a>. For the use of colors with <code>ggplot</code>, see Hadley Wickham, <em>ggplot2: Elegant Graphics for Data Analysis</em>, Second edition (Springer, 2016), 133–145. A full list of the named colors available in R can be found <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">here</a>↩︎</p></li>
<li id="fn12"><p>For a full discussion of the powers of <code>ggplot</code>, see <a href="http://www.springer.com/us/book/9783319242750">Wickham, <em>ggplot2</em></a>.↩︎</p></li>
<li id="fn13"><p>Wickham, <em>ggplot</em>, 142–143.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>rstats</category>
  <category>rspatial</category>
  <guid>https://www.jessesadler.com/post/geocoding-with-r/</guid>
  <pubDate>Fri, 13 Oct 2017 04:00:00 GMT</pubDate>
  <media:content url="https://www.jessesadler.com/post/geocoding-with-r/img/data-map3.png" medium="image" type="image/png" height="115" width="144"/>
</item>
<item>
  <title>Excel vs R: A Brief Introduction to R</title>
  <link>https://www.jessesadler.com/post/excel-vs-r/</link>
  <description><![CDATA[ <p>Quantitative research often begins with the humble process of counting. Historical documents are never as plentiful as a historian would wish, but counting words, material objects, court cases, etc. can lead to a better understanding of the sources and the subject under study. When beginning the process of counting, the first instinct is to open a spreadsheet. The end result might be the production of tables and charts created in the very same spreadsheet document. In this post, I want to show why this spreadsheet-centric workflow is problematic and recommend the use of a programming language such as <a href="https://www.r-project.org">R</a> as an alternative for both analyzing and visualizing data. There is no doubt that the learning curve for R is much steeper than producing one or two charts in a spreadsheet. However, there are real long-term advantages to learning a dedicated data analysis tool like R. Such advice to learn a programming language can seem both daunting and vague, especially <a href="https://jessesadler.com/post/new-kinds-of-projects/">if you do not really understand what it means to code</a>. For this reason, after discussing why it is preferable to analyze data with R instead of a spreadsheet program, this post provides a brief introduction to R, as well as an example of analysis and visualization of historical data with R.<sup>1</sup></p>
<p>The draw of the spreadsheet is strong. As I first thought about ways to keep track of and analyze the thousands of letters in the <a href="https://jessesadler.com/project/dvdm-correspondence/">Daniel van der Meulen Archive</a>, I automatically opened up <a href="https://www.apple.com/numbers/">Numbers</a> — the spreadsheet software I use most often — and started to think about what columns I would need to create to document information about the letters. Whether one uses Excel, Numbers, Google Sheets or any other spreadsheet program, the basic structure and capabilities are well known. They all provide more-or-less aesthetically pleasing ways to easily enter data, view subsets of the data, and rearrange the rows based on the values of the various columns. But, of course, spreadsheet programs are more powerful than this, because you can add in your own programatic logic into cells to combine them in seemingly endless ways and produce graphs and charts from the results. The spreadsheet, after all, was <a href="https://en.wikipedia.org/wiki/VisiCalc">the first killer app</a>.</p>
<p><a href="https://giphy.com/gifs/11qAyKz9AbFEYM/html5">With great power, there must also come great responsibility</a>. Or, in the case of the spreadsheet, with great power there must also come great danger. The danger of the spreadsheet derives from its very structure. The mixture of data entry, analysis, and visualization makes it easy to confuse cells that contain raw data from those that are the product of analysis. The nature of defining programatic logic — such as which cells are to be added together — by mouse clicks means that a mistaken click or drag action can lead to errors or the overwriting of data. You only need to think about the dread of the moment when you go to close a spreadsheet and the program asks whether you would like to save changes. It makes you wonder. Do I want to save? What changes did I make? Because the logic in a spreadsheet is all done through mouse clicks, there is no way to effectively track what changes have been made either in one session or in the production of a chart. Excel mistakes can have wide-ranging consequences, as the controversy around the paper of <a href="https://www.marketplace.org/2013/04/17/economy/excel-mistake-heard-round-world" title="The Excel mistake heard round the world">Carmen Reinhart and Kenneth Rogoff on national debt made clear</a>.<sup>2</sup></p>
<p>There are certainly legitimate reasons why people default to using spreadsheets for data analysis instead of using a programming language like R. Spreadsheets are much more inviting and comforting than any programming language could ever be to a newcomer. Learning how to program is intimidating and not something that can be done either quickly or easily. <a href="https://en.wikipedia.org/wiki/Graphical_user_interface">Graphical user interface (GUI)</a> applications are simply less daunting than a <a href="https://en.wikipedia.org/wiki/Command-line_interface">command-line interface</a>. Secondly, spreadsheets are a good tool for data entry, and it is tempting to simply move on to data analysis, keeping everything in the same document. Finally, the interactive nature of spreadsheets and the ability to create charts that change based on inputs is very attractive, even if fully unlocking this potential involves quite complex knowledge about how the program works. The first advantage of spreadsheets over programming is not easily overcome, but the latter two are built on what I believe to be a problematic workflow. Instead of using a couple of monolithic applications — often a office suite of applications — to do everything, I think that it is better to split up the workflow among several applications that <a href="https://en.m.wikipedia.org/wiki/Unix_philosophy">do one thing well</a>.</p>
<p>Creating a clear division between data entry and analysis is a major reason why analyzing data in a programming language is preferable to spreadsheet software. I still use spreadsheets, but their use is strictly limited to data entry.<sup>3</sup> In a spreadsheet program the analysis directly manipulates the only copy of the raw data. In contrast, with R you import the data, creating an object that is a copy of the raw data.<sup>4</sup> All manipulations to the data are done on this copy, and the original data are never altered in any way. This means that there is no way to mess up the raw data. Manipulating a copy of the data enables you to more freely experiment. All mistakes are basically inconsequential, even if they can be frustrating. A line of code that fails to produce the expected result can be tweaked and rerun — with the process repeated many times if necessary — until the expected result is returned.</p>
<p>Working on a copy of the raw data can even simplify the process of data entry. Analyzing tabular data in R results in the creation of multiple objects, which are referred to as <strong>data frames</strong> and can be thought of as equivalent to tables in a spreadsheet.<sup>5</sup> The ability to split, subset, and transform the original data set into many different data frames has the benefit of drastically reducing the complexity of data entry. Instead of needing bespoke spreadsheets with multiple interrelated sheets and tables, every piece of data only needs to be entered once and all manipulations can be done in code. The different data frames that are created in the process of analysis do not even have to be saved, because they are so easily reproduced by the script of code.</p>
<p>The separation of data entry and data analysis severely reduces the potential for mistakes, but maybe even more significantly, the use of code for data analysis enables the creation of <a href="https://cran.r-project.org/web/views/ReproducibleResearch.html">reproducible research</a> that is simply not possible in spreadsheets. Reproducible research has been a <a href="http://science.sciencemag.org/content/348/6242/1403.full">hot button issue in the sciences</a>, but there is no reason why research in the humanities should not strive to be reproducible where possible. With a programming language, the steps of the analysis can be clearly laid out in the code. The <a href="http://r4ds.had.co.nz/workflow-projects.html#what-is-real">“truth” of the analysis is the code</a>, not the objects or visuals that the code creates. Saving analysis in code has the immediate benefit that it can be easily rerun anytime that new data is added. Code can also be applied to a completely new data set in a much more transparent manner than with spreadsheets. The long-term benefit is that with code all analysis is documented instead of being hidden behind mouse clicks. This makes it easier for you to go over your own analyses long after you have finished with it, as well as for others to understand what you did and check for errors.</p>
<section id="a-brief-introduction-to-r" class="level2"><h2 class="anchored" data-anchor-id="a-brief-introduction-to-r">A Brief Introduction to R</h2>
<p>If you have never read or written any code before, it is difficult to know what the theoretical differences between spreadsheets and coding mean in practice.<sup>6</sup> Therefore, I want to provide an example of analyzing and visualizing data in R. I will use the example of letters sent to Daniel van der Meulen in 1585, which is a subset of the data from my project on the <a href="https://jessesadler.com/project/dvdm-correspondence/">correspondence of Daniel van der Meulen</a>. Before getting to the analysis, I will give a very brief introduction to R and define some key terms in order to make it more possible for anyone who has never used R or coded before to follow along. This is not meant to be a full-scale tutorial, so much as an introduction to what code in R looks like.<sup>7</sup></p>
<p>R is an open-source programming language, which can be <a href="https://cloud.r-project.org">freely downloaded</a>. Opening the downloaded program will lead you to a command-line interface devoid of any clues for what a novice should do next. Thankfully, there is a freely available application, or <a href="https://en.wikipedia.org/wiki/Integrated_development_environment">IDE</a>, called <a href="https://www.rstudio.com/products/rstudio">RStudio</a>, which provides a number of features to help write code. It is very much recommended to write your R code in RStudio. RStudio also has a plethora of <a href="https://www.rstudio.com/online-learning/">online tutorials</a> on their website to help you get familiar with both R and the RStudio IDE.</p>
<p>In either R or RStudio, the command line or <strong>console</strong> is where all of the action takes place. It is here that you enter and run the code. The foundation of working in R is the process of creating and manipulating objects of various sorts. <strong>Objects</strong> are assigned names with the assignment operator <code>&lt;-</code>. Thus, if I want to assign the name x the value of 5, I write <code>x &lt;- 5</code> into the console and press return.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span></code></pre></div>
</div>
<p>Nothing is printed when this operation is run, but now, if I type <code>x</code> into the console and hit return, the value of x will be printed. Alternatively, I could have explicitly called for the object <code>x</code> to be printed with the command <code>print(x)</code>. The result is the same with either method.<sup>8</sup></p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 5</span></span></code></pre></div>
</div>
<p>The power of R comes with the manipulation of objects through the use of functions. <strong>Functions</strong> take in objects, possibly with a list of arguments to specify how the function works, and return another object. The objects and instructions for the functions are included within parentheses following the function name, and all instructions are separated by a comma.<sup>9</sup> You can think of objects as nouns and functions as verbs. A simple example with the <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> function demonstrates how functions work. <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> does exactly what you would think. It takes a series of objects and returns their sum. You can see the function’s documentation by entering <code>?sum()</code> on the console.<sup>10</sup> The result of the <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> function can either be immediately printed to the console, or it can be saved by assigning it a name. Below, I assign the result of <code>x + 10</code> a name and then in a second command print out the value of the newly created object.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">y</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">y</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 15</span></span></code></pre></div>
</div>
<p>The flexibility of coding enables objects to be redefined endlessly. If a mistake is made or the data changes, the command can be rerun with the new values. For instance, if the value of <code>x</code> changes from 5 to 15 in the data, I can simply change the code for creating the <code>x</code> object and reassign the value of <code>x</code>. Below, I do this and then rerun the same <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> command, but this time I print the result directly to the console instead of assigning it to the object <code>y</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 25</span></span></code></pre></div>
</div>
<p>Once you get a command that produces the expected result, you can save the command to an R script. A <strong>script</strong> is a text file with a suffix of .R, which you can save. Thus, you could save the commands to create the objects <code>x</code> and <code>y</code> to a file called <code>my_script.R</code>. The script will then be available to you whenever you want to rerun the code in the console.</p>
</section><section id="r-packages-the-tidyverse" class="level2"><h2 class="anchored" data-anchor-id="r-packages-the-tidyverse">R Packages: The tidyverse</h2>
<p>Upon download, R comes with a large number of functions, which together are referred to as base R. However, the capabilities of R can be greatly extended through the use of additional packages, which can be downloaded through <a href="https://cran.r-project.org">The Comprehensive R Archive Network (CRAN)</a>. Packages both extend what is possible in R and provide alternative ways to do things possible in base R. This can be confusing, because it means there are often a plethora of ways to do a single operation, but the extension in capability is well worth it. Particularly significant are the packages bundled together in the <code>tidyverse</code> package that were built by <a href="http://hadley.nz">Hadley Wickham</a> and collaborators. The <a href="https://www.tidyverse.org">tidyverse</a> provides a set of linked packages that all use a similar grammar to work with data. The tidyverse is <a href="http://varianceexplained.org/r/teach-tidyverse/">the best place to start if you are new to R</a>.</p>
<p>The examples below show the ability to analyze and visualize data using the tidyverse packages. The analysis will mainly be done with the <a href="http://dplyr.tidyverse.org">dplyr package</a> and the visualization is done with <a href="http://ggplot2.tidyverse.org">ggplot</a>. The <strong>dplyr</strong> functions all have a similar structure. The main <code>dplyr</code> verbs or functions are <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>. All take a data frame as their first argument. The next set of arguments are the column names on which the function performs its actions. The result of the functions is a new data frame object. The <code>dplyr</code> functions can be linked together, so that it is possible to perform multiple manipulations on a data frame in one command. This is done with the use of the pipe, which in R is <code>%&gt;%</code>.<sup>11</sup></p>
<p>The commands needed to produce a <strong>ggplot</strong> graph can be confusing at first, but the advantages of <code>ggplot</code> are that it is based on a <a href="http://vita.had.co.nz/papers/layered-grammar.pdf">grammar of graphics</a>, which provides a systematic way to discuss graphs, and that <code>ggplot</code> comes with good defaults, enabling the creation of nice looking graphs with minimal code. The two main components of <code>ggplot</code> are geoms and the mapping of aesthetics. <strong>Geoms</strong> tell <code>ggplot</code> what kind of visual graphic to make, so there are separate geom functions for bar charts, points, lines, etc. <strong>Aesthetics</strong> tell <code>ggplot</code> which columns of the data to use for placement on the graph and for any other distinguishing aspects of these variables such as size, shape, and color. The graphs below are used to show some of the possibilities of <code>ggplot</code> while staying mainly within the defaults. Publication ready visualizations are possible with <code>ggplot</code>, but this would take more fiddling.<sup>12</sup></p>
</section><section id="an-example-analyzing-a-correspondence-network" class="level2"><h2 class="anchored" data-anchor-id="an-example-analyzing-a-correspondence-network">An Example: Analyzing a correspondence network</h2>
<p>With this basic overview of R out of the way, let’s move on to an example of an actual analysis of historical data to see what analysis and visualization in R looks like in practice. The data and an R script with all of the code can be found on <a href="https://github.com/jessesadler/intro-to-r">my GitHub page</a>, if you would like to run the code yourself.</p>
<p>Before doing anything with the data, it is necessary to set up our environment in R. This means loading the packages that we will be using with the <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> command. To begin we only need to load the <code>tidyverse</code> package, which includes the individual packages that I will use for the analysis.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Once this is done, it is possible to use the functions from the tidyverse packages, beginning with reading our data into R with the <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> function. The code below takes a <a href="https://en.wikipedia.org/wiki/Comma-separated_values">csv file</a> from a location on my computer and loads it into R as a data frame, while saving the object under the name <code>letters</code>.<sup>13</sup> The code can be read as “create a data frame object called <code>letters</code> from the csv file named <code>correspondence-data-1585.csv</code>.”</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/correspondence-data-1585.csv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Even before anything has been done to manipulate the data, we are already in a better position than if we kept the data in Excel. Having loaded the data, all further manipulations will be done on the object <code>letters</code>, and no changes will be made to the <code>correspondence-data-1585.csv</code> file. In other words, there is no way to tamper with the database that may have taken hours (or more) to meticulously produce.</p>
<p>Let’s start by taking a look at the data itself by printing out a subset of the data to the console, which can be done by typing the name of the object into the console.<sup>14</sup></p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 114 × 4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    writer                  source  destination date      </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;chr&gt;                   &lt;chr&gt;   &lt;chr&gt;       &lt;date&gt;    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Meulen, Andries van der Antwerp Delft       1585-01-03</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Meulen, Andries van der Antwerp Haarlem     1585-01-09</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Meulen, Andries van der Antwerp Haarlem     1585-01-11</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Meulen, Andries van der Antwerp Delft       1585-01-12</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Meulen, Andries van der Antwerp Haarlem     1585-01-12</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Meulen, Andries van der Antwerp Delft       1585-01-17</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Meulen, Andries van der Antwerp Delft       1585-01-22</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Meulen, Andries van der Antwerp Delft       1585-01-23</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Della Faille, Marten    Antwerp Haarlem     1585-01-24</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Meulen, Andries van der Antwerp Delft       1585-01-28</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # … with 104 more rows</span></span></code></pre></div>
</div>
<p>This tells us that <code>letters</code> is a <a href="http://r4ds.had.co.nz/tibbles.html">tibble</a>, which is a special kind of data frame meant to work well in the tidyverse. Though not necessarily aesthetically pleasing, the basic shape of a table of data is clear.<sup>15</sup> The command printed out the first ten rows, while informing us that the complete data set contains 114 rows. Each letter has four pieces of information or variables: the writer of the letter, the place from which it was sent, the place to which it was sent, and the date sent. Below the column headings of writer, source, destination, and date we are informed of the type of data for each variable. This shows that the first three columns consist of character strings (chr), meaning that the data is words, while the last column contains dates, which is discussed in greater detail below.</p>
</section><section id="creating-new-data-frames" class="level2"><h2 class="anchored" data-anchor-id="creating-new-data-frames">Creating new data frames</h2>
<p>Now that we have an idea of the basic structure of the data, it is possible to begin to analyze it. A simple question that is fairly difficult to answer in Excel — at least I do not know how to do it other than by hand — is how many different people wrote letters to Daniel during this period. The below gives a list of the writers of letters. The code is a good demonstration of basic structure of <code>dplyr</code> functions. The function <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> takes a data frame, followed by the name of the column that I am interested in, returning a new data frame object with one column, which consists of the unique values from the original column.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">writer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 12 × 1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    writer                        </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;chr&gt;                         </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Meulen, Andries van der       </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Della Faille, Marten          </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Della Faille, Jacques         </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Staten van Brabant            </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Della Faille, Joris           </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Eeckeren, Robert van          </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Anraet, Thomas                </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Burgemeesters of Antwerp      </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Wale, Jan de                  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Calvart, Jacques              </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11 Janssen van der Meulen, Peeter</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 Noirot, Jacques</span></span></code></pre></div>
</div>
<p>Because I did not assign the output a name, the results simply printed to the console. Saving the object requires the use of the assignment operator and choosing a memorable name. With this relatively simple operation I have created my first new data frame, which I can now refer to and further manipulate by calling to <code>writers</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">writers</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">writer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Printing out the object shows that there are 12 people who sent Daniel letters in 1585, but another way to get this information is to run the <code><a href="https://rdrr.io/r/base/nrow.html">nrow()</a></code> function, which returns the number of rows in a data frame. It is possible to run the function on either the <code>writers</code> data frame, or to use the command that created the <code>writers</code> data frame. Let’s do the latter and print the result to the console. If you happen to forget the number of correspondents, the command can be typed again.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">writer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; [1] 12</span></span></code></pre></div>
</div>
<p>Once we run the commands and see that they produce results that are what we would expect from the data, it is possible to both save the commands in a script and also to reuse their structure for other pieces of information. For example, we can learn the locations from which Daniel’s correspondents sent letters and the locations in which he received letters by reusing the <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> function and changing the column name to be manipulated.</p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">source</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 9 × 1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   source   </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;chr&gt;    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 Antwerp  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2 Haarlem  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3 Dordrecht</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4 Venice   </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5 Lisse    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 6 Het Vlie </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 7 Hamburg  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 8 Emden    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 9 Amsterdam</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destination</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 5 × 1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   destination</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;chr&gt;      </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 Delft      </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2 Haarlem    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3 The Hague  </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4 Middelburg </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5 Bremen</span></span></code></pre></div>
</div>
<p>We can save the objects for later use by using the assignment operator and giving the data frames names.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sources</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">source</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destinations</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">destination</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
</section><section id="linking-dplyr-commands-together-with-the-pipe" class="level2"><h2 class="anchored" data-anchor-id="linking-dplyr-commands-together-with-the-pipe">Linking <code>dplyr</code> commands together with the pipe</h2>
<p>Thus far, I have created data frames with one variable that show the unique values of the different variables, but this has not told us anything about the number of letters sent by each author or from each location. Doing this is more complicated, because it is necessary to chain together a series of functions using the pipe. This is the case for the question of how many letters each correspondent sent. Looking at the <code>dplyr</code> verbs listed above you might assume that the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> function will create a sum of the data. We can use the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> function to create a new column called count that is filled with the number of observations through the <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code> function. In other words, the code below tells R to summarize the <code>letters</code> data frame and place the number of observations in a column called count.</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_correspondent</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span>, count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_correspondent</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   count</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1   114</span></span></code></pre></div>
</div>
<p>Running the command and printing the result shows a result that was not what we hoped. Instead of showing letters per correspondent, the function created a column called count with a single value equal to the amount of rows in the <code>letters</code> data frame. However, because the objects that are made in R are ephemeral, we can simply rerun the code after reworking it. This overwrites the old <code>per_correspondent</code> object with one that is more useful. In the first attempt there is no notion that the goal is to group the number of letters by writer. This is the task <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function. To create an object with correspondents in one column and the number of letters they sent in the second column we need to group the <code>letters</code> data frame by writer and then summarize the letters within each group, creating the count column while doing so. The last line of the code arranges the table in descending order of letters sent by the newly created count variable. Notice that the <code>letters</code> data frame is listed first before any function. This is because the <code>letters</code> data frame is piped into each of the functions with the use of the <code>%&gt;%</code> command, which can be read as “and then.”</p>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_correspondent</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">writer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">count</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_correspondent</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 12 × 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    writer                         count</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;chr&gt;                          &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Meulen, Andries van der           63</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Della Faille, Jacques             31</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Della Faille, Marten               6</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Staten van Brabant                 4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Noirot, Jacques                    2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Wale, Jan de                       2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Anraet, Thomas                     1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Burgemeesters of Antwerp           1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Calvart, Jacques                   1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Della Faille, Joris                1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11 Eeckeren, Robert van               1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 Janssen van der Meulen, Peeter     1</span></span></code></pre></div>
</div>
<p>Looking at the result, we can see that the above changes produced the kind output we expected. The <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> functions worked to create a data frame in which each author is listed once. The <code>count = n()</code> within the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> function created a new variable called count that is filled with the number of letters each correspondent sent. A cursory look at the results shows that the vast majority of the letters sent to Daniel were written by his brother Andries and his brother-in-law Jacques della Faille. Andries lived in the besieged city of Antwerp for most of 1585, and Jacques lived in Haarlem, so it will hardly be surprising that if we look at the amount of letters sent from each location that Antwerp and Haarlem dominate. Having written the above code, it is possible to rework it to create a data frame called <code>per_source</code>, which is done by replacing the writer column in the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function with the source variable.</p>
<div class="cell">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_source</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">source</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">count</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_source</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 9 × 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   source    count</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;chr&gt;     &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 Antwerp      76</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2 Haarlem      30</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3 Venice        2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4 Amsterdam     1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5 Dordrecht     1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 6 Emden         1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 7 Hamburg       1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 8 Het Vlie      1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 9 Lisse         1</span></span></code></pre></div>
</div>
</section><section id="visualizing-the-data-with-ggplot2" class="level2"><h2 class="anchored" data-anchor-id="visualizing-the-data-with-ggplot2">Visualizing the data with <code>ggplot2</code>
</h2>
<p>While it is nice to have the two above sets of information presented in tables, it is also possible to visualize the newly created data with <code>ggplot</code>. The structure of <code>ggplot</code> functions is a bit different than that of <code>dplyr</code>. Like <code>dplyr</code> the functions are linked together, but the linking is done with the <code>+</code> symbol instead of <code>%&gt;%</code>. With <code>ggplot2</code> the three main functions are <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, one or more <code>geom_*</code> function, which informs the type of graphical element to draw, and one or more <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> function that sets the aesthetic values of the graph. The designation of the data to use and the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> functions can be placed within either the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function, indicating that they apply to all of the geoms, or they can be placed within individual <code>geom_*</code> functions in which case they will only be used for that geom. All this is to say that there are a variety of ways to produce the same visuals. The below code adds an extra function to label the axes with <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> and uses <code><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder()</a></code> from the <a href="https://forcats.tidyverse.org/index.html"><code>forcats</code> package</a> to convert the source cities into a factor so that the bars are organized by height.</p>
<div class="cell">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_source</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">source</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">count</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">count</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, stat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters written"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/excel-vs-r/index_files/figure-html/per-source-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>One part of the above code that might be a bit difficult to figure out is <code>stat = "identity"</code>. This needs to be called, because the code to create the <code>per_source</code> data frame actually did more work than necessary. <code>stat = "identity"</code> tells <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> to set the height of the bars to the exact number in the count column. However, with <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> only the x-axis needs to be specified. The y value is then calculated automatically based on the x value. Therefore, the below code, which uses the original <code>letters</code> data frame, could produce the exact same graph. Because of this, it is little trouble to change the variable for the x-axis to writers and get a completely new graph. Notice the change in the data and the deletion of the y variable and <code>stat</code>. The data for the x-axis is again converted to a factor, but this time with <code><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq()</a></code> to automatically create and order the factor by the frequency of observations. One problem with the correspondents data is the length of the names. Therefore, this command makes changes to the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> function. The arguments in the function are used to place the correspondent names at a ninety degree angle so that they do not overlap.</p>
<div class="cell" data-fig.asp="1">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">writer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters written"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>axis.text.x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>angle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>, hjust <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, vjust <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/excel-vs-r/index_files/figure-html/per-correspondent-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="working-with-dates-lubridate" class="level2"><h2 class="anchored" data-anchor-id="working-with-dates-lubridate">Working with dates: <code>lubridate</code>
</h2>
<p>Now, let’s investigate the dates column. Dealing with dates is often tricky. To facilitate this analysis we need to load the <code>lubridate</code> package. <a href="http://lubridate.tidyverse.org/">lubridate</a> is another package created by Hadley Wickham, which fits into the tidyverse manner of dealing with data. It is not among the packages loaded with <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code>, and so it is necessary to load it separately.</p>
<div class="cell">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>Since the letters in this data set were all received in one year, it would be interesting to see how many letters Daniel received each month. This question is particularly interesting, because in 1585 Daniel’s home city of Antwerp was under siege by Spanish troops, and Daniel was serving as a representative for his city to the rebels in Holland. It is also an interesting issue of analysis, because while the <code>letters</code> data frame contains information about the month the letters were sent, there is no month column. This prevents us from using the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> workflow that we have developed. The answer comes from the <code>lubridate</code> package, which includes a function called <code><a href="https://lubridate.tidyverse.org/reference/month.html">month()</a></code>. This function extracts the month from a date object, which we know the date column is, because it is identified as such when we have printed the <code>letters</code> data frame. The goal is to create a new column called month. This is done through the <code>dplyr</code> function <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, which creates the column and then applies the <code><a href="https://lubridate.tidyverse.org/reference/month.html">month()</a></code> function to each of the dates. The remaining code is similar to that used above, but now the column we want to <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> is the newly created month column.</p>
<div class="cell">
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_month</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>month <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">date</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">month</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_month</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 12 × 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    month count</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1     1    11</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2     2    14</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3     3    18</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4     4     9</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5     5    14</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6     6     9</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7     7     9</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8     8    14</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9     9    10</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10    10     2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11    11     1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12    12     3</span></span></code></pre></div>
</div>
<p>Looking at the result of this code, a problem is immediately apparent. The number of letters per month is as expected, but the months are returned as numbers, which is less than ideal. However, by looking at the documentation for lubridate by typing <code>?month()</code> into the console, it is possible to see that what needs to be done is to change the label argument to TRUE from the default of false.</p>
<div class="cell">
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_month</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>month <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">date</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">month</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_month</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 12 × 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    month count</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;ord&gt; &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Jan      11</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Feb      14</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Mar      18</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Apr       9</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 May      14</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Jun       9</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Jul       9</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Aug      14</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Sep      10</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Oct       2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 11 Nov       1</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 12 Dec       3</span></span></code></pre></div>
</div>
<p>Now that we have the data in a good form we can plot it by making another bar chart.</p>
<div class="cell">
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_month</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">month</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">count</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, stat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1585</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters sent"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/excel-vs-r/index_files/figure-html/per-month-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The graph shows a peak in March of 1585 when Antwerp was in an extremely vulnerable position and it was more important than ever that it receive military and monetary assistance from the rebels in Holland. Another peak is reached in August when Antwerp surrendered, forcing Daniel and his family members to go into exile. The letters declined beginning in October, when Daniel left Holland to live in exile with his family in Bremen.</p>
<p>As a fun aside, it is also possible to see what day of the week the letters were sent. Luckily, the data comes from 1585, three years after the creation of <a href="http://en.wikipedia.org/wiki/Gregorian_calendar">Gregorian Calendar</a>, and the areas from which the letters were sent had already transitioned to the new calendar. This means that they were using the same calendar as we do now, as opposed to a place like England, which only adopted the Gregorian Calendar in 1752. Therefore, we do not have to worry about adding 10 days to move from the old calendar to the new calendar.</p>
<div class="cell">
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_wday</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>wday <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">date</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">wday</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">per_wday</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 7 × 2</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   wday  count</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;ord&gt; &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 Sun       7</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2 Mon      16</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3 Tue      20</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4 Wed      16</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5 Thu      22</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 6 Fri      16</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 7 Sat      17</span></span></code></pre></div>
</div>
<p>We can even create the chart using the original <code>letters</code> data frame and call the <code><a href="https://lubridate.tidyverse.org/reference/day.html">wday()</a></code> function within the definition of the x variable.</p>
<div class="cell">
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">date</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1585</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters sent"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/excel-vs-r/index_files/figure-html/per-wday-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, let’s see who sent Daniel letters on Sundays. We can use the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function, which returns rows that match a certain argument. The below code uses the knowledge that without labels, Sunday is equivalent to 1. The code is also written in a slightly different style. Even though only a single function is called, <code>%&gt;%</code> is used to pipe the data frame into the function, which cleans up the function call slightly.</p>
<div class="cell">
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">date</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 7 × 4</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   writer                  source  destination date      </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;chr&gt;                   &lt;chr&gt;   &lt;chr&gt;       &lt;date&gt;    </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 Della Faille, Jacques   Haarlem Delft       1585-02-10</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2 Meulen, Andries van der Antwerp Delft       1585-03-31</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3 Meulen, Andries van der Antwerp Delft       1585-04-28</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4 Della Faille, Jacques   Haarlem Delft       1585-05-12</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5 Wale, Jan de            Venice  Haarlem     1585-06-23</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 6 Della Faille, Jacques   Haarlem Delft       1585-08-18</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 7 Della Faille, Jacques   Haarlem Delft       1585-09-08</span></span></code></pre></div>
</div>
</section><section id="combining-data-for-correspondents-and-dates" class="level2"><h2 class="anchored" data-anchor-id="combining-data-for-correspondents-and-dates">Combining data for correspondents and dates</h2>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> workflow developed so far results in data frames with two columns and thus only tells us about one variable from the data at a time. We can get a better understanding of Daniel’s network by looking into how many letters each writer sent per month, which would involve the creation of a data frame with three columns. One advantage of using code is that it is often relatively simple to take a functioning line of code and tweak it to create a different result. Here, I take the line of code that produced <code>per_month</code> and alter it by adding the writer variable to the <code>group_by</code> function. Now the code will group the letters written by each correspondent per month and then count them. Notice how the dimensions of the resulting data frame has changed.</p>
<div class="cell">
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">correspondent_month</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">letters</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>month <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">date</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">writer</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">month</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">count</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; `summarise()` has grouped output by 'writer'. You can override using the</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; `.groups` argument.</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">correspondent_month</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 34 × 3</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Groups:   writer [12]</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    writer                  month count</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;chr&gt;                   &lt;ord&gt; &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1 Meulen, Andries van der Mar      12</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2 Meulen, Andries van der Jan      10</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3 Meulen, Andries van der Feb       9</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4 Meulen, Andries van der Jul       8</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5 Della Faille, Jacques   Aug       7</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6 Della Faille, Jacques   Sep       7</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7 Meulen, Andries van der Apr       7</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8 Meulen, Andries van der May       7</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9 Della Faille, Jacques   May       5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10 Meulen, Andries van der Jun       5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # … with 24 more rows</span></span></code></pre></div>
</div>
<p>With this new object called <code>correspondent_month</code> it is possible to add to the bar chart on letters per month, by filling in the bars with letters per correspondent in each month. The only difference in the code below from the earlier chart is the inclusion of <code>fill = writer</code> in <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> and then giving it a label in <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">correspondent_month</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">month</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">count</span>, fill <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">writer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, stat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1585</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters sent"</span>, fill <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correspondents"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/excel-vs-r/index_files/figure-html/correspondent-month-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A bar graph is only one of many different geoms made available through <code>ggplot</code>, so let me finish by using the same information to produce a line graph with points showing the amount of letters each correspondent sent in a month. The structure of the command is slightly different here, because I place the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> function in the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function. This is done because the same aesthetics will be used by both <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code>. In the <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> function I increase the size of all of the points so that they are more clearly visible. The <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> function adds a new aesthetic for group, which tells the function how to connect the lines.</p>
<div class="cell" data-fig.asp="0.75">
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">correspondent_month</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">month</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">count</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">writer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>group <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">writer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1585</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Letters sent"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correspondents"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://www.jessesadler.com/post/excel-vs-r/index_files/figure-html/line-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These two graphs provide different ways to visualize the data. Both give a clearer picture of the development of Daniel’s correspondence over the course of 1585. Up until September, Andries was Daniel’s most signifiant correspondent. After the fall of Antwerp, the two lived together in Bremen, forestalling any need to communicate by correspondence. On the other hand, in the second half of the year, Daniel’s correspondence picked up with his brother-in-law, Jacques.</p>
</section><section id="conclusion" class="level2"><h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The examples above only display a small fraction of the analysis and visualization capabilities of R. More fully developed visualizations with a larger set of the data used here can be seen on the <a href="https://www.jessesadler.com/project/">the Projects page of this website</a>, including an <a href="https://jessesadler.shinyapps.io/dvdm-correspondence/">interactive map of the letters that can be filtered by date</a>. Going from no coding experience to the production of visualizations in R is by no means easy, though there is an ever-growing set of resources designed to make the process as easy as possible. This post is part of my attempt to add to these resources from the perspective of a historian. In future posts I will build on the foundation provided here. In particular, the above analysis did not take advantage of the geographic nature of the data. I will discuss the process of geocoding the data and mapping it in an upcoming post.</p>


</section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>This post concentrates on the basic aspects of data analysis and visualization using the popular <a href="http://dplyr.tidyverse.org">dplyr</a> and <a href="http://ggplot2.tidyverse.org">ggplot</a> packages for R. In future posts, I will discuss more aspects of R.↩︎</p></li>
<li id="fn2"><p><a href="https://simplystatistics.org/2016/02/12/not-so-standard-deviations-episode-9-spreadsheet-drama/">Episode 9 of the Not So Standard Deviations podcast</a> has a good discussion of Excel vs R, which helped me think through my own thoughts on this subject.↩︎</p></li>
<li id="fn3"><p>My workflow is to enter data into Numbers, export it into a csv file, and then analyze with R. I have found data entry directly into csv too clunky, and so spreadsheets still have a place in my life.↩︎</p></li>
<li id="fn4"><p>There are a variety of different data types in R, but in this post I will concentrate on tabular data, or data frames, because that is the form of data derived from spreadsheet and most used within the humanities and social sciences.↩︎</p></li>
<li id="fn5"><p>See the explanation and examples below on how objects in R are created and manipulated.↩︎</p></li>
<li id="fn6"><p>This was the position that I was in only a couple of months ago.↩︎</p></li>
<li id="fn7"><p>If you are interested in learning how to use R, two good places to start are <a href="http://r4ds.had.co.nz">Garrett Grolemund and Hadley Wickham, <em>R for Data Science</em></a> and <a href="https://bookdown.org/rdpeng/rprogdatascience/">Roger Peng, <em>R Programming for Data Science</em></a>. Both are available for free and cover the topics that I discuss here in much greater detail.↩︎</p></li>
<li id="fn8"><p>Do not worry about the <code>[1]</code> in the printed output. This merely informs us that this is the first number in the object <code>x</code>. Behind the scenes in R <code>x</code> is not simply a number but a vector of numbers of length one.↩︎</p></li>
<li id="fn9"><p>A common frustration when learning to code is how persnickety computers are about typos and grammar. If a command does not work, it is likely because there is a typo somewhere.↩︎</p></li>
<li id="fn10"><p>If you want to know how a function works or what arguments are necessary to run the function, you can always access a function’s documentation with <code>?function_name()</code>. The documentation for many functions tend to be jargon heavy, but most also contain examples of how to use the function.↩︎</p></li>
<li id="fn11"><p>The best resource for learning about these <code>dplyr</code> functions is Chapter 5 of <a href="http://r4ds.had.co.nz/transform.html">Grolemund and Wickham, <em>R for Data Science</em></a>.↩︎</p></li>
<li id="fn12"><p>There are many resources on learning <code>ggplot</code>. Chapter 3 of <a href="http://r4ds.had.co.nz/data-visualisation.html">Grolemund and Wickham, <em>R for Data Science</em></a> is a good place to start. Another invaluable resource for ggplot that is still under development is <a href="http://socviz.co/">Kieran Healy’s <em>Data Visualization for Social Science</em></a>↩︎</p></li>
<li id="fn13"><p>Remember that a data frame is essentially a table. To be more precise, in this case, the <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> function produces a <a href="http://tibble.tidyverse.org">tibble</a>, which is a special kind of data frame.↩︎</p></li>
<li id="fn14"><p>One advantage of tibbles over default data frames is that tibbles are smart about printing out a subset of the data to the console instead of all of the content. The latter approach becomes messy when data frames have hundreds or thousands of rows.↩︎</p></li>
<li id="fn15"><p>RStudio comes with its own viewer, enabling you to view the contents of data frames in a manner that replicates the experience of a spreadsheet.↩︎</p></li>
</ol></section></div> ]]></description>
  <category>rstats</category>
  <category>digitalhumanities</category>
  <category>tidyverse</category>
  <guid>https://www.jessesadler.com/post/excel-vs-r/</guid>
  <pubDate>Mon, 02 Oct 2017 04:00:00 GMT</pubDate>
  <media:content url="https://www.jessesadler.com/post/excel-vs-r/correspondent_month.png" medium="image" type="image/png" height="123" width="144"/>
</item>
<item>
  <title>My Approach to Digital Humanities</title>
  <link>https://www.jessesadler.com/post/my-approach-to-dh/</link>
  <description><![CDATA[ 




<p>Digital humanities holds the promise of increasing the means by which scholars are able to analyze and present data. Though some sentiments about the significance of digital humanities might be overblown, there is no doubt that <a href="http://dh-r.lincolnmullen.com/introduction.html">the more ways we have to analyze sources the better</a>. Learning a variety of the tools that make up the rather nebulous universe of digital humanities is like learning a new language. It opens up new possibilities that were previously closed or necessitated the expertise of others. This frames digital humanities as a collection of skills rather than a means to a predetermined end. I have adopted this perspective in learning about the possibilities opened by digital humanities and working on a <a href="https://jessesadler.com/project/dvdm-correspondence/">digital humanities project</a>. I am hardly the first person to take these steps, but I hope that by explaining my thought process I can set a basis for future posts on digital humanities.</p>
<p>If there has been one guiding force in my approach to digital humanities, it is to learn skills and tools in the process of production. In a way, this is simply the application of critical thinking to how I create my scholarly work. Instead of doing things in what seems the de facto manner, I have sought to question if there is either a more efficient way or a way in which I could gain or improve my competency. The goal of efficiency was particularly significant in thinking about how to organize my research and writing <a href="https://jessesadler.com/post/thinking-about-workflow/">(DH 1.0)</a>, while learning new skills has been more important in the production of digital humanities projects <a href="https://jessesadler.com/post/new-kinds-of-projects/">(DH 2.0)</a>. This may not be the easiest way to complete a project in the short run, but by doing things the hard way, I am looking to open up new opportunities for future projects. With this theoretical approach in mind, let me now discuss a few concrete principles of my digital humanities practices concerning text, applications, and producing digital humanities projects.</p>
<p>At the basis of all my research is the use of <a href="https://en.wikipedia.org/wiki/Plain_text">plain text</a>, which I usually write in <a href="https://daringfireball.net/projects/markdown/">Markdown</a>. All of my research notes are in plain text, and I wrote drafts for over half of my dissertation in plain text. Writing in plain text has a number of advantages — which I will discuss in a future post — but an unexpected benefit is that writing Markdown changed my approach to text in a way that gave me a solid basis to tackle HTML, CSS, and even coding.<sup>1</sup> In addition, Markdown is ubiquitous on the web. This blog post is written in Markdown, and I have made <a href="https://jessesadler.shinyapps.io/dvdm-correspondence/">interactive visualizations</a> with <a href="http://rmarkdown.rstudio.com">R Markdown</a>, an extension of Markdown for R.</p>
<p>Of course, plain text by itself only gets you so far. The power of text has to be harnessed by applications. A major turning point for me in the efficiency and power of my research workflow was the realization that investment in apps, in terms of both money and time, could provide long-term benefits. Using free apps is definitely nice, but if you consider how many hours you spend in an app that plays a significant role in your workflow, the investment is usually worth it. I have come to have real enjoyment in using certain apps. I also think that is is worth while to take some time to learn how to use each app efficiently and even to learn some history about them. There is nothing worse than adapting to a new app only to learn that it is no longer under development. Though there are exceptions, many of my most essential apps have long histories and a solid base of users that points towards continued development.<sup>2</sup></p>
<p>In terms of the tools and choices I have made in the production of digital humanities projects, I have almost always chosen in favor of more control and customization over plug-and-play options. This goal is often in parallel with choosing to use open standards — with plain text being the ultimate open standard — and <a href="https://en.wikipedia.org/wiki/Open-source_software">open-source software</a>, which for me has come to include the use of programming languages such as <a href="https://www.r-project.org">R</a>. Complete control and knowledge is certainly not possible, at least not for me, but more control goes along with my goal of learning by doing. This website is a simple example of this approach. I was never going to be able to make this website by hand, but instead of using perfectly good ready-made solutions such as <a href="https://www.squarespace.com">Squarespace</a> or <a href="https://wordpress.com">Wordpress</a>, I decided to make a static website using <a href="https://gohugo.io">Hugo</a>. Plug-and-play approaches may satisfy the visualization aspect of digital humanities, but they often do little to improve your skills, or at least they are not extendable in the same way that coding skills are. When faced with a decision about how do something for a digital humanities project, I often see an easy way and a more complex route. My approach has been to choose the more complex route. This way is often not overly difficult if you know what to do, but I usually do not have that knowledge, and so the process is slow and arduous. However, the goal is that in completing the task I learn a new set of skills or improve those I already had, making it possible for me to use them in future contexts.</p>




<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Markdown is essentially a simpler way to write HTML. It is very approachable, but it still has the basic structure of all markup languages or code in the need to properly structure the markup. If something goes wrong, it is almost always because you mistyped something.↩︎</p></li>
<li id="fn2"><p>I use a number of apps from the <a href="https://www.omnigroup.com">Omni Group</a>, which began writing apps for <a href="https://en.wikipedia.org/wiki/NeXT">NeXT</a>, and <a href="http://www.barebones.com/products/bbedit/">BBEdit</a>, which has been actively developed for the Mac since 1992.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>digitalhumanities</category>
  <guid>https://www.jessesadler.com/post/my-approach-to-dh/</guid>
  <pubDate>Fri, 18 Aug 2017 04:00:00 GMT</pubDate>
</item>
<item>
  <title>New kinds of Projects: DH 2.0 and Coding</title>
  <link>https://www.jessesadler.com/post/new-kinds-of-projects/</link>
  <description><![CDATA[ 




<p>In the process of learning about how I could use digital technologies to better organize my research, I quickly started to think about how I might extend these skills to produce new kinds of outputs.<sup>1</sup> I was familiar with the concept of digital humanities, but the step from an internal process of organizing research and writing to production seemed both too nebulous and difficult. Digital humanities also seemed to concentrate on the visual. This was intriguing, but did not present itself as the most pressing need for a graduate student who was writing a dissertation on sibling relations among 16th-century merchants. It took years for me to move from what I am calling DH 1.0 to DH 2.0, to move from research methodology to making what could properly be termed digital humanities projects. This post presents an introduction to how I eventually took this step and why I decided to learn to code instead of other available solutions.<sup>2</sup></p>
<p>In reading tech websites and listening to tech podcasts I inevitably came into contact with the question of how to learn to program. A refrain that I heard over and over was that it was best to have a project in mind. Programming, I was told, is not an abstract entity, but something that one does to complete a set of specific tasks. In one sense this advice was encouraging. I had a possible digital humanities project in mind. I wanted to map a correspondence network of the letters found in the <a href="https://www.erfgoedleiden.nl/collecties/archieven/archievenoverzicht/ead/index/zoekterm/meulen/eadid/0096">archive of Daniel van der Meulen</a>. The archive contains approximately 6,600 letters that Daniel received from 1578 to 1600. A chapter of my dissertation analyzes the collection, but the work was all done by hand in spreadsheets. When it came time to visualize the data, I was not able to find the time or energy to do more than make rather simplistic maps on a website and creating some graphs with Numbers. This sufficed for the purposes of the dissertation, but it did not bring me any closer to digital humanities. Alongside the issue of time, I simply did not know what a solution could look like with more sophisticated tools much less with code. Working with data in code seemed interesting and powerful, but I had difficulty moving beyond my naive ideas about coding and digital humanities where there appeared endless possibilities but concrete steps were mysterious and nebulous.<sup>3</sup></p>
<p>At the <a href="http://historians.org">American Historical Association’s</a> annual meeting in Denver in January of this year I was inspired by a number panels on the use of digital humanities in History, especially by <a href="http://www.colorado.edu/history/henry-lovejoy">Henry Lovejoy’s</a> <a href="http://www.liberatedafricans.org">Liberated Africans Project</a> and <a href="https://cla.auburn.edu/history/people/faculty/kate-craig/">Kate Craig’s</a> discussion of using digital humanities in the classroom.<sup>4</sup> These panels motivated me to finally take the initiative to learn more about the tools of digital humanities and think about how I could create a project analyzing and visualizing the correspondence network of Daniel van der Meulen. I started by gathering together information on digital humanities in general. I found a plethora of sources such as <a href="https://www.historians.org/teaching-and-learning/digital-history-resources">AHA’s Digital History Resources</a>, <a href="http://dhresourcesforprojectbuilding.pbworks.com/w/page/69244243/FrontPage">DH Toychest</a>, <a href="http://digitalhumanitiesnow.org">Digital Humanities Now</a>, and <a href="http://programminghistorian.org">The Programming Historian</a>. Most helpful in the early going was reading through <a href="https://www.scribd.com/document/345432425/Introduction-to-Digital-Humanities-Johanna-Drucker">Johanna Drucker’s <em>Introduction to Digital Humanities Course Book: Concepts, Methods, and Tutorials for Students and Instructors</em></a>. This book is based on the Digital Humanities 101 course at UCLA and covers topics from HTML to textual analysis. Most interesting for me were the sections on networks and GIS or Geographical Information Systems.</p>
<p>My initial research gave me a starting point, but now I actually had to choose a path forward and decide on a tool or set of tools to create the project. I began by playing around with <a href="https://public.tableau.com">Tableau Public</a> and <a href="http://hdlab.stanford.edu/palladio/">Palladio</a>. Both provide more or less ready-made visualizations of spreadsheet data, the former as a desktop application and the latter as a web app. Both were interesting, but they lacked in terms of customization and did little to help me learn about producing visuals. I also tested out <a href="https://gephi.org">Gephi</a>, an open-source application for the visualization of networks. I went through <a href="http://www.martingrandjean.ch">Martin Grandjean’s</a> very helpful <a href="http://www.martingrandjean.ch/gephi-introduction/">Introduction to Network Analysis and Visualization</a>. However, because my project was aimed at producing a geographic representation of a network, I gravitated towards <a href="http://gisgeography.com/mapping-out-gis-software-landscape/">GIS tools</a>. Initially, I was interested in <a href="http://www.qgis.org">QGIS</a>, an open-source GIS application popular among geographers, but I also kept thinking of the possibility of doing something completely different and trying to do the project with code. Having no experience with programming or code, I remained hesitant, but a couple of resources showed me that what I wanted to do was possible through code.</p>
<p>In getting a sense of digital humanities and digital history I came across the work of <a href="http://lincolnmullen.com">Lincoln Mullen</a>, a historian at George Mason. Lincoln has authored a number of digital history projects using the <a href="https://www.r-project.org">programming language R</a>. R was made by statisticians, but over the twenty years of its existence it has developed into a programming language fully capable of both data analysis and visualization. I read the Introduction to <a href="http://dh-r.lincolnmullen.com">Lincoln Mullen’s <em>Computational Historical Thinking: With Applications in R</em></a>. The book is very much a work in progress, but the introduction was enough to convince me that I could accomplish my goals with R. Further exploring resources on R, I came across <a href="http://www.springer.com/us/book/9783319207018">Taylor Arnold and Lauren Tilton’s <em>Humanities Data in R: Exploring Networks, Geospatial Data, Images, and Text</em></a>.<sup>5</sup> This book put all my reservations about learning to code and the possibilities of using R to rest. I was convinced that I needed to dive all the way in and learn R. I knew that it would not be the easiest way to produce a visualization of a correspondence network, but I also began to realize the actual potential of code.</p>




<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>For more on how I got interested in digital technologies see the below post <a href="https://jessesadler.com/post/thinking-about-workflow/">Thinking about Workflow: DH 1.0</a>↩︎</p></li>
<li id="fn2"><p>In this post I am using both coding and programming in a colloquial manner. By both terms I simply mean the creation of computer code to analyze and visualize data.↩︎</p></li>
<li id="fn3"><p>Taking a Digital Humanities course at UCLA was obviously an option, but, at least at the time, enrolling in a class never seemed particularly practical in the middle of writing my dissertation.↩︎</p></li>
<li id="fn4"><p>Both are former colleagues at UCLA.↩︎</p></li>
<li id="fn5"><p>You may be able to download a free copy of <em>Humanities Data in R</em> through your university.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>digitalhumanities</category>
  <guid>https://www.jessesadler.com/post/new-kinds-of-projects/</guid>
  <pubDate>Wed, 16 Aug 2017 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Thinking about Workflow: DH 1.0</title>
  <link>https://www.jessesadler.com/post/thinking-about-workflow/</link>
  <description><![CDATA[ 




<p>In the spring of 2011, I was in the middle of doing research for my dissertation. I had recently returned from my second extended trip to the archives in the Netherlands and Belgium and had accumulated a ton of notes. I knew that technology had drastically altered the possibilities for research, but the fundamentals of my own workflow were hardly different than they had been when I began undergrad in the early 2000s. Sure, I used the internet to watch Netflix, but the basic tools—centered on the Microsoft Office Suite—were essentially the same. One day, I gave in to the nagging feeling that I was not getting enough out of my computer, that there were better ways of doing things. I started to poke around the internet to see if I could find ways to improve my workflow. What started as a distraction soon turned into a months-long project on finding better tools for conducting research. I quickly realized that the actual process of getting work done, doing research and writing papers, is little discussed in graduate school. Early career graduate students are so busy reading, writing, and generally trying to keep up, that the process of how to do the work is easily pushed to the background. Since then, I have tried to think critically and systematically about my workflow and have often discussed this with others.</p>
<p>My desire to embark upon a technological odyssey was driven by a very simple problem that developed naturally in the course of research for my dissertation. My primary research involved reading 16th-century correspondence. I used a simple—and I think somewhat commonsensical—approach to taking notes. For each correspondent in the archive, I would create a new Word document and do my best to paraphrase what was said in the letter. As time went by, these Word documents became quite long. After a month of taking notes on the letters of one correspondent, my Word document reached 100 pages single-spaced. At this point, writing in the document became unbearable. It would take almost a minute for the document to fully load. I would sit there and look at the bottom of the window and see the page count go up: 10 pages, then 15 pages, then 17 pages for a document I knew to be over 100 pages long. Scrolling through the document was difficult, and I had no real way to find anything in the middle of the document other than manually scrolling to where I thought it might be; search was a disaster.<sup>1</sup> My solution at the time was simply to open up another Word document and continue typing. This solution was neither practical nor scalable.</p>
<p>When I finally decided to do something about this issue, it did not take much searching to come up with the solution: text files. I knew that my Mac came with a program called TextEdit, but I had never thought to use it. I began to copy and past some of my longer notes from word into TextEdit. Upon opening the files, I saw to my amazement that they were completely functional in under a second. One hundred page documents opened in a flash.</p>
<p>This simple change away from Word to text documents opened up a world of possibilities. It caused me to pause and think. If this way of taking notes was so much better and so simple, why did I not know about it. What else was I missing? It took a while and a lot of trial and error before I found a system that worked for me. I first moved to rich text files, before turning to plain text. But I had begun the process. Plain text proved to be the basis for my research workflow and for what I am calling DH 1.0. Even more significant than the particular solution that I developed was thinking critically about my workflow. I began to read articles and listen to podcasts about technology and Apple. I started to use an RSS reader to subscribe to blogs. And I joined <a href="http://twitter.com/vivalosburros">Twitter</a>. You can obviously go too far in thinking about how to get things done to the point that it distracts you from doing the actual work, but that does not mean it is not worth the time and effort to think through how you do things. One of my goals in this blog and in future posts is to discuss the system that I developed based on plain text files and why I think it is better.</p>




<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This was with Word 2009. I do not know if new versions are better. I haven’t tried.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>digitalhumanities</category>
  <guid>https://www.jessesadler.com/post/thinking-about-workflow/</guid>
  <pubDate>Thu, 22 Jun 2017 04:00:00 GMT</pubDate>
</item>
<item>
  <title>By Way of Introduction</title>
  <link>https://www.jessesadler.com/post/by-way-of-introduction/</link>
  <description><![CDATA[ 




<p>In this introductory post I want to lay out the reasons for the creation of this website, to discuss some content that I will be looking to create, and to set some goals for the site. First though, I should first introduce myself. I am a historian of early modern Europe. My research investigates merchant families and the social basis of trade, politics, and religion. Specifically, I have worked in the archives of the Van der Meulens and Della Failles, two merchant families from Antwerp involved in European-wide trade at the end of the sixteenth century. I am currently working on a manuscript that argues for the significance of sibling relationships and inheritance in the development of early modern capitalism. In addition, I am working on some <a href="http://www.cdh.ucla.edu">digital humanities</a> projects using the two archives.</p>
<p>There is no need to justify creating a website in 2017, nevertheless I want to put forward the specific reasons that led me to create this site. Fundamentally, this website provides a space for me to showcase <a href="https://jessesadler.com/project/">projects</a> either digital or traditional, <a href="https://jessesadler.com/course/">syllabi for courses</a> that I have taught, and a place to link to <a href="https://jessesadler.com/page/cv/">my cv</a> for anyone interested. However, the actual impetus for creating this website is that I have been developing a few digital humanities projects that I want to both discuss and display. The creation of the website itself has also been a digital—if not necessarily digital humanities—project in itself. Instead of using a more ready-made solution such as <a href="https://www.squarespace.com">SquareSpace</a> or <a href="https://wordpress.com">WordPress</a>, this website is a <a href="https://davidwalsh.name/introduction-static-site-generators">static site</a>, which means that it is composed of <a href="http://jamstack.org">HTML, CSS, and JavaScript</a>, and all of the content is produced in <a href="https://daringfireball.net/projects/markdown/">Markdown documents</a>. I am using the static site generator <a href="http://gohugo.io">Hugo</a> to build the site and am deploying it through <a href="http://netlify.com">Netlify</a>. This process enabled me to learn more about these technologies and have greater control over the process and content. You can view all of the components of the raw website on my <a href="https://github.com/jessesadler/jessesadler/">GitHub page</a>.</p>
<p>Concerning, the actual content of this blog, I envision the posts falling into two general categories. In the first place, the blog will be a space for me to discuss the various projects that I am working on, both traditional history projects and those in digital humanities. Emphasis will be on the latter, since it was in the course of working on digital projects that I created this site. Secondly, I want to use the blog to discuss my own process and reasons for learning some of the skills of digital humanities. I want to document what I have done, and hopefully in doing so, I can provide useful information to others looking into the field of digital humanities. I should say that I use Apple products for all of my computing, and so my posts will be centered on macOS and iOS.</p>
<p>I am planning on writing two main series of posts about my path in digital humanities, pointing towards strategies and resources that I have found useful. I am calling these series DH 1.0 and DH 2.0. The differences between the two are both personal and technical. What I am labelling DH 1.0 is a series of strategies that I developed while in graduate school to optimize the way that I conduct research and turn that research into written work. This mainly involved taking advantage of various GUI applications to make my research notes and writing process more organized and readily searchable. DH 2.0 will discuss the second step that I have more recently taken to produce the digital humanities projects that will be shown on the site, including going through the creation of the website itself. The skills of DH 2.0 build on those I developed in DH 1.0, but instead of GUI applications, I have moved to the use of code to analyze data and produce visualizations. I will discuss the challenges and advantages I have found in moving to what is for me a very new way of thinking. For now, you can see the fruits of my ongoing digital humanities project on the <a href="https://jessesadler.com/project/dvdm-correspondence/">correspondence network of Daniel van der Meulen</a> on the <a href="https://jessesadler.com/project/">Projects</a> page of the website.</p>



 ]]></description>
  <guid>https://www.jessesadler.com/post/by-way-of-introduction/</guid>
  <pubDate>Tue, 06 Jun 2017 04:00:00 GMT</pubDate>
</item>
</channel>
</rss>
